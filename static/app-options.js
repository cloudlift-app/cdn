!function(){function t(t){return t&&t.__esModule?t.default:t}class e{static merge(t,i,o){for(let n in i)!i.hasOwnProperty(n)||null!=o&&-1===o.indexOf(n)||("[object Object]"===Object.prototype.toString.call(i[n])?t[n]=e.merge(t[n],i[n]):void 0!==i[n]&&(t[n]=i[n]));return t}static extend(){let t={},i=function(i){for(let o in i)i.hasOwnProperty(o)&&("[object Object]"===Object.prototype.toString.call(i[o])?t[o]=e.extend(t[o],i[o]):void 0!==i[o]&&(t[o]=i[o]))};for(let t=0;t<arguments.length;t++){i(arguments[t])}return t}static deepCopy(t,e){if(!e||0===e.length)return JSON.parse(JSON.stringify(t));const i=e.map((t=>t instanceof RegExp?t:new RegExp("^"+t.replace(/\*/g,".*")+"$"))),o=Object.keys(t).filter((t=>!(t=>i.some((e=>e.test(t))))(t))).reduce(((e,i)=>(e[i]=t[i],e)),{});return JSON.parse(JSON.stringify(o))}static isElement(t){return"object"==typeof t&&void 0!==t.nodeType}static isNodeList(t){let i=Object.prototype.toString.call(t),o="object"==typeof t&&/^\[object (HTMLCollection|NodeList|RadioNodeList|Object)\]$/.test(i)&&"number"==typeof t.length&&(0===t.length||"object"==typeof t[0]&&t[0].nodeType>0);return!o&&Array.isArray(t)&&t.length>0?e.isElement(t[0]):o}static isInPage(t){return t!==document.body&&document.body.contains(t)}static isHidden(t){return 0===t.offsetHeight||0===t.offsetWidth||null===t.offsetParent||"none"===window.getComputedStyle(t).display||1===t.offsetHeight&&1===t.offsetWidth}static isMinSize(t,e=1,i=1){const o=t.getBoundingClientRect();return!(o.width>e||o.height>e)}static isScrolledIntoView(t){let e=t.getBoundingClientRect(),i=e.top,o=e.bottom;return i>=0&&o<=window.innerHeight}static matches(t,e){return Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(t){for(var e=(this.document||this.ownerDocument).querySelectorAll(t),i=e.length;--i>=0&&e.item(i)!==this;);return i>-1}),t.matches(e)}static matchesIncludeParent(t,i){return!(!t||!e.matches(t,i)&&null==e.findParent(t,i))}static findParent(t,i){if("function"==typeof t.closest)return t.closest(i)||null;for(;t;){if(e.matches(t,i))return t;t=t.parentElement}return null}static findInnerDimensions(t){let e=getComputedStyle(t),i=t.clientWidth,o=t.clientHeight;return o-=parseFloat(e.paddingTop)+parseFloat(e.paddingBottom),i-=parseFloat(e.paddingLeft)+parseFloat(e.paddingRight),{height:o,width:i}}static getCalculatedPosition(t){const e=document.body,i=document.documentElement,o=window.pageYOffset||i.scrollTop||e.scrollTop,n=window.pageXOffset||i.scrollLeft||e.scrollLeft,r=t.getBoundingClientRect();return{top:r.top+o,left:r.left+n,right:r.left+n+r.width,bottom:r.top+o+r.height}}static findElementContainsText(t,i,o=document){return e.findElementContainsRegex(t,new RegExp(i),o)}static findElementContainsRegex(t,e,i=document){let o=i.querySelectorAll(t);return Array.prototype.filter.call(o,(function(t){return e.test(t.textContent)}))}static escapeRegex(t){return t.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}static readCookie(t){t+="=";for(let e=document.cookie.split(/;\s*/),i=e.length-1;i>=0;i--)if(!e[i].indexOf(t))return e[i].replace(t,"")}static writeCookie(t,e,i,o="/"){let n=new Date;n.setDate(n.getDate()+i);let r=null==i?"":"; expires="+n.toUTCString();document.cookie=encodeURIComponent(t)+"="+encodeURIComponent(e)+r+(o?"; path="+o:"")+";"}static removeCookie(t,e="/"){document.cookie=t+"=; Path="+e+"; Expires=Thu, 01 Jan 1970 00:00:01 GMT;"}static addStyleElement(t,e){e&&"head"!=e||(e=document.head||document.getElementsByTagName("head")[0]);let i=document.createElement("style");return i.appendChild(document.createTextNode(t)),e.appendChild(i),i}static addScriptElement(t,e){e&&"head"!=e||(e=document.head||document.getElementsByTagName("head")[0]);let i=document.createElement("script");return i.appendChild(document.createTextNode(t)),e.appendChild(i),i}static objectKeys(t){if(!Object.keys){let e,i=[];for(e in t)Object.prototype.hasOwnProperty.call(t,e)&&i.push(e);return i}return Object.keys(t)}static hasQueryParam(t,e){return-1!==t.indexOf(e)}static getQueryParam(t,e){let i=new RegExp("[?&]"+e+"=([^&#]*)","i").exec(t);return i?decodeURIComponent(i[1]):null}static getQueryParams(t){let e={},i=document.createElement("a");i.href=t;let o=i.search.substring(1).split("&");for(let t=0;t<o.length;t++){let i=o[t].split("=");e[i[0]]=decodeURIComponent(i[1])}return e}static buildQueryParams(t){return Object.keys(t).map((e=>encodeURIComponent(e)+"="+encodeURIComponent(t[e]))).join("&")}static debounced(t,e){let i;return function(...o){i&&clearTimeout(i),i=setTimeout((()=>{e(...o),i=null}),t)}}static throttled(t,e){let i=0;return function(...o){const n=(new Date).getTime();if(!(n-i<t))return i=n,e(...o)}}static decodeHtml(t){const e=document.createElement("textarea");return e.innerHTML=t,e.value}static pathBaseName(t,e=!0){let i=t.split("/").pop();return e||(i=i.substring(0,i.lastIndexOf("."))),i}static getAgent(){return navigator.userAgent||navigator.vendor||window.opera}static isInApp(t){return t.indexOf("FBAN")>-1||t.indexOf("FBAV")>-1||t.indexOf("Instagram")>-1}static isFacebook(t){return t.indexOf("FBAN")>-1||t.indexOf("FBAV")>-1}static isInstagram(t){return t.indexOf("Instagram")>-1}static isIOS(t){return(t=t.toLowerCase()).indexOf("iphone")>-1||t.indexOf("ipad")>-1}static isAndroid(t){return(t=t.toLowerCase()).indexOf("android")>-1}static isMobile(t){return this.isAndroid(t)||this.isIOS(t)}static getImageSize(t){return new Promise(((e,i)=>{const o=new Image;o.onload=()=>{e({width:o.width,height:o.height})},o.onerror=i,o.src=t}))}static convertSizeToUnit(t,e,n){let r=t.width/e,s=t.height/e;switch(n){case"mm":return{width:Number((r*i*10).toFixed(2)),height:Number((s*i*10).toFixed(2))};case"cm":return{width:Number((r*i).toFixed(2)),height:Number((s*i).toFixed(2))};case"m":return{width:Number((r*i/100).toFixed(2)),height:Number((s*i/100).toFixed(2))};case"inch":return{width:Number(r.toFixed(2)),height:Number(s.toFixed(2))};case"feet":return{width:Number((r/o).toFixed(2)),height:Number((s/o).toFixed(2))}}return null}}const i=2.54,o=12;var n=e;var r=class{supports(){return"XMLHttpRequest"in window&&"JSON"in window&&"Promise"in window}parse(t){let e;if("text"!==this.settings.responseType&&""!==this.settings.responseType){let e=t.response;if("json"===this.settings.responseType&&"string"==typeof e)try{e=JSON.parse(e)}catch(t){}return{data:e,xhr:t}}try{e=JSON.parse(t.responseText)}catch(i){e=t.responseText}return{data:e,xhr:t}}param(t){if("string"==typeof t||"[object FormData]"===Object.prototype.toString.call(t)||"[object File]"===Object.prototype.toString.call(t)||"[object Blob]"===Object.prototype.toString.call(t))return t;if(/application\/json/i.test(this.settings.headers["Content-type"])||"[object Array]"===Object.prototype.toString.call(t))return JSON.stringify(t);let e=[];for(let i in t)t.hasOwnProperty(i)&&e.push(encodeURIComponent(i)+"="+encodeURIComponent(t[i]));return e.join("&")}addQueryParams(t){if(this.settings.queryParams){let e=[];for(let t in this.settings.queryParams)this.settings.queryParams.hasOwnProperty(t)&&e.push(t+"="+this.settings.queryParams[t]);if(e.length>0){let i=e.join("&");return-1===t.indexOf("?")?t+"?"+i:t+"&"+i}}return t}xhr(t){const e=new XMLHttpRequest,i=new Promise(((i,o)=>{e.onreadystatechange=()=>{if(4!==e.readyState)return;let t=this.parse(e);e.status>=200&&e.status<300?i(t):o(t)},t=this.addQueryParams(t),e.open(this.settings.method,t,!0,this.settings.username,this.settings.password),e.responseType=this.settings.responseType;for(let t in this.settings.headers)this.settings.headers.hasOwnProperty(t)&&e.setRequestHeader(t,this.settings.headers[t]);this.settings.timeout&&(e.timeout=this.settings.timeout,e.ontimeout=t=>{o({status:408,statusText:"Request timeout"})}),this.settings.withCredentials&&(e.withCredentials=!0),this.settings.onProgress&&(e.upload.onprogress=this.settings.onProgress),e.send(this.param(this.settings.data))}));return i.cancel=()=>{e.abort()},i}constructor(t,e){if(!this.supports())throw"This browser is not supported";return this.settings=n.extend({method:"GET",username:null,password:null,data:{},queryParams:{},headers:{},responseType:"text",timeout:null,withCredentials:!1,onProgress:null},e||{}),this.xhr(t)}},s={};!function(t,e){"use strict";"function"==typeof define&&define.amd?define(e):s?s=e():t.log=e()}(s,(function(){"use strict";var t=function(){},e="undefined",i=typeof window!==e&&typeof window.navigator!==e&&/Trident\/|MSIE /.test(window.navigator.userAgent),o=["trace","debug","info","warn","error"];function n(t,e){var i=t[e];if("function"==typeof i.bind)return i.bind(t);try{return Function.prototype.bind.call(i,t)}catch(e){return function(){return Function.prototype.apply.apply(i,[t,arguments])}}}function r(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function s(e,i){for(var n=0;n<o.length;n++){var r=o[n];this[r]=n<e?t:this.methodFactory(r,e,i)}this.log=this.debug}function a(t,i,o){return function(){typeof console!==e&&(s.call(this,i,o),this[t].apply(this,arguments))}}function l(o,s,l){return function(o){return"debug"===o&&(o="log"),typeof console!==e&&("trace"===o&&i?r:void 0!==console[o]?n(console,o):void 0!==console.log?n(console,"log"):t)}(o)||a.apply(this,arguments)}function c(t,i,n){var r,a=this;i=null==i?"WARN":i;var c="loglevel";function p(){var t;if(typeof window!==e&&c){try{t=window.localStorage[c]}catch(t){}if(typeof t===e)try{var i=window.document.cookie,o=i.indexOf(encodeURIComponent(c)+"=");-1!==o&&(t=/^([^;]+)/.exec(i.slice(o))[1])}catch(t){}return void 0===a.levels[t]&&(t=void 0),t}}"string"==typeof t?c+=":"+t:"symbol"==typeof t&&(c=void 0),a.name=t,a.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},a.methodFactory=n||l,a.getLevel=function(){return r},a.setLevel=function(i,n){if("string"==typeof i&&void 0!==a.levels[i.toUpperCase()]&&(i=a.levels[i.toUpperCase()]),!("number"==typeof i&&i>=0&&i<=a.levels.SILENT))throw"log.setLevel() called with invalid level: "+i;if(r=i,!1!==n&&function(t){var i=(o[t]||"silent").toUpperCase();if(typeof window!==e&&c){try{return void(window.localStorage[c]=i)}catch(t){}try{window.document.cookie=encodeURIComponent(c)+"="+i+";"}catch(t){}}}(i),s.call(a,i,t),typeof console===e&&i<a.levels.SILENT)return"No console available for logging"},a.setDefaultLevel=function(t){i=t,p()||a.setLevel(t,!1)},a.resetLevel=function(){a.setLevel(i,!1),function(){if(typeof window!==e&&c){try{return void window.localStorage.removeItem(c)}catch(t){}try{window.document.cookie=encodeURIComponent(c)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch(t){}}}()},a.enableAll=function(t){a.setLevel(a.levels.TRACE,t)},a.disableAll=function(t){a.setLevel(a.levels.SILENT,t)};var d=p();null==d&&(d=i),a.setLevel(d,!1)}var p=new c,d={};p.getLogger=function(t){if("symbol"!=typeof t&&"string"!=typeof t||""===t)throw new TypeError("You must supply a name when creating a logger.");var e=d[t];return e||(e=d[t]=new c(t,p.getLevel(),p.methodFactory)),e};var h=typeof window!==e?window.log:void 0;return p.noConflict=function(){return typeof window!==e&&window.log===p&&(window.log=h),p},p.getLoggers=function(){return d},p.default=p,p}));class a{static get(t,e,i){let o=a.translations[t]||i||t;if(e)for(let t in e)e.hasOwnProperty(t)&&(o=o.replace(new RegExp("{"+t+"}","g"),e[t]));return o}static translate(t,e){if(t&&"string"==typeof t){if("#"===t.charAt(0))return a.get(t.substr(1).trim(),e);if(-1!==t.indexOf("#{")){let i=t;for(;-1!==i.indexOf("#{");){let t=i.indexOf("#{"),o=i.indexOf("}",t),n=i.substring(t+2,o),r=a.get(n,e);i=i.replace("#{"+n+"}",r)}return i}}return t}static fetch(t){let e=a.api.replace("{locale}",t),i=new r(e,{method:"GET"});return a.ready=i.then((t=>(s.debug("[translate] "+e+" response",t.data),a.update(t.data),a.translations))).catch((t=>(s.error("[translate] "+e+" error",t),a.translations))),a.ready}static update(t){a.translations=n.extend(a.translations,t),a.updated()}static updated(){const t=new CustomEvent(a.event,{detail:{},cancelable:!0,bubbles:!0});window.dispatchEvent(t)}static onUpdated(t){window.addEventListener(a.event,t)}}a.locale=window.Shopify&&window.Shopify.locale?window.Shopify.locale:document.documentElement.lang,a.translations={},a.ready=Promise.resolve(!0),a.event="cloudlift.translate",a.api="";var l=a,c={};!function(){function t(t,e,i){return t.call.apply(t.bind,arguments)}function e(t,e,i){if(!t)throw Error();if(2<arguments.length){var o=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,o),t.apply(e,i)}}return function(){return t.apply(e,arguments)}}function i(o,n,r){return(i=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?t:e).apply(null,arguments)}var o=Date.now||function(){return+new Date};function n(t,e){this.a=t,this.o=e||t,this.c=this.o.document}var r=!!window.FontFace;function s(t,e,i,o){if(e=t.c.createElement(e),i)for(var n in i)i.hasOwnProperty(n)&&("style"==n?e.style.cssText=i[n]:e.setAttribute(n,i[n]));return o&&e.appendChild(t.c.createTextNode(o)),e}function a(t,e,i){(t=t.c.getElementsByTagName(e)[0])||(t=document.documentElement),t.insertBefore(i,t.lastChild)}function l(t){t.parentNode&&t.parentNode.removeChild(t)}function p(t,e,i){e=e||[],i=i||[];for(var o=t.className.split(/\s+/),n=0;n<e.length;n+=1){for(var r=!1,s=0;s<o.length;s+=1)if(e[n]===o[s]){r=!0;break}r||o.push(e[n])}for(e=[],n=0;n<o.length;n+=1){for(r=!1,s=0;s<i.length;s+=1)if(o[n]===i[s]){r=!0;break}r||e.push(o[n])}t.className=e.join(" ").replace(/\s+/g," ").replace(/^\s+|\s+$/,"")}function d(t,e){for(var i=t.className.split(/\s+/),o=0,n=i.length;o<n;o++)if(i[o]==e)return!0;return!1}function h(t,e,i){function o(){p&&n&&l&&(p(c),p=null)}e=s(t,"link",{rel:"stylesheet",href:e,media:"all"});var n=!1,l=!0,c=null,p=i||null;r?(e.onload=function(){n=!0,o()},e.onerror=function(){n=!0,c=Error("Stylesheet failed to load"),o()}):setTimeout((function(){n=!0,o()}),0),a(t,"head",e)}function u(t,e,i,o){var n=t.c.getElementsByTagName("head")[0];if(n){var r=s(t,"script",{src:e}),a=!1;return r.onload=r.onreadystatechange=function(){a||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(a=!0,i&&i(null),r.onload=r.onreadystatechange=null,"HEAD"==r.parentNode.tagName&&n.removeChild(r))},n.appendChild(r),setTimeout((function(){a||(a=!0,i&&i(Error("Script load timeout")))}),o||5e3),r}return null}function m(){this.a=0,this.c=null}function g(t){return t.a++,function(){t.a--,v(t)}}function f(t,e){t.c=e,v(t)}function v(t){0==t.a&&t.c&&(t.c(),t.c=null)}function y(t){this.a=t||"-"}function _(t,e){this.c=t,this.f=4,this.a="n";var i=(e||"n4").match(/^([nio])([1-9])$/i);i&&(this.a=i[1],this.f=parseInt(i[2],10))}function w(t){var e=[];t=t.split(/,\s*/);for(var i=0;i<t.length;i++){var o=t[i].replace(/['"]/g,"");-1!=o.indexOf(" ")||/^\d/.test(o)?e.push("'"+o+"'"):e.push(o)}return e.join(",")}function b(t){return t.a+t.f}function x(t){var e="normal";return"o"===t.a?e="oblique":"i"===t.a&&(e="italic"),e}function C(t){var e=4,i="n",o=null;return t&&((o=t.match(/(normal|oblique|italic)/i))&&o[1]&&(i=o[1].substr(0,1).toLowerCase()),(o=t.match(/([1-9]00|normal|bold)/i))&&o[1]&&(/bold/i.test(o[1])?e=7:/[1-9]00/.test(o[1])&&(e=parseInt(o[1].substr(0,1),10)))),i+e}function E(t,e){this.c=t,this.f=t.o.document.documentElement,this.h=e,this.a=new y("-"),this.j=!1!==e.events,this.g=!1!==e.classes}function I(t){if(t.g){var e=d(t.f,t.a.c("wf","active")),i=[],o=[t.a.c("wf","loading")];e||i.push(t.a.c("wf","inactive")),p(t.f,i,o)}S(t,"inactive")}function S(t,e,i){t.j&&t.h[e]&&(i?t.h[e](i.c,b(i)):t.h[e]())}function O(){this.c={}}function L(t,e){this.c=t,this.f=e,this.a=s(this.c,"span",{"aria-hidden":"true"},this.f)}function P(t){a(t.c,"body",t.a)}function M(t){return"display:block;position:absolute;top:-9999px;left:-9999px;font-size:300px;width:auto;height:auto;line-height:normal;margin:0;padding:0;font-variant:normal;white-space:nowrap;font-family:"+w(t.c)+";font-style:"+x(t)+";font-weight:"+t.f+"00;"}function $(t,e,i,o,n,r){this.g=t,this.j=e,this.a=o,this.c=i,this.f=n||3e3,this.h=r||void 0}function k(t,e,i,o,n,r,s){this.v=t,this.B=e,this.c=i,this.a=o,this.s=s||"BESbswy",this.f={},this.w=n||3e3,this.u=r||null,this.m=this.j=this.h=this.g=null,this.g=new L(this.c,this.s),this.h=new L(this.c,this.s),this.j=new L(this.c,this.s),this.m=new L(this.c,this.s),t=M(t=new _(this.a.c+",serif",b(this.a))),this.g.a.style.cssText=t,t=M(t=new _(this.a.c+",sans-serif",b(this.a))),this.h.a.style.cssText=t,t=M(t=new _("serif",b(this.a))),this.j.a.style.cssText=t,t=M(t=new _("sans-serif",b(this.a))),this.m.a.style.cssText=t,P(this.g),P(this.h),P(this.j),P(this.m)}y.prototype.c=function(t){for(var e=[],i=0;i<arguments.length;i++)e.push(arguments[i].replace(/[\W_]+/g,"").toLowerCase());return e.join(this.a)},$.prototype.start=function(){var t=this.c.o.document,e=this,i=o(),n=new Promise((function(n,r){!function s(){o()-i>=e.f?r():t.fonts.load(function(t){return x(t)+" "+t.f+"00 300px "+w(t.c)}(e.a),e.h).then((function(t){1<=t.length?n():setTimeout(s,25)}),(function(){r()}))}()})),r=null,s=new Promise((function(t,i){r=setTimeout(i,e.f)}));Promise.race([s,n]).then((function(){r&&(clearTimeout(r),r=null),e.g(e.a)}),(function(){e.j(e.a)}))};var T={D:"serif",C:"sans-serif"},A=null;function F(){if(null===A){var t=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent);A=!!t&&(536>parseInt(t[1],10)||536===parseInt(t[1],10)&&11>=parseInt(t[2],10))}return A}function N(t,e,i){for(var o in T)if(T.hasOwnProperty(o)&&e===t.f[T[o]]&&i===t.f[T[o]])return!0;return!1}function D(t){var e,n=t.g.a.offsetWidth,r=t.h.a.offsetWidth;(e=n===t.f.serif&&r===t.f["sans-serif"])||(e=F()&&N(t,n,r)),e?o()-t.A>=t.w?F()&&N(t,n,r)&&(null===t.u||t.u.hasOwnProperty(t.a.c))?V(t,t.v):V(t,t.B):function(t){setTimeout(i((function(){D(this)}),t),50)}(t):V(t,t.v)}function V(t,e){setTimeout(i((function(){l(this.g.a),l(this.h.a),l(this.j.a),l(this.m.a),e(this.a)}),t),0)}function R(t,e,i){this.c=t,this.a=e,this.f=0,this.m=this.j=!1,this.s=i}k.prototype.start=function(){this.f.serif=this.j.a.offsetWidth,this.f["sans-serif"]=this.m.a.offsetWidth,this.A=o(),D(this)};var j=null;function H(t){0==--t.f&&t.j&&(t.m?((t=t.a).g&&p(t.f,[t.a.c("wf","active")],[t.a.c("wf","loading"),t.a.c("wf","inactive")]),S(t,"active")):I(t.a))}function z(t){this.j=t,this.a=new O,this.h=0,this.f=this.g=!0}function B(t,e,o,n,r){var s=0==--t.h;(t.f||t.g)&&setTimeout((function(){var t=r||null,a=n||{};if(0===o.length&&s)I(e.a);else{e.f+=o.length,s&&(e.j=s);var l,c=[];for(l=0;l<o.length;l++){var d=o[l],h=a[d.c],u=e.a,m=d;if(u.g&&p(u.f,[u.a.c("wf",m.c,b(m).toString(),"loading")]),S(u,"fontloading",m),u=null,null===j)if(window.FontFace){m=/Gecko.*Firefox\/(\d+)/.exec(window.navigator.userAgent);var g=/OS X.*Version\/10\..*Safari/.exec(window.navigator.userAgent)&&/Apple/.exec(window.navigator.vendor);j=m?42<parseInt(m[1],10):!g}else j=!1;u=j?new $(i(e.g,e),i(e.h,e),e.c,d,e.s,h):new k(i(e.g,e),i(e.h,e),e.c,d,e.s,t,h),c.push(u)}for(l=0;l<c.length;l++)c[l].start()}}),0)}function q(t,e){this.c=t,this.a=e}function U(t,e){this.c=t,this.a=e}function W(t,e){this.c=t||G,this.a=[],this.f=[],this.g=e||""}R.prototype.g=function(t){var e=this.a;e.g&&p(e.f,[e.a.c("wf",t.c,b(t).toString(),"active")],[e.a.c("wf",t.c,b(t).toString(),"loading"),e.a.c("wf",t.c,b(t).toString(),"inactive")]),S(e,"fontactive",t),this.m=!0,H(this)},R.prototype.h=function(t){var e=this.a;if(e.g){var i=d(e.f,e.a.c("wf",t.c,b(t).toString(),"active")),o=[],n=[e.a.c("wf",t.c,b(t).toString(),"loading")];i||o.push(e.a.c("wf",t.c,b(t).toString(),"inactive")),p(e.f,o,n)}S(e,"fontinactive",t),H(this)},z.prototype.load=function(t){this.c=new n(this.j,t.context||this.j),this.g=!1!==t.events,this.f=!1!==t.classes,function(t,e,i){var o=[],n=i.timeout;!function(t){t.g&&p(t.f,[t.a.c("wf","loading")]),S(t,"loading")}(e);o=function(t,e,i){var o,n=[];for(o in e)if(e.hasOwnProperty(o)){var r=t.c[o];r&&n.push(r(e[o],i))}return n}(t.a,i,t.c);var r=new R(t.c,e,n);for(t.h=o.length,e=0,i=o.length;e<i;e++)o[e].load((function(e,i,o){B(t,r,e,i,o)}))}(this,new E(this.c,t),t)},q.prototype.load=function(t){function e(){if(r["__mti_fntLst"+o]){var i,n=r["__mti_fntLst"+o](),s=[];if(n)for(var a=0;a<n.length;a++){var l=n[a].fontfamily;null!=n[a].fontStyle&&null!=n[a].fontWeight?(i=n[a].fontStyle+n[a].fontWeight,s.push(new _(l,i))):s.push(new _(l))}t(s)}else setTimeout((function(){e()}),50)}var i=this,o=i.a.projectId,n=i.a.version;if(o){var r=i.c.o;u(this.c,(i.a.api||"https://fast.fonts.net/jsapi")+"/"+o+".js"+(n?"?v="+n:""),(function(n){n?t([]):(r["__MonotypeConfiguration__"+o]=function(){return i.a},e())})).id="__MonotypeAPIScript__"+o}else t([])},U.prototype.load=function(t){var e,i,o=this.a.urls||[],n=this.a.families||[],r=this.a.testStrings||{},s=new m;for(e=0,i=o.length;e<i;e++)h(this.c,o[e],g(s));var a=[];for(e=0,i=n.length;e<i;e++)if((o=n[e].split(":"))[1])for(var l=o[1].split(","),c=0;c<l.length;c+=1)a.push(new _(o[0],l[c]));else a.push(new _(o[0]));f(s,(function(){t(a,r)}))};var G="https://fonts.googleapis.com/css";function Y(t){this.f=t,this.a=[],this.c={}}var X={latin:"BESbswy","latin-ext":"çöüğş",cyrillic:"йяЖ",greek:"αβΣ",khmer:"កខគ",Hanuman:"កខគ"},Q={thin:"1",extralight:"2","extra-light":"2",ultralight:"2","ultra-light":"2",light:"3",regular:"4",book:"4",medium:"5","semi-bold":"6",semibold:"6","demi-bold":"6",demibold:"6",bold:"7","extra-bold":"8",extrabold:"8","ultra-bold":"8",ultrabold:"8",black:"9",heavy:"9",l:"3",r:"4",b:"7"},Z={i:"i",italic:"i",n:"n",normal:"n"},J=/^(thin|(?:(?:extra|ultra)-?)?light|regular|book|medium|(?:(?:semi|demi|extra|ultra)-?)?bold|black|heavy|l|r|b|[1-9]00)?(n|i|normal|italic)?$/;function K(t,e){this.c=t,this.a=e}var tt={Arimo:!0,Cousine:!0,Tinos:!0};function et(t,e){this.c=t,this.a=e}function it(t,e){this.c=t,this.f=e,this.a=[]}K.prototype.load=function(t){var e=new m,i=this.c,o=new W(this.a.api,this.a.text),n=this.a.families;!function(t,e){for(var i=e.length,o=0;o<i;o++){var n=e[o].split(":");3==n.length&&t.f.push(n.pop());var r="";2==n.length&&""!=n[1]&&(r=":"),t.a.push(n.join(r))}}(o,n);var r=new Y(n);!function(t){for(var e=t.f.length,i=0;i<e;i++){var o=t.f[i].split(":"),n=o[0].replace(/\+/g," "),r=["n4"];if(2<=o.length){var s;if(s=[],a=o[1])for(var a,l=(a=a.split(",")).length,c=0;c<l;c++){var p;if((p=a[c]).match(/^[\w-]+$/))if(null==(d=J.exec(p.toLowerCase())))p="";else{if(p=null==(p=d[2])||""==p?"n":Z[p],null==(d=d[1])||""==d)d="4";else var d=Q[d]||(isNaN(d)?"4":d.substr(0,1));p=[p,d].join("")}else p="";p&&s.push(p)}0<s.length&&(r=s),3==o.length&&(s=[],0<(o=(o=o[2])?o.split(","):s).length&&(o=X[o[0]])&&(t.c[n]=o))}for(t.c[n]||(o=X[n])&&(t.c[n]=o),o=0;o<r.length;o+=1)t.a.push(new _(n,r[o]))}}(r),h(i,function(t){if(0==t.a.length)throw Error("No fonts to load!");if(-1!=t.c.indexOf("kit="))return t.c;for(var e=t.a.length,i=[],o=0;o<e;o++)i.push(t.a[o].replace(/ /g,"+"));return e=t.c+"?family="+i.join("%7C"),0<t.f.length&&(e+="&subset="+t.f.join(",")),0<t.g.length&&(e+="&text="+encodeURIComponent(t.g)),e}(o),g(e)),f(e,(function(){t(r.a,r.c,tt)}))},et.prototype.load=function(t){var e=this.a.id,i=this.c.o;e?u(this.c,(this.a.api||"https://use.typekit.net")+"/"+e+".js",(function(e){if(e)t([]);else if(i.Typekit&&i.Typekit.config&&i.Typekit.config.fn){e=i.Typekit.config.fn;for(var o=[],n=0;n<e.length;n+=2)for(var r=e[n],s=e[n+1],a=0;a<s.length;a++)o.push(new _(r,s[a]));try{i.Typekit.load({events:!1,classes:!1,async:!0})}catch(t){}t(o)}}),2e3):t([])},it.prototype.load=function(t){var e=this.f.id,i=this.c.o,o=this;e?(i.__webfontfontdeckmodule__||(i.__webfontfontdeckmodule__={}),i.__webfontfontdeckmodule__[e]=function(e,i){for(var n=0,r=i.fonts.length;n<r;++n){var s=i.fonts[n];o.a.push(new _(s.name,C("font-weight:"+s.weight+";font-style:"+s.style)))}t(o.a)},u(this.c,(this.f.api||"https://f.fontdeck.com/s/css/js/")+function(t){return t.o.location.hostname||t.a.location.hostname}(this.c)+"/"+e+".js",(function(e){e&&t([])}))):t([])};var ot=new z(window);ot.a.c.custom=function(t,e){return new U(e,t)},ot.a.c.fontdeck=function(t,e){return new it(e,t)},ot.a.c.monotype=function(t,e){return new q(e,t)},ot.a.c.typekit=function(t,e){return new et(e,t)},ot.a.c.google=function(t,e){return new K(e,t)};var nt={load:i(ot.load,ot)};"function"==typeof define&&define.amd?define((function(){return nt})):c?c=nt:(window.WebFont=nt,window.WebFontConfig&&ot.load(window.WebFontConfig))}();class p{static getFont(t){for(let e of this.fonts)if(e.name===t)return e}static addFvd(t,e){return e+=":n4",t.files.italic&&(e+=",i4"),t.files.bold&&(e+=",n7"),t.files.bold_italic&&(e+=",i7"),e}static addGoogleFontStyle(t,e){let i=[];if(t.files.regular&&(t.files.regular_300?i.push("300"):i.push("400")),t.files.italic&&(t.files.italic_300?i.push("300italic"):i.push("italic")),t.files.bold&&i.push("bold"),t.files.bold_italic&&i.push("bolditalic"),i.length)return e+":"+i.join(",")}static loadFontsByName(t){let e=[],i=[];return null==this._loadQueue&&(this._loadQueue=Promise.resolve()),this._loadQueue=this._loadQueue.then((()=>{for(let o of t){let t=this.getFont(o);if(t&&!t.loaded)switch(t.type){case 0:t.loaded=!0;break;case 1:let n=this.addGoogleFontStyle(t,o);-1===i.indexOf(n)&&i.push(n);break;case 2:let r=this.addFvd(t,o);-1===e.indexOf(r)&&e.push(r)}}return e.length>0||i.length>0?this.loadFontsByFamilies(e,i):Promise.resolve(!0)})),this._loadQueue}static loadFontsByFamilies(t,e){return new Promise(((i,o)=>{const n={timeout:3e3};if(t&&t.length){let e=t.map((t=>t.substring(0,t.indexOf(":"))));n.custom={families:t,urls:[this.fontCss(e)]}}e&&e.length&&(n.google={families:e}),n.active=()=>{i()},n.inactive=()=>{i()},n.fontactive=(t,e)=>{let i=p.getFont(t);i?i.loaded=!0:p.fonts.push({name:t,loaded:!0})},n.fontinactive=(t,e)=>{let i=p.getFont(t);s.warn("[live-options] failed to load font",i),i.loaded=!0},c.load(n)}))}static fontPreview(t){let e=n.extend(p.apiParams,{name:t});return p.api+"/preview?"+n.buildQueryParams(e)}static fontCss(t){let e=n.extend(p.apiParams,{names:t.join(",")});return p.api+"/css?"+n.buildQueryParams(e)}}p.fonts=[],p.api="",p.apiParams={};var d=p;class h{static getInstance(t){return h._instance||(h._instance=new h(t)),h._instance}fakeProduct(t){this.isProduct=()=>!0,this.getHandleFromUrl=()=>t}isAdmin(){return null!=document.getElementById("admin_bar_iframe")}isProduct(){return-1!==window.location.pathname.indexOf("/products/")||this.isProductPreview()}isProductPreview(){return-1!==window.location.pathname.indexOf("/products_preview")}getDiscountUrl(t,e){return"/discount/"+t+(e?"?redirect="+e:"")}getDiscountCode(){return n.readCookie("discount_code")}saveDiscountCode(t){return n.writeCookie("discount_code",t,null,"/")}removeDiscountCode(){return n.removeCookie("discount_code")}getCustomerId(){return window.theme&&window.theme.customerId?window.theme.customerId:window.meta&&window.meta.page&&window.meta.page.customerId?window.meta.page.customerId:window.ShopifyAnalytics&&window.ShopifyAnalytics.meta&&window.ShopifyAnalytics.meta.page&&window.ShopifyAnalytics.meta.page.customerId?window.ShopifyAnalytics.meta.page.customerId:null}getHandleFromUrl(t=location.pathname){window.Shopify&&window.Shopify.routes&&window.Shopify.routes.root&&"/"!==window.Shopify.routes.root&&(t=t.replace(window.Shopify.routes.root,"/"));let e=t.replace(/\/$/,"").split("/"),i=("products"==e[e.length-2]||"products_preview"===e.pop())&&e[e.length-1].replace(/(.*)?\?.*$/,"$1");return decodeURIComponent(i).toLowerCase()}tryGetProduct(){return this.isProduct()?this.getProduct():new Promise(((t,e)=>{t(null)}))}async tryGetProductMap(){return this.isTheme("Dawn")&&await this.parseOfferJsonElements(),this.isProduct()&&await this.getProduct(),h.products}parseOfferJsonElements(){document.querySelectorAll('.featured-product form[id^="product_form_"]').forEach((t=>{t.setAttribute("id",t.getAttribute("id").replace("product_form_","product-form-installment-featured--")),s.debug("updated featured product form id: ",t,t.id)}));let t=document.querySelectorAll('script[type="application/ld+json"]'),e=[];if(t.length>0)for(let i=0;i<t.length;i++){let o=t[i];try{let t=JSON.parse(o.innerHTML);if(t.offers&&t.url){let i=this.getHandleFromUrl(t.url)+".js";h.products[i]||e.push(new Promise(((e,o)=>new r(t.url+".js",{method:"GET",responseType:"json"}).then((t=>{let o=t.data;h.products[i]=o,e(o)})).catch((i=>{s.error("failed to fetch product: ",t.url,i),e(null)})))))}}catch(t){s.debug("error parsing ProductOffer: ",o,t)}}return Promise.all(e)}parseProductJsonElements(){let t=document.querySelectorAll('[id^="ProductJson-"]');if(0===t.length&&(t=document.querySelectorAll('[data-product-json], [data-section-type="dynamic-featured-product"]')),t.length>0)for(let e=0;e<t.length;e++){let i=t[e];try{let t=JSON.parse(i.innerHTML);"object"==typeof t.product&&(t=t.product),t.handle&&t.variants?.length&&(h.products[t.handle.toLowerCase()+".js"]=this.convertProductJson(t))}catch(t){s.debug("error parsing ProductJson: ",i,t)}}}convertProductJson(t){if(t.options&&t.options.length&&"object"!=typeof t.options[0]){let e=[];for(let i=0;i<t.options.length;i++){let o={name:t.options[i],position:i+1,values:[]};for(let e=0;e<t.variants.length;e++){let i=t.variants[e]["option"+o.position];i&&-1===o.values.indexOf(i)&&o.values.push(i)}e.push(o)}t.options=e}return t.images&&t.images.length&&(t.images=t.images.map((t=>"object"==typeof t?t.src?t.src:t.url?t.url:t.sizes?.original?t.sizes.original:t:t))),t}getProduct(t,e="js"){if(!t&&!(t=this.getHandleFromUrl())&&this.isProductPreview())for(const t in h.products)if(h.products.hasOwnProperty(t))return new Promise(((e,i)=>{e(h.products[t])}));let i,o=t+"."+e;return h.products[o]?new Promise(((t,e)=>{t(h.products[o])})):!window.Shopify&&window._getProduct?window._getProduct(t).then((t=>{o=t.handle+"."+e,h.products[o]=t})).catch((t=>{throw t})):(t?i=this.settings.api+this.settings.path.products.replace("{handle}",t).replace("{view}",e):this.isProductPreview()&&(i=window.location.href.replace("products_preview","products_preview."+e)),new r(i,{method:"GET",responseType:"json"}).then((t=>{let i=t.data;return"json"===e&&(i=t.data.product),o=i.handle+"."+e,h.products[o]=i,i})).catch((t=>{throw t})))}isTheme(t){if(window.Shopify&&window.Shopify.theme){const e=window.Shopify.theme.theme_store_id;if("Dawn"===t&&(887===e||1368===e||1363===e||1356===e||1431===e||1434===e||1499===e||1500===e||1567===e||1864===e||1841===e||1891===e||2699===e))return!0;if("Horizon"===t&&customElements.get("fly-to-cart")&&customElements.get("dialog-component"))return!0;if("Expanse"===t&&902===e)return!0;if(window.Shopify.theme.name&&-1!==window.Shopify.theme.name.toLowerCase().indexOf(t.toLowerCase()))return!0}return!1}isThemeEditor(){return window.Shopify&&window.Shopify.designMode}onThemeSectionEvent(t,e){return document.addEventListener("shopify:section:"+t,e)}findProductForms(t=document){return t.querySelectorAll('form[action*="/cart/add"]')}findProductFormBestMatch(t,e){let i="#product_form_"+t,o=document.querySelector(i);if(o&&null!=o.querySelector("shopify-payment-terms")&&(o=null),o&&document.querySelector(`[data-product-form="${t}"]`)&&(o=null),o&&this.isProductFormInstallment(o)&&(o=null),o&&this.isTheme("Dawn")){let e=document.querySelector('[data-type="add-to-cart-form"]');e&&(e.dataset.productForm=t.toString(),o=null)}if(o&&e.srcEl&&e.srcEl.closest(".shopify-app-block")&&(o=null),!o){let i=null;if(e&&e.srcEl){let t=e.srcEl.parentNode;for(;t;){if(i=this.findProductForms(t),i.length){e.parentEl=t;break}t=t.parentNode}}if(null!=i&&0!==i.length||(i=this.findProductForms()),1===i.length)return i[0];if(i.length>1)for(let e=0;e<i.length;e++)if(!this.isProductFormInstallment(i[e])&&(o=i[e],o.dataset.productForm===t.toString()))return o}return o}isProductFormInstallment(t){let e=t.getAttribute("id");return!(!e||(e=e.toLowerCase(),-1===e.indexOf("installment")&&-1===e.indexOf("instalment")&&-1===e.indexOf("quick-add")&&-1===e.indexOf("complementary-")&&-1===t.className.indexOf("installment")&&-1===t.className.indexOf("instalment")&&null==t.querySelector("shopify-payment-terms")))}findProductFormVariantIdEl(t){if(null!=t){if(t.elements instanceof HTMLFormControlsCollection){let e=t.id;if(e)return e}let e=t.querySelectorAll('[name=id], [name="id[]"]');for(let t=0;t<e.length;t++){let i=e[t];if(null!=i&&i.value){if(e.length>1){let t=i.closest("form");if(t&&this.isProductFormInstallment(t))continue;if(i.disabled)continue}return i}}}return null}findProductFormVariantId(t,e){let i=this.findProductFormVariantIdEl(t);return!i&&e&&(i=this.findProductFormVariantIdEl(e)),i?i.value:null}onVariantIdChange(t,e){let i=this.findProductFormVariantIdEl(t);if(i)if(n.isNodeList(i))for(let t=0;t<i.length;t++){const o=i[t];o.addEventListener("change",(t=>e(t,o.value)))}else i.addEventListener("change",(t=>e(t,i.value))),this.isTheme("Horizon")&&t.addEventListener("variant:update",(t=>setTimeout((()=>e(t,i.value)))))}findProductFormQuantityEl(t,e){return null!=t?t.querySelector("[name=quantity]")||(e?e.querySelector("[name=quantity]"):null):null}findProductFormQuantity(t,e){let i=this.findProductFormQuantityEl(t,e);return null!=i?parseInt(i.value):1}getFormProperties(t){const e=new FormData(t);return Array.from(e.keys()).reduce(((t,i)=>{if(-1!==i.indexOf("properties")){let o=i.indexOf("["),n=i.indexOf("]");if(-1!==o&&-1!==n){let r=i.substring(o+1,n);if(t.hasOwnProperty(r)){let o=e.getAll(i);t[r]=o[o.length-1]}else t[r]=e.get(i)}}return t}),{})}findExpressPaymentButtons(t=document){return t.querySelectorAll('.shopify-payment-button, [data-shopify="payment-button"]')}findExpressDynamicCheckoutCart(t=document){return t.querySelectorAll('#dynamic-checkout-cart, [data-shopify="dynamic-checkout-cart"]')}isExpressPaymentButton(t){return n.matchesIncludeParent(t,'.shopify-payment-button, [data-shopify="payment-button"]')}onProductFormSubmit(t,e,i,o,r=["[data-live-validate]"]){let a="[type=submit],.add_to_cart,.add-to-cart,.product-addToCart,.addToCart,.addtocart-js";this.isTheme("Dawn")&&(a=a.replace("[type=submit]","[type=submit]:not(.quick-add__submit)"));let l=e.querySelectorAll(r.join(","));if(l.length&&(o=!1),!o){t.addEventListener("submit",i);let e=t.querySelectorAll(a);for(let t=0;t<e.length;t++){e[t].addEventListener("click",i)}let o=e.length,n=this.findExpressPaymentButtons(t);for(let t=0;t<n.length;t++){n[t].addEventListener("click",i,{capture:!0})}for(let t=0;t<l.length;t++){l[t].addEventListener("click",i,{capture:!0}),o=!0}return o||s.warn("[live-options] failed to find add to cart button"),o}{const t=a+',.shopify-payment-button, [data-shopify="payment-button"]';e.addEventListener("click",(e=>{e.target&&n.matchesIncludeParent(e.target,t)&&i(e)}),{capture:!0})}}onCartFormSubmit(t,e,i=["[data-live-checkout]"]){let o='form[action="/cart"], form[action$="/cart"], form[action*="/cart?"], form[action="/checkout"], form[action$="/checkout"], form[action*="/checkout?"]';if(i.push('a[href="/checkout"], a[href$="/checkout"], a[href*="/checkout?"], button[onclick*="/checkout"]'),e){document.addEventListener("submit",(e=>{e.target&&n.matches(e.target,o)&&t(e)}),{capture:!0});const e=i.join(",");document.addEventListener("click",(i=>{i.target&&(n.matches(i.target,e)||null!=n.findParent(i.target,e))&&t(i)}),{capture:!0})}else{let e=document.querySelectorAll(o);if(e.length)for(let i=0;i<e.length;i++){e[i].addEventListener("submit",(e=>{t(e)}))}let n=document.querySelectorAll(i.join(","));for(let e=0;e<n.length;e++){n[e].addEventListener("click",t,{capture:!0})}}}trimMoneyFormatAmount(t){let e=t.indexOf("{"),i=t.lastIndexOf("}");return-1!==e&&-1!==i&&(t=t.substring(e,i+1)),t.trim()}parseImageDimension(t){let e={x:0,y:0},i=/(\d*)x(\d*)/.exec(t);return i&&3===i.length&&(e.x=parseInt(i[1])||0,e.y=i[2]?parseInt(i[2]):e.x),e}stripImageDimension(t){let e=(t=t.replace(/_(\d*)x(\d*)/g,"")).lastIndexOf("@");-1!==e&&(t=t.substring(0,e));let i=t.lastIndexOf(".progressive");return-1!==i&&(t=t.substring(0,i)),t}constructor(t){this.settings=n.extend({api:"",path:{products:"/products/{handle}.{view}"}},t||{})}}h.products={},h.collections={};var u=h;class m{static getInstance(t){return m._instance||(m._instance=new m(t)),m._instance}getCart(t=!1){return t&&this.cache?Promise.resolve(this.cache):this._cart().then((t=>(this.cache=t,t)))}getItemLine(t,e){for(let i=0;i<t.items.length;i++){const o=t.items[i];if(e.key===o.key)return i+1}return-1}toItem(t,e,i){return{id:t,quantity:e,properties:i}}addItem(t){return this._cartAdd(t)}addItems(t,e){return this._cartAdd({items:t,attributes:e}).then((t=>t.items))}addItemFormData(t,e){const i=new FormData;if(i.append("id",t.id),i.append("quantity",t.quantity?t.quantity:1),i.append("utf8","✓"),i.append("form_type","product"),t.properties)for(let e in t.properties)t.properties.hasOwnProperty(e)&&i.append("properties["+e+"]",t.properties[e]);return new r("/cart/add.js",{method:"POST",responseType:"json",onProgress:e,data:i})}removeItem(t){return this.updateItem(t,this.toItem(null,0))}removeItemById(t){return this.updateItemById(this.toItem(t,0))}updateItem(t,e){return this._cartChange({line:t,quantity:e.quantity,properties:e.properties})}updateItemById(t){return this._cartChange(t)}updateItemQuantitiesById(t){return this._cartUpdate({updates:t})}setNote(t){return this._cartUpdate({note:t})}setAttributes(t){return this._cartUpdate({attributes:t})}clear(){return this._cartClear()}_cart(){return this._cartRequest("/cart.js",{method:"GET"})}_cartAdd(t){return this._cartRequest("/cart/add.js",{method:"POST",data:t})}_cartUpdate(t){return this._cartRequest("/cart/update.js",{method:"POST",data:t})}_cartChange(t){return this._cartRequest("/cart/change.js",{method:"POST",data:t})}_cartClear(){return this._cartRequest("/cart/clear.js",{method:"POST"})}_cartRequest(t,e){let i=n.extend(this.settings.requestOptions,e),o=this.settings.api+t;return new r(o,i).then((t=>(s.debug("[shopify-cart] "+o+" response",t.data),t.data))).catch((t=>{throw s.error("[shopify-cart] "+o+" error",t),t.data}))}constructor(t){this.cache=null,this.settings=n.extend({api:"",requestOptions:{responseType:"json",headers:{"Content-type":"application/json"}}},t||{})}}var g=m;class f{static register(t){return this.listeners.push(t),this.patched||this._patch(),()=>{let e=this.listeners.indexOf(t);-1!==e&&this.listeners.splice(e,1),0===this.listeners.length&&this._unpatch()}}static _callListeners(t){for(let e=0;e<f.listeners.length;e++){(0,f.listeners[e])(t)}}static _patch(){f.originalOpen=XMLHttpRequest.prototype.open,XMLHttpRequest.prototype.open=function(){let t=arguments[0],e=arguments[1];this.addEventListener("readystatechange",(function(){4==this.readyState&&200==this.status&&f._callListeners({method:t,url:e})}),!1),f.originalOpen.apply(this,arguments)},"function"==typeof window.fetch&&(f.originalFetch=window.fetch,window.fetch=function(){let t=arguments[0],e=void 0!==arguments[1]?arguments[1].method:"GET",i=f.originalFetch.apply(this,arguments);return i.then((()=>{"object"==typeof t&&(t.pathname?t=t.pathname+t.search:t.url&&(t=t.url)),f._callListeners({method:e,url:t})})),i}),this.patched=!0}static _unpatch(){f.originalOpen&&(XMLHttpRequest.prototype.open=f.originalOpen),f.originalFetch&&(window.fetch=f.originalFetch),this.patched=!1}}f.patched=!1,f.listeners=[];var v=f;
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const y=new WeakMap,_=t=>(...e)=>{const i=t(...e);return y.set(i,!0),i},w=t=>"function"==typeof t&&y.has(t),b="undefined"!=typeof window&&null!=window.customElements&&void 0!==window.customElements.polyfillWrapFlushCallback,x=(t,e,i=null,o=null)=>{for(;e!==i;){const i=e.nextSibling;t.insertBefore(e,o),e=i}},C=(t,e,i=null)=>{for(;e!==i;){const i=e.nextSibling;t.removeChild(e),e=i}},E={},I={},S=`{{lit-${String(Math.random()).slice(2)}}}`,O=`\x3c!--${S}--\x3e`,L=new RegExp(`${S}|${O}`),P="$lit$";class M{constructor(t,e){this.parts=[],this.element=e;const i=[],o=[],n=document.createTreeWalker(e.content,133,null,!1);let r=0,s=-1,a=0;const{strings:l,values:{length:c}}=t;for(;a<c;){const t=n.nextNode();if(null!==t){if(s++,1===t.nodeType){if(t.hasAttributes()){const e=t.attributes,{length:i}=e;let o=0;for(let t=0;t<i;t++)$(e[t].name,P)&&o++;for(;o-- >0;){const e=l[a],i=A.exec(e)[2],o=i.toLowerCase()+P,n=t.getAttribute(o);t.removeAttribute(o);const r=n.split(L);this.parts.push({type:"attribute",index:s,name:i,strings:r}),a+=r.length-1}}"TEMPLATE"===t.tagName&&(o.push(t),n.currentNode=t.content)}else if(3===t.nodeType){const e=t.data;if(e.indexOf(S)>=0){const o=t.parentNode,n=e.split(L),r=n.length-1;for(let e=0;e<r;e++){let i,r=n[e];if(""===r)i=T();else{const t=A.exec(r);null!==t&&$(t[2],P)&&(r=r.slice(0,t.index)+t[1]+t[2].slice(0,-P.length)+t[3]),i=document.createTextNode(r)}o.insertBefore(i,t),this.parts.push({type:"node",index:++s})}""===n[r]?(o.insertBefore(T(),t),i.push(t)):t.data=n[r],a+=r}}else if(8===t.nodeType)if(t.data===S){const e=t.parentNode;null!==t.previousSibling&&s!==r||(s++,e.insertBefore(T(),t)),r=s,this.parts.push({type:"node",index:s}),null===t.nextSibling?t.data="":(i.push(t),s--),a++}else{let e=-1;for(;-1!==(e=t.data.indexOf(S,e+1));)this.parts.push({type:"node",index:-1}),a++}}else n.currentNode=o.pop()}for(const t of i)t.parentNode.removeChild(t)}}const $=(t,e)=>{const i=t.length-e.length;return i>=0&&t.slice(i)===e},k=t=>-1!==t.index,T=()=>document.createComment(""),A=/([ \x09\x0a\x0c\x0d])([^\0-\x1F\x7F-\x9F "'>=/]+)([ \x09\x0a\x0c\x0d]*=[ \x09\x0a\x0c\x0d]*(?:[^ \x09\x0a\x0c\x0d"'`<>=]*|"[^"]*|'[^']*))$/;class F{update(t){let e=0;for(const i of this.__parts)void 0!==i&&i.setValue(t[e]),e++;for(const t of this.__parts)void 0!==t&&t.commit()}_clone(){const t=b?this.template.element.content.cloneNode(!0):document.importNode(this.template.element.content,!0),e=[],i=this.template.parts,o=document.createTreeWalker(t,133,null,!1);let n,r=0,s=0,a=o.nextNode();for(;r<i.length;)if(n=i[r],k(n)){for(;s<n.index;)s++,"TEMPLATE"===a.nodeName&&(e.push(a),o.currentNode=a.content),null===(a=o.nextNode())&&(o.currentNode=e.pop(),a=o.nextNode());if("node"===n.type){const t=this.processor.handleTextExpression(this.options);t.insertAfterNode(a.previousSibling),this.__parts.push(t)}else this.__parts.push(...this.processor.handleAttributeExpressions(a,n.name,n.strings,this.options));r++}else this.__parts.push(void 0),r++;return b&&(document.adoptNode(t),customElements.upgrade(t)),t}constructor(t,e,i){this.__parts=[],this.template=t,this.processor=e,this.options=i}}
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const N=window.trustedTypes&&trustedTypes.createPolicy("lit-html",{createHTML:t=>t}),D=` ${S} `;class V{getHTML(){const t=this.strings.length-1;let e="",i=!1;for(let o=0;o<t;o++){const t=this.strings[o],n=t.lastIndexOf("\x3c!--");i=(n>-1||i)&&-1===t.indexOf("--\x3e",n+1);const r=A.exec(t);e+=null===r?t+(i?D:O):t.substr(0,r.index)+r[1]+r[2]+P+r[3]+S}return e+=this.strings[t],e}getTemplateElement(){const t=document.createElement("template");let e=this.getHTML();return void 0!==N&&(e=N.createHTML(e)),t.innerHTML=e,t}constructor(t,e,i,o){this.strings=t,this.values=e,this.type=i,this.processor=o}}const R=t=>null===t||!("object"==typeof t||"function"==typeof t),j=t=>Array.isArray(t)||!(!t||!t[Symbol.iterator]);class H{_createPart(){return new z(this)}_getValue(){const t=this.strings,e=t.length-1,i=this.parts;if(1===e&&""===t[0]&&""===t[1]){const t=i[0].value;if("symbol"==typeof t)return String(t);if("string"==typeof t||!j(t))return t}let o="";for(let n=0;n<e;n++){o+=t[n];const e=i[n];if(void 0!==e){const t=e.value;if(R(t)||!j(t))o+="string"==typeof t?t:String(t);else for(const e of t)o+="string"==typeof e?e:String(e)}}return o+=t[e],o}commit(){this.dirty&&(this.dirty=!1,this.element.setAttribute(this.name,this._getValue()))}constructor(t,e,i){this.dirty=!0,this.element=t,this.name=e,this.strings=i,this.parts=[];for(let t=0;t<i.length-1;t++)this.parts[t]=this._createPart()}}class z{setValue(t){t===E||R(t)&&t===this.value||(this.value=t,w(t)||(this.committer.dirty=!0))}commit(){for(;w(this.value);){const t=this.value;this.value=E,t(this)}this.value!==E&&this.committer.commit()}constructor(t){this.value=void 0,this.committer=t}}class B{appendInto(t){this.startNode=t.appendChild(T()),this.endNode=t.appendChild(T())}insertAfterNode(t){this.startNode=t,this.endNode=t.nextSibling}appendIntoPart(t){t.__insert(this.startNode=T()),t.__insert(this.endNode=T())}insertAfterPart(t){t.__insert(this.startNode=T()),this.endNode=t.endNode,t.endNode=this.startNode}setValue(t){this.__pendingValue=t}commit(){if(null===this.startNode.parentNode)return;for(;w(this.__pendingValue);){const t=this.__pendingValue;this.__pendingValue=E,t(this)}const t=this.__pendingValue;t!==E&&(R(t)?t!==this.value&&this.__commitText(t):t instanceof V?this.__commitTemplateResult(t):t instanceof Node?this.__commitNode(t):j(t)?this.__commitIterable(t):t===I?(this.value=I,this.clear()):this.__commitText(t))}__insert(t){this.endNode.parentNode.insertBefore(t,this.endNode)}__commitNode(t){this.value!==t&&(this.clear(),this.__insert(t),this.value=t)}__commitText(t){const e=this.startNode.nextSibling,i="string"==typeof(t=null==t?"":t)?t:String(t);e===this.endNode.previousSibling&&3===e.nodeType?e.data=i:this.__commitNode(document.createTextNode(i)),this.value=t}__commitTemplateResult(t){const e=this.options.templateFactory(t);if(this.value instanceof F&&this.value.template===e)this.value.update(t.values);else{const i=new F(e,t.processor,this.options),o=i._clone();i.update(t.values),this.__commitNode(o),this.value=i}}__commitIterable(t){Array.isArray(this.value)||(this.value=[],this.clear());const e=this.value;let i,o=0;for(const n of t)i=e[o],void 0===i&&(i=new B(this.options),e.push(i),0===o?i.appendIntoPart(this):i.insertAfterPart(e[o-1])),i.setValue(n),i.commit(),o++;o<e.length&&(e.length=o,this.clear(i&&i.endNode))}clear(t=this.startNode){C(this.startNode.parentNode,t.nextSibling,this.endNode)}constructor(t){this.value=void 0,this.__pendingValue=void 0,this.options=t}}class q{setValue(t){this.__pendingValue=t}commit(){for(;w(this.__pendingValue);){const t=this.__pendingValue;this.__pendingValue=E,t(this)}if(this.__pendingValue===E)return;const t=!!this.__pendingValue;this.value!==t&&(t?this.element.setAttribute(this.name,""):this.element.removeAttribute(this.name),this.value=t),this.__pendingValue=E}constructor(t,e,i){if(this.value=void 0,this.__pendingValue=void 0,2!==i.length||""!==i[0]||""!==i[1])throw new Error("Boolean attributes can only contain a single expression");this.element=t,this.name=e,this.strings=i}}class U extends H{_createPart(){return new W(this)}_getValue(){return this.single?this.parts[0].value:super._getValue()}commit(){this.dirty&&(this.dirty=!1,this.element[this.name]=this._getValue())}constructor(t,e,i){super(t,e,i),this.single=2===i.length&&""===i[0]&&""===i[1]}}class W extends z{}let G=!1;(()=>{try{const t={get capture(){return G=!0,!1}};window.addEventListener("test",t,t),window.removeEventListener("test",t,t)}catch(t){}})();class Y{setValue(t){this.__pendingValue=t}commit(){for(;w(this.__pendingValue);){const t=this.__pendingValue;this.__pendingValue=E,t(this)}if(this.__pendingValue===E)return;const t=this.__pendingValue,e=this.value,i=null==t||null!=e&&(t.capture!==e.capture||t.once!==e.once||t.passive!==e.passive),o=null!=t&&(null==e||i);i&&this.element.removeEventListener(this.eventName,this.__boundHandleEvent,this.__options),o&&(this.__options=X(t),this.element.addEventListener(this.eventName,this.__boundHandleEvent,this.__options)),this.value=t,this.__pendingValue=E}handleEvent(t){"function"==typeof this.value?this.value.call(this.eventContext||this.element,t):this.value.handleEvent(t)}constructor(t,e,i){this.value=void 0,this.__pendingValue=void 0,this.element=t,this.eventName=e,this.eventContext=i,this.__boundHandleEvent=t=>this.handleEvent(t)}}const X=t=>t&&(G?{capture:t.capture,passive:t.passive,once:t.once}:t.capture);const Q=new class{handleAttributeExpressions(t,e,i,o){const n=e[0];if("."===n){return new U(t,e.slice(1),i).parts}if("@"===n)return[new Y(t,e.slice(1),o.eventContext)];if("?"===n)return[new q(t,e.slice(1),i)];return new H(t,e,i).parts}handleTextExpression(t){return new B(t)}};
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */function Z(t){let e=J.get(t.type);void 0===e&&(e={stringsArray:new WeakMap,keyString:new Map},J.set(t.type,e));let i=e.stringsArray.get(t.strings);if(void 0!==i)return i;const o=t.strings.join(S);return i=e.keyString.get(o),void 0===i&&(i=new M(t,t.getTemplateElement()),e.keyString.set(o,i)),e.stringsArray.set(t.strings,i),i}const J=new Map,K=new WeakMap,tt=(t,e,i)=>{let o=K.get(e);void 0===o&&(C(e,e.firstChild),K.set(e,o=new B(Object.assign({templateFactory:Z},i))),o.appendInto(e)),o.setValue(t),o.commit()};"undefined"!=typeof window&&(window.litHtmlVersions||(window.litHtmlVersions=[])).push("1.4.1");const et=(t,...e)=>new V(t,e,"html",Q);
/**!
* tippy.js v6.3.7
* (c) 2017-2021 atomiks
* MIT License
*/
function it(t){return t?(t.nodeName||"").toLowerCase():null}function ot(t){if(null==t)return window;if("[object Window]"!==t.toString()){var e=t.ownerDocument;return e&&e.defaultView||window}return t}function nt(t){return t instanceof ot(t).Element||t instanceof Element}function rt(t){return t instanceof ot(t).HTMLElement||t instanceof HTMLElement}function st(t){return"undefined"!=typeof ShadowRoot&&(t instanceof ot(t).ShadowRoot||t instanceof ShadowRoot)}var at={name:"applyStyles",enabled:!0,phase:"write",fn:function(t){var e=t.state;Object.keys(e.elements).forEach((function(t){var i=e.styles[t]||{},o=e.attributes[t]||{},n=e.elements[t];rt(n)&&it(n)&&(Object.assign(n.style,i),Object.keys(o).forEach((function(t){var e=o[t];!1===e?n.removeAttribute(t):n.setAttribute(t,!0===e?"":e)})))}))},effect:function(t){var e=t.state,i={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,i.popper),e.styles=i,e.elements.arrow&&Object.assign(e.elements.arrow.style,i.arrow),function(){Object.keys(e.elements).forEach((function(t){var o=e.elements[t],n=e.attributes[t]||{},r=Object.keys(e.styles.hasOwnProperty(t)?e.styles[t]:i[t]).reduce((function(t,e){return t[e]="",t}),{});rt(o)&&it(o)&&(Object.assign(o.style,r),Object.keys(n).forEach((function(t){o.removeAttribute(t)})))}))}},requires:["computeStyles"]},lt=Math.max,ct=Math.min,pt=Math.round;function dt(){var t=navigator.userAgentData;return null!=t&&t.brands?t.brands.map((function(t){return t.brand+"/"+t.version})).join(" "):navigator.userAgent}function ht(){return!/^((?!chrome|android).)*safari/i.test(dt())}function ut(t,e,i){void 0===e&&(e=!1),void 0===i&&(i=!1);var o=t.getBoundingClientRect(),n=1,r=1;e&&rt(t)&&(n=t.offsetWidth>0&&pt(o.width)/t.offsetWidth||1,r=t.offsetHeight>0&&pt(o.height)/t.offsetHeight||1);var s=(nt(t)?ot(t):window).visualViewport,a=!ht()&&i,l=(o.left+(a&&s?s.offsetLeft:0))/n,c=(o.top+(a&&s?s.offsetTop:0))/r,p=o.width/n,d=o.height/r;return{width:p,height:d,top:c,right:l+p,bottom:c+d,left:l,x:l,y:c}}function mt(t){var e=ot(t);return{scrollLeft:e.pageXOffset,scrollTop:e.pageYOffset}}function gt(t){return((nt(t)?t.ownerDocument:t.document)||window.document).documentElement}function ft(t){return ut(gt(t)).left+mt(t).scrollLeft}function vt(t){return ot(t).getComputedStyle(t)}function yt(t){var e=vt(t),i=e.overflow,o=e.overflowX,n=e.overflowY;return/auto|scroll|overlay|hidden/.test(i+n+o)}function _t(t,e,i){void 0===i&&(i=!1);var o,n,r=rt(e),s=rt(e)&&function(t){var e=t.getBoundingClientRect(),i=pt(e.width)/t.offsetWidth||1,o=pt(e.height)/t.offsetHeight||1;return 1!==i||1!==o}(e),a=gt(e),l=ut(t,s,i),c={scrollLeft:0,scrollTop:0},p={x:0,y:0};return(r||!r&&!i)&&(("body"!==it(e)||yt(a))&&(c=(o=e)!==ot(o)&&rt(o)?{scrollLeft:(n=o).scrollLeft,scrollTop:n.scrollTop}:mt(o)),rt(e)?((p=ut(e,!0)).x+=e.clientLeft,p.y+=e.clientTop):a&&(p.x=ft(a))),{x:l.left+c.scrollLeft-p.x,y:l.top+c.scrollTop-p.y,width:l.width,height:l.height}}function wt(t){var e=ut(t),i=t.offsetWidth,o=t.offsetHeight;return Math.abs(e.width-i)<=1&&(i=e.width),Math.abs(e.height-o)<=1&&(o=e.height),{x:t.offsetLeft,y:t.offsetTop,width:i,height:o}}function bt(t){return"html"===it(t)?t:t.assignedSlot||t.parentNode||(st(t)?t.host:null)||gt(t)}function xt(t){return["html","body","#document"].indexOf(it(t))>=0?t.ownerDocument.body:rt(t)&&yt(t)?t:xt(bt(t))}function Ct(t,e){var i;void 0===e&&(e=[]);var o=xt(t),n=o===(null==(i=t.ownerDocument)?void 0:i.body),r=ot(o),s=n?[r].concat(r.visualViewport||[],yt(o)?o:[]):o,a=e.concat(s);return n?a:a.concat(Ct(bt(s)))}function Et(t){return["table","td","th"].indexOf(it(t))>=0}function It(t){return rt(t)&&"fixed"!==vt(t).position?t.offsetParent:null}function St(t){for(var e=ot(t),i=It(t);i&&Et(i)&&"static"===vt(i).position;)i=It(i);return i&&("html"===it(i)||"body"===it(i)&&"static"===vt(i).position)?e:i||function(t){var e=/firefox/i.test(dt());if(/Trident/i.test(dt())&&rt(t)&&"fixed"===vt(t).position)return null;var i=bt(t);for(st(i)&&(i=i.host);rt(i)&&["html","body"].indexOf(it(i))<0;){var o=vt(i);if("none"!==o.transform||"none"!==o.perspective||"paint"===o.contain||-1!==["transform","perspective"].indexOf(o.willChange)||e&&"filter"===o.willChange||e&&o.filter&&"none"!==o.filter)return i;i=i.parentNode}return null}(t)||e}var Ot="top",Lt="bottom",Pt="right",Mt="left",$t="auto",kt=[Ot,Lt,Pt,Mt],Tt="start",At="end",Ft="clippingParents",Nt="viewport",Dt="popper",Vt="reference",Rt=kt.reduce((function(t,e){return t.concat([e+"-"+Tt,e+"-"+At])}),[]),jt=[].concat(kt,[$t]).reduce((function(t,e){return t.concat([e,e+"-"+Tt,e+"-"+At])}),[]),Ht=["beforeRead","read","afterRead","beforeMain","main","afterMain","beforeWrite","write","afterWrite"];function zt(t){var e=new Map,i=new Set,o=[];function n(t){i.add(t.name),[].concat(t.requires||[],t.requiresIfExists||[]).forEach((function(t){if(!i.has(t)){var o=e.get(t);o&&n(o)}})),o.push(t)}return t.forEach((function(t){e.set(t.name,t)})),t.forEach((function(t){i.has(t.name)||n(t)})),o}function Bt(t){var e=zt(t);return Ht.reduce((function(t,i){return t.concat(e.filter((function(t){return t.phase===i})))}),[])}function qt(t){var e=t.reduce((function(t,e){var i=t[e.name];return t[e.name]=i?Object.assign({},i,e,{options:Object.assign({},i.options,e.options),data:Object.assign({},i.data,e.data)}):e,t}),{});return Object.keys(e).map((function(t){return e[t]}))}var Ut={placement:"bottom",modifiers:[],strategy:"absolute"};function Wt(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return!e.some((function(t){return!(t&&"function"==typeof t.getBoundingClientRect)}))}function Gt(t){void 0===t&&(t={});var e=t,i=e.defaultModifiers,o=void 0===i?[]:i,n=e.defaultOptions,r=void 0===n?Ut:n;return function(t,e,i){void 0===i&&(i=r);var n,s,a={placement:"bottom",orderedModifiers:[],options:Object.assign({},Ut,r),modifiersData:{},elements:{reference:t,popper:e},attributes:{},styles:{}},l=[],c=!1,p={state:a,setOptions:function(i){var n="function"==typeof i?i(a.options):i;d(),a.options=Object.assign({},r,a.options,n),a.scrollParents={reference:nt(t)?Ct(t):t.contextElement?Ct(t.contextElement):[],popper:Ct(e)};var s=Bt(qt([].concat(o,a.options.modifiers)));return a.orderedModifiers=s.filter((function(t){return t.enabled})),a.orderedModifiers.forEach((function(t){var e=t.name,i=t.options,o=void 0===i?{}:i,n=t.effect;if("function"==typeof n){var r=n({state:a,name:e,instance:p,options:o}),s=function(){};l.push(r||s)}})),p.update()},forceUpdate:function(){if(!c){var t=a.elements,e=t.reference,i=t.popper;if(Wt(e,i)){a.rects={reference:_t(e,St(i),"fixed"===a.options.strategy),popper:wt(i)},a.reset=!1,a.placement=a.options.placement,a.orderedModifiers.forEach((function(t){return a.modifiersData[t.name]=Object.assign({},t.data)}));for(var o=0;o<a.orderedModifiers.length;o++)if(!0!==a.reset){var n=a.orderedModifiers[o],r=n.fn,s=n.options,l=void 0===s?{}:s,d=n.name;"function"==typeof r&&(a=r({state:a,options:l,name:d,instance:p})||a)}else a.reset=!1,o=-1}}},update:(n=function(){return new Promise((function(t){p.forceUpdate(),t(a)}))},function(){return s||(s=new Promise((function(t){Promise.resolve().then((function(){s=void 0,t(n())}))}))),s}),destroy:function(){d(),c=!0}};if(!Wt(t,e))return p;function d(){l.forEach((function(t){return t()})),l=[]}return p.setOptions(i).then((function(t){!c&&i.onFirstUpdate&&i.onFirstUpdate(t)})),p}}var Yt={passive:!0};function Xt(t){return t.split("-")[0]}function Qt(t){return t.split("-")[1]}function Zt(t){return["top","bottom"].indexOf(t)>=0?"x":"y"}function Jt(t){var e,i=t.reference,o=t.element,n=t.placement,r=n?Xt(n):null,s=n?Qt(n):null,a=i.x+i.width/2-o.width/2,l=i.y+i.height/2-o.height/2;switch(r){case Ot:e={x:a,y:i.y-o.height};break;case Lt:e={x:a,y:i.y+i.height};break;case Pt:e={x:i.x+i.width,y:l};break;case Mt:e={x:i.x-o.width,y:l};break;default:e={x:i.x,y:i.y}}var c=r?Zt(r):null;if(null!=c){var p="y"===c?"height":"width";switch(s){case Tt:e[c]=e[c]-(i[p]/2-o[p]/2);break;case At:e[c]=e[c]+(i[p]/2-o[p]/2)}}return e}var Kt={top:"auto",right:"auto",bottom:"auto",left:"auto"};function te(t){var e,i=t.popper,o=t.popperRect,n=t.placement,r=t.variation,s=t.offsets,a=t.position,l=t.gpuAcceleration,c=t.adaptive,p=t.roundOffsets,d=t.isFixed,h=s.x,u=void 0===h?0:h,m=s.y,g=void 0===m?0:m,f="function"==typeof p?p({x:u,y:g}):{x:u,y:g};u=f.x,g=f.y;var v=s.hasOwnProperty("x"),y=s.hasOwnProperty("y"),_=Mt,w=Ot,b=window;if(c){var x=St(i),C="clientHeight",E="clientWidth";if(x===ot(i)&&"static"!==vt(x=gt(i)).position&&"absolute"===a&&(C="scrollHeight",E="scrollWidth"),n===Ot||(n===Mt||n===Pt)&&r===At)w=Lt,g-=(d&&x===b&&b.visualViewport?b.visualViewport.height:x[C])-o.height,g*=l?1:-1;if(n===Mt||(n===Ot||n===Lt)&&r===At)_=Pt,u-=(d&&x===b&&b.visualViewport?b.visualViewport.width:x[E])-o.width,u*=l?1:-1}var I,S=Object.assign({position:a},c&&Kt),O=!0===p?function(t){var e=t.x,i=t.y,o=window.devicePixelRatio||1;return{x:pt(e*o)/o||0,y:pt(i*o)/o||0}}({x:u,y:g}):{x:u,y:g};return u=O.x,g=O.y,l?Object.assign({},S,((I={})[w]=y?"0":"",I[_]=v?"0":"",I.transform=(b.devicePixelRatio||1)<=1?"translate("+u+"px, "+g+"px)":"translate3d("+u+"px, "+g+"px, 0)",I)):Object.assign({},S,((e={})[w]=y?g+"px":"",e[_]=v?u+"px":"",e.transform="",e))}var ee={left:"right",right:"left",bottom:"top",top:"bottom"};function ie(t){return t.replace(/left|right|bottom|top/g,(function(t){return ee[t]}))}var oe={start:"end",end:"start"};function ne(t){return t.replace(/start|end/g,(function(t){return oe[t]}))}function re(t,e){var i=ot(t),o=gt(t),n=i.visualViewport,r=o.clientWidth,s=o.clientHeight,a=0,l=0;if(n){r=n.width,s=n.height;var c=ht();(c||!c&&"fixed"===e)&&(a=n.offsetLeft,l=n.offsetTop)}return{width:r,height:s,x:a+ft(t),y:l}}function se(t){var e,i=gt(t),o=mt(t),n=null==(e=t.ownerDocument)?void 0:e.body,r=lt(i.scrollWidth,i.clientWidth,n?n.scrollWidth:0,n?n.clientWidth:0),s=lt(i.scrollHeight,i.clientHeight,n?n.scrollHeight:0,n?n.clientHeight:0),a=-o.scrollLeft+ft(t),l=-o.scrollTop;return"rtl"===vt(n||i).direction&&(a+=lt(i.clientWidth,n?n.clientWidth:0)-r),{width:r,height:s,x:a,y:l}}function ae(t,e){var i=e.getRootNode&&e.getRootNode();if(t.contains(e))return!0;if(i&&st(i)){var o=e;do{if(o&&t.isSameNode(o))return!0;o=o.parentNode||o.host}while(o)}return!1}function le(t){return Object.assign({},t,{left:t.x,top:t.y,right:t.x+t.width,bottom:t.y+t.height})}function ce(t,e,i){return e===Nt?le(re(t,i)):nt(e)?function(t,e){var i=ut(t,!1,"fixed"===e);return i.top=i.top+t.clientTop,i.left=i.left+t.clientLeft,i.bottom=i.top+t.clientHeight,i.right=i.left+t.clientWidth,i.width=t.clientWidth,i.height=t.clientHeight,i.x=i.left,i.y=i.top,i}(e,i):le(se(gt(t)))}function pe(t,e,i,o){var n="clippingParents"===e?function(t){var e=Ct(bt(t)),i=["absolute","fixed"].indexOf(vt(t).position)>=0&&rt(t)?St(t):t;return nt(i)?e.filter((function(t){return nt(t)&&ae(t,i)&&"body"!==it(t)})):[]}(t):[].concat(e),r=[].concat(n,[i]),s=r[0],a=r.reduce((function(e,i){var n=ce(t,i,o);return e.top=lt(n.top,e.top),e.right=ct(n.right,e.right),e.bottom=ct(n.bottom,e.bottom),e.left=lt(n.left,e.left),e}),ce(t,s,o));return a.width=a.right-a.left,a.height=a.bottom-a.top,a.x=a.left,a.y=a.top,a}function de(t){return Object.assign({},{top:0,right:0,bottom:0,left:0},t)}function he(t,e){return e.reduce((function(e,i){return e[i]=t,e}),{})}function ue(t,e){void 0===e&&(e={});var i=e,o=i.placement,n=void 0===o?t.placement:o,r=i.strategy,s=void 0===r?t.strategy:r,a=i.boundary,l=void 0===a?Ft:a,c=i.rootBoundary,p=void 0===c?Nt:c,d=i.elementContext,h=void 0===d?Dt:d,u=i.altBoundary,m=void 0!==u&&u,g=i.padding,f=void 0===g?0:g,v=de("number"!=typeof f?f:he(f,kt)),y=h===Dt?Vt:Dt,_=t.rects.popper,w=t.elements[m?y:h],b=pe(nt(w)?w:w.contextElement||gt(t.elements.popper),l,p,s),x=ut(t.elements.reference),C=Jt({reference:x,element:_,strategy:"absolute",placement:n}),E=le(Object.assign({},_,C)),I=h===Dt?E:x,S={top:b.top-I.top+v.top,bottom:I.bottom-b.bottom+v.bottom,left:b.left-I.left+v.left,right:I.right-b.right+v.right},O=t.modifiersData.offset;if(h===Dt&&O){var L=O[n];Object.keys(S).forEach((function(t){var e=[Pt,Lt].indexOf(t)>=0?1:-1,i=[Ot,Lt].indexOf(t)>=0?"y":"x";S[t]+=L[i]*e}))}return S}function me(t,e){void 0===e&&(e={});var i=e,o=i.placement,n=i.boundary,r=i.rootBoundary,s=i.padding,a=i.flipVariations,l=i.allowedAutoPlacements,c=void 0===l?jt:l,p=Qt(o),d=p?a?Rt:Rt.filter((function(t){return Qt(t)===p})):kt,h=d.filter((function(t){return c.indexOf(t)>=0}));0===h.length&&(h=d);var u=h.reduce((function(e,i){return e[i]=ue(t,{placement:i,boundary:n,rootBoundary:r,padding:s})[Xt(i)],e}),{});return Object.keys(u).sort((function(t,e){return u[t]-u[e]}))}function ge(t,e,i){return lt(t,ct(e,i))}function fe(t,e,i){var o=ge(t,e,i);return o>i?i:o}var ve=function(t,e){return de("number"!=typeof(t="function"==typeof t?t(Object.assign({},e.rects,{placement:e.placement})):t)?t:he(t,kt))};function ye(t,e,i){return void 0===i&&(i={x:0,y:0}),{top:t.top-e.height-i.y,right:t.right-e.width+i.x,bottom:t.bottom-e.height+i.y,left:t.left-e.width-i.x}}function _e(t){return[Ot,Pt,Lt,Mt].some((function(e){return t[e]>=0}))}var we=Gt({defaultModifiers:[{name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function(t){var e=t.state,i=t.instance,o=t.options,n=o.scroll,r=void 0===n||n,s=o.resize,a=void 0===s||s,l=ot(e.elements.popper),c=[].concat(e.scrollParents.reference,e.scrollParents.popper);return r&&c.forEach((function(t){t.addEventListener("scroll",i.update,Yt)})),a&&l.addEventListener("resize",i.update,Yt),function(){r&&c.forEach((function(t){t.removeEventListener("scroll",i.update,Yt)})),a&&l.removeEventListener("resize",i.update,Yt)}},data:{}},{name:"popperOffsets",enabled:!0,phase:"read",fn:function(t){var e=t.state,i=t.name;e.modifiersData[i]=Jt({reference:e.rects.reference,element:e.rects.popper,strategy:"absolute",placement:e.placement})},data:{}},{name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function(t){var e=t.state,i=t.options,o=i.gpuAcceleration,n=void 0===o||o,r=i.adaptive,s=void 0===r||r,a=i.roundOffsets,l=void 0===a||a,c={placement:Xt(e.placement),variation:Qt(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:n,isFixed:"fixed"===e.options.strategy};null!=e.modifiersData.popperOffsets&&(e.styles.popper=Object.assign({},e.styles.popper,te(Object.assign({},c,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:s,roundOffsets:l})))),null!=e.modifiersData.arrow&&(e.styles.arrow=Object.assign({},e.styles.arrow,te(Object.assign({},c,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:l})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})},data:{}},at,{name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function(t){var e=t.state,i=t.options,o=t.name,n=i.offset,r=void 0===n?[0,0]:n,s=jt.reduce((function(t,i){return t[i]=function(t,e,i){var o=Xt(t),n=[Mt,Ot].indexOf(o)>=0?-1:1,r="function"==typeof i?i(Object.assign({},e,{placement:t})):i,s=r[0],a=r[1];return s=s||0,a=(a||0)*n,[Mt,Pt].indexOf(o)>=0?{x:a,y:s}:{x:s,y:a}}(i,e.rects,r),t}),{}),a=s[e.placement],l=a.x,c=a.y;null!=e.modifiersData.popperOffsets&&(e.modifiersData.popperOffsets.x+=l,e.modifiersData.popperOffsets.y+=c),e.modifiersData[o]=s}},{name:"flip",enabled:!0,phase:"main",fn:function(t){var e=t.state,i=t.options,o=t.name;if(!e.modifiersData[o]._skip){for(var n=i.mainAxis,r=void 0===n||n,s=i.altAxis,a=void 0===s||s,l=i.fallbackPlacements,c=i.padding,p=i.boundary,d=i.rootBoundary,h=i.altBoundary,u=i.flipVariations,m=void 0===u||u,g=i.allowedAutoPlacements,f=e.options.placement,v=Xt(f),y=l||(v===f||!m?[ie(f)]:function(t){if(Xt(t)===$t)return[];var e=ie(t);return[ne(t),e,ne(e)]}(f)),_=[f].concat(y).reduce((function(t,i){return t.concat(Xt(i)===$t?me(e,{placement:i,boundary:p,rootBoundary:d,padding:c,flipVariations:m,allowedAutoPlacements:g}):i)}),[]),w=e.rects.reference,b=e.rects.popper,x=new Map,C=!0,E=_[0],I=0;I<_.length;I++){var S=_[I],O=Xt(S),L=Qt(S)===Tt,P=[Ot,Lt].indexOf(O)>=0,M=P?"width":"height",$=ue(e,{placement:S,boundary:p,rootBoundary:d,altBoundary:h,padding:c}),k=P?L?Pt:Mt:L?Lt:Ot;w[M]>b[M]&&(k=ie(k));var T=ie(k),A=[];if(r&&A.push($[O]<=0),a&&A.push($[k]<=0,$[T]<=0),A.every((function(t){return t}))){E=S,C=!1;break}x.set(S,A)}if(C)for(var F=function(t){var e=_.find((function(e){var i=x.get(e);if(i)return i.slice(0,t).every((function(t){return t}))}));if(e)return E=e,"break"},N=m?3:1;N>0;N--){if("break"===F(N))break}e.placement!==E&&(e.modifiersData[o]._skip=!0,e.placement=E,e.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}},{name:"preventOverflow",enabled:!0,phase:"main",fn:function(t){var e=t.state,i=t.options,o=t.name,n=i.mainAxis,r=void 0===n||n,s=i.altAxis,a=void 0!==s&&s,l=i.boundary,c=i.rootBoundary,p=i.altBoundary,d=i.padding,h=i.tether,u=void 0===h||h,m=i.tetherOffset,g=void 0===m?0:m,f=ue(e,{boundary:l,rootBoundary:c,padding:d,altBoundary:p}),v=Xt(e.placement),y=Qt(e.placement),_=!y,w=Zt(v),b="x"===w?"y":"x",x=e.modifiersData.popperOffsets,C=e.rects.reference,E=e.rects.popper,I="function"==typeof g?g(Object.assign({},e.rects,{placement:e.placement})):g,S="number"==typeof I?{mainAxis:I,altAxis:I}:Object.assign({mainAxis:0,altAxis:0},I),O=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,L={x:0,y:0};if(x){if(r){var P,M="y"===w?Ot:Mt,$="y"===w?Lt:Pt,k="y"===w?"height":"width",T=x[w],A=T+f[M],F=T-f[$],N=u?-E[k]/2:0,D=y===Tt?C[k]:E[k],V=y===Tt?-E[k]:-C[k],R=e.elements.arrow,j=u&&R?wt(R):{width:0,height:0},H=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},z=H[M],B=H[$],q=ge(0,C[k],j[k]),U=_?C[k]/2-N-q-z-S.mainAxis:D-q-z-S.mainAxis,W=_?-C[k]/2+N+q+B+S.mainAxis:V+q+B+S.mainAxis,G=e.elements.arrow&&St(e.elements.arrow),Y=G?"y"===w?G.clientTop||0:G.clientLeft||0:0,X=null!=(P=null==O?void 0:O[w])?P:0,Q=T+W-X,Z=ge(u?ct(A,T+U-X-Y):A,T,u?lt(F,Q):F);x[w]=Z,L[w]=Z-T}if(a){var J,K="x"===w?Ot:Mt,tt="x"===w?Lt:Pt,et=x[b],it="y"===b?"height":"width",ot=et+f[K],nt=et-f[tt],rt=-1!==[Ot,Mt].indexOf(v),st=null!=(J=null==O?void 0:O[b])?J:0,at=rt?ot:et-C[it]-E[it]-st+S.altAxis,pt=rt?et+C[it]+E[it]-st-S.altAxis:nt,dt=u&&rt?fe(at,et,pt):ge(u?at:ot,et,u?pt:nt);x[b]=dt,L[b]=dt-et}e.modifiersData[o]=L}},requiresIfExists:["offset"]},{name:"arrow",enabled:!0,phase:"main",fn:function(t){var e,i=t.state,o=t.name,n=t.options,r=i.elements.arrow,s=i.modifiersData.popperOffsets,a=Xt(i.placement),l=Zt(a),c=[Mt,Pt].indexOf(a)>=0?"height":"width";if(r&&s){var p=ve(n.padding,i),d=wt(r),h="y"===l?Ot:Mt,u="y"===l?Lt:Pt,m=i.rects.reference[c]+i.rects.reference[l]-s[l]-i.rects.popper[c],g=s[l]-i.rects.reference[l],f=St(r),v=f?"y"===l?f.clientHeight||0:f.clientWidth||0:0,y=m/2-g/2,_=p[h],w=v-d[c]-p[u],b=v/2-d[c]/2+y,x=ge(_,b,w),C=l;i.modifiersData[o]=((e={})[C]=x,e.centerOffset=x-b,e)}},effect:function(t){var e=t.state,i=t.options.element,o=void 0===i?"[data-popper-arrow]":i;null!=o&&("string"!=typeof o||(o=e.elements.popper.querySelector(o)))&&ae(e.elements.popper,o)&&(e.elements.arrow=o)},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]},{name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function(t){var e=t.state,i=t.name,o=e.rects.reference,n=e.rects.popper,r=e.modifiersData.preventOverflow,s=ue(e,{elementContext:"reference"}),a=ue(e,{altBoundary:!0}),l=ye(s,o),c=ye(a,n,r),p=_e(l),d=_e(c);e.modifiersData[i]={referenceClippingOffsets:l,popperEscapeOffsets:c,isReferenceHidden:p,hasPopperEscaped:d},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":p,"data-popper-escaped":d})}}]}),be="tippy-box",xe="tippy-content",Ce="tippy-backdrop",Ee="tippy-arrow",Ie="tippy-svg-arrow",Se={passive:!0,capture:!0},Oe=function(){return document.body};function Le(t,e,i){if(Array.isArray(t)){var o=t[e];return null==o?Array.isArray(i)?i[e]:i:o}return t}function Pe(t,e){var i={}.toString.call(t);return 0===i.indexOf("[object")&&i.indexOf(e+"]")>-1}function Me(t,e){return"function"==typeof t?t.apply(void 0,e):t}function $e(t,e){return 0===e?t:function(o){clearTimeout(i),i=setTimeout((function(){t(o)}),e)};var i}function ke(t){return[].concat(t)}function Te(t,e){-1===t.indexOf(e)&&t.push(e)}function Ae(t){return t.split("-")[0]}function Fe(t){return[].slice.call(t)}function Ne(t){return Object.keys(t).reduce((function(e,i){return void 0!==t[i]&&(e[i]=t[i]),e}),{})}function De(){return document.createElement("div")}function Ve(t){return["Element","Fragment"].some((function(e){return Pe(t,e)}))}function Re(t){return Pe(t,"MouseEvent")}function je(t){return!(!t||!t._tippy||t._tippy.reference!==t)}function He(t){return Ve(t)?[t]:function(t){return Pe(t,"NodeList")}(t)?Fe(t):Array.isArray(t)?t:Fe(document.querySelectorAll(t))}function ze(t,e){t.forEach((function(t){t&&(t.style.transitionDuration=e+"ms")}))}function Be(t,e){t.forEach((function(t){t&&t.setAttribute("data-state",e)}))}function qe(t){var e,i=ke(t)[0];return null!=i&&null!=(e=i.ownerDocument)&&e.body?i.ownerDocument:document}function Ue(t,e,i){var o=e+"EventListener";["transitionend","webkitTransitionEnd"].forEach((function(e){t[o](e,i)}))}function We(t,e){for(var i=e;i;){var o;if(t.contains(i))return!0;i=null==i.getRootNode||null==(o=i.getRootNode())?void 0:o.host}return!1}var Ge={isTouch:!1},Ye=0;function Xe(){Ge.isTouch||(Ge.isTouch=!0,window.performance&&document.addEventListener("mousemove",Qe))}function Qe(){var t=performance.now();t-Ye<20&&(Ge.isTouch=!1,document.removeEventListener("mousemove",Qe)),Ye=t}function Ze(){var t=document.activeElement;if(je(t)){var e=t._tippy;t.blur&&!e.state.isVisible&&t.blur()}}var Je=!!("undefined"!=typeof window&&"undefined"!=typeof document)&&!!window.msCrypto;var Ke={animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},ti=Object.assign({appendTo:Oe,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},Ke,{allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999}),ei=Object.keys(ti);function ii(t){var e=(t.plugins||[]).reduce((function(e,i){var o,n=i.name,r=i.defaultValue;n&&(e[n]=void 0!==t[n]?t[n]:null!=(o=ti[n])?o:r);return e}),{});return Object.assign({},t,e)}function oi(t,e){var i=Object.assign({},e,{content:Me(e.content,[t])},e.ignoreAttributes?{}:function(t,e){return(e?Object.keys(ii(Object.assign({},ti,{plugins:e}))):ei).reduce((function(e,i){var o=(t.getAttribute("data-tippy-"+i)||"").trim();if(!o)return e;if("content"===i)e[i]=o;else try{e[i]=JSON.parse(o)}catch(t){e[i]=o}return e}),{})}(t,e.plugins));return i.aria=Object.assign({},ti.aria,i.aria),i.aria={expanded:"auto"===i.aria.expanded?e.interactive:i.aria.expanded,content:"auto"===i.aria.content?e.interactive?null:"describedby":i.aria.content},i}var ni=function(){return"innerHTML"};function ri(t,e){t[ni()]=e}function si(t){var e=De();return!0===t?e.className=Ee:(e.className=Ie,Ve(t)?e.appendChild(t):ri(e,t)),e}function ai(t,e){Ve(e.content)?(ri(t,""),t.appendChild(e.content)):"function"!=typeof e.content&&(e.allowHTML?ri(t,e.content):t.textContent=e.content)}function li(t){var e=t.firstElementChild,i=Fe(e.children);return{box:e,content:i.find((function(t){return t.classList.contains(xe)})),arrow:i.find((function(t){return t.classList.contains(Ee)||t.classList.contains(Ie)})),backdrop:i.find((function(t){return t.classList.contains(Ce)}))}}function ci(t){var e=De(),i=De();i.className=be,i.setAttribute("data-state","hidden"),i.setAttribute("tabindex","-1");var o=De();function n(i,o){var n=li(e),r=n.box,s=n.content,a=n.arrow;o.theme?r.setAttribute("data-theme",o.theme):r.removeAttribute("data-theme"),"string"==typeof o.animation?r.setAttribute("data-animation",o.animation):r.removeAttribute("data-animation"),o.inertia?r.setAttribute("data-inertia",""):r.removeAttribute("data-inertia"),r.style.maxWidth="number"==typeof o.maxWidth?o.maxWidth+"px":o.maxWidth,o.role?r.setAttribute("role",o.role):r.removeAttribute("role"),i.content===o.content&&i.allowHTML===o.allowHTML||ai(s,t.props),o.arrow?a?i.arrow!==o.arrow&&(r.removeChild(a),r.appendChild(si(o.arrow))):r.appendChild(si(o.arrow)):a&&r.removeChild(a)}return o.className=xe,o.setAttribute("data-state","hidden"),ai(o,t.props),e.appendChild(i),i.appendChild(o),n(t.props,t.props),{popper:e,onUpdate:n}}ci.$$tippy=!0;var pi=1,di=[],hi=[];function ui(t,e){var i,o,n,r,s,a,l,c,p=oi(t,Object.assign({},ti,ii(Ne(e)))),d=!1,h=!1,u=!1,m=!1,g=[],f=$e(G,p.interactiveDebounce),v=pi++,y=(c=p.plugins).filter((function(t,e){return c.indexOf(t)===e})),_={id:v,reference:t,popper:De(),popperInstance:null,props:p,state:{isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},plugins:y,clearDelayTimeouts:function(){clearTimeout(i),clearTimeout(o),cancelAnimationFrame(n)},setProps:function(e){if(_.state.isDestroyed)return;T("onBeforeUpdate",[_,e]),U();var i=_.props,o=oi(t,Object.assign({},i,Ne(e),{ignoreAttributes:!0}));_.props=o,q(),i.interactiveDebounce!==o.interactiveDebounce&&(N(),f=$e(G,o.interactiveDebounce));i.triggerTarget&&!o.triggerTarget?ke(i.triggerTarget).forEach((function(t){t.removeAttribute("aria-expanded")})):o.triggerTarget&&t.removeAttribute("aria-expanded");F(),k(),x&&x(i,o);_.popperInstance&&(Z(),K().forEach((function(t){requestAnimationFrame(t._tippy.popperInstance.forceUpdate)})));T("onAfterUpdate",[_,e])},setContent:function(t){_.setProps({content:t})},show:function(){var t=_.state.isVisible,e=_.state.isDestroyed,i=!_.state.isEnabled,o=Ge.isTouch&&!_.props.touch,n=Le(_.props.duration,0,ti.duration);if(t||e||i||o)return;if(L().hasAttribute("disabled"))return;if(T("onShow",[_],!1),!1===_.props.onShow(_))return;_.state.isVisible=!0,O()&&(b.style.visibility="visible");k(),j(),_.state.isMounted||(b.style.transition="none");if(O()){var r=M();ze([r.box,r.content],0)}a=function(){var t;if(_.state.isVisible&&!m){if(m=!0,b.offsetHeight,b.style.transition=_.props.moveTransition,O()&&_.props.animation){var e=M(),i=e.box,o=e.content;ze([i,o],n),Be([i,o],"visible")}A(),F(),Te(hi,_),null==(t=_.popperInstance)||t.forceUpdate(),T("onMount",[_]),_.props.animation&&O()&&function(t,e){z(t,e)}(n,(function(){_.state.isShown=!0,T("onShown",[_])}))}},function(){var t,e=_.props.appendTo,i=L();t=_.props.interactive&&e===Oe||"parent"===e?i.parentNode:Me(e,[i]);t.contains(b)||t.appendChild(b);_.state.isMounted=!0,Z()}()},hide:function(){var t=!_.state.isVisible,e=_.state.isDestroyed,i=!_.state.isEnabled,o=Le(_.props.duration,1,ti.duration);if(t||e||i)return;if(T("onHide",[_],!1),!1===_.props.onHide(_))return;_.state.isVisible=!1,_.state.isShown=!1,m=!1,d=!1,O()&&(b.style.visibility="hidden");if(N(),H(),k(!0),O()){var n=M(),r=n.box,s=n.content;_.props.animation&&(ze([r,s],o),Be([r,s],"hidden"))}A(),F(),_.props.animation?O()&&function(t,e){z(t,(function(){!_.state.isVisible&&b.parentNode&&b.parentNode.contains(b)&&e()}))}(o,_.unmount):_.unmount()},hideWithInteractivity:function(t){P().addEventListener("mousemove",f),Te(di,f),f(t)},enable:function(){_.state.isEnabled=!0},disable:function(){_.hide(),_.state.isEnabled=!1},unmount:function(){_.state.isVisible&&_.hide();if(!_.state.isMounted)return;J(),K().forEach((function(t){t._tippy.unmount()})),b.parentNode&&b.parentNode.removeChild(b);hi=hi.filter((function(t){return t!==_})),_.state.isMounted=!1,T("onHidden",[_])},destroy:function(){if(_.state.isDestroyed)return;_.clearDelayTimeouts(),_.unmount(),U(),delete t._tippy,_.state.isDestroyed=!0,T("onDestroy",[_])}};if(!p.render)return _;var w=p.render(_),b=w.popper,x=w.onUpdate;b.setAttribute("data-tippy-root",""),b.id="tippy-"+_.id,_.popper=b,t._tippy=_,b._tippy=_;var C=y.map((function(t){return t.fn(_)})),E=t.hasAttribute("aria-expanded");return q(),F(),k(),T("onCreate",[_]),p.showOnCreate&&tt(),b.addEventListener("mouseenter",(function(){_.props.interactive&&_.state.isVisible&&_.clearDelayTimeouts()})),b.addEventListener("mouseleave",(function(){_.props.interactive&&_.props.trigger.indexOf("mouseenter")>=0&&P().addEventListener("mousemove",f)})),_;function I(){var t=_.props.touch;return Array.isArray(t)?t:[t,0]}function S(){return"hold"===I()[0]}function O(){var t;return!(null==(t=_.props.render)||!t.$$tippy)}function L(){return l||t}function P(){var t=L().parentNode;return t?qe(t):document}function M(){return li(b)}function $(t){return _.state.isMounted&&!_.state.isVisible||Ge.isTouch||r&&"focus"===r.type?0:Le(_.props.delay,t?0:1,ti.delay)}function k(t){void 0===t&&(t=!1),b.style.pointerEvents=_.props.interactive&&!t?"":"none",b.style.zIndex=""+_.props.zIndex}function T(t,e,i){var o;(void 0===i&&(i=!0),C.forEach((function(i){i[t]&&i[t].apply(i,e)})),i)&&(o=_.props)[t].apply(o,e)}function A(){var e=_.props.aria;if(e.content){var i="aria-"+e.content,o=b.id;ke(_.props.triggerTarget||t).forEach((function(t){var e=t.getAttribute(i);if(_.state.isVisible)t.setAttribute(i,e?e+" "+o:o);else{var n=e&&e.replace(o,"").trim();n?t.setAttribute(i,n):t.removeAttribute(i)}}))}}function F(){!E&&_.props.aria.expanded&&ke(_.props.triggerTarget||t).forEach((function(t){_.props.interactive?t.setAttribute("aria-expanded",_.state.isVisible&&t===L()?"true":"false"):t.removeAttribute("aria-expanded")}))}function N(){P().removeEventListener("mousemove",f),di=di.filter((function(t){return t!==f}))}function D(e){if(!Ge.isTouch||!u&&"mousedown"!==e.type){var i=e.composedPath&&e.composedPath()[0]||e.target;if(!_.props.interactive||!We(b,i)){if(ke(_.props.triggerTarget||t).some((function(t){return We(t,i)}))){if(Ge.isTouch)return;if(_.state.isVisible&&_.props.trigger.indexOf("click")>=0)return}else T("onClickOutside",[_,e]);!0===_.props.hideOnClick&&(_.clearDelayTimeouts(),_.hide(),h=!0,setTimeout((function(){h=!1})),_.state.isMounted||H())}}}function V(){u=!0}function R(){u=!1}function j(){var t=P();t.addEventListener("mousedown",D,!0),t.addEventListener("touchend",D,Se),t.addEventListener("touchstart",R,Se),t.addEventListener("touchmove",V,Se)}function H(){var t=P();t.removeEventListener("mousedown",D,!0),t.removeEventListener("touchend",D,Se),t.removeEventListener("touchstart",R,Se),t.removeEventListener("touchmove",V,Se)}function z(t,e){var i=M().box;function o(t){t.target===i&&(Ue(i,"remove",o),e())}if(0===t)return e();Ue(i,"remove",s),Ue(i,"add",o),s=o}function B(e,i,o){void 0===o&&(o=!1),ke(_.props.triggerTarget||t).forEach((function(t){t.addEventListener(e,i,o),g.push({node:t,eventType:e,handler:i,options:o})}))}function q(){var t;S()&&(B("touchstart",W,{passive:!0}),B("touchend",Y,{passive:!0})),(t=_.props.trigger,t.split(/\s+/).filter(Boolean)).forEach((function(t){if("manual"!==t)switch(B(t,W),t){case"mouseenter":B("mouseleave",Y);break;case"focus":B(Je?"focusout":"blur",X);break;case"focusin":B("focusout",X)}}))}function U(){g.forEach((function(t){var e=t.node,i=t.eventType,o=t.handler,n=t.options;e.removeEventListener(i,o,n)})),g=[]}function W(t){var e,i=!1;if(_.state.isEnabled&&!Q(t)&&!h){var o="focus"===(null==(e=r)?void 0:e.type);r=t,l=t.currentTarget,F(),!_.state.isVisible&&Re(t)&&di.forEach((function(e){return e(t)})),"click"===t.type&&(_.props.trigger.indexOf("mouseenter")<0||d)&&!1!==_.props.hideOnClick&&_.state.isVisible?i=!0:tt(t),"click"===t.type&&(d=!i),i&&!o&&et(t)}}function G(t){var e=t.target,i=L().contains(e)||b.contains(e);if("mousemove"!==t.type||!i){var o=K().concat(b).map((function(t){var e,i=null==(e=t._tippy.popperInstance)?void 0:e.state;return i?{popperRect:t.getBoundingClientRect(),popperState:i,props:p}:null})).filter(Boolean);(function(t,e){var i=e.clientX,o=e.clientY;return t.every((function(t){var e=t.popperRect,n=t.popperState,r=t.props.interactiveBorder,s=Ae(n.placement),a=n.modifiersData.offset;if(!a)return!0;var l="bottom"===s?a.top.y:0,c="top"===s?a.bottom.y:0,p="right"===s?a.left.x:0,d="left"===s?a.right.x:0,h=e.top-o+l>r,u=o-e.bottom-c>r,m=e.left-i+p>r,g=i-e.right-d>r;return h||u||m||g}))})(o,t)&&(N(),et(t))}}function Y(t){Q(t)||_.props.trigger.indexOf("click")>=0&&d||(_.props.interactive?_.hideWithInteractivity(t):et(t))}function X(t){_.props.trigger.indexOf("focusin")<0&&t.target!==L()||_.props.interactive&&t.relatedTarget&&b.contains(t.relatedTarget)||et(t)}function Q(t){return!!Ge.isTouch&&S()!==t.type.indexOf("touch")>=0}function Z(){J();var e=_.props,i=e.popperOptions,o=e.placement,n=e.offset,r=e.getReferenceClientRect,s=e.moveTransition,l=O()?li(b).arrow:null,c=r?{getBoundingClientRect:r,contextElement:r.contextElement||L()}:t,p={name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(t){var e=t.state;if(O()){var i=M().box;["placement","reference-hidden","escaped"].forEach((function(t){"placement"===t?i.setAttribute("data-placement",e.placement):e.attributes.popper["data-popper-"+t]?i.setAttribute("data-"+t,""):i.removeAttribute("data-"+t)})),e.attributes.popper={}}}},d=[{name:"offset",options:{offset:n}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!s}},p];O()&&l&&d.push({name:"arrow",options:{element:l,padding:3}}),d.push.apply(d,(null==i?void 0:i.modifiers)||[]),_.popperInstance=we(c,b,Object.assign({},i,{placement:o,onFirstUpdate:a,modifiers:d}))}function J(){_.popperInstance&&(_.popperInstance.destroy(),_.popperInstance=null)}function K(){return Fe(b.querySelectorAll("[data-tippy-root]"))}function tt(t){_.clearDelayTimeouts(),t&&T("onTrigger",[_,t]),j();var e=$(!0),o=I(),n=o[0],r=o[1];Ge.isTouch&&"hold"===n&&r&&(e=r),e?i=setTimeout((function(){_.show()}),e):_.show()}function et(t){if(_.clearDelayTimeouts(),T("onUntrigger",[_,t]),_.state.isVisible){if(!(_.props.trigger.indexOf("mouseenter")>=0&&_.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(t.type)>=0&&d)){var e=$(!1);e?o=setTimeout((function(){_.state.isVisible&&_.hide()}),e):n=requestAnimationFrame((function(){_.hide()}))}}else H()}}function mi(t,e){void 0===e&&(e={});var i=ti.plugins.concat(e.plugins||[]);document.addEventListener("touchstart",Xe,Se),window.addEventListener("blur",Ze);var o=Object.assign({},e,{plugins:i}),n=He(t).reduce((function(t,e){var i=e&&ui(e,o);return i&&t.push(i),t}),[]);return Ve(t)?n[0]:n}mi.defaultProps=ti,mi.setDefaultProps=function(t){Object.keys(t).forEach((function(e){ti[e]=t[e]}))},mi.currentInput=Ge;Object.assign({},at,{effect:function(t){var e=t.state,i={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(e.elements.popper.style,i.popper),e.styles=i,e.elements.arrow&&Object.assign(e.elements.arrow.style,i.arrow)}});mi.setDefaultProps({render:ci});var gi=mi;
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const fi=new WeakMap,vi=_((t=>e=>{if(!(e instanceof B))throw new Error("unsafeHTML can only be used in text bindings");const i=fi.get(e);if(void 0!==i&&R(t)&&t===i.value&&e.value===i.fragment)return;const o=document.createElement("template");o.innerHTML=t;const n=document.importNode(o.content,!0);e.setValue(n),fi.set(e,{value:t,fragment:n})})),yi=(t,e)=>{const i=t.startNode.parentNode,o=void 0===e?t.endNode:e.startNode,n=i.insertBefore(T(),o);i.insertBefore(T(),o);const r=new B(t.options);return r.insertAfterNode(n),r},_i=(t,e)=>(t.setValue(e),t.commit(),t),wi=(t,e,i)=>{const o=t.startNode.parentNode,n=i?i.startNode:t.endNode,r=e.endNode.nextSibling;r!==n&&x(o,e.startNode,r,n)},bi=t=>{C(t.startNode.parentNode,t.startNode,t.endNode.nextSibling)},xi=(t,e,i)=>{const o=new Map;for(let n=e;n<=i;n++)o.set(t[n],n);return o},Ci=new WeakMap,Ei=new WeakMap,Ii=_(((t,e,i)=>{let o;return void 0===i?i=e:void 0!==e&&(o=e),e=>{if(!(e instanceof B))throw new Error("repeat can only be used in text bindings");const n=Ci.get(e)||[],r=Ei.get(e)||[],s=[],a=[],l=[];let c,p,d=0;for(const e of t)l[d]=o?o(e,d):d,a[d]=i(e,d),d++;let h=0,u=n.length-1,m=0,g=a.length-1;for(;h<=u&&m<=g;)if(null===n[h])h++;else if(null===n[u])u--;else if(r[h]===l[m])s[m]=_i(n[h],a[m]),h++,m++;else if(r[u]===l[g])s[g]=_i(n[u],a[g]),u--,g--;else if(r[h]===l[g])s[g]=_i(n[h],a[g]),wi(e,n[h],s[g+1]),h++,g--;else if(r[u]===l[m])s[m]=_i(n[u],a[m]),wi(e,n[u],n[h]),u--,m++;else if(void 0===c&&(c=xi(l,m,g),p=xi(r,h,u)),c.has(r[h]))if(c.has(r[u])){const t=p.get(l[m]),i=void 0!==t?n[t]:null;if(null===i){const t=yi(e,n[h]);_i(t,a[m]),s[m]=t}else s[m]=_i(i,a[m]),wi(e,i,n[h]),n[t]=null;m++}else bi(n[u]),u--;else bi(n[h]),h++;for(;m<=g;){const t=yi(e,s[g+1]);_i(t,a[m]),s[m++]=t}for(;h<=u;){const t=n[h++];null!==t&&bi(t)}Ci.set(e,s),Ei.set(e,l)}})),Si=new WeakMap,Oi=_((t=>e=>{if(!(e instanceof B))throw new Error("cache can only be used in text bindings");let i=Si.get(e);void 0===i&&(i=new WeakMap,Si.set(e,i));const o=e.value;if(o instanceof F){if(t instanceof V&&o.template===e.options.templateFactory(t))return void e.setValue(t);{let t=i.get(o.template);void 0===t&&(t={instance:o,nodes:document.createDocumentFragment()},i.set(o.template,t)),x(t.nodes,e.startNode.nextSibling,e.endNode)}}if(t instanceof V){const o=e.options.templateFactory(t),n=i.get(o);void 0!==n&&(e.setValue(n.nodes),e.commit(),e.value=n.instance)}e.setValue(t)})),Li=new WeakMap,Pi=_((t=>e=>{const i=Li.get(e);if(void 0===t&&e instanceof z){if(void 0!==i||!Li.has(e)){const t=e.committer.name;e.committer.element.removeAttribute(t)}}else t!==i&&e.setValue(t);Li.set(e,t)}));class Mi{add(t){this.classes.add(t),this.commit()}remove(t){this.classes.delete(t),this.commit()}commit(){let t="";this.classes.forEach((e=>t+=e+" ")),this.element.setAttribute("class",t)}constructor(t){this.classes=new Set,this.element=t;const e=(t.getAttribute("class")||"").split(/\s+/);for(const t of e)this.classes.add(t)}}let $i=!1;function ki(t){return $i?new Mi(t):t.classList||new Mi(t)}function Ti(t=1){return new Promise((e=>0==--t?requestAnimationFrame((()=>e())):e(Ti(t))))}function Ai(t){let e=t;for(;e=e.parentNode||e.host;)if(e instanceof HTMLElement)return e;return null}function Fi(t,e,i=!0){return new Promise((o=>{const n=new MutationObserver((async()=>{n.disconnect(),i&&await Ti(),o()}));n.observe(t,{attributes:!0,attributeFilter:["class"]}),e&&e()}))}function Ni(t){let e=function(t){const e=[];let i=t.startNode.nextSibling;for(;i!==t.endNode;)e.push(i),i=i.nextSibling;return e}(t),i=e.filter((t=>{return!("#text"===(e=t).nodeName&&!(null===(i=e.nodeValue)||void 0===i?void 0:i.trim()));var e,i}));if(1!=i.length)throw new Error(`lit-transition directive expects exactly one child node,\n      but was passed ${i.map((t=>t.nodeName)).join(", ")}`);return i[0]}const Di=new WeakMap;function Vi(t,e){return Di.set(t,e),t}function Ri(t,e){const i=Ai(t);if(i){if("absolute"===(()=>{const t=document.createElement("div"),o=ki(t),n=i.shadowRoot||i;var r;r=e,Array.isArray(r)?r.forEach((t=>o.add(t))):o.add(r),n.appendChild(t);const s=window.getComputedStyle(t).position;return n.removeChild(t),s})()){return"relative"===window.getComputedStyle(i).position}}return!1}function ji(t){const e=t.getBoundingClientRect();let i=0,o=0;{let e=t.offsetParent;for(;t&&t!==document&&!(t instanceof DocumentFragment)&&t!==e;)i+=t.offsetTop-(t.scrollTop||0),o+=t.offsetLeft-(t.scrollLeft||0),t=Ai(t)}return{left:o,top:i,width:e.width,height:e.height}}let Hi;function zi(t=!document.hidden){Hi=t}zi(),document.addEventListener("visibilitychange",(()=>zi()),!1);const Bi=new WeakMap;function qi(t){return function(e,i){return async o=>{if(!(o instanceof B))throw new Error("The `transition` directive can only be used on nodes");e||(e=et`<div></div>`),"string"!=typeof e&&"number"!=typeof e||(e=et`<div style="display: inline-block">${e}</div>`);const n=(r=e,Di.get(r));var r;const{enter:s,leave:a,onEnter:l,onLeave:c,onAfterEnter:p,onAfterLeave:d,mode:h="in-out"}=i;let u=Bi.get(o);function m(t){const e=new B(o.options);return e.appendIntoPart(o),e.setValue(t),e.commit(),e}function g(t){const{startNode:e,endNode:i}=t;try{e&&t.clear()}catch(i){}e&&e.parentNode&&e.parentNode.removeChild(e),i&&i.parentNode&&i.parentNode.removeChild(i)}if(!Hi)return u&&u.last&&g(u.last),c&&await c(),d&&await d(),l&&await l(),u&&(u.last=m(e)),void(p&&await p());async function f(e){l&&await l(),s&&await t.transition(e,s,i),p&&await p()}async function v(e){c&&await c(),a&&await t.transition(e,a,i),g(e),d&&await d()}if(u||Bi.set(o,u={children:new Map,styles:new Map,transition:i}),t.init&&t.init({transition:i,data:u,add:m,remove:g}),u.last&&n&&n===u.name)u.last.setValue(e),u.last.commit();else if(u.name=n,"in-out"===h){const t=u.last;await f(u.last=m(e)),t&&await v(t)}else if("out-in"===h){const t=u.last;t&&await v(t),await f(u.last=m(e))}else u.last&&v(u.last),await f(u.last=m(e))}}}var Ui,Wi,Gi,Yi;function Xi(t={}){const{css:e,duration:i,enter:o={},leave:n={},mode:r=Ui.Both,onAfterEnter:s,onAfterLeave:a,onEnter:l,onLeave:c,skipHidden:p=!0}=t;return{duration:i,skipHidden:p,css:et`<style>${e}</style>`,enter:0!=o&&(Array.isArray(o)||"string"==typeof o?{active:o}:Object.assign({active:"enter-active",from:"enter-from",to:"enter-to"},o)),leave:0!=n&&(Array.isArray(n)||"string"==typeof n?{active:n,lock:false}:Object.assign({active:"leave-active",from:"leave-from",to:"leave-to",lock:false},n)),onEnter:l,onLeave:c,onAfterEnter:s,onAfterLeave:a,mode:r}}function Qi(t,e){const i=e();for(let t in i)e[t]=i[t];return Object.defineProperty(e,"name",{get:()=>t}),e}function Zi(t,e){for(var i in e)try{e[i].constructor==Object?t[i]=Zi(t[i],e[i]):t[i]=e[i]}catch(o){t[i]=e[i]}return t}(Wi=Ui||(Ui={})).InOut="in-out",Wi.OutIn="out-in",Wi.Both="both",(Yi=Gi||(Gi={}))[Yi.None=0]="None",Yi[Yi.Lock=1]="Lock",Yi.Auto="auto";const Ji=Qi("fade",(function(t={}){const{duration:e=500,ease:i="ease-out",opacity:o=0}=t;return Zi({enter:{active:"fade-enter-active",from:"fade-enter-from",to:"fade-enter-to"},leave:{active:"fade-leave-active",from:"fade-leave-from",to:"fade-leave-to",lock:!0},css:`\n    .fade-leave-active {\n      position: fixed;\n      transition: opacity ${e}ms ${i}, transform ${e}ms ${i};\n    }\n    .fade-enter-active {\n      transition: opacity ${e}ms ${i}, transform ${e}ms ${i};\n    }\n  .fade-enter-from, .fade-leave-to {\n    opacity: ${o};\n  }\n  .fade-enter-to, .fade-leave-from {\n    opacity: 1;\n  }\n  `},t)})),Ki={async transition(t,e,i){const{duration:o=i.duration,active:n,from:r,to:s,lock:a}=e,l=Ni(t);if(!l)return;let c;a&&(a!==Gi.Auto||n&&Ri(l,n))&&(c=ji(l)),await new Promise((async t=>{const e=ki(l),i=t=>Array.isArray(t)?t.forEach((t=>e.add(t))):e.add(t),a=t=>Array.isArray(t)?t.forEach((t=>e.remove(t))):e.remove(t);var p,d;function h(e){if(e){if(e.target!==l)return;e.preventDefault(),e.stopPropagation()}["transitionend","transitioncancel","animationend","animationcancel"].filter((t=>!e||t!==e.type)).forEach((t=>l.removeEventListener(t,h))),n&&a(n),r&&a(r),s&&a(s),t()}c&&(d=c,(p=l).style.marginLeft="0px",p.style.marginTop="0px",p.style.left=d.left+"px",p.style.top=d.top+"px",p.style.width=d.width+"px",p.style.height=d.height+"px");const u={once:!0};o?setTimeout(h,o):(l.addEventListener("transitionrun",(function(){l.addEventListener("transitionend",h,u),l.addEventListener("transitioncancel",h,u)}),u),l.addEventListener("animationstart",(function(){l.addEventListener("animationend",h,u),l.addEventListener("animationcancel",h,u)}),u)),r&&await Fi(l,(()=>i(r))),n&&await Fi(l,(()=>i(n))),r&&a(r),s&&i(s)}))},init({data:t,remove:e,add:i,transition:o}){if(t._cssSource!==o.css&&(t.css&&e(t.css),o.css)){t._cssSource=o.css;let e=o.css;e="string"==typeof e?et`<style>${e}</style>`:e,t.css=i(e)}}},to=(Qi("land",(function(t={}){const{duration:e=500,ease:i="ease-out",opacity:o=0}=t;return Zi({enter:{active:"land1-enter-active",from:"land1-enter-from",to:"land1-enter-to"},leave:{active:"land1-leave-active",from:"land1-leave-from",to:"land1-leave-to"},mode:"both",css:`\n      .land1-enter-active {\n        transform-origin: 50% 50%;\n        transition: transform ${e}ms ${i}, opacity ${e}ms ${i};\n      }\n      .land1-leave-active {\n        transform-origin: 50% 50%;\n        position: absolute;\n        transition: transform ${e}ms ${i}, opacity ${e}ms ${i};\n      }\n      .land1-enter-from {\n        opacity: ${o};\n        transform: translate(0px, 0px) scale(3);\n      }\n      .land1-leave-to {\n        transform: translate(0px, 100px);\n        opacity: ${o};\n      }`},t)})),Qi("slide",(function(t={}){const{left:e,right:i,up:o,down:n}=t;let r={};e&&(r={x:"-100%",x1:"100%"}),i&&(r={x:"100%",x1:"-100%"}),o&&(r={y:"100%",y1:"-100%"}),n&&(r={y:"-100%",y1:"100%"});let{mode:s,duration:a=500,x:l="100%",y:c="0%",x1:p="",y1:d="",ease:h="ease-out",leavePosition:u="",opacity:m=0}=Object.assign(Object.assign({},r),t);return p=p||l,d=d||c,Zi({enter:{active:"slide-enter-active",from:"slide-enter-from"},leave:{active:"slide-leave-active",to:"slide-leave-to",lock:Gi.Auto},css:`\n    .slide-enter-active {\n      transition: transform ${a}ms ${h}, opacity ${a}ms ${h};\n    }\n    .slide-leave-active {\n      position: ${u||(s!==Ui.OutIn?"absolute":"initial")};\n      transition: transform ${a}ms ${h}, opacity ${a}ms ${h};\n    }\n    .slide-leave-to {\n      opacity: ${m};\n      transform: translate(${l}, ${c});\n    }\n    .slide-enter-from {\n      opacity: ${m};\n      transform: translate(${p}, ${d});\n    }`,mode:s},t)})),_((function(t,e=Ji){return"function"==typeof e&&(e=e()),qi(Ki)(t,Xi(e))}))),eo={OPTIONS:"_cl_options",ID:"_cl_options_id",PRICE:"_cl_options_price",PRICE_BASE:"_cl_options_price_base",PRICE_KEY:"_cl_options_price_key",CURRENCY:"_cl_options_currency",WEIGHT:"_cl_options_weight",QUANTITY_ID:"_cl_options_quantity_id",QUANTITY_DISCOUNT:"_cl_options_quantity_discount",QUANTITY_MIN:"_cl_options_quantity_min",BUNDLE:"_cl_options_bundle",BUNDLE_TITLE:"_cl_options_bundle_title",JSON:"_cl_options_json",JSON_PRICE:"_cl_options_json_price"},io={formInject:!0,cartItem:!0,cartItemPreview:!0,cartItemPreviewViews:!0,cartItemPrice:!0,cartItemPriceOptions:!0,cartItemEdit:!1,cartItemClOptions:!0,cartItemPriceRemove:!0,cartCount:!0,cartTotal:!0,cartFormCapture:!0,cartDiscount:!1,cartPriceRegex:!1,checkoutDomain:!1,productFormCapture:!0,productFormDisabled:!0,productFormSubmitDelay:!1,productBuyNow:!0,productPrice:!0,productPriceAll:!1,productPriceComparePct:!1,productVariantHide:!0,productVariantFilter:!0,productVariantObserver:!1,productVariantHistory:!1,productVariantHistoryPush:!0,productVariantHistoryReplace:!0,productLinkAvailable:!1,productVariantExcludeTotal:!1,productPriceDeductVP:!1,productPriceTimeout:!1,productPriceObserver:!1,productItemUpdate:!0,productItemModal:!1,productOptionsClear:!1,productOptionsEmptyId:!1,productOptionsEmptyExclude:!1,bundlePriceVariant:!1,bundleCartLayout:!0,productCropOverlay:!0,productSKU:!1,productQuickView:!1,amountNoDecimals:!1,themeGallery:!1,themeGalleryTimeout:!1,previewHiddenExclude:!1,tooltipBody:!0,currencyFormat:!0,priceVisible:!0,priceVisibleCustomer:!1,previewCdnSize:!0,previewExportLog:!0,previewExportRequired:!1,previewBlobs:!1,previewExportEmbed:!1,previewImgResize:!1,checkoutLog:!1,checkoutQuantityValidate:!1,evaluateOptionPriceHidden:!1,checkoutJson:!0},oo={currency:"",currencyConvert:!1,currencyFactor:1,moneyFormat:"$ {{amount}}",moneyFormatWithCurrency:"${{amount}} USD",priceVariant:!1,priceVariantValue:.01,priceVariantId:"",priceProductHandle:"",checkout:{key:"",update:!1,negative:!1,validate:!1}},no=t=>{if(1!==oo.currencyFactor)if(t*=oo.currencyFactor,oo.priceVariant){let e=Math.round(t/oo.priceVariantValue);t=oo.priceVariantValue*e,t=Math.round(100*t)/100}else t=oo.currencyFactor>100&&t>100?100*Math.ceil(t/100):Math.ceil(t);return t},ro={NONE:0,CODE:1,AUTO:2},so={ABSOLUTE:1,PERCENTAGE:2,LETTER:3,FORMULA:4,UPLOAD:5},ao={EXPORT:!1,FORMULA:!1,QUANTITY:!1,BUNDLE:!1,AI:!1};class lo{}lo.templates={};var co=lo;const po="${{amount}}";function ho(t,e){"string"==typeof t&&(t=t.replace(".",""));let i="";const o=/\{\{\s*(\w+)\s*\}\}/,n=e||po;function r(t,e=2,i=",",o="."){if(isNaN(t)||null==t)return 0;const n=(t=(t/100).toFixed(e)).split(".");return n[0].replace(/(\d)(?=(\d\d\d)+(?!\d))/g,`$1${i}`)+(n[1]?o+n[1]:"")}switch(n.match(o)[1]){case"amount":i=r(t,2);break;case"amount_no_decimals":i=r(t,0);break;case"amount_with_comma_separator":i=r(t,2,".",",");break;case"amount_no_decimals_with_comma_separator":i=r(t,0,".",",")}return n.replace(o,i)}const uo=t=>t&&(-1!==t.indexOf("//cdn.shopify.com/")||-1!==t.indexOf("/cdn/shop/")),mo=(t,e="200x")=>"small"===t?"100x":"medium"===t?"200x":"large"===t?"400x":e,go=(t,e)=>{if(uo(t)){let i=t.substring(t.lastIndexOf(".")+1);return"svg"===i?t:t.replace("."+i,"")+"_"+e+"."+i}return t},fo=(t,e)=>{let i=t.target;if(i){let t=i.parentNode.querySelector(".cl-po--text-help");t&&(e.value=i.value,t.innerHTML=vo(e.params.textHelp,e))}},vo=(t,e)=>{if(t){let i={};i.used=e.value.length,i.min=e.params.min?e.params.min:0,i.max=e.params.max?e.params.max:1e3,i.left=i.max-i.used;for(let e in i)i.hasOwnProperty(e)&&(t=t.replace(new RegExp("{"+e+"}","g"),i[e]));return t}},yo=t=>t?t.replace(/\\n/g,"\n"):t,_o=(t,e,i)=>{if(io.priceVisible&&t){let o;return o=e?e.replace(new RegExp("{price}","g"),t):`(+ ${t})`,i&&(-1!==o.indexOf("-")?o=o.replace("-","").replace("+","-"):-1!==o.indexOf("==")&&(o=o.replace("==","").replace("+",""))),oo.checkout.negative&&-1!==o.indexOf("-")&&(o=o.replace("-","").replace("+","-")),o}return""},wo=t=>{if(t.values){let e=t._controller&&t._controller.multiSelect,i=e?[]:null;for(let o=0;o<t.values.length;o++){const n=t.values[o];if(e&&t._controller.isSelected(t,n))i.push(bo(n));else if(n.value==t.value)return n}if(i&&i.length)return{text:i.join(",")}}return t.value?{text:t.value}:null},bo=t=>t?t.text?t.text:t.value||"":"",xo=(t,e,i,o=!1)=>{let n=bo(e);if(t.params.valuePriceText){let o=Co(t,e,i);o&&(n+=" "+o)}return o&&(n=(t=>t.replace(/(<([^>]+)>)/gi,""))(n)),n},Co=(t,e,i)=>{if(!0===e.disabled){let t=l.get("product.options.disabled",null,"_");if("_"!==t)return`(${t})`}if(e.price&&i)return _o(Eo(t,e,i),t.params.priceTemplate,t.params.priceRelative)},Eo=(t,e,i)=>{if(e.price&&i){let o=e.price;if(t.params.priceRelative)for(let n=0;n<t.values.length;n++){const r=t.values[n];if(t.value===r.value){if(o-=r.price,0===o){if(t.params.priceRelativeEmpty)return"";o=e.price,i="=="+i}break}}return oo.currencyConvert&&!e.priceVariant&&(o=no(o)),ho(100*o,i)}return""},Io=(t,e,i,o=!1)=>{let n="";if(t.params.imgTooltip&&(n+=`<img src="${go(e.img,"600x")}" />${n}`),t.params.imgText||(n+=xo(t,e,i,o)),""!==n.trim())return n},So=()=>{let t=document.createElement("input");return t.type="color",t.value="!","color"===t.type&&"!"!==t.value},Oo=()=>{let t=document.createElement("input");return t.setAttribute("type","date"),t.setAttribute("value","a"),"a"!==t.value},Lo=(t,e,i={})=>((e.disabled||t._variantOption&&!1===e.available)&&(i["cl-po--disabled"]=!0),i),Po=(t,e={})=>(e["cl-po--invalid"]=t.errors&&t.errors.length>0,t._editor&&t._layer.params.collapse&&(e["cl-po--b-radius-0"]=!0),e),Mo=(t,e,i={})=>(t.params.size?i["cl-po--"+t.params.size]=!0:e&&(i["cl-po--"+e]=!0),t.params.shape&&(i["cl-po--"+t.params.shape]=!0),i),$o=(t,e,i,o)=>{e.params.toggle&&e.value===i.value&&(t.preventDefault(),t.stopImmediatePropagation(),e.value="",o(e))},ko=(t,e={})=>(t.params.minWidth&&t.params.minWidth>0&&(e.minWidth=t.params.minWidth+"px"),e),To=(t,e={})=>(t.params.btnColor&&(e.color=t.params.btnColor),t.params.btnBgColor&&(e.backgroundColor=t.params.btnBgColor),e),Ao=t=>{let e=`[data-option="${t.name}"] .cl-po--group`;if("grid"===t.params.groupLayout){let i=`${e} {\n          margin: 0 auto;\n          display: grid;\n          gap: 1rem;\n          grid-template-columns: repeat(${t.params.groupCols||2}, 1fr);\n        }`;return t.params.groupColsM&&(i+=` @media only screen and (max-width: 450px) { ${e} {\n              grid-template-columns: repeat(${t.params.groupColsM}, 1fr);\n            } }`),i}return""},Fo=(t,e,i=300)=>0===(i=t.params.debounce||i)?e:n.debounced(i,e),No=t=>t.params.name?t.params.name:t.params.exclude?"_"+t.name:`properties[${t.name}]`,Do=(t,e="noop")=>t.params.autocomplete?t.params.autocomplete:e,Vo=(t,e)=>{if(t.params.optionFont){let i=e(t.params.optionFont);if(i&&i.value){let t=i.value,e=d.getFont(t);if(e)return e.loaded||d.loadFontsByName([t]),t}}return null},Ro=(t,e,i)=>{if(t.target.value){let i=[];if("uppercase"===e.params.textTransform?t.target.value=t.target.value.toUpperCase():"lowercase"===e.params.textTransform&&(t.target.value=t.target.value.toLowerCase()),e.params.rowsMax){let i=t.target.value.split("\n");i.length>e.params.rowsMax&&(i.length=e.params.rowsMax,t.target.value=i.join("\n"))}if(e.params.max&&t.target.value.length>e.params.max&&(t.target.value=t.target.value.substring(0,e.params.max)),window.clTextClean&&(e.params.textClean=window.clTextClean),e.params.textClean){if(!e._textClean)try{e._textClean=new RegExp(e.params.textClean,e.params.textCleanFlags||"ugi")}catch(t){s.error("failed to compile textClean pattern for option: ",e.params.textClean,e,t)}e._textClean&&e._textClean.test(t.target.value)&&(t.target.value=t.target.value.replaceAll(e._textClean,""),i.push(l.get("product.options.validity.textClean",null,e.params.validationMsg||"Input not allowed")))}i.length&&(e.errors=i,e._error=!0)}return jo(t,e,i)},jo=(t,e,i)=>(e.value=t.target.value,i(e)),Ho=t=>{let e=[];return t._layer.params.editor.font&&e.push("font:"+(t._editor.fontFamily||"")),t._layer.params.editor.style&&(e.push("weight:"+(t._editor.fontWeight||"normal")),e.push("style:"+(t._editor.fontStyle||"normal"))),t._layer.params.editor.align&&e.push("align:"+(t._editor.textAlign||"left")),t._layer.params.editor.size&&e.push("size:"+(t._editor.fontSize||"normal")),t._layer.params.editor.color&&e.push("color:"+(t._editor.color||"#000000")),e.join(",")},zo=(t,e)=>{let i=[],o=null;const n={};for(let r=0;r<t.length;r++){const s=t[r],a=(s._text||s.text||"").split(e);if(a.length>1){const t=a[0];o&&t===o.groupLabel||(n.hasOwnProperty(t)?o=n[t]:(o={groupLabel:t,values:[]},i.push(o),n[t]=o)),s._text||(s._text=s.text,s.text=a[1]),o.values.push(s)}else i.push(s)}return i},Bo=(t,e,i)=>({multiSelect:!0,onValidate:t=>{let e=t.value?t.value.split(",").length:0;return t.params.minSelect&&e<t.params.minSelect?(t.errors.push(l.get("product.options.validity.selectMin",{min:t.params.minSelect})),!1):t.params.maxSelect&&e>t.params.maxSelect?(t.errors.push(l.get("product.options.validity.selectMax",{max:t.params.maxSelect})),!1):!(t.required&&!t.value)||(t.errors.push(l.get("product.options.validity.valueMissing")),!1)},onChange:(t,e)=>{let o=document.querySelector("#"+e.id);if(o){let t=document.querySelectorAll('[id^="'+e.id+'-"]'),n=[];for(let e=0;e<t.length;e++){const i=t[e];i!==o&&i.checked&&n.push(i.value)}let r=n.join(",");o.value=r,e.value=r,i(e)}},isSelected:(t,e)=>{if(String(e.value).trim()===String(t.value).trim())return!0;if(t.value&&-1!==t.value.indexOf(e.value)){if(-1!==t.value.split(",").indexOf(e.value))return!0}return!1}}),qo=(t,e,i)=>e.quantityInput&&e.priceVariant?et`
            <div class="cl-po--quantity-input">
                <input type="number" class="cl-po--input" min="1" step="1" max="999" .value=${e.priceVariant.quantity} @input=${Fo(t,(o=>{e.priceVariant.quantity=parseInt(o.target.value),i(t)}))}>
            </div>
        `:null,Uo=t=>et`
    ${t._layer.params.collapseLabel?et`<span class="cl-po--edit-label">${t._layer.params.collapseLabel}</span>`:null}
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20"><path d="M15.728 9.686l-1.414-1.414L5 17.586V19h1.414l9.314-9.314zm1.414-1.414l1.414-1.414-1.414-1.414-1.414 1.414 1.414 1.414zM7.242 21H3v-4.243L16.435 3.322a1 1 0 0 1 1.414 0l2.829 2.829a1 1 0 0 1 0 1.414L7.243 21z" fill="var(--text-editor-color)"/></svg>
`,Wo=(t,e,i,o="")=>et`
    <div class="cl-po--collapse ${i?o+" cl-po--open":o}" @click=${t=>(t=>{let e=t.currentTarget,i=-1!==e.className.indexOf("open"),o=e.nextElementSibling;i||(o.style.maxHeight=o.scrollHeight+100+"px",setTimeout((()=>{o.style.maxHeight&&(o.style.maxHeight=null)}),500)),e.classList.toggle("cl-po--open")})(t)}>${t}</div>
    <div class="cl-po--panel ${o}">
        ${e}
    </div>
`
/**
 * @license
 * Copyright (c) 2020 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */,Go=_((t=>e=>{let i;if(e instanceof Y||e instanceof B)throw new Error("The `live` directive is not allowed on text or event bindings");if(e instanceof q)Yo(e.strings),i=e.element.hasAttribute(e.name),e.value=i;else{const{element:o,name:n,strings:r}=e.committer;if(Yo(r),e instanceof W){if(i=o[n],i===t)return}else e instanceof z&&(i=o.getAttribute(n));if(i===String(t))return}e.setValue(t)})),Yo=t=>{if(2!==t.length||""!==t[0]||""!==t[1])throw new Error("`live` bindings can only contain a single expression")};co.templates.hidden=(t,e,i)=>et`
    <input type="hidden" id="${t.id}" name="${No(t)}" .value=${Go(t.value)} form=${Pi(e.productFormLink)}>
`,co.templates["value-formula"]=(t,e,i)=>et`
        <style>[data-option="${t.name}"] { display:none; }</style>
        ${co.templates.hidden(t,e,i)}}
`
/**
 * @license
 * Copyright (c) 2018 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */;class Xo{add(t){this.classes.add(t),this.changed=!0}remove(t){this.classes.delete(t),this.changed=!0}commit(){if(this.changed){let t="";this.classes.forEach((e=>t+=e+" ")),this.element.setAttribute("class",t)}}constructor(t){this.classes=new Set,this.changed=!1,this.element=t;const e=(t.getAttribute("class")||"").split(/\s+/);for(const t of e)this.classes.add(t)}}const Qo=new WeakMap,Zo=_((t=>e=>{if(!(e instanceof z)||e instanceof W||"class"!==e.committer.name||e.committer.parts.length>1)throw new Error("The `classMap` directive must be used in the `class` attribute and must be the only part in the attribute.");const{committer:i}=e,{element:o}=i;let n=Qo.get(e);void 0===n&&(o.setAttribute("class",i.strings.join(" ")),Qo.set(e,n=new Set));const r=o.classList||new Xo(o);n.forEach((e=>{e in t||(r.remove(e),n.delete(e))}));for(const e in t){const i=t[e];i!=n.has(e)&&(i?(r.add(e),n.add(e)):(r.remove(e),n.delete(e)))}"function"==typeof r.commit&&r.commit()})),Jo=new WeakMap,Ko=_((t=>e=>{if(!(e instanceof z)||e instanceof W||"style"!==e.committer.name||e.committer.parts.length>1)throw new Error("The `styleMap` directive must be used in the style attribute and must be the only part in the attribute.");const{committer:i}=e,{style:o}=i.element;let n=Jo.get(e);void 0===n&&(o.cssText=i.strings.join(" "),Jo.set(e,n=new Set)),n.forEach((e=>{e in t||(n.delete(e),-1===e.indexOf("-")?o[e]=null:o.removeProperty(e))}));for(const e in t)n.add(e),-1===e.indexOf("-")?o[e]=t[e]:o.setProperty(e,t[e])}));co.templates.text=(t,e,i)=>et`
    <input type="text" class="cl-po--input ${Zo(Po(t))}" id="${t.id}" name="${No(t)}" .value=${Go(t.value)} @input=${Fo(t,(e=>Ro(e,t,i)))}
      ?required=${t.required} minlength=${Pi(t.params.min)} maxlength=${Pi(t.params.max)} pattern=${Pi(t.params.pattern||void 0)} placeholder=${Pi(t.params.placeholder)} autocomplete="${Do(t)}" inputmode=${Pi(t.params.inputmode)} form=${Pi(e.productFormLink)} style=${Ko({textTransform:t.params.textTransform})}>

    ${t._editor?t._layer.params.collapse?et`${Wo(Uo(t),co.templates.text_editor(t,e,i),!1,"cl-po--edit")}`:et`${co.templates.text_editor(t,e,i)}`:null}
`,co.templates.textarea=(t,e,i,o,n)=>et`
    <textarea class="cl-po--input ${Zo(Po(t))}" id="${t.id}" name="${No(t)}" .value=${Go(yo(t.value))} @input=${Fo(t,(e=>Ro(e,t,i)))} @keyup=${t.params.textUsage?e=>fo(e,t):null}
     ?required=${t.required} minlength=${Pi(t.params.min)} maxlength=${Pi(t.params.max)} rows=${Pi(t.params.rows)} placeholder=${Pi(yo(t.params.placeholder))} style=${Ko({textTransform:t.params.textTransform,fontFamily:Vo(t,n)})} autocomplete="${Do(t)}" form=${Pi(e.productFormLink)}>
    </textarea>

    ${t._editor?t._layer.params.collapse?et`${Wo(Uo(t),co.templates.text_editor(t,e,i),!1,"cl-po--edit")}`:et`${co.templates.text_editor(t,e,i)}`:null}
        
    ${t.params.textUsage?et`
        <div class="cl-po--help cl-po--text-help"></div>
    `:null}
`,co.templates.text_editor=(t,e,i)=>et`
    <div class="cl-po--text-editor">

        ${co.templates.hidden({id:t.id+"_editor",name:"_"+t.name+"_editor",params:{},value:Ho(t)},e)}
        
        ${t._layer.params.editor.font?et`
        <div class="cl-po--editor-group cl-po--font-family">
            ${co.templates.font({id:t.id+"_font",name:t.name+"_font",params:{name:t.name+"_font"},value:t._editor.fontFamily},e,(e=>{t._editor.fontFamily=e.value,i(t)}))}
        </div>`:null}
        ${t._layer.params.editor.style?et` 
        <div class="cl-po--editor-group cl-po--font-style">
            <div @click=${e=>{t._editor.fontWeight="bold"===t._editor.fontWeight?"normal":"bold",i(t)}} class="cl-po--swatch cl-po--swatch-button ${"bold"===t._editor.fontWeight?"selected":""}" data-tippy-content="${l.get("product.options.text.style.bold")}" data-tippy-placement="bottom">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path d="M8 11h4.5a2.5 2.5 0 1 0 0-5H8v5zm10 4.5a4.5 4.5 0 0 1-4.5 4.5H6V4h6.5a4.5 4.5 0 0 1 3.256 7.606A4.498 4.498 0 0 1 18 15.5zM8 13v5h5.5a2.5 2.5 0 1 0 0-5H8z" fill="var(--text-editor-color)"/></svg>
            </div>
            <div @click=${e=>{t._editor.fontStyle="italic"===t._editor.fontStyle?"normal":"italic",i(t)}} class="cl-po--swatch cl-po--swatch-button ${"italic"===t._editor.fontStyle?"selected":""}" data-tippy-content="${l.get("product.options.text.style.italic")}" data-tippy-placement="bottom">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path d="M15 20H7v-2h2.927l2.116-12H9V4h8v2h-2.927l-2.116 12H15z" fill="var(--text-editor-color)"/></svg>
            </div>
        </div>`:null}
        ${t._layer.params.editor.align?et` 
        <div class="cl-po--editor-group cl-po--text-align">
            <div @click=${e=>{t._editor.textAlign="left",i(t)}} class="cl-po--swatch cl-po--swatch-button ${"left"===t._editor.textAlign?"selected":""}" data-tippy-content="${l.get("product.options.text.align.left")}" data-tippy-placement="bottom">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path d="M3 4h18v2H3V4zm0 15h14v2H3v-2zm0-5h18v2H3v-2zm0-5h14v2H3V9z" fill="var(--text-editor-color)"/></svg>
            </div>
            <div @click=${e=>{t._editor.textAlign="center",i(t)}} class="cl-po--swatch cl-po--swatch-button ${"center"===t._editor.textAlign?"selected":""}" data-tippy-content="${l.get("product.options.text.align.center")}" data-tippy-placement="bottom">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path d="M3 4h18v2H3V4zm2 15h14v2H5v-2zm-2-5h18v2H3v-2zm2-5h14v2H5V9z" fill="var(--text-editor-color)"/></svg>
            </div>
            <div @click=${e=>{t._editor.textAlign="right",i(t)}} class="cl-po--swatch cl-po--swatch-button ${"right"===t._editor.textAlign?"selected":""}" data-tippy-content="${l.get("product.options.text.align.right")}" data-tippy-placement="bottom">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path d="M3 4h18v2H3V4zm4 15h14v2H7v-2zm-4-5h18v2H3v-2zm4-5h14v2H7V9z" fill="var(--text-editor-color)"/></svg>
            </div>
        </div>`:null}
        ${t._layer.params.editor.size?et` 
        <div class="cl-po--editor-group cl-po--font-size">
            <div @click=${e=>{t._editor.fontSize=Math.max(t._layer.params.fontSizeMin||1,t._editor.fontSize-(t._layer.params.fontSizeStep||1)),i(t)}} class="cl-po--swatch cl-po--swatch-button">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path d="M5 11h14v2H5z" fill="var(--text-editor-color)"/></svg>
            </div>
            <div class="cl-po--swatch cl-po--swatch-button icon" data-tippy-content="${l.get("product.options.text.fontSize")}" data-tippy-placement="bottom">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path d="M11.246 15H4.754l-2 5H.6L7 4h2l6.4 16h-2.154l-2-5zm-.8-2L8 6.885 5.554 13h4.892zM21 12.535V12h2v8h-2v-.535a4 4 0 1 1 0-6.93zM19 18a2 2 0 1 0 0-4 2 2 0 0 0 0 4z" fill="var(--text-editor-color)"/></svg>
            </div>
            <div @click=${e=>{t._editor.fontSize=Math.min(t._layer.params.fontSizeMax||1e5,t._editor.fontSize+(t._layer.params.fontSizeStep||1)),i(t)}} class="cl-po--swatch cl-po--swatch-button">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path d="M11 11V5h2v6h6v2h-6v6h-2v-6H5v-2z" fill="var(--text-editor-color)"/></svg>
            </div>
        </div>`:null}
         ${t._layer.params.editor.color?et` 
        <div class="cl-po--editor-group cl-po--font-color">
            ${co.templates.color({id:t.id+"_color",name:t.name+"_color",params:{name:t.name+"_color"},value:t._editor.color||"#000000"},e,(e=>{t._editor.color=e.value,i(t)}))}
            ${So()?et`
            <div class="cl-po--font-color-input">
            ${co.templates.color_input({id:t.id+"_color",name:t.name+"_color",params:{name:t.name+"_color"},value:t._editor.color||"#000000"},e,(e=>{t._editor.color=e.value,i(t)}))}
              </div>`:null}
        </div>`:null}
        
    </div>
    
    ${t._layer?et`${co.templates.layer_editor(t,e,i)}`:null}
`;var tn,en={};tn=function(){var t=function(){},e={},i={},o={};function n(t,e){if(t){var n=o[t];if(i[t]=e,n)for(;n.length;)n[0](t,e),n.splice(0,1)}}function r(e,i){e.call&&(e={success:e}),i.length?(e.error||t)(i):(e.success||t)(e)}function s(e,i,o,n){var r,a,l=document,c=o.async,p=(o.numRetries||0)+1,d=o.before||t,h=e.replace(/[\?|#].*$/,""),u=e.replace(/^(css|img)!/,"");n=n||0,/(^css!|\.css$)/.test(h)?((a=l.createElement("link")).rel="stylesheet",a.href=u,(r="hideFocus"in a)&&a.relList&&(r=0,a.rel="preload",a.as="style")):/(^img!|\.(png|gif|jpg|svg|webp)$)/.test(h)?(a=l.createElement("img")).src=u:((a=l.createElement("script")).src=e,a.async=void 0===c||c),a.onload=a.onerror=a.onbeforeload=function(t){var l=t.type[0];if(r)try{a.sheet.cssText.length||(l="e")}catch(t){18!=t.code&&(l="e")}if("e"==l){if((n+=1)<p)return s(e,i,o,n)}else if("preload"==a.rel&&"style"==a.as)return a.rel="stylesheet";i(e,l,t.defaultPrevented)},!1!==d(e,a)&&l.head.appendChild(a)}function a(t,i,o){var a,l;if(i&&i.trim&&(a=i),l=(a?o:i)||{},a){if(a in e)throw"LoadJS";e[a]=!0}function c(e,i){!function(t,e,i){var o,n,r=(t=t.push?t:[t]).length,a=r,l=[];for(o=function(t,i,o){if("e"==i&&l.push(t),"b"==i){if(!o)return;l.push(t)}--r||e(l)},n=0;n<a;n++)s(t[n],o,i)}(t,(function(t){r(l,t),e&&r({success:e,error:i},t),n(a,t)}),l)}if(l.returnPromise)return new Promise(c);c()}return a.ready=function(t,e){return function(t,e){t=t.push?t:[t];var n,r,s,a=[],l=t.length,c=l;for(n=function(t,i){i.length&&a.push(t),--c||e(a)};l--;)r=t[l],(s=i[r])?n(r,s):(o[r]=o[r]||[]).push(n)}(t,(function(t){r(e,t)})),a},a.done=function(t){n(t,[])},a.reset=function(){e={},i={},o={}},a.isDefined=function(t){return t in e},a},"function"==typeof define&&define.amd?define([],tn):en=tn();class on{static load(e,i,o={async:!0}){return o.returnPromise=!0,t(en)(e,i,o)}static isReady(e){return Array.isArray(e)||(e=[e]),new Promise(((i,o)=>{t(en).ready(e,(()=>{i(e)}))}))}static isDefined(e){return t(en).isDefined(e)}static loadOnce(t,e,i={async:!0}){return on.isDefined(e)?on.isReady(e):on.load(t,e,i)}}var nn=on;class rn{setup(){if(this.native=Oo(),this.native)this.ready=Promise.resolve();else{let t=[this.config.assets+"/static/lib/dateinput/dateinput.min.js"];this.ready=nn.loadOnce(t,"option-date",{async:!1})}}onValidate(){let t=this.dateEl,e=t.checkValidity(),i=!1,o=!1;if(e&&!this.native){if(t.min){let o=new Date(t.min+"T00:00:00");t.valueAsDate<o&&(e=!1,i=!0)}if(t.max){let i=new Date(t.max+"T00:00:00");t.valueAsDate>i&&(e=!1,o=!0)}}if(!e){if(t.validity.rangeUnderflow||i){let e=t.min,i=new Date(e+"T00:00:00");i.setDate(i.getDate()-1),e=this.format(i,this.option.params.dateFormat||"yyyy-mm-dd"),this.option.errors.push(l.get("product.options.validity.dateMin",{min:e}))}else if(t.validity.rangeOverflow||o){let e=t.max,i=new Date(e+"T00:00:00");i.setDate(i.getDate()+1),e=this.format(i,this.option.params.dateFormat||"yyyy-mm-dd"),this.option.errors.push(l.get("product.options.validity.dateMax",{max:e}))}else this.option.errors.push(l.get("product.options.validity.valueMissing"));return!1}return!0}handleChange(t,e){this.mapDateValue(e),this.onChange(e)}mapDateValue(t){if(this.dateEl.value)if(t.params.dateFormat){let e=this.dateEl.valueAsDate,i=new Date(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds());this.el.value=this.format(i,t.params.dateFormat)}else this.el.value=this.dateEl.value;else this.el.value="";t.value=this.el.value}mapOptionValue(){if(this.option.value&&this.option.value!==this.el.value){let t,e=this.option.params.dateFormat;if(e&&"yyyy-mm-dd"!==e){let i;if(-1!==e.indexOf("/")?i=e.startsWith("yyyy")?/(?<year>\d{4})\/(?<month>\d{2})\/(?<day>\d{2})/:/(?<day>\d{2})\/(?<month>\d{2})\/(?<year>\d{4})/:-1!==e.indexOf(".")&&(i=e.startsWith("dd")?/(?<day>\d{2})\.(?<month>\d{2})\.(?<year>\d{4})/:/(?<month>\d{2})\.(?<day>\d{2})\.(?<year>\d{4})/),i){let e=i.exec(this.option.value);e&&(t=new Date(e.groups.year,e.groups.month-1,e.groups.day))}}else t=new Date(this.option.value+"T00:00:00");if(t)return this.dateEl.valueAsDate=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate())),!0}return!1}format(t,e){return-1!==e.indexOf("mmmm")?e=e.replace("mmmm",t.toLocaleString("default",{month:"long"})):-1!==e.indexOf("mmm")&&(e=e.replace("mmm",t.toLocaleString("default",{month:"short"}))),e=(e=(e=(e=e.replace("yyyy",t.getFullYear())).replace("yy",t.getFullYear().toString().substr(-2))).replace("mm",("0"+(t.getMonth()+1)).slice(-2))).replace("dd",("0"+t.getDate()).slice(-2))}init(t,e){e&&(this.options=e),this.ready.then((()=>{if(this.el=document.querySelector("#"+t.id),this.dateEl=document.querySelector("#"+t.id+"-date"),!this.native){if(window.navigator&&window.navigator.language){let t=navigator.language,e=t.substr(0,2);this.dateEl.setAttribute("lang",t),"en"!==e&&this.dateEl.setAttribute("data-first-day","mo")}t.params.dateFormat&&this.dateEl.setAttribute("data-date-format",t.params.dateFormat)}this.mapOptionValue(),this.initMinMax(t)}))}initMinMax(t){const e=e=>{if(e.setDate(e.getDate()+t.params.maxDays),t.params.maxDate){let i=new Date(t.params.maxDate+"T00:00:00");e>i&&(e=i)}this.dateEl.max=this.format(e,"yyyy-mm-dd"),this.dateEl.valueAsDate&&this.dateEl.valueAsDate>e&&(this.dateEl.valueAsDate=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())),this.mapDateValue(t))},i=e=>{if(e.setDate(e.getDate()+t.params.minDays),t.params.minDate){let i=new Date(t.params.minDate+"T00:00:00");e<i&&(e=i)}this.dateEl.min=this.format(e,"yyyy-mm-dd"),(!t.value||this.dateEl.valueAsDate&&this.dateEl.valueAsDate<e)&&(this.dateEl.valueAsDate=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())),this.mapDateValue(t))},o=!isNaN(t.params.maxDays)&&null!=t.params.maxDays,n=!isNaN(t.params.minDays)&&null!=t.params.minDays;if(n||o){const r=t=>{o&&e(new Date(t.getTime())),n&&i(new Date(t.getTime()))};let s=new Date;if(t.params.optionDate){if(this.options)for(let e=0;e<this.options.length;e++){const i=this.options[e];if(i.name===t.params.optionDate&&i._controller&&i._controller.dateEl){s=i._controller.dateEl.valueAsDate;break}}this.optionChanged&&this.config.productForm.removeEventListener("option:changed",this.optionChanged),this.optionChanged=e=>{let i=e.detail;i.name===t.params.optionDate&&i._controller&&i._controller.dateEl&&(r(i._controller.dateEl.valueAsDate),this.onChange(t))},this.config.productForm.addEventListener("option:changed",this.optionChanged)}r(s)}else if(this.dateEl.min){let e=new Date(this.dateEl.min+"T00:00:00");(!t.value||this.dateEl.valueAsDate&&this.dateEl.valueAsDate<e)&&(this.dateEl.valueAsDate=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())),this.mapDateValue(t))}}constructor(t,e){this.onChange=t,this.getOption=e,this.config=null,this.option=null}}function sn(t){if(Math.floor(t)===t)return 0;const e=t.toString();return-1!==e.indexOf(".")&&-1===e.indexOf("e")?e.split(".")[1].length:0}function an(t,e,i,o,n){const r=parseFloat(t)||0,s=e||1,a=Math.max(sn(r),sn(s)),l=Math.pow(10,a),c=(Math.round(r*l)+Math.round(s*l)*i)/l;return i>0?Math.min(c,n||Number.MAX_SAFE_INTEGER):Math.max(c,o||0)}co.templates.date=(t,e,i)=>{let o=void 0===t._controller;if(t._controller=t._controller||new rn(i),t._controller.config=e,t._controller.option=t,e.productForm)if(o){t._controller.setup();const i=o=>{let n=o.detail;e.productForm.removeEventListener("options:rendered",i),t._controller.init(t,n.config.options)};e.productForm.addEventListener("options:rendered",i)}else e.editorMode?t._controller.init(t):t._controller.mapOptionValue()&&t._controller.initMinMax(t);return et`
         <input type="hidden" name="${No(t)}" id="${t.id}" .value=${Go(t.value)} form=${Pi(e.productFormLink)}  />
         <input type="date" class="cl-po--input ${Zo(Po(t))}" id="${t.id}-date" @change=${e=>t._controller.handleChange(e,t)}
            ?required=${t.required} min=${Pi(null!=t.params.minDate?t.params.minDate:void 0)} max=${Pi(null!=t.params.maxDate?t.params.maxDate:void 0)}>
    `},co.templates.number=(t,e,i)=>t.params.numberSteps?et`
            <div class="cl-po--quantity-wrap cl-po--number-steps">
                <span class="cl-po--quantity-btn" @click=${e=>{var o,n,r;t.value=(o=t.value,n=t.params.numberStep||1,r=t.params.min||0,an(o,n,-1,r,Number.MAX_SAFE_INTEGER)),i(t)}}>-</span>
                <input type="number" class="cl-po--input cl-po--quantity ${Zo(Po(t))}" id="${t.id}" name="${No(t)}" .value=${Go(t.value)} @input=${Fo(t,(e=>jo(e,t,i)))}
                       ?required=${t.required} step="any" min=${Pi(t.params.min)} max=${Pi(t.params.max)} placeholder=${Pi(t.params.placeholder)} autocomplete="${Do(t)}" form=${Pi(e.productFormLink)}>
                <span class="cl-po--quantity-btn" @click=${e=>{var o,n,r;t.value=(o=t.value,n=t.params.numberStep||1,r=t.params.max||Number.MAX_SAFE_INTEGER,an(o,n,1,0,r)),i(t)}}>+</span>
            </div>
        `:et`
            <input type="number" class="cl-po--input ${Zo(Po(t))}" id="${t.id}" name="${No(t)}" .value=${Go(t.value)} @input=${Fo(t,(e=>jo(e,t,i)))}
                   ?required=${t.required} step="any" min=${Pi(t.params.min)} max=${Pi(t.params.max)} placeholder=${Pi(t.params.placeholder)} autocomplete="${Do(t)}" form=${Pi(e.productFormLink)}>
        `;class ln{onValidate(t){return!t.required||t.value&&0!==this.x&&(t.params.onlyX||0===t.params.minY||0!==this.y)?(this.validateDimension(t,t.errors,!this.xInput,!this.yInput),!t.errors.length):(t.errors.push(l.get("product.options.validity.valueMissing")),!1)}validateDimension(t,e,i=!1,o=!1){let n=this.x,r=this.y;if(t.params.bigX&&n<r){let t=n;n=r,r=t}const s=t=>t&&"#"===t[0]?t.substring(1):t;!i&&t.params.minX&&n<t.params.minX&&e.push(l.get(s(t.params.minXKey)||"{label} must be at least {min} {addon}",{label:t.params.labelX,min:t.params.minX,addon:t.params.addonX})),!o&&t.params.minY&&r<t.params.minY&&e.push(l.get(s(t.params.minYKey)||"{label} must be at least {min} {addon}",{label:t.params.labelY,min:t.params.minY,addon:t.params.addonY})),t.params.maxX&&n>t.params.maxX&&e.push(l.get(s(t.params.maxXKey)||"{label} must be at most {max} {addon}",{label:t.params.labelX,max:t.params.maxX,addon:t.params.addonX})),t.params.maxY&&r>t.params.maxY&&e.push(l.get(s(t.params.maxYKey)||"{label} must be at most {max} {addon}",{label:t.params.labelY,max:t.params.maxY,addon:t.params.addonY}))}optionValue(t){return(t.params.valueTemplate||"{x}x{y}").replace(new RegExp("{x}","g"),this.x).replace(new RegExp("{y}","g"),this.y).replace(new RegExp("{area}","g"),this.area.toFixed(2))}handleChange(t,e,i=!1){i||(this.xEl=this.xEl||document.querySelector("#"+e.id+"-x"),this.yEl=this.yEl||document.querySelector("#"+e.id+"-y"),null!=e.params.ratio&&(this.xEl.value!==this.xInput?this.yEl.value=parseFloat(this.xEl.value/e.params.ratio).toFixed(2):this.xEl.value=parseFloat(this.yEl.value*e.params.ratio).toFixed(2)),this.xInput=this.xEl.value,this.yInput=this.yEl.value);const o=t=>t?t.replaceAll(",","."):"0";if(this.x=parseFloat(o(this.xInput))||0,this.y=parseFloat(o(this.yInput))||0,e.params.steps){let t=e.params.steps;this.x%t!=0&&(this.x=Math.round(this.x/t)*t),this.y%t!=0&&(this.y=Math.round(this.y/t)*t),(isNaN(e.params.rounding)||null===e.params.rounding)&&(e.params.rounding=0)}if(!isNaN(e.params.rounding)&&null!==e.params.rounding){let i=null==t;if(0!==this.x){let t=this.x.toFixed(e.params.rounding);this.x=parseFloat(t),i?this.xInput=t:(this.xInputBlur=()=>{this.xInput=t,this.xEl.value=this.xInput,delete this.xInputBlur},this.xEl.addEventListener("blur",(t=>{this.xInputBlur&&this.xInputBlur()}),{once:!0}))}if(0!==this.y){let t=this.y.toFixed(e.params.rounding);this.y=parseFloat(t),i?this.yInput=t:(this.yInputBlur=()=>{this.yInput=t,this.yEl.value=this.yInput,delete this.yInputBlur},this.yEl.addEventListener("blur",(t=>{this.yInputBlur&&this.yInputBlur()}),{once:!0}))}this.blurInterval||!this.xInputBlur&&!this.yInputBlur||(this.blurInterval=setInterval((()=>{this.xInputBlur&&document.activeElement!==this.xEl&&this.xInputBlur(),this.yInputBlur&&document.activeElement!==this.yEl&&this.yInputBlur(),this.xInputBlur||this.yInputBlur||(clearInterval(this.blurInterval),delete this.blurInterval)}),500))}if(e.params.areaCalc)try{if(!e._areaFunction)try{e._areaFunction=Function('"use strict";return (function(x,y){ return ('+e.params.areaCalc+") })")()}catch(t){s.error("failed to parse areaCalc: ",e.params.areaCalc,t),e.config&&e.config.editorMode&&(e.errors=e.errors||[],e.errors.push(t))}e._areaFunction&&(this.area=e._areaFunction(this.x,this.y),this.area||(this.area=0))}catch(t){s.error("failed to calculate area with areaCalc: ",e.params.areaCalc,t),e.config&&e.config.editorMode&&(e.errors=e.errors||[],e.errors.push(t))}else this.area=this.x*this.y;let n=[];this.validateDimension(e,n,!this.xInput,!this.yInput),n.length&&(e.errors=n,e._error=!0),e.value=this.optionValue(e),e.values||(e.values=[]);let r="";if(e.list&&(r="var lookup=function(x,y,t){return options.lookup(option._controller.list(option), x,y,t)};",!e.params.priceFormula&&e.values.length&&(e.values[0].values?e.params.priceFormula="lookup(x, y)":e.params.priceFormula="lookup(area) * area")),e.params.priceFormula)if(e.values.length&&e.values[0]._calc)e.values[0].value=e.value;else{let t="var x=option._controller.x;var y=option._controller.y;var area=option._controller.area;"+r;-1===e.params.priceFormula.indexOf("return")?t+="return ("+e.params.priceFormula+")":t+=e.params.priceFormula;let i={value:e.value,text:"",priceType:so.FORMULA,priceFormula:t,_calc:!0};e.values.unshift(i)}else e.values.unshift({value:e.value,text:""});this.onChange(e)}list(t){return t.values.slice(1)}restore(t){if(t.value&&t.value!==this.optionValue(t)){let e=(t.params.valueTemplate||"{x}x{y}").replace(".","\\.").replace("*","\\*").replace(new RegExp("{x}","g"),"(?<x>.*)").replace(new RegExp("{y}","g"),"(?<y>.*)").replace(new RegExp("{area}","g"),"(?<area>.*)"),i=new RegExp(e,"g").exec(t.value);if(i&&i.groups)return void 0!==i.groups.x&&(this.xInput=i.groups.x),void 0!==i.groups.y&&(this.yInput=i.groups.y),this.handleChange(null,t,!0),!0}return!1}init(t,e){isNaN(t.params.valueX)||null===t.params.valueX||(this.xInput=String(t.params.valueX)),isNaN(t.params.valueY)||null===t.params.valueY||(this.yInput=String(t.params.valueY)),t.value&&this.restore(t)||(this.xInput||this.yInput)&&this.handleChange(null,t,!0)}stepDec(t,e){let i=this[e],o=t.params.numberStep||1,n=isNaN(t.params.rounding)||null===t.params.rounding?null:t.params.rounding,r=Math.round(i/o);const s=Math.pow(10,-10);Math.abs(i-r*o)<s?i-=o:i=Math.floor(i/o)*o,i=Math.max(i,t.params["min"+e.toUpperCase()]||0);let a=this[e+"El"];a||(a=document.querySelector("#"+t.id+"-"+e)),a.value=null!==n?i.toFixed(n):i.toString(),this.handleChange(null,t)}stepInc(t,e){let i=this[e],o=t.params.numberStep||1,n=isNaN(t.params.rounding)||null===t.params.rounding?null:t.params.rounding,r=Math.round(i/o);const s=Math.pow(10,-10);Math.abs(i-r*o)<s?i+=o:i=Math.ceil(i/o)*o,i=Math.min(i,t.params["max"+e.toUpperCase()]||Number.MAX_SAFE_INTEGER);let a=this[e+"El"];a||(a=document.querySelector("#"+t.id+"-"+e)),a.value=null!==n?i.toFixed(n):i.toString(),this.handleChange(null,t)}constructor(t){this.onChange=t,this.x=0,this.y=0,this.area=0,this.xInput="",this.yInput="",this.xEl=null,this.yEl=null}}co.templates.dimension=(t,e,i)=>{let o=void 0===t._controller;if(t._controller=t._controller||new ln(i),o){const i=()=>{e.productForm.removeEventListener("options:rendered",i),t._controller.init(t)};e.productForm.addEventListener("options:rendered",i)}else t.value&&!t._controller.xEl&&t._controller.restore(t);const n=et`<input type="text" class="cl-po--input ${Zo(Po(t))}" id="${t.id}-x" name="properties[_${t.name}_x]" 
                .value=${Go(t._controller.xInput)} @input=${Fo(t,(e=>t._controller.handleChange(e,t)))} 
                ?required=${t.required} form=${Pi(e.productFormLink)}>`,r=et`<input type="text" class="cl-po--input ${Zo(Po(t))}" id="${t.id}-y" name="properties[_${t.name}_y]" 
                .value=${Go(t._controller.yInput)} @input=${Fo(t,(e=>t._controller.handleChange(e,t)))}
                ?required=${t.required&&!t.params.onlyX} form=${Pi(e.productFormLink)}>`;return et`
            <input type="hidden" name="${No(t)}" id="${t.id}" value=${t.value} form=${Pi(e.productFormLink)} />
            <div class="cl-po--dimension-container">
                 <div class="cl-po--dimension-item ${Zo({full:t.params.onlyX})}">
                     ${t.params.labelX?et`<label class="cl-po--label" for="${t.id}-x">${t.params.labelX}</label>`:null}
                     <div class="cl-po--input-group ${Zo({"cl-po--dimension-steps":t.params.numberSteps,"cl-po--addon":t.params.addonX})}">
                         ${t.params.numberSteps?et`<div class="cl-po--quantity-wrap">
                                <span class="cl-po--quantity-btn" @click=${e=>{t._controller.stepDec(t,"x")}}>-</span>
                                ${n}
                                <span class="cl-po--quantity-btn" @click=${e=>{t._controller.stepInc(t,"x")}}>+</span>
                            </div>`:n}
                         ${t.params.addonX?et`<span class="cl-po--input cl-po--input-addon">${t.params.addonX}</span>`:null}
                     </div>
                 </div>
                <div class="cl-po--dimension-item ${Zo({"cl-hide":t.params.onlyX})}">
                    ${t.params.labelY?et`<label class="cl-po--label" for="${t.id}-y">${t.params.labelY}</label>`:null}
                    <div class="cl-po--input-group ${Zo({"cl-po--dimension-steps":t.params.numberSteps,"cl-po--addon":t.params.addonY})}">
                        ${t.params.numberSteps?et`<div class="cl-po--quantity-wrap">
                                <span class="cl-po--quantity-btn" @click=${e=>{t._controller.stepDec(t,"y")}}>-</span>
                                ${r}
                                <span class="cl-po--quantity-btn" @click=${e=>{t._controller.stepInc(t,"y")}}>+</span>
                            </div>`:r}
                        ${t.params.addonY?et`<span class="cl-po--input cl-po--input-addon">${t.params.addonY}</span>`:null}
                    </div>
                </div>
           </div>
        `},co.templates.email=(t,e,i)=>(t.params.pattern||(t.params.pattern="[a-zA-Z0-9._%+\\-]+@[a-z0-9.\\-]+\\.[a-z]{2,}$",t.params.inputmode="email"),co.templates.text(t,e,i)),co.templates.radio=(t,e,i)=>et`
    ${Ii(t.values||[],(t=>t.value),((o,n)=>et`
        <label class="cl-po--radio-item ${Zo(Lo(t,o))}" >
            <input type="radio" class="cl-po--input ${Zo(Po(t))}" id="${t.id}-${n}" name="${No(t)}" .value=${o.value} @change=${e=>jo(e,t,i)}
                   .checked=${Go(t.value==o.value)} ?required=${t.required} ?disabled=${o.disabled} form=${Pi(e.productFormLink)}>
            ${vi(xo(t,o,oo.moneyFormat))}
        </label>
    `))}
`,co.templates.checkbox=(t,e,i)=>(t._controller=t._controller||Bo(0,0,i),et`
        <input type="hidden" name="${No(t)}" id="${t.id}" value=${t.value} form=${Pi(e.productFormLink)} />
        ${Ii(t.values||[],(t=>t.value),((o,n)=>et`
        <label class="cl-po--checkbox-item ${Zo(Lo(t,o))}">
            <input type="checkbox" class="cl-po--input ${Zo(Po(t))}" id="${t.id}-${n}" .value=${o.value} @change=${e=>t._controller.onChange(e,t)}
                   .checked=${Go(t._controller.isSelected(t,o))} ?disabled=${o.disabled} form=${Pi(e.productFormLink)}>
            ${vi(xo(t,o,oo.moneyFormat))}
            ${qo(t,o,i)}
        </label>
    `))}
    `),co.templates.select=(t,e,i)=>{let o=t.params.groupDelimiter?zo(t.values,t.params.groupDelimiter):null;const n=(e,i)=>et`
        <option class="${Zo(Lo(t,e))}" .value=${e.value} ?selected=${t.value==e.value} ?disabled=${e.disabled}> ${xo(t,e,oo.moneyFormat,!0)}</option>
    `;return et`
    <select class="cl-po--input ${Zo(Po(t))}" id="${t.id}" .value=${Go(t.value)} name="${No(t)}" @change=${e=>jo(e,t,i)} ?required=${t.required} form=${Pi(e.productFormLink)}>
        ${t.value?null:et`
           <option value="" selected>${t.params.textValueSelect||""}</option>`}

        ${o?.length?et`
            ${Ii(o,(t=>t.label),((t,e)=>et`
                ${t.groupLabel?et`
                    <optgroup label="${t.groupLabel}">
                        ${Ii(t.values,(t=>t.value),n)}
                    </optgroup>`:n(t)}
            `))}`:et`${Ii(t.values||[],(t=>t.value),n)}`}
    </select>
    ${t._editor?t._layer.params.collapse?et`${Wo(Uo(t),co.templates.text_editor(t,e,i),!1,"cl-po--edit")}`:et`${co.templates.text_editor(t,e,i)}`:null}
`};class cn{init(t){let e=this.codes;if(t.params.countryCodes&&(Array.isArray(t.params.countryCodes)?e=t.params.countryCodes:"string"==typeof t.params.countryCodes&&(e=t.params.countryCodes.split(","))),t.values=e.map((t=>{try{return{value:t,text:this.regionNames.of(t)}}catch(e){return s.warn("country code not found:",t),null}})).filter((t=>null!==t)),t.values.sort(((t,e)=>t.text.localeCompare(e.text))),window.Shopify?.country){let e=t.values.find((t=>t.value===window.Shopify.country));e&&(t.value=e.value)}}constructor(t,e){this.onChange=t,this.getOption=e,this.config=null,this.option=null,this.codes=["AC","AD","AE","AF","AG","AI","AL","AM","AO","AQ","AR","AS","AT","AU","AW","AX","AZ","BA","BB","BD","BE","BF","BG","BH","BI","BJ","BL","BM","BN","BO","BQ","BR","BS","BT","BV","BW","BY","BZ","CA","CC","CD","CF","CG","CH","CI","CK","CL","CM","CN","CO","CR","CU","CV","CW","CX","CY","CZ","DE","DG","DJ","DK","DM","DO","DZ","EA","EC","EE","EG","EH","ER","ES","ET","FI","FJ","FK","FM","FO","FR","GA","GB","GD","GE","GF","GG","GH","GI","GL","GM","GN","GP","GQ","GR","GS","GT","GU","GW","GY","HK","HM","HN","HR","HT","HU","IC","ID","IE","IL","IM","IN","IO","IQ","IR","IS","IT","JE","JM","JO","JP","KE","KG","KH","KI","KM","KN","KP","KR","KW","KY","KZ","LA","LB","LC","LI","LK","LR","LS","LT","LU","LV","LY","MA","MC","MD","ME","MF","MG","MH","MK","ML","MM","MN","MO","MP","MQ","MR","MS","MT","MU","MV","MW","MX","MY","MZ","NA","NC","NE","NF","NG","NI","NL","NO","NP","NR","NU","NZ","OM","PA","PE","PF","PG","PH","PK","PL","PM","PN","PR","PS","PT","PW","PY","QA","RE","RO","RS","RU","RW","SA","SB","SC","SD","SE","SG","SH","SI","SJ","SK","SL","SM","SN","SO","SR","SS","ST","SV","SX","SY","SZ","TA","TC","TD","TF","TG","TH","TJ","TK","TL","TM","TN","TO","TR","TT","TV","TW","TZ","UA","UG","UM","US","UY","UZ","VA","VC","VE","VG","VI","VN","VU","WF","WS","XK","YE","YT","ZA","ZM","ZW"],this.regionNames=new Intl.DisplayNames([navigator.language],{type:"region"})}}co.templates.country=(t,e,i)=>{let o=void 0===t._controller;return t._controller=t._controller||new cn(i),t._controller.option=t,t._controller.config=e,(o||e.editorMode)&&t._controller.init(t),co.templates.select(t,e,i)};class pn{setup(){let t=[this.config.assets+"/static/lib/choicesjs/choices.min.css",this.config.assets+"/static/lib/choicesjs/choices.min.js"];this.ready=nn.loadOnce(t,"option-dropdown",{async:!1})}mapValues(t){let e=t.values?t.values.map((e=>{let i=t.value==e.value;return!i&&t.value&&this.multiSelect&&(i=this.isSelected(t,e)),{value:e.value,label:xo(t,e,oo.moneyFormat),customProperties:e.img,selected:i,disabled:!0===e.disabled}})):[];return t.value||t.params.multiSelect?this._empty&&delete this._empty:(e.unshift({value:"",label:t.params.textValueSelect||"",selected:!0}),this._empty=!0),e}handleChangeMulti(t,e){let i=this.instance.getValue(!0).join(",");this.optionEl.value=i,e.value=i,this.onChange(e)}isSelected(t,e){if(String(e.value).trim()===String(t.value).trim())return!0;if(t.value&&-1!==t.value.indexOf(e.value)){if(-1!==t.value.split(",").indexOf(e.value))return!0}return!1}onValidate(t){if(t.required&&!t.value)return t.errors.push(l.get("product.options.validity.valueMissing")),!1;if(t.params.multiSelect){let e=t.value?t.value.split(",").length:0;if(t.params.minSelect&&e<t.params.minSelect)return t.errors.push(l.get("product.options.validity.selectMin",{min:t.params.minSelect})),!1;if(t.params.maxSelect&&e>t.params.maxSelect)return t.errors.push(l.get("product.options.validity.selectMax",{max:t.params.maxSelect})),!1}return!0}init(t){this.ready.then((()=>{let e=document.querySelector("#"+t.id);t.params.multiSelect?(this.optionEl=e,this.selectEl=document.querySelector("#"+t.id+"-select"),this.multiSelect=!0):this.selectEl=e;const i=t=>{let e=`<span class="o--text">${t.label}</span>`;return t.customProperties?`<img src="${go(t.customProperties,"200x")}" class="o--img"/> ${e}`:e};this.instance=new Choices(this.selectEl,{choices:this.mapValues(t),itemSelectText:"",noResultsText:"",noChoicesText:"",removeItemButton:!!t.params.multiSelect,maxItemCount:t.params.maxSelect?t.params.maxSelect:-1,maxItemText:t.params.maxSelect?l.get("product.options.validity.selectMax",{max:t.params.maxSelect}):"",searchPlaceholderValue:t.params.textSearchValues||"",searchEnabled:t.params.searchValues||!1,searchChoices:t.params.searchValues||!1,position:t.params.dropdownPosition||"auto",fuseOptions:window.clDropdownFuseOptions||{},shouldSort:!1,callbackOnCreateTemplates:function(e){return{item:(e,o,n)=>{let r=Choices.defaults.templates.item.apply(this,[e,o,n]),s=i(o);return t.params.multiSelect?(r.innerHTML=r.innerHTML.replace(o.label,s),r.lastElementChild.innerHTML="X"):r.innerHTML=s,""===o.value&&r.classList.add("cl-po--placeholder"),r},choice:(t,e,o)=>{let n=Choices.defaults.templates.choice.apply(this,[t,e,o]);return n.innerHTML=i(e),e.disabled&&n.classList.add("cl-po--disabled"),""===e.value&&n.classList.add("cl-po--placeholder"),n}}}})}))}updateChoices(t){this.instance&&(t.value&&t.params.multiSelect&&this.instance.clearStore(),this.instance.setChoices(this.mapValues(t),"value","label",!0))}update(t){this.instance&&(t.params.multiSelect?this.optionEl&&t.value!==this.optionEl.value&&this.instance.setChoiceByValue(t.value.split(",")):this.selectEl&&t.value!==this.selectEl.value&&this.instance.setChoiceByValue(t.value))}constructor(t){this.onChange=t,this.config=null,this.option=null,this.ready=null,this.instance=null,this.optionEl=null,this.selectEl=null,this.multiSelect=!1,this._empty=!1}}co.templates.dropdown=(t,e,i)=>{let o=void 0===t._controller;if(t._controller=t._controller||new pn(i),t._controller.config=e,t._controller.option=t,e.productForm)if(o){t._controller.setup();const i=()=>{e.productForm.removeEventListener("options:rendered",i),t._controller.init(t)};e.productForm.addEventListener("options:rendered",i)}else if(e.editorMode)t._controller.multiSelect!==(!0===t.params.multiSelect)?(delete t._controller.multiSelect,t._controller.init(t)):t._controller.updateChoices(t);else{if(t._controller.update(t),t.params.valuePriceText){let e=wo(t);e&&(e._priceFunction||e.priceType===so.PERCENTAGE)&&t._controller.updateChoices(t)}t._variantOption&&t._controller.updateChoices(t),t.value&&t._controller._empty&&(t._controller.updateChoices(t),delete t._controller._empty)}return t.params.multiSelect?et`
        <input type="hidden" name="${No(t)}" id="${t.id}" value=${t.value} form=${Pi(e.productFormLink)} />
        <select class="cl-po--input ${Zo(Po(t))}" id="${t.id}-select" @change=${e=>t._controller.handleChangeMulti(e,t)} multiple>
        </select>
        `:et`
        <select class="cl-po--input ${Zo(Po(t))}" id="${t.id}" name="${No(t)}" @change=${e=>jo(e,t,i)} ?required=${t.required} form=${Pi(e.productFormLink)}>
        </select>
        `},co.templates.color=(t,e,i)=>et`
    ${So()?et`
     <input type="color" class="cl-po--input ${Zo(Po(t))}" id="${t.id}" name="${No(t)}" .value=${Go(t.value)} @change=${e=>jo(e,t,i)}
     ?required=${t.required} minlength=${Pi(t.params.min)} maxlength=${Pi(t.params.max)} placeholder=${Pi(t.params.placeholder)} form=${Pi(e.productFormLink)}>
        `:co.templates.color_input(t,e,i)}
`,co.templates.color_input=(t,e,i)=>et`
      <input type="text" class="cl-po--input ${Zo(Po(t))}" id="${t.id}" name="${No(t)}" .value=${Go(t.value)} @change=${e=>jo(e,t,i)} 
      ?required=${t.required} pattern="#[0-9A-Fa-f]{6}" placeholder=${Pi(t.params.placeholder)} autocomplete="${Do(t,"color")}" form=${Pi(e.productFormLink)}>
`,co.templates["img-swatch"]=(t,e,i)=>{const o="color-img-swatch"===t.type;return t.params.multiSelect?(t._controller=t._controller||Bo(0,0,i),et`
            <div class="cl-po--swatch-container">
                <input type="hidden" name="${No(t)}" id="${t.id}" value=${t.value} form=${Pi(e.productFormLink)} />
                ${Ii(t.values||[],(t=>t.value),((i,n)=>et`
                    <label class="cl-po--swatch-item ${Zo(Lo(t,i,{grow:t.params.grow}))}">
                        <input type="checkbox" class="cl-po--input ${Zo(Po(t))}" id="${t.id}-${n}"  .value=${i.value} @change=${e=>t._controller.onChange(e,t)}
                               .checked=${Go(t._controller.isSelected(t,i))} ?disabled=${i.disabled} form=${Pi(e.productFormLink)}>
                        
                        ${o&&!i.img?et`<div class="cl-po--swatch cl-po--swatch-color ${Zo(Mo(t,"small"))}" style=${Ko({backgroundColor:i.color})} data-tippy-content="${xo(t,i,oo.moneyFormat)}" data-tippy-placement="bottom">
                                </div>`:et`<div class="cl-po--swatch cl-po--swatch-img ${Zo(Mo(t,"large"))}" data-tippy-content="${Pi(Io(t,i,oo.moneyFormat))}" data-tippy-placement="bottom">
                            ${i.img?et`<img src="${go(i.img,mo(t.params.size||"large"))}" alt="${xo(t,i,oo.moneyFormat)}" />`:null}
                          </div>`}
                        ${t.params.imgText?et`<span class="cl-po--swatch-text">${vi(xo(t,i,oo.moneyFormat))}</span>`:null}
                        <span class="visually-hidden">${xo(t,i,oo.moneyFormat)}</span>
                    </label>
                    ${t.params.items&&(n+1)%t.params.items==0?et`<div class="cl-po--break" data-index=${n}></div>`:null}
                `))}
            </div>
        `):et`
            <div class="cl-po--swatch-container">
                ${Ii(t.values||[],(t=>t.value),((n,r)=>et`
                    <label class="cl-po--swatch-item ${Zo(Lo(t,n,{grow:t.params.grow}))}">
                        <input type="radio" class="cl-po--input ${Zo(Po(t))}" id="${t.id}-${r}" name="${No(t)}" .value=${n.value} @change=${e=>jo(e,t,i)}
                               .checked=${Go(t.value==n.value)} ?required=${t.required} ?disabled=${n.disabled} form=${Pi(e.productFormLink)}>
                        
                        ${o&&!n.img?et`<div class="cl-po--swatch cl-po--swatch-color ${Zo(Mo(t,"small"))}" style=${Ko({backgroundColor:n.color})} data-tippy-content="${xo(t,n,oo.moneyFormat)}" data-tippy-placement="bottom"
                                  @click=${e=>$o(e,t,n,i)}>
                            </div>`:et`<div class="cl-po--swatch cl-po--swatch-img  ${Zo(Mo(t,"large"))}" data-tippy-content="${Pi(Io(t,n,oo.moneyFormat))}" data-tippy-placement="bottom"
                                     @click=${e=>$o(e,t,n,i)}>
                            ${n.img?et`<img src="${go(n.img,mo(t.params.size||"large"))}" alt="${xo(t,n,oo.moneyFormat)}"/>`:null}
                            </div>`}
                        
                        ${t.params.imgText?et`<span class="cl-po--swatch-text">${vi(xo(t,n,oo.moneyFormat))}</span>`:null}
                        <span class="visually-hidden">${xo(t,n,oo.moneyFormat)}</span>
                    </label>
                    ${t.params.items&&(r+1)%t.params.items==0?et`<div class="cl-po--break" data-index=${r}></div>`:null}
                `))}
            </div>
        `},co.templates["button-swatch"]=(t,e,i)=>t.params.multiSelect?(t._controller=t._controller||Bo(0,0,i),et`
            <div class="cl-po--swatch-container">
                <input type="hidden" name="${No(t)}" id="${t.id}" value=${t.value} form=${Pi(e.productFormLink)} />
                ${Ii(t.values||[],(t=>t.value),((i,o)=>et`
                    <label class="cl-po--swatch-item ${Zo(Lo(t,i,{grow:t.params.grow}))}">
                        <input type="checkbox" class="cl-po--input ${Zo(Po(t))}" id="${t.id}-${o}" .value=${i.value} @change=${e=>t._controller.onChange(e,t)}
                               .checked=${Go(t._controller.isSelected(t,i))} ?disabled=${i.disabled} form=${Pi(e.productFormLink)}>
                        <div class="cl-po--swatch cl-po--swatch-button ${Zo(Mo(t,"small"))}" style=${Ko(ko(t))} data-tippy-content="${Pi(t.params.valuePriceTooltip?Co(t,i,oo.moneyFormat):void 0)}" data-tippy-placement="bottom">
                            ${vi(xo(t,i,oo.moneyFormat))}
                        </div>
                    </label>
                    ${t.params.items&&(o+1)%t.params.items==0?et`<div class="cl-po--break" data-index=${o}></div>`:null}
                `))}
            </div>
        `):et`
            <div class="cl-po--swatch-container">
                ${Ii(t.values||[],(t=>t.value),((o,n)=>et`
                    <label class="cl-po--swatch-item ${Zo(Lo(t,o,{grow:t.params.grow}))}" >
                        <input type="radio" class="cl-po--input ${Zo(Po(t))}" id="${t.id}-${n}" name="${No(t)}" .value=${o.value} @change=${e=>jo(e,t,i)}
                               .checked=${Go(t.value==o.value)} ?required=${t.required} ?disabled=${o.disabled} form=${Pi(e.productFormLink)} >
                        <div class="cl-po--swatch cl-po--swatch-button ${Zo(Mo(t,"small"))}" style=${Ko(ko(t))} data-tippy-content="${Pi(t.params.valuePriceTooltip?Co(t,o,oo.moneyFormat):void 0)}" data-tippy-placement="bottom"
                             @click=${e=>$o(e,t,o,i)}>
                            ${vi(xo(t,o,oo.moneyFormat))}
                        </div>
                    </label>
                    ${t.params.items&&(n+1)%t.params.items==0?et`<div class="cl-po--break" data-index=${n}></div>`:null}
                `))}
            </div>
          
        `,co.templates["color-swatch"]=(t,e,i)=>t.params.multiSelect?(t._controller=t._controller||Bo(0,0,i),et`
            <div class="cl-po--swatch-container">
                <input type="hidden" name="${No(t)}" id="${t.id}" value=${t.value} form=${Pi(e.productFormLink)} />
                ${Ii(t.values||[],(t=>t.value),((i,o)=>et`
                    <label class="cl-po--swatch-item ${Zo(Lo(t,i,{grow:t.params.grow}))}">
                        <input type="checkbox" class="cl-po--input ${Zo(Po(t))}" id="${t.id}-${o}"  .value=${i.value} @change=${e=>t._controller.onChange(e,t)}
                               .checked=${Go(t._controller.isSelected(t,i))} ?disabled=${i.disabled} form=${Pi(e.productFormLink)}>
                        <div class="cl-po--swatch cl-po--swatch-color ${Zo(Mo(t,"small"))}" style=${Ko({backgroundColor:i.color})} data-tippy-content="${xo(t,i,oo.moneyFormat)}" data-tippy-placement="bottom">
                        </div>
                        <span class="visually-hidden">${xo(t,i,oo.moneyFormat)}</span>
                    </label>
                    ${t.params.items&&(o+1)%t.params.items==0?et`<div class="cl-po--break" data-index=${o}></div>`:null}
                `))}
            </div>
        `):et`
            <div class="cl-po--swatch-container">
            ${Ii(t.values||[],(t=>t.value),((o,n)=>et`
                <label class="cl-po--swatch-item ${Zo(Lo(t,o,{grow:t.params.grow}))}">
                    <input type="radio" class="cl-po--input ${Zo(Po(t))}" id="${t.id}-${n}" name="${No(t)}" .value=${o.value} @change=${e=>jo(e,t,i)}
                           .checked=${Go(t.value==o.value)} ?required=${t.required} ?disabled=${o.disabled} form=${Pi(e.productFormLink)}>
                    <div class="cl-po--swatch cl-po--swatch-color ${Zo(Mo(t,"small"))}" style=${Ko({backgroundColor:o.color})} data-tippy-content="${xo(t,o,oo.moneyFormat)}" data-tippy-placement="bottom"
                         @click=${e=>$o(e,t,o,i)}>
                    </div>
                    <span class="visually-hidden">${xo(t,o,oo.moneyFormat)}</span>
                </label>
                ${t.params.items&&(n+1)%t.params.items==0?et`<div class="cl-po--break" data-index=${n}></div>`:null}
            `))}
            </div>
        `,co.templates["color-img-swatch"]=(t,e,i)=>co.templates["img-swatch"](t,e,i),co.templates.font=(t,e,i)=>{let o;o=t.params.fontFamilies&&t.params.fontFamilies.length?t.params.fontFamilies:d.fonts.map((t=>t.name)),t.params.fontSortAlpha&&o.sort(((t,e)=>t.localeCompare(e))),t.values=o.map((t=>({value:t,text:" ",img:d.fontPreview(t)})));let n="dropdown";return t.params.fontSwatch&&(t.params.grow=!0,t.params.items=t.params.fontSwatchItems||3,n="img-swatch"),et`
        <div class="cl-po--font-selector">
              ${co.templates[n](t,e,i)}
        </div>
    `},co.templates.html=(t,e,i)=>et`
    ${vi(t.params.html.replace(new RegExp("{product}","g"),e.product.id))}
`,co.templates.group=(t,e,i,o,n)=>{const r=et`
            <div class="cl-po--group" >
                ${t.params.groupLayout?et`
                    <style>${Ao(t)}</style>
                `:null}
                ${t.options&&t.options.length>0?et`
                    ${Vn(t.options,e,i,o,n)}
                `:null}
            </div>`;return t.params.collapse?Wo(vi(t.params.collapseLabel),r,t.params.collapseOpen):r};class dn{initTabs(){for(let t=0;t<this.option.options.length;t++){const e=this.option.options[t];e.label&&(e._tabLabel=e.label,e.label="")}this.optionsValidated&&this.config.productForm.removeEventListener("options:validated",this.optionsValidated),this.optionsValidated=this.onOptionsValidated.bind(this),this.config.productForm.addEventListener("options:validated",this.optionsValidated)}onOptionsValidated(t){if(t.detail.valid)void 0!==this.pendingTab&&(this.activeTab=this.pendingTab,delete this.pendingTab);else{let t=this.findInvalidTabIndex(this.option.options);-1!==t&&(t>=this.pendingTab?(t=this.pendingTab,s.debug("tabs: clearing errors on pending tab",t),this.clearTabErrors([this.option.options[t]]),delete this.pendingTab):this.option.params.tabsValidation&&(s.debug("tabs: clearing errors on other tabs except",t),this.clearTabErrors(this.option.options,t)),this.activeTab=t)}}findInvalidTabIndex(t,e=-1){for(let i=0;i<t.length;i++){const o=t[i];if(o.errors?.length)return-1===e?i:e;if(o.options?.length){let t=this.findInvalidTabIndex(o.options,i);if(-1!==t)return t}}return-1}clearTabErrors(t,e=-1){for(let i=0;i<t.length;i++){if(i===e)continue;const o=t[i];o.errors?.length&&delete o.errors,o.options?.length&&this.clearTabErrors(o.options)}}renderOptions(){this.config.productForm.dispatchEvent(new CustomEvent("options:render",{detail:this.option,cancelable:!0,bubbles:!0}))}validateOptions(){this.config.productForm.dispatchEvent(new CustomEvent("options:validate",{detail:this.option,cancelable:!0,bubbles:!0}))}selectTab(t){this.activeTab=t,this.renderOptions()}switchTab(t){this.option.params.tabsValidation&&t>=this.activeTab?(this.pendingTab=t,this.validateOptions()):this.selectTab(t)}nextTab(){this.option.params.tabsValidation?(this.pendingTab=this.activeTab+1,this.validateOptions()):this.selectTab(this.activeTab+1)}prevTab(){this.selectTab(this.activeTab-1)}tabsStyleMap(t={}){const{tabsButtonColor:e,tabsButtonLabelColor:i,tabsButtonAlignment:o,tabsLayout:n}=this.option.params||{};return e&&(t["--tabs-button-color"]=e),i&&(t["--tabs-button-label-color"]=i),o&&(t["--tabs-button-alignment"]="space"===o?"space-between":"flex-end"),n&&(t["--tabs-layout"]="tabs"===n?"tabs":"grid"),t}constructor(t,e){this.onChange=t,this.getOption=e,this.config=null,this.option=null,this.activeTab=0}}co.templates.tabs=(t,e,i,o,n)=>{let r=void 0===t._controller;t._controller=t._controller||new dn(i,n),t._controller.option=t,t._controller.config=e,r&&t._controller.initTabs();const s=t._controller,a=l.get("product.options.tabs.previous",null,"Previous"),c=l.get("product.options.tabs.next",null,"Next"),p=t.params?.tabsList??!0;return et`
        <div class="cl-po--tabs-container" style=${Ko(s.tabsStyleMap())} data-tabs-layout=${t.params?.tabsLayout||"tabs"}>
            ${t.options&&t.options.length>0?et`

                ${p?et`<div class="cl-po--tabs-nav" role="tablist" aria-label=${t.label||t.name||"Tab"}>
                    ${Ii(t.options,((t,e)=>e),((t,e)=>et`
                        <button
                            type="button"
                            class="cl-po--tab-item ${Zo({"cl-po--tab-active":s.activeTab===e})}"
                            id=${`cl-po-tab-${e}`}
                            role="tab"
                            aria-selected=${s.activeTab===e}
                            aria-controls=${`cl-po-tab-panel-${e}`}
                            tabindex=${s.activeTab===e?"0":"-1"}
                            @click=${()=>s.switchTab(e)}
                            title=${t._tabLabel||t.name||`Tab ${e+1}`}
                        >
                            <span class="cl-po--tab-item-text">${vi(t._tabLabel||t.name||`Tab ${e+1}`)}</span>
                        </button>
                    `))}
                </div>`:null}
                
                <div class="cl-po--tab-content">
                    ${Ii(t.options,((t,e)=>e),((t,r)=>et`
                        <div class="cl-po--tab-panel ${Zo({"cl-po--tab-panel-active":s.activeTab===r})}" id=${`cl-po-tab-panel-${r}`} role="tabpanel" aria-labelledby=${`cl-po-tab-${r}`} ?hidden=${s.activeTab!==r}>
                            ${Vn([t],e,i,o,n)}
                        </div>
                    `))}
                    ${t.params?.tabsNavigation?et`
                    <div class="cl-po--tabs-button">
                        <button class="cl-po--btn-prev" type="button" @click=${()=>s.prevTab()} 
                        ?hidden=${0===s.activeTab}>${a}</button>

                        <button class="cl-po--btn-next" type="button" @click=${()=>s.nextTab()} 
                        ?hidden=${s.activeTab===t.options.length-1}>${c}</button>
                    </div>`:null}
                </div>
            `:null}
        </div>
    `};class hn{onValidate(t){if(t.params.quantityId){let e=t.params.quantityId;-1!==e.indexOf("{random}")&&(e=e.replace("{random}",String(Math.floor(1e3*Math.random()+1)))),-1!==e.indexOf("{product}")&&(e=e.replace("{product}",String(this.config.product.id))),-1!==e.indexOf("{variant}")&&(e=e.replace("{variant}",String(this.config.productForm.id.value))),this.quantityId=e}return!0}handleChange(t,e){this.quantity=parseInt(e.value),this.syncEl(),this.selectDiscount(e),this.onChange(e)}selectDiscount(t){if(t.values)for(let e=0;e<t.values.length;e++){const i=t.values[e];if(i.value===t.value&&i._discount)return this.discount=i._discount,void(this.discountType=i.priceType)}this.discount=0}syncEl(){this.quantityEl.value=this.quantity}syncValue(t){if(this.quantity=parseInt(this.quantityEl.value)||1,t.value="",this.discount=0,t.values)for(let e=0;e<t.values.length;e++){const i=t.values[e];let o=parseInt(i.value);this.quantity>=o&&(i._discount?i._discount>this.discount&&(t.value=i.value):t.value=i.value)}this.selectDiscount(t)}quantityDiscountText(t,e,i,o,n,r=""){const s=this.calcQuantityDiscountVars(t,e,i,o,n);let a=t.params.discountTemplate||"{price} {compare} {discount}";return i||(a=a.replace(new RegExp("{compareP}|{compare}|{discountP}|{discount}","g"),"").trim()),`<span class="_quantity">${t.params.textDiscountBuy||"Buy:"} ${e}${r}</span>${a}`.replace(new RegExp("{compareP}","g"),`<span class="_compare">${ho(100*s.price,oo.moneyFormat)}</span>`).replace(new RegExp("{compare}","g"),`<span class="_compare">${ho(100*s.total,oo.moneyFormat)}</span>`).replace(new RegExp("{priceP}","g"),`<span class="_price">${ho(100*s.productFinal,oo.moneyFormat)}</span>`).replace(new RegExp("{price}","g"),`<span class="_price">${ho(100*s.totalFinal,oo.moneyFormat)}</span>`).replace(new RegExp("{discountP}","g"),`<span class="_save">${s.productSave}</span>`).replace(new RegExp("{discount}","g"),`<span class="_save">${s.totalSave}</span>`)}optionValueDiscountText(t,e,i){let o=parseInt(e.value),n="+",r=t.values.indexOf(e);if(t.values.length>r+1){parseInt(t.values[r+1].value)===o+1&&(n="")}return this.quantityDiscountText(t,o,e._discount,e.priceType,i,n)}calcQuantityDiscountVars(t,e,i,o,n){let r=n.price.final-n.price.variantTotal;if(n.price.bundle.length)for(const t of n.price.bundle)"0"!==t.id&&(r+=t.price*t.quantity);let s,a,l,c,p=e*r;if(i)if(o===so.PERCENTAGE)s=r-r*(i/100),l=s*e,a=`${t.params.textDiscountSave||"Save:"} ${i}%`,c=a;else{oo.currencyConvert&&(i=no(i));let t=Math.min(i,r);s=r-t,a="-"+ho(100*t,oo.moneyFormat);let o=t*e;l=p-o,c="-"+ho(100*o,oo.moneyFormat)}else s=r,a="",l=p,c="";return{price:r,total:p,productFinal:s,productSave:a,totalFinal:l,totalSave:c}}updatePriceElements(t,e){if(this._priceElList&&this._priceElList.length)for(let t=0;t<this._priceElList.length;t++)if(!n.isInPage(this._priceElList[t])){delete this._priceElList;break}if(this._priceElList&&0!==this._priceElList.length||(this._priceElList=document.querySelectorAll('[data-live-price-quantity="'+e.product?.id+'"], [data-live-price-quantity-single="'+e.product?.id+'"]')),this._priceElList.length){const i=this.calcQuantityDiscountVars(t,this.quantity,this.discount,this.discountType,e);this._priceElList.forEach((t=>{const e=void 0!==t.dataset.livePriceQuantitySingle?"productFinal":"totalFinal";let o=ho(100*i[e],oo.moneyFormat);t.dataset.liveFormat&&(t.dataset.liveFormat=o),t.innerHTML=o}))}this.quantityEl&&this.quantityEl.value!==String(this.quantity)&&this.syncEl(t)}init(t){let e=[];if(t.values)for(let i=0;i<t.values.length;i++){const o=t.values[i];let n=parseInt(o.value);(o.price||o._price)&&(o._discount=o._price||o.price,o.price=0,o._price=0,isNaN(n)||e.push(n+":"+o._discount+(o.priceType===so.PERCENTAGE?"%":""))),io.checkoutQuantityValidate&&!isNaN(n)&&(this.quantityMin=null===this.quantityMin?n:Math.min(this.quantityMin,n))}if(this.quantityId=this.config.uuid,this.quantityDiscount=e.join(","),!this.quantityEl){const e="[name=quantity]";if(this.quantityEl=this.config.productForm.querySelector(e)||document.querySelector(e),this.quantityEl&&"hidden"===this.quantityEl.type&&(this.quantityEl.parentNode.removeChild(this.quantityEl),this.quantityEl=null),this.quantityEl&&!t.params.quantityInput)this.syncValue(t),this.quantityEl.addEventListener("change",(()=>{t.visible&&(this.syncValue(t),this.onChange(t))}));else if(!this.quantityElOption){this.quantityElOption=!0;const e=i=>{this.config.productForm.removeEventListener("options:rendered",e),this.quantityEl=document.querySelector("#"+t.id+"-quantity"),this.quantityEl.value="1",this.syncValue(t)};this.config.productForm.addEventListener("options:rendered",e)}}t.params.selectedQuantity&&!this.config.editorMode&&setTimeout((()=>{this.quantity=parseInt(t.params.selectedQuantity),this.syncEl(t),this.syncValue(t),this.onChange(t)}))}constructor(t){this.onChange=t,this.config=null,this.option=null,this.quantity=1,this.quantityEl=null,this.quantityElOption=!1,this.quantityId="",this.quantityDiscount="",this.quantityMin=null,this.discount=0,this.discountType=so.ABSOLUTE}}co.templates["quantity-discount"]=(t,e,i)=>{if(!ao.QUANTITY)return et``;let o=void 0===t._controller;return t._controller=t._controller||new hn(i),t._controller.config=e,t._controller.option=t,(o||e.editorMode)&&t._controller.init(t),t._controller.updatePriceElements(t,e),et`
            ${Ii(t.values||[],((i,o)=>et`
                <label class="cl-po--radio-item" >
                    <input type="radio" class="cl-po--input ${Zo(Po(t))}" id="${t.id}-${o}" .value=${i.value} @change=${e=>jo(e,t,(t=>t._controller.handleChange(e,t)))}
                           .checked=${Go(t.value==i.value)} ?required=${t.required} name="_${t.name}" form=${Pi(e.productFormLink)}>
                    <div class="cl-po--discount-text">${vi(t._controller.optionValueDiscountText(t,i,e))}</div>
                </label>
            `))}

            ${!1!==t.params.discountLine&&t._controller.discount&&t._controller.quantity!==parseInt(t.value)?et`
                <label class="cl-po--radio-item cl-po--discount-text-custom">
                    <input type="radio" class="cl-po--input ${Zo(Po(t))}" style="opacity:0">
                    <div class="cl-po--discount-text">${vi(t._controller.quantityDiscountText(t,t._controller.quantity,t._controller.discount,t._controller.discountType,e))}</div>
                </label>
            `:null}
           
            ${t._controller.quantityElOption?et`
                <div class="cl-po--quantity-wrap cl-po--quantity-discount-el">
                    <span class="cl-po--quantity-btn" @click=${e=>{t._controller.quantity--,t._controller.syncEl(t),t._controller.syncValue(t),i(t)}}>-</span>
                    <input class="cl-po--input cl-po--quantity" id="${t.id}-quantity" name="quantity" form=${Pi(e.productFormLink)} @change=${e=>{t._controller.syncValue(t),i(t)}}>
                    <span class="cl-po--quantity-btn" @click=${e=>{t._controller.quantity++,t._controller.syncEl(t),t._controller.syncValue(t),i(t)}}>+</span>
                </div>
            `:null}
            
            <input type="hidden" name="properties[${eo.QUANTITY_ID}]" value=${t._controller.quantityId} form=${Pi(e.productFormLink)}>
            <input type="hidden" name="properties[${eo.QUANTITY_DISCOUNT}]" value=${t._controller.quantityDiscount} form=${Pi(e.productFormLink)}>

            ${null!==t._controller.quantityMin?et`
                <input type="hidden" name="properties[${eo.QUANTITY_MIN}]" value=${t._controller.quantityMin} form=${Pi(e.productFormLink)}>
            `:null}
        `};co.templates.personalize=(t,e,i)=>t.params.btnCheckbox?et`
            ${Ii(t.values||[],((i,o)=>0===o?et`
                        <label class="cl-po--checkbox-item ${Zo(Lo(t,i))}">
                            <input type="checkbox" class="cl-po--input ${Zo(Po(t))}" id="${t.id}-${o}" name="${No(t)}" .value=${i.value} @change=${e=>((t,e,i)=>(e.value=e.value===e.values[0].value?e.values[1].value:e.values[0].value,i(e)))(0,t,(t=>t._controller.onChange(e,t,!0)))}
                                   .checked=${t.value==i.value} ?required=${t.required} form=${Pi(e.productFormLink)}>
                            ${vi(xo(t,i,oo.moneyFormat))}
                        </label>`:et`<input type="checkbox" style="display:none;" name="${No(t)}" id="${t.id}" value=${i.value} .checked=${t.value==i.value}  form=${Pi(e.productFormLink)} />`))}
        `:et`
            <div class="cl-po--swatch-container">
                ${Ii(t.values||[],((o,n)=>et`

                    <label class="cl-po--swatch-item ${Zo({grow:t.params.grow,personalize:t.value==o.value?"none":null})}" >
                        <input type="radio" class="cl-po--input ${Zo(Po(t))}" id="${t.id}-${n}" name="${No(t)}" .value=${o.value} @change=${e=>jo(e,t,(t=>t._controller.onChange(e,t)))} 
                               .checked=${t.value==o.value} ?required=${t.required} form=${Pi(e.productFormLink)}>
                        <div class="cl-po--swatch cl-po--swatch-button ${Zo(Mo(t,"small"))}" style=${Ko(ko(t,To(t)))} data-tippy-content="${Pi(t.params.valuePriceTooltip?Co(t,o,oo.moneyFormat):void 0)}" data-tippy-placement="bottom"
                             @click=${e=>$o(e,t,o,i)}>
                            ${vi(xo(t,o,oo.moneyFormat))}
                        </div>
                    </label>
                    ${t.params.items&&(n+1)%t.params.items==0?et`<div class="cl-po--break" data-index=${n}></div>`:null}
                `))}
            </div>
        `,co.templates.download=(t,e,i)=>et`
            <div class="cl-po--swatch-container">
                 <label class="cl-po--swatch-item ${Zo({grow:t.params.grow})}" >
                        <div class="cl-po--swatch cl-po--swatch-button ${Zo(Mo(t,"small"))}" style=${Ko(ko(t,To(t)))}
                             @click=${i=>e.productForm.dispatchEvent(new CustomEvent("option:export",{detail:t,cancelable:!0,bubbles:!0}))}>
                             ${t.params.btnText||"Download"}
                        </div>
                 </label>
            </div>
        `;class un{static getProductOption(t,e){for(let i=0;i<e.length;i++){const o=e[i];if(o.name===t)return o;if(o.options&&o.options.length>0){let e=this.getProductOption(t,o.options);if(null!=e)return e}}return null}static hasEditLayer(t,e){return t&&e&&e!==un.editLayer}static isEditLayer(t,e,i){return!!e&&(!i||!(t.name!==i&&!t.name.startsWith(i+"_")))}static isCropLayer(t,e,i){return!(!e||t.name!==i)}static hasRefRect(t){return t.params.refRect&&(t.params.autoScale||t.params.autoPos)}static getRefDimensions(t,e){return un.hasRefRect(t)?{width:t.params.refWidth||e.config.width-100,height:t.params.refHeight||e.config.height-100}:{width:e.config.width,height:e.config.height}}static getRefCoordinates(t,e){return un.hasRefRect(t)?{x:void 0!==t.params.refX?t.params.refX:50,y:void 0!==t.params.refY?t.params.refY:50,angle:void 0!==t.params.refAngle?t.params.refAngle:0}:t.params.autoPos?{x:0,y:0,angle:0}:{x:0|t.params.x,y:0|t.params.y,angle:0}}static getDimensions(t,e=!1){return e?{height:t.getScaledWidth(),width:t.getScaledHeight()}:{width:t.getScaledWidth(),height:t.getScaledHeight()}}static center(t,e,i,o){this.centerHorizontal(t,e,i,o),this.centerVertical(t,e,i,o)}static centerHorizontal(t,e,i,o){let n=i.x+o.width/2-e.width/2;t.left=parseFloat(n.toFixed(2))}static centerVertical(t,e,i,o){let n=i.y+o.height/2-e.height/2;t.top=parseFloat(n.toFixed(2))}}un.editLayer="_";var mn=un;var gn=class{static moveX(t,e){t._object.left+=e,this.updateMoving(t)}static moveY(t,e){t._object.top+=e,this.updateMoving(t)}static scale(t,e){t._object.scaleX+=e,t._object.scaleY+=e,this.updateScaling(t)}static rotate(){}static center(t,e){let i=mn.getDimensions(t._object),o=mn.getRefCoordinates(t,t._context),n=mn.getRefDimensions(t,t._context);"h"===e?mn.centerHorizontal(t._object,i,o,n):"v"===e?mn.centerVertical(t._object,i,o,n):mn.center(t._object,i,o,n),this.updateMoving(t)}static updateMoving(t){t._canvas&&(t._canvas.fire("object:moving",{target:t._object}),t._canvas.fire("object:modified",{target:t._object}),t._canvas.requestRenderAll())}static updateScaling(t){t._canvas&&(t._canvas.fire("object:scaling",{target:t._object}),t._canvas.fire("object:modified",{target:t._object}),t._canvas.requestRenderAll())}};co.templates.layer_editor=(t,e,i)=>et`
    ${t._layer.params.collapseLabel?et`<span class="cl-po--layer-editor-label cl-po--help">${t._layer.params.collapseLabel}</span>`:null}
    <div class="cl-po--text-editor cl-po--layer-editor">
        ${t._layer.params.editor.scale?et`
        <div class="cl-po--editor-group cl-po--layer-scale">
            <div @click=${e=>{gn.scale(t._layer,-(t._layer.params.editor.scaleStep||.1))}} class="cl-po--swatch cl-po--swatch-button" data-tippy-content="${l.get("product.options.layer.scaleDown",null,"Scale down")}" data-tippy-placement="bottom">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path d="M5 11h14v2H5z" fill="var(--text-editor-color)"/></svg>
            </div>
            <div @click=${e=>{gn.scale(t._layer,t._layer.params.editor.scaleStep||.1)}} class="cl-po--swatch cl-po--swatch-button" data-tippy-content="${l.get("product.options.layer.scaleUp",null,"Scale up")}" data-tippy-placement="bottom">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path d="M11 11V5h2v6h6v2h-6v6h-2v-6H5v-2z" fill="var(--text-editor-color)"/></svg>
            </div>
        </div>
        `:null}
        ${t._layer.params.editor.center?et`
        <div class="cl-po--editor-group cl-po--layer-center">
            <div @click=${e=>{gn.center(t._layer,"h")}} class="cl-po--swatch cl-po--swatch-button" data-tippy-content="${l.get("product.options.layer.centerH",null,"Center horizontal")}" data-tippy-placement="bottom">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path d="M16.05,7.05 L21,12 L16.05,16.95 L14.636,15.536 L17.172,12.999 L4,13 L4,11 L17.172,11 L14.636,8.464 L16.05,7.05 Z M7.95,7.05 L9.364,8.464 L6.828,11 L20,11 L20,13 L6.828,13 L9.364,15.536 L7.95,16.95 L3,12 L7.95,7.05 Z" fill="var(--text-editor-color)"></path></svg>
            </div>
            <div @click=${e=>{gn.center(t._layer,"v")}} class="cl-po--swatch cl-po--swatch-button" data-tippy-content="${l.get("product.options.layer.centerV",null,"Center vertical")}" data-tippy-placement="bottom">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><g transform="translate(7, 3)"><path d="M9.95,4.95 L8.536,6.364 L6,3.828 L6,17 L4,17 L4,3.828 L1.465,6.364 L0.05,4.95 L5,0 L9.95,4.95 Z M9.95,13.05 L5,18 L0.05,13.05 L1.464,11.636 L4.001,14.172 L4,1 L6,1 L6,14.172 L8.536,11.636 L9.95,13.05 L9.95,13.05 Z" fill="var(--text-editor-color)"></path></g></svg>
            </div>
            <div @click=${e=>{gn.center(t._layer)}} class="cl-po--swatch cl-po--swatch-button" data-tippy-content="${l.get("product.options.layer.center",null,"Center")}" data-tippy-placement="bottom">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path d="M11 11V5.828L9.172 7.657 7.757 6.243 12 2l4.243 4.243-1.415 1.414L13 5.828V11h5.172l-1.829-1.828 1.414-1.415L22 12l-4.243 4.243-1.414-1.415L18.172 13H13v5.172l1.828-1.829 1.415 1.414L12 22l-4.243-4.243 1.415-1.414L11 18.172V13H5.828l1.829 1.828-1.414 1.415L2 12l4.243-4.243 1.414 1.415L5.828 11z" fill="var(--text-editor-color)"/></svg>
            </div>
        </div>
        `:null}
        ${t._layer.params.editor.move?et`
        <div class="cl-po--editor-group cl-po--layer-move">
            <div @click=${e=>{gn.moveX(t._layer,-(t._layer.params.editor.moveStep||50))}} class="cl-po--swatch cl-po--swatch-button" data-tippy-content="${l.get("product.options.layer.moveLeft",null,"Move left")}" data-tippy-placement="bottom">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path d="M7.828 11H20v2H7.828l5.364 5.364-1.414 1.414L4 12l7.778-7.778 1.414 1.414z" fill="var(--text-editor-color)"/></svg>
            </div>
            <div @click=${e=>{gn.moveX(t._layer,t._layer.params.editor.moveStep||50)}} class="cl-po--swatch cl-po--swatch-button" data-tippy-content="${l.get("product.options.layer.moveRight",null,"Move right")}" data-tippy-placement="bottom">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path d="M16.172 11l-5.364-5.364 1.414-1.414L20 12l-7.778 7.778-1.414-1.414L16.172 13H4v-2z" fill="var(--text-editor-color)"/></svg>
            </div>
            <div @click=${e=>{gn.moveY(t._layer,-(t._layer.params.editor.moveStep||50))}} class="cl-po--swatch cl-po--swatch-button" data-tippy-content="${l.get("product.options.layer.moveUp",null,"Move up")}" data-tippy-placement="bottom">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path d="M13 7.828V20h-2V7.828l-5.364 5.364-1.414-1.414L12 4l7.778 7.778-1.414 1.414L13 7.828z" fill="var(--text-editor-color)"/></svg>
            </div>
            <div @click=${e=>{gn.moveY(t._layer,t._layer.params.editor.moveStep||50)}} class="cl-po--swatch cl-po--swatch-button" data-tippy-content="${l.get("product.options.layer.moveDown",null,"Move down")}" data-tippy-placement="bottom">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path d="M13 16.172l5.364-5.364 1.414 1.414L12 20l-7.778-7.778 1.414-1.414L11 16.172V4h2v12.172z" fill="var(--text-editor-color)"/></svg>
            </div>
        </div>
        `:null}
    </div>
`;var fn=class{upload(t,e){const i=[],o=[];for(let n=0;n<t.length;n++){const s=t[n];i.push(new Promise(((t,i)=>{this._getSignedUrl(s).then((a=>{const l={method:"PUT",headers:{"Content-type":s.mimeType},data:s._file};0===n&&(l.onProgress=e);const c=new r(a.upload,l);o.push(c),c.then((e=>{s.url=a.download,s.path=a.path;let i=parseInt(e.xhr.getResponseHeader("x-goog-stored-content-length"));isNaN(i)||s.meta&&(s.meta.contentLength=i),t(s)})).catch((t=>{i(t)}))})).catch((t=>{i(t)}))})))}let n=Promise.all(i).then((t=>(s.info(t),t)));return n.cancel=()=>{for(let t=0;t<o.length;t++){o[t].cancel()}},n}_getSignedUrl(t){let e=this.settings.api+this.settings.path,i=n.extend(this.settings.queryParams,{name:encodeURIComponent(t.name),type:encodeURIComponent(t.mimeType),public:"1",cb:1e18*Math.random()+""});return new r(e,{method:"GET",queryParams:i}).then((t=>t.data))}constructor(t){this.settings=n.extend({api:"",path:"/api/storage",queryParams:{}},t||{})}};var vn=class{findToken(){let t=n.readCookie("token");t&&(this.settings.queryParams.token=t)}blobToFile(t,e){return new File([t],e,{lastModified:(new Date).getTime(),type:t.type})}fromBlob(t,e){return{name:e,size:t.size,mimeType:t.type,meta:{},_file:t}}fromNative(t){return{name:t.name?t.name:"",size:t.size,mimeType:t.type,meta:{},_file:t}}saveFile(t){return this.settings.queryParams.token||this.findToken(),this.settings.origin&&(t.origin=this.settings.origin),new r(this.settings.api+this.settings.path,{method:"POST",responseType:"json",headers:{"Content-type":"application/json"},data:t,queryParams:this.settings.queryParams}).then((t=>{if(!this.settings.queryParams.token&&t.data.token){let e=t.data.token;n.writeCookie("token",e,10,"/"),this.settings.queryParams.token=e}return t.data})).catch((t=>{throw t}))}removeFile(t){return Promise.resolve()}exportFailed(t){return"object"==typeof t&&(t.xhr&&(t.xhr={url:t.xhr._url,status:t.xhr.status,statusText:t.xhr.statusText}),t=JSON.stringify(t,Object.getOwnPropertyNames(t))),new r(this.settings.api+this.settings.path+"/export",{method:"POST",responseType:"text",headers:{"Content-type":"application/json"},data:t,queryParams:this.settings.queryParams}).then((t=>t.data)).catch((t=>{throw t}))}constructor(t){this.settings=n.extend({api:"",path:"/api/upload",queryParams:{}},t||{}),this.findToken()}};class yn{static getInstance(t){return yn._instance||(yn._instance=new yn(t)),yn._instance}controller(t,e,i,o){let r={files:[],inputs:[],onValidate:t=>{i.dispatchEvent(new CustomEvent("option:crop:apply",{detail:t,cancelable:!0,bubbles:!0}));let e=!0;return t.required&&0===r.files.length&&(t.errors.push(l.get(this.settings.errorPrefix+"required")),e=!1),e},onChange:(t,e,i,s,a)=>{let c=t.target;if(c.value&&c.files.length>0){const t=c.files;let i=[];for(let o=0;o<t.length;o++){const n=t[o];let r=e.params.maxMb||10;const s=1048576*r;if(n.size>s)return c.value="",e.errors=e.errors||[],e.errors.push(l.get(this.settings.errorPrefix+"max",{max:r})),void c.dispatchEvent(new CustomEvent("options:render",{detail:e,cancelable:!0,bubbles:!0}));i.push(this._fileMeta.fromNative(n))}let p=n.findParent(c,".cl-po--upload"),d=p.querySelector("progress");d.max=100,d.value=0,d.style.display="block",this.upload(i,(t=>{if(t.lengthComputable){let e=t.loaded/t.total*100;e>d.value&&(d.value=e)}})).then((t=>{d.style.display="none";for(let t=0;t<r.files.length;t++){const e=r.files[t];e.uuid&&this._fileMeta.removeFile(e)}for(let t=0;t<r.inputs.length;t++){const e=r.inputs[t];e.parentNode&&e.parentNode.removeChild(e)}r.inputs.length=0,r.files=t;let i="";for(let t=0;t<r.files.length;t++){const o=r.files[t];i+=this._corsUrl(o.url);let n=t+1;n<r.files.length&&(i+=",");let a=document.createElement("input");a.type="hidden",e.params.multiple?a.name="properties["+e.name+"_"+n+"]":a.name="properties["+e.name+"]",a.value=o.url,s&&a.setAttribute("form",s),p.appendChild(a),r.inputs.push(a)}e.value=i,c.value="",a(e),e.params.optionDimension&&this._dimensionUpdate(e,o(e.params.optionDimension),i)})).catch((t=>{alert(t.error),d.style.display="none",c.value=""}))}},update:(t,e,i)=>{if(t.value){if(0===r.inputs.length){r.files.push({url:t.value,name:"file"+t.value.substring(t.value.lastIndexOf(".")),meta:{}});let o=document.createElement("input");o.type="hidden",o.name="properties["+t.name+"]",o.value=t.value,t.value=this._corsUrl(t.value),i&&o.setAttribute("form",i),e.addEventListener("options:rendered",(()=>{let e=document.querySelector('[data-option="'+t.name+'"] .cl-po--upload');e&&e.appendChild(o)}),{once:!0}),r.inputs.push(o)}}else if(r.inputs.length>0){for(let t=0;t<r.inputs.length;t++){const e=r.inputs[t];e.parentNode&&e.parentNode.removeChild(e)}r.inputs.length=0,r.files.length=0}},remove:(t,e,i,o)=>{for(let e=0;e<r.files.length;e++)if(r.files[e]===i){this._fileMeta.removeFile(i),r.files.splice(e,1);for(let t=0;t<r.inputs.length;t++)if(r.inputs[t].value==i.url){let e=r.inputs[t];e.parentNode&&e.parentNode.removeChild(e),r.inputs.splice(t,1)}t.value="",o(t);break}},crop:(t,e)=>{e.dispatchEvent(new CustomEvent("option:crop",{detail:t,cancelable:!0,bubbles:!0}))}};return this._migrateDimensionParams(t),r}controllerLift(t,e,i,o,n){let r={option:t,selector:`.cl-po--upload-lift-${t.id}`,container:null,field:null,urls:[],onValidate:t=>{if(t._controller._cropConfig)return r.updateCrop(),!1;let e=!0;if(t.required&&0===r.urls.length)t.errors.push(l.get(this.settings.errorPrefix+"required")),e=!1;else if(r.field)return r.field.validate();return e},syncValue:()=>{let t="";for(let e=0;e<r.urls.length;e++){t+=this._corsUrl(r.urls[e]),e+1<r.urls.length&&(t+=",")}r.option.value=t,o(r.option)},_removeByUrl:t=>{const e=t.substring(t.lastIndexOf("/")+1);let i=Object.keys(r.field._upload.files);for(const t of i){const i=r.field._upload.files[t];if(i.path.includes(e)){let t=r.field._upload._pond.getFiles();for(const e of t)i.uuid===e.serverId&&r.field._upload._pond.removeFile(e,{revert:!0});break}}},watchUploads:()=>{r.container=document.querySelector(r.selector),r.container&&(r.container.addEventListener("upload:added",(async t=>{var e=t.detail;const i=r.option.params;let o=i.variant||"original";e.url&&e.meta.variant===o&&(r.urls.push(e.url),r.syncValue(),i.optionDimension&&this._dimensionUpdate(r.option,n(i.optionDimension),this._corsUrl(e.url)))})),r.container.addEventListener("upload:removed",(t=>{var e=t.detail;let i=r.option.params.variant||"original";if(e?.url&&e.meta.variant===i){let t=r.urls.indexOf(e.url);-1!==t&&(r.urls.splice(t,1),r.syncValue())}})))},watchCrop:(e,i)=>{t._controller.optionChanged&&e.removeEventListener("option:changed",t._controller.optionChanged);const o=()=>{let o=i(t.params.optionDimension);o&&(s.debug("init crop dimension based on option",o),n(o,!0),t._controller.optionChanged=e=>{e.detail.name===t.params.optionDimension&&(s.debug("updating crop dimension based on option",o),n(e.detail))},e.addEventListener("option:changed",t._controller.optionChanged),r.container.addEventListener("upload:removed",(e=>{t._controller._cropConfig&&t._controller.updateCrop()})))},n=(e,i=!1)=>{if(e._controller&&e._controller.x&&e._controller.y&&(!e.errors||0===e.errors.length)){void 0===t._controller._cropRatio&&(t._controller._cropRatio=-1);let o,n=t._controller._cropRatio;if(o=t._controller.field.config.imageEditorPintura?Math.round(e._controller.x/e._controller.y*1e4)/1e4:Math.round(e._controller.y/e._controller.x*1e4)/1e4,n!==o){t._controller._cropRatioCurrent=o;let e={imageSizeValidate:!0,imageEditorCropRestrict:!0,imageEditorCropRatios:[{label:"Dimension",value:o}]};s.debug("updating upload-lift crop dimension",e),t._controller._cropConfig=e,!i&&t.value||t._controller.updateCrop()}else delete t._controller._cropConfig}};r.field._upload?o():r.field.element.addEventListener("upload:ready",o)},updateCrop:()=>{t._controller._cropRatio=t._controller._cropRatioCurrent,t._controller.field.updateConfig(t._controller._cropConfig),delete t._controller._cropConfig},update:(t,e)=>{t.value?0===r.urls.length&&t._controller.ready.then((()=>{if(t.value){let e=t.value.split(",");t._controller.field.restore(e),t.value=""}})):r.urls.length>0&&t._controller.field&&t._controller.field.clearFiles()},crop:(t,e)=>{t._controller._cropConfig?t._controller.updateCrop():!t.params.cropEdit||t._layer&&t._layer.params.crop?e.dispatchEvent(new CustomEvent("option:crop",{detail:t,cancelable:!0,bubbles:!0})):t._controller.field.editFile()}};r.ready=new Promise(((t,e)=>{r.onReady=t}));return i.addEventListener("options:rendered",(o=>{const s=()=>{let o=window.Cloudlift.upload.App;if(o.fields.length>0)for(let e=0;e<o.fields.length;e++){const i=o.fields[e];i.config.uuid==t.params.uuid&&(i.destroy(),o.fields.splice(e,1))}else o.config.setup=!1;for(let s=0;s<window.Cloudlift.upload.config.fields.length;s++){const a=window.Cloudlift.upload.config.fields[s];if(a.uuid===t.params.uuid){const s=JSON.parse(JSON.stringify(a));s.field=t.name,s.fileFetch=!1,s.selector=r.selector,o._createUploadField(s,e);const l=o.fields.length-1;r.field=o.fields[l],r.field._productForm=i,o.fields.splice(l,1),r.field.element.addEventListener("upload:ready",(()=>{t._controller.onReady(r.field)})),this._migrateDimensionParams(t),t.params.optionDimension&&t.params.dimensionCrop&&r.watchCrop(i,n)}}r.field||(r.notfound=!0)};let a=()=>{setTimeout((()=>{window.Cloudlift.upload.App?r.field||s():a()}),300)};window.Cloudlift&&window.Cloudlift.upload&&(window.Cloudlift.upload.App?s():a());window.addEventListener("cloudlift.upload.ready",(t=>{window.Cloudlift.upload.App?r.field||s():a()}),{once:!0}),r.watchUploads()}),{once:!0}),r}_corsUrl(t){return t=(t=t.replace("https://upload.dev.cloudlift.app/s/dev","https://storage.googleapis.com/cloudlift-app-cloud-dev-upload")).replace("https://upload.cloudlift.app/s","https://storage.googleapis.com/cloudlift-app-cloud-prod-upload")}_migrateDimensionParams(t){let e=t.params;e.optionCrop&&(e.optionDimension=e.optionCrop,e.dimensionCrop=!0,delete e.optionCrop)}async _dimensionUpdate(t,e,i){let o=t.params;if(e&&o.dimensionUpdate){let r=!1;t._layer?.params.crop&&(t._layer.params.crop=!1,r=!0);let s=await n.getImageSize(i);const a=Math.round(s.width/s.height*100)/100;o.dimensionRatio&&(e.params.ratio=a),o.dimensionCrop&&"upload-lift"===t.type&&void 0===t._controller._cropRatio&&(t._controller.field.config.imageEditorPintura?t._controller._cropRatio=a:t._controller._cropRatio=Math.round(s.height/s.width*100)/100),o.dimensionUnit&&(s=n.convertSizeToUnit(s,o.dimensionDpi||72,o.dimensionUnit)),e._controller.xInput=String(s.width),e._controller.yInput=String(s.height),r&&(t._layer.params.crop=!0,o.dimensionCrop&&(t._layer._autoCrop=!1)),e._controller.handleChange(null,e,!0)}}upload(t,e){try{let i=this._provider.upload(t,e);const o=new Promise(((t,e)=>{i.then((i=>{for(let t=0;t<i.length;t++)delete i[t]._file;let o=i[0];if(void 0!==o.meta.contentLength&&o.size!==o.meta.contentLength)return io.previewExportLog&&this._fileMeta.exportFailed({upload:!0,contentLength:o.meta.contentLength,size:o.size}),void e({upload:!0,error:"Upload failed - please try again"});this._fileMeta.saveFile(o).then((e=>{const o=[];for(let t=1;t<i.length;t++){const n=i[t];n.parent=e.uuid,o.push(this._fileMeta.saveFile(n).then((t=>t)))}Promise.all(o).then((i=>{i.unshift(e),t(i)}))})).catch((t=>{e(t)}))})),i.catch((t=>{e(t)}))}));return o.cancel=()=>{i.cancel()},o}catch(t){return Promise.reject(t)}}constructor(t){this.settings=n.extend({api:"",queryParams:{},errorPrefix:"upload."},t||{}),this._fileMeta=new vn({api:this.settings.api,queryParams:this.settings.queryParams,origin:4}),this._provider=new fn({api:this.settings.api,queryParams:this.settings.queryParams})}}var _n=yn;function wn(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}co.templates.upload=(t,e,i,o,n)=>(t._controller=t._controller||_n.getInstance().controller(t,e.product,e.productForm,n),t._controller.update(t,e.productForm,e.productFormLink),et`  
        <div class="cl-po--upload ${Zo(Po(t))}">
            <div class="cl-po--upload-wrap">
                <label class="cl-po--input cl-po--upload-button">
                 <input type="file" @change=${o=>t._controller.onChange(o,t,e.productForm,e.productFormLink,i)} 
                     ?multiple=${t.params.multiple}  accept=${Pi(t.params.accept)} >
                 <span>${vi(t.params.button||"Choose file")}</span>
                </label>
                ${t.value&&t._layer&&t._layer.params.crop?et`
                    <label class="cl-po--input cl-po--upload-button crop ${Zo({"has-label":t._layer.params.cropLabel})}" @click=${i=>t._controller.crop(t,e.productForm)}>
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M15 17v2H6a1 1 0 0 1-1-1V7H2V5h3V2h2v15h8zm2 5V7H9V5h9a1 1 0 0 1 1 1v11h3v2h-3v3h-2z" /></svg>
                        ${t._layer.params.cropLabel?et`<span class="cl-po--crop-label">${t._layer.params.cropLabel}</span>`:null}
                    </label>
                `:null}
            </div>
            <progress class="cl-po--preview-progress" style="display:none;"></progress>
            <div class="cl-po--upload-files">
             ${Ii(t._controller.files,(o=>et`
                   <div>${o.name} <span class="cl-po--remove" @click=${n=>t._controller.remove(t,e.productForm,o,i)}>&times;</span></div>
             `))}
            </div>
            
            ${t.value&&t._layer&&t._layer.params.layerEditor?et`${co.templates.layer_editor(t,e,i)}`:null}
        </div>
    `),co.templates["upload-lift"]=(t,e,i,o,n)=>{if(t.params.uuid){t._controller&&(t._controller.field&&t._controller.field.config.uuid!==t.params.uuid?(t._controller.field.destroy(),delete t._controller):e.editorMode&&t._controller.notfound&&delete t._controller);let o=void 0===t._controller;t._controller=t._controller||_n.getInstance().controllerLift(t,e.product,e.productForm,i,n),o||t._controller.update(t,e.productForm),t._controller.option=t;let r=t._layer&&t._layer.params.cropLabel?t._layer.params.cropLabel:t.params.cropLabel;return et`
            <div class="cl-po--upload-lift ${Zo(Po(t))}">
                <div class="cl-po--upload-lift-${t.id}"></div>
                ${t.value&&(t._layer&&t._layer.params.crop||t._controller._cropConfig||t.params.cropEdit)?et`
                    <label class="cl-po--input cl-po--upload-lift-crop ${Zo({"has-label":r})}" @click=${i=>t._controller.crop(t,e.productForm)}>
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20" ><path fill="currentColor" d="M15 17v2H6a1 1 0 0 1-1-1V7H2V5h3V2h2v15h8zm2 5V7H9V5h9a1 1 0 0 1 1 1v11h3v2h-3v3h-2z" /></svg>
                        ${r?et`<span class="cl-po--crop-label">${r}</span>`:null}
                    </label>
                `:null}

                ${t.value&&t._layer&&t._layer.params.layerEditor?et`${co.templates.layer_editor(t,e,i)}`:null}
            </div>`}return null};class bn{init(){this.images=[],this.imagesPaged=[],this.imagesHide=!0,this.page=1,this.cache={},this.searchQuery="",this.fuse=null,this.searchLists=!0,this.category=null,this.categoryDefault=null,this.checkExternalImage()}initUI(){if(this.categoryCount=this.option.values?.length||0,this.image&&this.categoryCount--,this.searchHide=0===this.categoryCount,this.pageSize=this.option.params.librarySize||20,!this.category&&this.categoryCount>0&&(1!==this.categoryCount||this.config.editorMode?!0!==this.option.params.categoryGrid&&this.onCategoryChange(null,this.option.values[0]):(this.categoryDefault=this.option.values[0],this.onCategoryChange(null,this.categoryDefault))),this.option.params.optionUpload){let t=this.getOption(this.option.params.optionUpload);this._uploadEvents=t!==this.optionUpload,this.optionUpload=t,void 0!==this.option.params.uploadHide&&this.config.productForm.addEventListener("options:rendered",(t=>{let e=document.querySelector(`[data-option="${this.option.params.optionUpload}"]`);e&&(e.style.display=this.option.params.uploadHide?"none":"")}),{once:!0})}}pageImages(){this.imagesPaged=[],this.page=0,this.imagesHide=!1,this.categoryHide=!0===this.option.params.categoryGrid||null!==this.categoryDefault,this.onMoreImages()}onImageChange(t,e){this.removeImage(),this.category&&this.category.price&&!e.price&&0!==e.price&&(e.price=this.category.price),this.image=e,this.option.values.push(e);let i=e.img;"function"==typeof window.clLibraryGetImage&&(i=window.clLibraryGetImage(e)),this.option.value=i,this.popupOpen&&this._popup.set("close",!0),this.optionUpload&&this.syncUploadLiftImage(i),this.onChange(this.option)}removeImage(){if(this.image){let t=this.option.values.indexOf(this.image);-1!==t&&this.option.values.splice(t,1),this.image=null}this.option.value=""}restoreImage(){let t={id:this.option._imageId,img:this._corsUrl(this.option.value)};this.onImageChange(null,t)}_corsUrl(t){return t=(t=t.replace("https://upload.dev.cloudlift.app/s/dev","https://storage.googleapis.com/cloudlift-app-cloud-dev-upload")).replace("https://upload.cloudlift.app/s","https://storage.googleapis.com/cloudlift-app-cloud-prod-upload")}isSelected(t,e){return this.image===e}conditionValue(t){return this.category?.value||""}onValidate(t){return!(t.required&&!this.image)||(t.errors.push(l.get("product.options.validity.valueMissing")),!1)}showCategories(){this.categoryHide=!1,this.imagesHide=!0,this.renderOptions()}async onCategoryChange(t,e){s.debug("library category changed",t),this.category=e,this.searchQuery="",this.images=await this.getImages(this.category),this.pageImages()}async onMoreImages(){this.page++;let t=(this.page-1)*this.pageSize,e=t+this.pageSize;this.hasMoreImages=e<this.images.length,this.searchQuery?"function"==typeof window.clLibrarySearchImages&&await this.callExternalImages(window.clLibrarySearchImages,e,this.searchQuery,this.page,this.pageSize):"function"==typeof window.clLibraryGetImages&&await this.callExternalImages(window.clLibraryGetImages,e,this.category,this.page,this.pageSize),this.imagesPaged.push(...this.images.slice(t,e)),this.renderOptions()}async callExternalImages(t,e,...i){try{s.debug("call external images using function:",t);let o=await t.apply(this,i);o?.images?.length&&(this.imagesPaged.push(...o?.images),o.total&&(this.hasMoreImages=o.total>e))}catch(t){s.debug("error loading images using function",t)}}checkExternalImage(){let t;if(-1!==window.location.search.indexOf("library.")){let e=new URLSearchParams(window.location.search);t={},e.forEach(((e,i)=>{i.startsWith("library.")&&(t[i.replace("library.","")]=e)}))}else"object"==typeof window.clLibraryImage?t=window.clLibraryImage:"object"==typeof window.clLibraryImages&&window.clLibraryImages[this.option.name]&&(t=window.clLibraryImages[this.option.name]);t?.img&&(t.img.startsWith("//")&&(t.img="https:"+t.img),setTimeout((()=>{this.onImageChange(null,t)})))}async onSearch(t){if(s.debug("library search changed",t),this.searchQuery=t.target.value,!this.fuse&&this.searchLists){let t=await this.fetchAllOptionsLists();if(t.length){await nn.loadOnce(["https://cdn.jsdelivr.net/npm/fuse.js@6.6.2/dist/fuse.basic.min.js"],"fuse-search",{async:!1});const e={threshold:.4,ignoreLocation:!0,includeScore:!0,keys:[{name:"text",weight:2},{name:"value",weight:1}]};this.fuse=new Fuse(t,e)}else this.searchLists=!1}if(this.searchLists){let t=this.fuse.search(this.searchQuery);console.debug("search results:",t),this.images=t.map((function(t){return t.item}))}else this.images=[];""===this.searchQuery&&this.categoryDefault?this.onCategoryChange(null,this.categoryDefault):(this.category=null,this.pageImages())}async getImages(t){let e=[];return t.list&&(e=await this.fetchOptionList(t.list)),e}async fetchAllOptionsLists(){let t=[];for(const e of this.option.values)e.list&&t.push(this.fetchOptionList(e.list));return Promise.all(t).then((t=>t.flat()))}async fetchOptionList(t){if(this.cache[t])return this.cache[t];let e=(await new r(this.settings.api+this.settings.path+"/"+t,{method:"GET",responseType:"json",headers:{"Content-type":"application/json"},queryParams:this.settings.queryParams})).data;return this.cache[t]=e,e}libraryStyleMap(t={}){return this.option.params.popup&&!this.popupOpen&&(t.display="none"),this.option.params.libraryCols&&(t["--library-grid-cols"]=this.option.params.libraryCols),this.option.params.libraryColsM&&(t["--library-grid-cols-m"]=this.option.params.libraryColsM),this.option.params.libraryColsH&&(t["--library-grid-cols-h"]=this.option.params.libraryColsH+"px"),t}async openPopup(){if(this._popupEl)this.renderPopup();else{this._popupEl=document.createElement("div");let t=[this.settings.assets+"/static/lib/ldcover/ldcv.full.min.css",this.settings.assets+"/static/lib/ldcover/ldcv.min.js"];await nn.loadOnce(t,"popup",{async:!1});const e=`[data-option="${this.option.name}"] .cl-po--library`;this._libraryEl=this.config.wrapper.querySelector(e)||document.querySelector(e),this.renderPopup(),document.body.appendChild(this._popupEl),this._popup=new ldCover({root:this._popupEl.querySelector(".ldcv"),lock:!1}),this._popup.on("toggle.on",(()=>{this.popupOpen=!0,this._libraryEl.style.display=""}))}this._popup.get().then((t=>{this.popupOpen=!1})),this._popup.toggle()}renderOptions(){this.config.productForm.dispatchEvent(new CustomEvent("options:render",{detail:this.option,cancelable:!0,bubbles:!0}))}renderPopup(){const t={id:this.config.uuid,className:"popup fade"+(this.option.params.popupFull?" full":"")};tt(co.templates["library-popup"](this._libraryEl,t,(t=>{this._popup.set("close",!0)})),this._popupEl)}crop(){this._fileCrop?(this._syncUpload=!0,this._syncCrop=!0,this.image._img=this.image._preview,this.image._preview=this._preview,this.optionUpload._controller?._cropConfig?this.optionUpload._controller.updateCrop():this._fileCrop.edit()):this.config.productForm.dispatchEvent(new CustomEvent("option:crop",{detail:this.option,cancelable:!0,bubbles:!0}))}syncUploadLiftImage(t){if(this.optionUpload._controller?.field){let e=this.optionUpload._controller.field;s.debug("library image upload-lift sync",e,t),this.image._preview=this._preview,this._uploadEvents&&(delete this._uploadEvents,this.optionUpload._controller.field.element.addEventListener("upload:added",(t=>{if(this._syncUpload&&this.image){let i=t.detail;if("original"===i.meta.variant){this.image._preview=i.url;let t=e._upload._pond.getFile();t&&t.edit&&(this._fileCrop=t),this._updateCropOriginal||(this._updateCropOriginal=this.optionUpload._controller.updateCrop,this.optionUpload._controller.updateCrop=()=>{this._syncUpload=!0,this._syncCrop=!0,this._updateCropOriginal()}),this.onChange(this.option),delete this._syncUpload,delete this._syncCrop}}})),this.optionUpload._controller.field.element.addEventListener("upload:removed",(t=>{!this._syncUpload&&this.image&&(this.removeImage(),delete this._fileCrop,this.onChange(this.option))})),this.optionUpload._controller.field.element.addEventListener("upload:editor:cancel",(t=>{this._syncUpload&&this.image&&(this.image._img&&(this.image._preview=this.image._img,delete this.image._img),this._syncCrop||this.removeImage(),this.onChange(this.option),delete this._syncUpload,delete this._syncCrop)}))),this._syncUpload=!0,this._syncCrop=!1;const i=()=>{this.optionUpload._controller.field.uploadFile(t).then((t=>{s.debug("library image upload-lift complete",t)}))};this.optionUpload._controller.field._upload?.isReady()?i():this.optionUpload._controller.field.element.addEventListener("upload:ready",(()=>i()),{once:!0})}}constructor(t,e){wn(this,"_preview","data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/Pgo8IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPgo8c3ZnIHdpZHRoPSI0MHB4IiBoZWlnaHQ9IjQwcHgiIHZpZXdCb3g9IjAgMCA0MCA0MCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4bWw6c3BhY2U9InByZXNlcnZlIiBzdHlsZT0iZmlsbC1ydWxlOmV2ZW5vZGQ7Y2xpcC1ydWxlOmV2ZW5vZGQ7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZS1taXRlcmxpbWl0OjEuNDE0MjE7IiB4PSIwcHgiIHk9IjBweCI+CiAgICA8ZGVmcz4KICAgICAgICA8c3R5bGUgdHlwZT0idGV4dC9jc3MiPjwhW0NEQVRBWwogICAgICAgICAgICBALXdlYmtpdC1rZXlmcmFtZXMgc3BpbiB7CiAgICAgICAgICAgICAgZnJvbSB7CiAgICAgICAgICAgICAgICAtd2Via2l0LXRyYW5zZm9ybTogcm90YXRlKDBkZWcpCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHRvIHsKICAgICAgICAgICAgICAgIC13ZWJraXQtdHJhbnNmb3JtOiByb3RhdGUoLTM1OWRlZykKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgQGtleWZyYW1lcyBzcGluIHsKICAgICAgICAgICAgICBmcm9tIHsKICAgICAgICAgICAgICAgIHRyYW5zZm9ybTogcm90YXRlKDBkZWcpCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHRvIHsKICAgICAgICAgICAgICAgIHRyYW5zZm9ybTogcm90YXRlKC0zNTlkZWcpCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHN2ZyB7CiAgICAgICAgICAgICAgICAtd2Via2l0LXRyYW5zZm9ybS1vcmlnaW46IDUwJSA1MCU7CiAgICAgICAgICAgICAgICAtd2Via2l0LWFuaW1hdGlvbjogc3BpbiAxLjVzIGxpbmVhciBpbmZpbml0ZTsKICAgICAgICAgICAgICAgIC13ZWJraXQtYmFja2ZhY2UtdmlzaWJpbGl0eTogaGlkZGVuOwogICAgICAgICAgICAgICAgYW5pbWF0aW9uOiBzcGluIDEuNXMgbGluZWFyIGluZmluaXRlOwogICAgICAgICAgICB9CiAgICAgICAgXV0+PC9zdHlsZT4KICAgIDwvZGVmcz4KICAgIDxnIGlkPSJvdXRlciI+CiAgICAgICAgPGc+CiAgICAgICAgICAgIDxwYXRoIGQ9Ik0yMCwwQzIyLjIwNTgsMCAyMy45OTM5LDEuNzg4MTMgMjMuOTkzOSwzLjk5MzlDMjMuOTkzOSw2LjE5OTY4IDIyLjIwNTgsNy45ODc4MSAyMCw3Ljk4NzgxQzE3Ljc5NDIsNy45ODc4MSAxNi4wMDYxLDYuMTk5NjggMTYuMDA2MSwzLjk5MzlDMTYuMDA2MSwxLjc4ODEzIDE3Ljc5NDIsMCAyMCwwWiIgc3R5bGU9ImZpbGw6YmxhY2s7Ii8+CiAgICAgICAgPC9nPgogICAgICAgIDxnPgogICAgICAgICAgICA8cGF0aCBkPSJNNS44NTc4Niw1Ljg1Nzg2QzcuNDE3NTgsNC4yOTgxNSA5Ljk0NjM4LDQuMjk4MTUgMTEuNTA2MSw1Ljg1Nzg2QzEzLjA2NTgsNy40MTc1OCAxMy4wNjU4LDkuOTQ2MzggMTEuNTA2MSwxMS41MDYxQzkuOTQ2MzgsMTMuMDY1OCA3LjQxNzU4LDEzLjA2NTggNS44NTc4NiwxMS41MDYxQzQuMjk4MTUsOS45NDYzOCA0LjI5ODE1LDcuNDE3NTggNS44NTc4Niw1Ljg1Nzg2WiIgc3R5bGU9ImZpbGw6cmdiKDIxMCwyMTAsMjEwKTsiLz4KICAgICAgICA8L2c+CiAgICAgICAgPGc+CiAgICAgICAgICAgIDxwYXRoIGQ9Ik0yMCwzMi4wMTIyQzIyLjIwNTgsMzIuMDEyMiAyMy45OTM5LDMzLjgwMDMgMjMuOTkzOSwzNi4wMDYxQzIzLjk5MzksMzguMjExOSAyMi4yMDU4LDQwIDIwLDQwQzE3Ljc5NDIsNDAgMTYuMDA2MSwzOC4yMTE5IDE2LjAwNjEsMzYuMDA2MUMxNi4wMDYxLDMzLjgwMDMgMTcuNzk0MiwzMi4wMTIyIDIwLDMyLjAxMjJaIiBzdHlsZT0iZmlsbDpyZ2IoMTMwLDEzMCwxMzApOyIvPgogICAgICAgIDwvZz4KICAgICAgICA8Zz4KICAgICAgICAgICAgPHBhdGggZD0iTTI4LjQ5MzksMjguNDkzOUMzMC4wNTM2LDI2LjkzNDIgMzIuNTgyNCwyNi45MzQyIDM0LjE0MjEsMjguNDkzOUMzNS43MDE5LDMwLjA1MzYgMzUuNzAxOSwzMi41ODI0IDM0LjE0MjEsMzQuMTQyMUMzMi41ODI0LDM1LjcwMTkgMzAuMDUzNiwzNS43MDE5IDI4LjQ5MzksMzQuMTQyMUMyNi45MzQyLDMyLjU4MjQgMjYuOTM0MiwzMC4wNTM2IDI4LjQ5MzksMjguNDkzOVoiIHN0eWxlPSJmaWxsOnJnYigxMDEsMTAxLDEwMSk7Ii8+CiAgICAgICAgPC9nPgogICAgICAgIDxnPgogICAgICAgICAgICA8cGF0aCBkPSJNMy45OTM5LDE2LjAwNjFDNi4xOTk2OCwxNi4wMDYxIDcuOTg3ODEsMTcuNzk0MiA3Ljk4NzgxLDIwQzcuOTg3ODEsMjIuMjA1OCA2LjE5OTY4LDIzLjk5MzkgMy45OTM5LDIzLjk5MzlDMS43ODgxMywyMy45OTM5IDAsMjIuMjA1OCAwLDIwQzAsMTcuNzk0MiAxLjc4ODEzLDE2LjAwNjEgMy45OTM5LDE2LjAwNjFaIiBzdHlsZT0iZmlsbDpyZ2IoMTg3LDE4NywxODcpOyIvPgogICAgICAgIDwvZz4KICAgICAgICA8Zz4KICAgICAgICAgICAgPHBhdGggZD0iTTUuODU3ODYsMjguNDkzOUM3LjQxNzU4LDI2LjkzNDIgOS45NDYzOCwyNi45MzQyIDExLjUwNjEsMjguNDkzOUMxMy4wNjU4LDMwLjA1MzYgMTMuMDY1OCwzMi41ODI0IDExLjUwNjEsMzQuMTQyMUM5Ljk0NjM4LDM1LjcwMTkgNy40MTc1OCwzNS43MDE5IDUuODU3ODYsMzQuMTQyMUM0LjI5ODE1LDMyLjU4MjQgNC4yOTgxNSwzMC4wNTM2IDUuODU3ODYsMjguNDkzOVoiIHN0eWxlPSJmaWxsOnJnYigxNjQsMTY0LDE2NCk7Ii8+CiAgICAgICAgPC9nPgogICAgICAgIDxnPgogICAgICAgICAgICA8cGF0aCBkPSJNMzYuMDA2MSwxNi4wMDYxQzM4LjIxMTksMTYuMDA2MSA0MCwxNy43OTQyIDQwLDIwQzQwLDIyLjIwNTggMzguMjExOSwyMy45OTM5IDM2LjAwNjEsMjMuOTkzOUMzMy44MDAzLDIzLjk5MzkgMzIuMDEyMiwyMi4yMDU4IDMyLjAxMjIsMjBDMzIuMDEyMiwxNy43OTQyIDMzLjgwMDMsMTYuMDA2MSAzNi4wMDYxLDE2LjAwNjFaIiBzdHlsZT0iZmlsbDpyZ2IoNzQsNzQsNzQpOyIvPgogICAgICAgIDwvZz4KICAgICAgICA8Zz4KICAgICAgICAgICAgPHBhdGggZD0iTTI4LjQ5MzksNS44NTc4NkMzMC4wNTM2LDQuMjk4MTUgMzIuNTgyNCw0LjI5ODE1IDM0LjE0MjEsNS44NTc4NkMzNS43MDE5LDcuNDE3NTggMzUuNzAxOSw5Ljk0NjM4IDM0LjE0MjEsMTEuNTA2MUMzMi41ODI0LDEzLjA2NTggMzAuMDUzNiwxMy4wNjU4IDI4LjQ5MzksMTEuNTA2MUMyNi45MzQyLDkuOTQ2MzggMjYuOTM0Miw3LjQxNzU4IDI4LjQ5MzksNS44NTc4NloiIHN0eWxlPSJmaWxsOnJnYig1MCw1MCw1MCk7Ii8+CiAgICAgICAgPC9nPgogICAgPC9nPgo8L3N2Zz4K"),this.onChange=t,this.getOption=e,this.config=null,this.option=null,this.settings=bn.settings,this.settings.api=-1===this.settings.api.indexOf("local")?this.settings.api.replace("api.","assets."):this.settings.api}}bn.settings={assets:"",api:"",path:"/api/list",queryParams:{}};var xn=bn;co.templates.library=(t,e,i,o,n)=>{let r=void 0===t._controller;return t._controller=t._controller||new bn(i,n),t._controller.option=t,t._controller.config=e,r?t._controller.init():t.value&&!t._controller.image&&-1!==t.value.indexOf("http")&&t._controller.restoreImage(),(r||e.editorMode)&&t._controller.initUI(),et`

          ${t.params.popup?et`<div class="cl-po--swatch-container" data-library-popup>
                         <label class="cl-po--swatch-item grow" >
                                <div class="cl-po--swatch cl-po--swatch-button ${Zo(Mo(t,"small"))}" style=${Ko(ko(t,To(t)))}
                                     @click=${e=>t._controller.openPopup()}>
                                     ${l.get("product.options.library.button",null,"Select image")}
                                </div>
                         </label>
                    </div>`:null}


          ${t._controller.image?et`<div class="cl-po--swatch-container" data-library-image>

                      ${t._controller.image.id?et`<input type="hidden" id="${t.id}-id" name="properties[_${t.name}_id]" value=${t._controller.image.id} form=${Pi(e.productFormLink)}>`:null}
                       
                       <label class="cl-po--swatch-item ${Zo({"cl-hide":!t.params.popup&&!(t._layer?.params.crop||t._layer?.params.layerEditor||t._controller.optionUpload)})}">
                            <input type="radio" class="cl-po--input ${Zo(Po(t))}" id="${t.id}" name="${No(t)}" .value=${t.value}  
                               checked ?required=${t.required} form=${Pi(e.productFormLink)}>
                            <div class="cl-po--swatch cl-po--swatch-img  ${Zo(Mo(t,"large"))}" data-tippy-content="${Pi(Io(t,t._controller.image,oo.moneyFormat))}" data-tippy-placement="bottom">
                                 ${t._controller.image.img?et`<img src="${t._controller.image._preview?t._controller.image._preview:go(t._controller.image.img,mo(t.params.size||"large"))}" alt="${xo(t,t._controller.image,oo.moneyFormat)}"/>`:null}
                            </div>
                      </label>

                      ${t._layer?.params.crop||t._controller._fileCrop?et`
                          <div class="cl-po--swatch-item cl-po--upload">
                            <div class="cl-po--input cl-po--upload-button crop ${Zo({"has-label":(t._layer||t._controller.optionUpload?._layer)?.params.cropLabel})}" @click=${e=>t._controller.crop()}>
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M15 17v2H6a1 1 0 0 1-1-1V7H2V5h3V2h2v15h8zm2 5V7H9V5h9a1 1 0 0 1 1 1v11h3v2h-3v3h-2z" /></svg>
                                ${(t._layer||t._controller.optionUpload?._layer)?.params.cropLabel?et`<span class="cl-po--crop-label">${(t._layer||t._controller.optionUpload?._layer)?.params.cropLabel}</span>`:null}
                            </div>
                          </div>
                        `:null}
                      
                      ${t._layer?.params.layerEditor?et`${co.templates.layer_editor(t,e,i)}`:null}
                  </div>`:null}
          
            <div class="cl-po--library" style=${Ko(t._controller.libraryStyleMap())}">
                
                <div class="cl-po--library-search ${Zo({"cl-hide":t._controller.searchHide})}">
                     <input type="text" class="cl-po--input" id="${t.id}_search" name="${t.name}_search" .value=${t._controller.searchQuery}
                            placeholder=${l.get("product.options.library.search.placeholder",null,"Search images")}
                            @input=${Fo(t,(e=>t._controller.onSearch(e)))} >
                </div>
                <div class="cl-po--library-categories ${Zo({"cl-hide":t._controller.categoryHide})}">

                    ${t._controller.categoryCount>0?et`<div class="cl-po--label">${l.get("product.options.library.categories.label",null,"Categories")}</div>`:null}
                    
                    ${t.params.categoryGrid?et`
                        <div class="cl-po--library-grid">
                             ${Ii(t.values||[],(t=>t.value),((e,i)=>et`
                                 ${t._controller.image!==e?et`
                                     <div class="cl-po--library-grid-item">
                                         <div class="cl-po--swatch ${Zo({"cl-checked":t._controller.category===e})}" 
                                              @click=${i=>t._controller.onCategoryChange(i,e)}>
                                             ${e.img?et`<img src="${go(e.img,mo("large"))}" alt="${xo(t,e,oo.moneyFormat)}"/>`:null}
                                             <span class="cl-po--library-category-text">${vi(xo(t,e,oo.moneyFormat))}</span>
                                         </div>
                                     </div>`:null}
                            `))}
                        </div>
                        `:et`
                        <div class="cl-po--swatch-container">
                            ${Ii(t.values||[],(t=>t.value),((e,i)=>et`
                                ${t._controller.image!==e?et`
                                    <div class="cl-po--swatch-item" >
                                        <div class="cl-po--swatch cl-po--swatch-button ${Zo(Mo(t,"small",{"cl-checked":t._controller.category===e}))}"
                                             @click=${i=>t._controller.onCategoryChange(i,e)}>
                                            ${vi(xo(t,e,oo.moneyFormat))}
                                        </div>
                                    </div>`:null}
                            `))}
                        </div>`}
                </div>
                ${!t._controller.imagesHide&&t._controller.categoryHide?et`<div class="cl-po--library-images-category" >

                                <div class="cl-po--swatch cl-po--swatch-button cl-po--swatch-button-library ${Zo({"cl-hide":t._controller.categoryCount<=1})}" @click=${e=>t._controller.showCategories()}>
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2C17.52 2 22 6.48 22 12C22 17.52 17.52 22 12 22C6.48 22 2 17.52 2 12C2 6.48 6.48 2 12 2ZM12 20C16.42 20 20 16.42 20 12C20 7.58 16.42 4 12 4C7.58 4 4 7.58 4 12C4 16.42 7.58 20 12 20ZM12 11H16V13H12V16L8 12L12 8V11Z"></path></svg>
                                    ${l.get("product.options.library.categories.button",null,"Show categories")}
                                </div>
                            
                             </div>`:null}
                <div class="cl-po--library-images ${Zo({"cl-hide":t._controller.imagesHide})}">
                    
                    <div class="cl-po--library-grid">
                        ${Ii(t._controller.imagesPaged||[],(t=>t.value),((e,i)=>et`
                        <div class="cl-po--library-grid-item">
                            <div class="cl-po--swatch ${Zo({"cl-checked":t._controller.image===e})}" data-tippy-content="${Pi(Io(t,e,oo.moneyFormat))}" data-tippy-placement="bottom"
                                 @click=${i=>t._controller.onImageChange(i,e)}>
                                ${e.img?et`<img src="${go(e.img,mo("large"))}" alt="${xo(t,e,oo.moneyFormat)}"/>`:null}
                            </div>
                        </div>
                        `))}
                    </div>

                    ${t._controller.searchQuery&&0===t._controller.imagesPaged.length?et`
                                <div class="cl-po--library-images-more">
                                    <p>${l.get("product.options.library.search.empty",null,"No results found")}</p>
                                </div>
                            `:null}

                    ${t._controller.hasMoreImages?et`
                                <div class="cl-po--library-images-more">
                                    <div class="cl-po--swatch cl-po--swatch-button cl-po--swatch-button-library" @click=${e=>t._controller.onMoreImages()}>
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2C17.52 2 22 6.48 22 12C22 17.52 17.52 22 12 22C6.48 22 2 17.52 2 12C2 6.48 6.48 2 12 2ZM12 20C16.42 20 20 16.42 20 12C20 7.58 16.42 4 12 4C7.58 4 4 7.58 4 12C4 16.42 7.58 20 12 20ZM13 12H16L12 16L8 12H11V8H13V12Z"></path></svg>
                                        ${l.get("product.options.library.images.button",null,"More images")}
                                    </div>
                                </div>
                               `:null}
                    
                </div>
            </div>`},co.templates["library-popup"]=(t,e,i)=>et`
        <div class="ldcv ${e.className}" >
            <div class="base">
                <div class="inner card">
                    <div class="cl-po--popup cl-po--popup-library">
                        <div class="cl-po--popup-options cl--po-wrapper" id=${e.id}>
                            ${t}
                        </div>
                    </div>
                    <div class="cl-po--popup-close" @click="${t=>i(t)}">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" ><path fill="none" d="M0 0h24v24H0z"/><path d="M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10-4.477 10-10 10zm0-2a8 8 0 1 0 0-16 8 8 0 0 0 0 16zm0-9.414l2.828-2.829 1.415 1.415L13.414 12l2.829 2.828-1.415 1.415L12 13.414l-2.828 2.829-1.415-1.415L10.586 12 7.757 9.172l1.415-1.415L12 10.586z"/></svg>
                    </div>
                </div>
            </div>
        </div>
    `;const Cn=1,En=2,In=3;class Sn{init(){this.option.values.unshift({value:"0",priceVariant:{id:0},price:0}),"_"!==this.option.name[0]&&(this.option.name="_"+this.option.name)}initUI(){this.styles={},this.option.params.bundleColor&&(this.styles["--bundle-primary-color"]=this.option.params.bundleColor),this.option.params.bundleBgColor&&(this.styles["--bundle-primary-bg"]=this.option.params.bundleBgColor),this.bundles=this.option.params.bundles,this.calcPrices(),!this.selected&&this.bundles.length&&(n.hasQueryParam(window.location.href,"item")||this.config.productForm.addEventListener("options:rendered",(()=>{let t=this.bundles.find((t=>t.selected));this.select(t||this.bundles[0])}),{once:!0}))}calcPrices(){let t=this.config.variant.price/100+this.config.price.total;return!(this._priceProduct&&t===this._priceProduct&&!this.config.editorMode)&&(this._priceProduct=t,this.bundles.forEach((t=>{this.calcBundlePrice(t)})),!0)}calcBundlePrice(t){let e=0,i=0;t.products.forEach((o=>{let n=0,r="";if("0"===o.id)n=this.config.variant.price/100,o.title=this.config.product.title,o.available=this.config.variant.available,o.priceOptions=this.config.price.total-this.config.price.variantTotal,o.priceOptions&&(n+=o.priceOptions),r=this.config.product.featured_image,this.config.variant.featured_image&&this.config.variant.featured_image.src&&(r=this.config.variant.featured_image.src);else if(u.products.hasOwnProperty(o.handle+".js")){let t=u.products[o.handle+".js"];o.variants?.length&&!o.variantsSelect&&(o.variantsSelect=t.variants.filter((t=>o.variants.includes(String(t.id)))).map((t=>({id:String(t.id),title:t.title}))));let e=t.variants.find((t=>Number(t.id)===Number(o.variant)));e?(n=e.price/100,r=t.featured_image,e.featured_image&&e.featured_image.src&&(r=e.featured_image.src),o.variantsSelect?o.title=t.title:o.title=e.name,o.available=e.available):o.available=!1}switch(r&&(o.img=go(r,"200x200")),o.priceBefore=n,o.discountType){case Cn:o.price=Math.max(0,n-no(o.discount));break;case En:o.price=n*(1-o.discount/100);break;case In:o.price=no(o.discount),o.priceOptions&&(o.price+=o.priceOptions);break;default:o.price=n}if(oo.checkout.variantId&&o.priceOptions){let e=o.price-o.priceOptions;if(e<0){n-o.priceOptions+Math.abs(e)>o.priceOptions&&(o.price=o.priceOptions+1,s.warn("[live-options] Bundle discount exceeds base product and add-on price",t.title),t._reset=!0)}t._reset&&this.selected===t&&this.option.values[0].bundle&&(this.option.values[0].bundle.price=o.price-o.priceOptions)}e+=o.price*o.quantity,i+=o.priceBefore*o.quantity})),t.price=e,t.priceBefore=i,t.priceDiscount=i-e;let o=ho(100*t.priceDiscount,oo.moneyFormat);t._title=t._title||l.translate(t.title.replace(/{{ /g,"{{").replace(/ }}/g,"}}")),t.title=t._title.replace(/{{product}}/g,this.config.product.title).replace(/{{discount}}/g,o),t._subtitle=t._subtitle||l.translate(t.subtitle.replace(/{{ /g,"{{").replace(/ }}/g,"}}")),t.subtitle=t._subtitle.replace(/{{ /g,"{{").replace(/ }}/g,"}}").replace(/{{product}}/g,this.config.product.title).replace(/{{discount}}/g,o),t.badge&&(t._badge=t._badge||l.translate(t.badge.replace(/{{ /g,"{{").replace(/ }}/g,"}}")),t.badge=t._badge.replace(/{{product}}/g,this.config.product.title).replace(/{{discount}}/g,o))}isSelected(t,e){if(t.value&&-1!==t.value.indexOf(e.value)){if(-1!==t.value.split(",").indexOf(e.value))return!0}return!1}select(t){this.selected=t,this.bundles.forEach((t=>{t.selected=!1})),t.selected=!0;let e=[],i=!0;for(let o=0;o<t.products.length;o++){const n=t.products[o];if(!1===n.available){e.length=0,i=!1;break}let r;"0"!==n.id?(r=this.option.values.find((t=>String(n.variant)===t.priceVariant?.id)),r&&(e.push(n.variant),r.bundle={id:String(n.variant),handle:n.handle,quantity:n.quantity,price:n.price},r.price=n.price*n.quantity)):(r=this.option.values[0],(n.discount||n.quantity>1)&&(r.bundle={id:n.id,quantity:n.quantity,price:n.price-n.priceOptions},e.push("0")))}this.option.value=e.join(","),this.onChange(this.option)}selectVariant(t,e,i){e.variant=String(i),this.calcBundlePrice(t),this.select(t)}template(){if(this.option.value&&!this.selected){let t=this.bundles.find((t=>this.option.value===t.id));t&&(t.selected=!0,this.selected=t,queueMicrotask((()=>this.select(t))))}let t=this.calcPrices();!this.config.editorMode&&t&&this.selected&&queueMicrotask((()=>this.select(this.selected)));const e=this.option,i=this.config;return et`
        <input type="hidden" name="${No(e)}" id="${e.id}" value=${this.selected?.id} form=${Pi(i.productFormLink)} />
        <input type="hidden" name="properties[${eo.BUNDLE_TITLE}]" value=${this.selected?.title} form=${Pi(i.productFormLink)}>

        <div class="cl-bundle-group" style="${Ko(this.styles)}">
            ${Ii(this.bundles||[],(t=>t.id),((t,o)=>et`
                <div class="cl-bundle-option ${Zo({"cl-bundle-option--selected":t.selected})}">
                    <label for="${e.id}-${o}" class="cl-bundle-container ${t.badge?"cl-bundle-container--featured":""}">
                        ${t.badge?et`<div class="cl-bundle-badge">${t.badge}</div>`:""}

                        <div class="cl-bundle-wrapper">
                            <div class="cl-bundle-main">
                                <input type="radio" 
                                       class="cl-bundle-input ${Zo(Po(e))}" 
                                       id="${e.id}-${o}" 
                                       name="_${e.name}"
                                       .value=${o} 
                                       @change=${()=>this.select(t)}
                                       .checked=${Go(t.selected)} 
                                       form=${Pi(i.productFormLink)}>

                                <div class="cl-bundle-content">
                                    <div class="cl-bundle-text">
                                        <div class="cl-bundle-title">${vi(t.title)}</div>
                                        ${t.subtitle?et`<div class="cl-bundle-subtitle">${vi(t.subtitle)}</div>`:""}
                                    </div>
                                    <div class="cl-bundle-price">
                                        <span class="cl-bundle-price__current">${vi(ho(100*t.price,oo.moneyFormat))}</span>
                                        ${t.priceBefore!==t.price?et`
                                            <span class="cl-bundle-price__before">${vi(ho(100*t.priceBefore,oo.moneyFormat))}</span>
                                        `:""}
                                    </div>
                                </div>
                            </div>

                            ${t.products.length>1?et`
                                <div class="cl-bundle-items">
                                    ${Ii(t.products,(t=>t.id),((e,i)=>et`
                                        <div class="cl-bundle-item${!1===e.available?" cl-bundle-item__unavailable":""}">
                                            <div class="cl-bundle-item__wrapper">
                                                <img class="cl-bundle-item__image" src="${e.img}" alt="${e.title}">
                                                <div class="cl-bundle-item__title">
                                                    ${e.quantity>1?et`<span class="cl-bundle-item__quantity">${e.quantity}x</span>`:""}
                                                    <span class="cl-bundle-item__title-text">${e.title}</span>
                                                    ${t.selected&&e.variantsSelect?.length?et`
                                                        <select class="cl-bundle-item__variants" name="_${e.id}" @change=${i=>this.selectVariant(t,e,i.target.value)}>
                                                            ${Ii(e.variantsSelect,(t=>t.id),(t=>et`
                                                                <option value="${t.id}" ?selected=${t.id===e.variant}>${t.title}</option>
                                                            `))}
                                                        </select>
                                                    `:""}
                                                </div>
                                            </div>
                                            <div class="cl-bundle-price cl-bundle-item-price">
                                                <span class="cl-bundle-price__current">${e.price>0?vi(ho(100*e.price*e.quantity,oo.moneyFormat)):l.get("product.options.free",{},"FREE")}</span>
                                                ${e.priceBefore!==e.price?et`
                                                    <span class="cl-bundle-price__before">${vi(ho(100*e.priceBefore*e.quantity,oo.moneyFormat))}</span>
                                                `:""}
                                            </div>
                                        </div>
                                    `))}
                                </div>
                            `:""}
                        </div>
                    </label>
                </div>
            `))}
        </div>
        `}constructor(t){this.onChange=t,this.config=null,this.option=null,this.shopifyStore=u.getInstance(),this.selected=null}}co.templates.bundle=(t,e,i,o,n)=>{if(!ao.BUNDLE)return et``;let r=void 0===t._controller;return t._controller=t._controller||new Sn(i,n),t._controller.option=t,t._controller.config=e,r&&t._controller.init(),(r||e.editorMode)&&t._controller.initUI(),t._controller.template()};const On="none";class Ln{init(){this.prompt="",this.systemPrompt="",this.selectedImage=null,this.isLoading=!1,this.errors={},this.failures=0,this.failuresEdit=0,this.imageHistory=this.loadHistory(),this.selectedStyle=On,this.editingMode=!1,this.selectedImageForEdit=null,this.editPrompt="",this.displayedImagesCount=0,this.originalUploadImage=null}initUI(){this.level=window.Cloudlift.options.config?.ai?.level||3,this.levelEdit=window.Cloudlift.options.config?.ai?.levelEdit||3,this.levelBg=window.Cloudlift.options.config?.ai?.levelBg||1,this.option.params.aiPrompt&&(this.systemPrompt=this.option.params.aiPrompt),this.aiGenerate=this.option.params.aiEditor?.generate||!1,this.aiStyle=this.option.params.aiEditor?.style||!1,this.aiEdit=this.option.params.aiEditor?.edit||!1,this.aiRemoveBg=this.option.params.aiEditor?.removeBg||!1,this.aiRemoveBgAuto=this.option.params.aiRemoveBgAuto||!1,this.aiRatio=this.option.params.aiRatio||void 0,this.aiPageSize=this.option.params.aiPageSize||6,this.aiImagesMax=this.option.params.aiImagesMax??3*this.aiPageSize,0===this.displayedImagesCount&&(this.displayedImagesCount=Math.min(this.aiPageSize,this.imageHistory.length)),this.styles=window.Cloudlift.options.config?.ai?.styles||[],Array.isArray(this.option.params.aiStyles)&&this.option.params.aiStyles.length>0?this.styles=this.styles.filter((t=>this.option.params.aiStyles.includes(t.id))):this.aiGenerate&&(this.styles=this.styles.filter((t=>!t.id.startsWith("edit_"))));const t=this.styles.findIndex((t=>t.id===On));if(t>0){const[e]=this.styles.splice(t,1);this.styles.unshift(e)}this.selectedStyle&&this.selectedStyle!==On||(this.selectedStyle=this.styles.length?this.styles[0].id:On),this.option.params.optionUpload&&(this.uploadSync=this.option.params.uploadSync||!1,this.optionChanged&&this.config.productForm.removeEventListener("option:changed",this.optionChanged),this.optionChanged=this.onOptionChanged.bind(this),this.config.productForm.addEventListener("option:changed",this.optionChanged)),this.option.params.aiLivePreview&&window.addEventListener("options:rendered",(t=>{this._productOptions=t.detail}),{once:!0}),this.styles.length>4&&!this._dragScrollInitialized&&(this._dragScrollInitialized=!0,window.addEventListener("options:rendered",(()=>{this.initDragScroll()}),{once:!0}))}restore(){const t={id:"ai_cart",img:this._corsUrl(this.option.value),style:"none"};this.imageHistory.unshift(t),this.displayedImagesCount++,this.onImageSelect(null,t)}combinePrompts(t){if(!this.systemPrompt)return t||"";let e=this.systemPrompt;const i=[...e.matchAll(/\{([^}]+)\}/g)];for(const o of i){const i=o[0],n=o[1];let r="";if("prompt"===n)r=t||"";else{const t=this.getOption(n);r=t?.value||""}e=e.replace(new RegExp(i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"g"),r)}return e.trim()}getRatio(){if(this.aiRatio){if(this.aiRatio.startsWith("{")&&this.aiRatio.endsWith("}")){const t=this.aiRatio.slice(1,-1),e=this.getOption(t);if(e?.value)return e.value}return this.aiRatio}}async onGenerateImage(){const t=this.editingMode?this.editPrompt:this.prompt;if(!t.trim())return this.errors.general=l.get("product.options.ai.error.empty_prompt",null,"Please enter a prompt"),void this.renderOptions();this.errors={},this.isLoading=!0,this.renderOptions();const e=this.combinePrompts(t);let i;i=this.editingMode&&this.selectedImageForEdit?await this.editImage(this.selectedImageForEdit,e):await this.generateImage(e),await this.handleResult(i)}async handleResult(t){if(this.isLoading=!1,t){if(this.imageHistory.unshift(t),this.imageHistory.length>this.aiImagesMax&&(this.imageHistory=this.imageHistory.slice(0,this.aiImagesMax)),this.saveHistory(),this.displayedImagesCount=Math.min(this.aiPageSize,this.imageHistory.length),this.onImageSelect(null,t),this.aiRemoveBgAuto&&!t.backgroundRemoved)return void await this.removeBackground(t);this.editingMode&&this.exitEditingMode()}this.renderOptions()}onPromptChange(t){this.editingMode?this.editPrompt=t.target.value:this.prompt=t.target.value,Object.keys(this.errors).length>0&&(this.errors={},this.renderOptions())}onStyleClick(t){if(this.selectedStyle!==t)if(this.selectedStyle=t,this.originalUploadImage||this.isLoading){if(this.originalUploadImage){const t=this.imageHistory.find((t=>t.originalImage?.id===this.originalUploadImage.id&&(t.style===this.selectedStyle||this.selectedStyle===On&&t.id===this.originalUploadImage.id)));return t?(this.onImageSelect(null,t),void this.renderOptions()):this.selectedStyle!==On?(this.uploadImage={...this.originalUploadImage},void this.editUpload()):(this.onImageSelect(null,this.originalUploadImage),void this.renderOptions())}this.renderOptions()}else{const t=document.querySelectorAll(".cl-po--ai-style-item"),e=this.styles.findIndex((t=>t.id===this.selectedStyle));t.forEach(((t,i)=>{i===e?t.classList.add("cl-po--ai-style-selected"):t.classList.remove("cl-po--ai-style-selected")}))}}onImageSelect(t,e){if(this.selectedImage){const t=this.option.values?.indexOf(this.selectedImage);t>-1&&this.option.values.splice(t,1)}this.selectedImage=e,this.option.values||(this.option.values=[]),this.option.values.push(e),this.option.value=e.img,this.uploadSync&&(this.getOption(this.option.params.optionUpload).value=this.option.value),this.onChange(this.option)}isSelected(t,e){return this.selectedImage===e}onValidate(t){return!(t.required&&!this.selectedImage)||(t.errors.push(l.get("product.options.validity.valueMissing")),!1)}renderOptions(){this.config.productForm.dispatchEvent(new CustomEvent("options:render",{detail:this.option,cancelable:!0,bubbles:!0}))}aiStyleMap(t={}){return this.option.params.aiColor&&(t["--ai-primary-color"]=this.option.params.aiColor),this.option.params.aiImgSize&&(t["--ai-image-size"]=this.option.params.aiImgSize+"px"),t}handleApiError(t,e="generate"){const i=t.xhr?.status,o=t.data?.error||t.statusText||"Operation failed";switch(i){case 429:return this.errors.general=l.get("product.options.ai.error.rate_limit",null,"Too many requests. Please wait a moment and try again."),{shouldRetry:!1,isRateLimit:!0};case 402:return this.errors.general=l.get("product.options.ai.error.payment_required",null,"Not enough credits."),{shouldRetry:!1};case 400:return this.errors.general=o||l.get("product.options.ai.error.bad_request",null,"Invalid request. Please check your input."),{shouldRetry:!1};case 408:return this.errors.general=l.get("product.options.ai.error.timeout",null,"Request timed out. Please try again."),"edit"===e?this.failuresEdit++:"generate"===e&&this.failures++,{shouldRetry:!0};default:return this.errors.general=l.get("product.options.ai.error.unavailable",null,"Service temporarily unavailable. Please try again."),"edit"===e?this.failuresEdit++:"generate"===e&&this.failures++,{shouldRetry:!0}}}async generateImage(t){try{const e={prompt:t,level:this.level,retry:this.failures>0?Math.min(this.failures,2):void 0,ratio:3===this.level?this.getRatio():void 0};this.selectedStyle!==On&&(e.style=this.selectedStyle);const i=await new r(this.settings.api+"/api/ai/image/generate",{method:"POST",responseType:"json",headers:{"Content-type":"application/json"},data:e,queryParams:this.settings.queryParams});if(i.data.error)return this.errors.general=i.data.error,this.failures++,null;if(i.data.url)return{id:`ai_${Date.now()}`,img:i.data.url,prompt:t,style:this.selectedStyle}}catch(t){return s.error("AI image generation request failed:",t),this.handleApiError(t,"generate"),null}}async editImage(t,e){try{const i={prompt:e,url:t.img,data:t.data,retry:this.failuresEdit>0?Math.min(this.failuresEdit,1):void 0,level:this.levelEdit,ratio:this.getRatio()};this.selectedStyle!==On&&t.style!==this.selectedStyle&&(i.style=this.selectedStyle);const o=await new r(this.settings.api+"/api/ai/image/edit",{method:"POST",responseType:"json",headers:{"Content-type":"application/json"},data:i,queryParams:this.settings.queryParams});if(o.data.error)return this.errors.general=o.data.error,this.failuresEdit++,null;if(o.data.url)return{id:`ai_edit_${Date.now()}`,img:o.data.url,prompt:e,style:this.selectedStyle,originalImage:t,type:"edit"}}catch(t){return s.error("AI image editing request failed:",t),this.handleApiError(t,"edit"),null}}async removeBackground(t){this.isLoading=!0,this.renderOptions();try{const e={url:t.img,level:this.levelBg},i=await new r(this.settings.api+"/api/ai/image/removebg",{method:"POST",responseType:"json",headers:{"Content-type":"application/json"},data:e,queryParams:this.settings.queryParams});if(i.data.error)this.errors.general=i.data.error,await this.handleResult(null);else if(i.data.url){const e={id:`ai_removebg_${Date.now()}`,img:i.data.url,prompt:"Background removed",style:"background_removed",originalImage:t,type:"removebg",backgroundRemoved:!0};await this.handleResult(e)}}catch(t){s.error("AI background removal request failed:",t),this.handleApiError(t,"removebg"),await this.handleResult(null)}}onEditImage(t){const e=t||this.selectedImage;if(!e)return this.errors.general=l.get("product.options.ai.error.no_image_selected",null,"Please select an image first"),void this.renderOptions();this.editingMode=!0,this.selectedImageForEdit=e,this.editPrompt="",this.renderOptions()}exitEditingMode(){this.editingMode=!1,this.selectedImageForEdit=null,this.editPrompt=""}onCancelEdit(){this.exitEditingMode(),this.renderOptions()}async onOptionChanged(t){let e=t.detail;e.name===this.option.params.optionUpload?e.value?(this.uploadImage={id:`${e.name}_${Date.now()}`,img:e.value},this.originalUploadImage={...this.uploadImage},this.systemPrompt||this.selectedStyle!==On?await this.editUpload():await this.handleResult(this.uploadImage),this.aiEdit&&this.onEditImage(this.selectedImage)):this.uploadImage&&(this.imageHistory=this.imageHistory.filter((t=>t.originalImage?.id!==this.uploadImage.id)),this.saveHistory(),this.selectedImageForEdit?.originalImage?.id===this.uploadImage.id&&this.exitEditingMode(),this.selectedImage?.originalImage?.id===this.uploadImage.id&&(this.selectedImage=null,this.option.value=null,this.onChange(this.option)),delete this.uploadImage):this.uploadImage&&this.option.name!==e.name&&this.option.params.aiLivePreview&&(this.uploadImage.dirty=!0)}async editUpload(){if(this.isLoading=!0,this.renderOptions(),this.option.params.aiLivePreview&&this._productOptions){let t=this._productOptions._getPreviews();if(t?.length){let e=t[0];if(t.length>1&&this.option.params.aiLivePreviewView)for(const i of t)if(i.previewConfig.name===this.option.params.aiLivePreviewView){e=i;break}this.uploadImage.data=e.export({width:1024,height:1024},!1,!1,(t=>t._layer?.params?.option===this.option.name||t._layer?.params?.option===this.option.params.optionUpload),"jpeg")}}const t=this.combinePrompts("the image"),e=await this.editImage(this.uploadImage,t);e?await this.handleResult(e):await this.handleResult(this.uploadImage)}onLoadMore(){const t=this.imageHistory.length-this.displayedImagesCount,e=Math.min(this.aiPageSize,t);this.displayedImagesCount+=e,this.renderOptions()}getStorageKey(){return`cl_ai_${this.option?.name}`}saveHistory(){try{const t=this.getStorageKey(),e=this.imageHistory.slice(0,this.aiImagesMax).map((t=>({id:t.id,img:t.img,style:t.style}))),i={timestamp:Date.now(),images:e};localStorage.setItem(t,JSON.stringify(i))}catch(t){}}loadHistory(){try{window.addEventListener("options:submit",(()=>{this.clearHistory()}),{once:!0});const t=this.getStorageKey(),e=localStorage.getItem(t);if(!e)return[];const i=JSON.parse(e),o=864e5;return Date.now()-(i.timestamp||0)>o?(this.clearHistory(),[]):Array.isArray(i.images)?i.images:(this.clearHistory(),[])}catch(t){return this.clearHistory(),[]}}clearHistory(){try{const t=this.getStorageKey();localStorage.removeItem(t)}catch(t){}}_corsUrl(t){return t=(t=t.replace("https://upload.dev.cloudlift.app/s/dev","https://storage.googleapis.com/cloudlift-app-cloud-dev-upload")).replace("https://upload.cloudlift.app/s","https://storage.googleapis.com/cloudlift-app-cloud-prod-upload")}initDragScroll(){if("ontouchstart"in window||navigator.maxTouchPoints>0)return;const t=document.querySelector(".cl-po--ai-style-horizontal");if(!t)return;if("true"===t.dataset.dragScrollInit)return;t.dataset.dragScrollInit="true";let e,i,o=!1,n=!1;const r=()=>{o&&(o=!1,n=!1,t.style.cursor="grab",t.style.userSelect="")};t.addEventListener("mousedown",(r=>{r.preventDefault(),o=!0,n=!1,t.style.cursor="grabbing",t.style.userSelect="none",e=r.pageX,i=t.scrollLeft})),t.addEventListener("mousemove",(r=>{if(!o)return;r.preventDefault();const s=r.pageX;Math.abs(e-s)>5&&(n=!0);const a=2*(e-s);t.scrollLeft=i+a})),t.addEventListener("mouseup",(e=>{if(o){if(o=!1,t.style.cursor="grab",t.style.userSelect="",n){if(e.target.closest(".cl-po--ai-style-item")){const e=i=>{i.preventDefault(),i.stopPropagation(),setTimeout((()=>{t.removeEventListener("click",e,!0)}),0)};t.addEventListener("click",e,!0)}}n=!1}})),t.addEventListener("mouseleave",r),window.addEventListener("blur",r),t.style.cursor="grab"}scrollToPrevStyle(){const t=document.querySelector(".cl-po--ai-style-horizontal"),e=t?.querySelectorAll(".cl-po--ai-style-item");if(!t||!e?.length)return;const i=t.getBoundingClientRect(),o=t.scrollLeft;let n=null,r=0;for(let t=e.length-1;t>=0;t--){const o=e[t];if(o.getBoundingClientRect().left-i.left<-10){n=o,r=o.offsetLeft;break}}if(!n&&o>0)r=0;else if(n)return void t.scrollTo({left:r,behavior:"smooth"});void 0!==r&&t.scrollTo({left:r,behavior:"smooth"})}scrollToNextStyle(){const t=document.querySelector(".cl-po--ai-style-horizontal"),e=t?.querySelectorAll(".cl-po--ai-style-item");if(!t||!e?.length)return;const i=t.getBoundingClientRect(),o=i.width,n=t.scrollLeft,r=t.scrollWidth-o;let s=null,a=n;for(const t of e){if(t.getBoundingClientRect().right-i.right>10){s=t,a=t.offsetLeft;break}}if(!s&&n<r)a=r;else if(s)return void t.scrollTo({left:a,behavior:"smooth"});a!==n&&t.scrollTo({left:a,behavior:"smooth"})}openOverlay(t){const e=document.createElement("div");e.className="cl-po--ai-overlay",e.setAttribute("data-ai-overlay","true");const i=document.createElement("div");i.className="cl-po--ai-overlay-content";const o=document.createElement("button");o.type="button",o.className="cl-po--ai-overlay-close",o.innerHTML="×";const n=document.createElement("img");n.src=t.img,n.alt="Preview",i.appendChild(o),i.appendChild(n),e.appendChild(i);const r=()=>this.closeOverlay();e.addEventListener("click",r),o.addEventListener("click",r),i.addEventListener("click",(t=>t.stopPropagation())),this._overlayElement=e,document.body.appendChild(e),document.body.style.overflow="hidden"}closeOverlay(){this._overlayElement&&this._overlayElement.parentNode&&this._overlayElement.parentNode.removeChild(this._overlayElement),this._overlayElement=null,document.body.style.overflow=""}constructor(t,e){this.onChange=t,this.getOption=e,this.config=null,this.option=null,this.settings=Ln.settings,this.settings.cdn=-1===this.settings.api.indexOf("local")?this.settings.api.replace("api.","assets."):this.settings.api}}Ln.settings={assets:"",api:"",queryParams:{}};var Pn=Ln;co.templates.ai=(t,e,i,o,n)=>{if(!ao.AI)return et``;let r=void 0===t._controller;t._controller=t._controller||new Ln(i,n),t._controller.option=t,t._controller.config=e,r&&t._controller.init(),(r||e.editorMode)&&t._controller.initUI(),t.value&&null===t._controller.selectedImage&&t._controller.restore();const s=t._controller;return et`
        <div class="cl-po--ai" style=${Ko(s.aiStyleMap())}>
            
            ${s.aiGenerate||s.aiStyle||s.editingMode||s.aiStyleAuto?et`
                <div class="cl-po--ai-input-section">
                    
                ${s.aiStyle&&s.styles.length>1?et`
                    <div class="cl-po--ai-style-selector">
                        <div class="cl-po--ai-style-wrapper">
                            <div class="cl-po--ai-style-horizontal">
                                ${s.styles.map((e=>et`
                                    <div
                                        class="cl-po--ai-style-item ${Zo({"cl-po--ai-style-selected":s.selectedStyle===e.id})}"
                                        @click=${()=>s.onStyleClick(e.id)}
                                    >
                                        <div class="cl-po--ai-style-preview">
                                            ${e.img?et`<img src="${t._controller.settings.cdn+"/api/ai/style/"+e.img}" alt="${e.name}" />`:null}
                                        </div>
                                        <div class="cl-po--ai-style-name">${e.name}</div>
                                    </div>
                                `))}
                            </div>
                        </div>
                        ${s.styles.length>4?et`
                            <button
                                class="cl-po--ai-arrow cl-po--ai-arrow-left"
                                @click=${()=>s.scrollToPrevStyle()}
                                tabindex="-1"
                                type="button"
                            >
                                ‹
                            </button>
                            <button
                                class="cl-po--ai-arrow cl-po--ai-arrow-right"
                                @click=${()=>s.scrollToNextStyle()}
                                tabindex="-1"
                                type="button"
                            >
                                ›
                            </button>
                        `:null}
                    </div>
                `:null}
                
                ${s.aiGenerate||s.editingMode?et`
                <div class="cl-po--ai-prompt">
                    <div class="cl-po--ai-prompt-input ${Zo({"cl-po--ai-editing":s.editingMode})}">
                        <input 
                            type="text" 
                            class="cl-po--input ${Zo({"cl-po--editing":s.editingMode})}" 
                            id="${t.id}_prompt" autocomplete="off"
                            placeholder=${s.editingMode?l.get("product.options.ai.edit.placeholder",null,"Describe how to edit the image..."):l.get("product.options.ai.prompt.placeholder",null,"Describe the image you want to generate...")}
                            .value=${Go(s.editingMode?s.editPrompt:s.prompt)}
                            @input=${t=>s.onPromptChange(t)}
                            @keypress=${t=>"Enter"===t.key&&!s.isLoading&&s.onGenerateImage()}
                            ?disabled=${s.isLoading}
                        >
                        <button 
                            class="cl-po--ai-generate-button ${Zo({"cl-po--loading":s.isLoading,"cl-po--editing":s.editingMode})}"
                            @click=${t=>s.onGenerateImage()}
                            ?disabled=${s.isLoading}
                        >
                            ${s.isLoading?"":s.editingMode?l.get("product.options.ai.button.edit",null,"Edit Image"):l.get("product.options.ai.button.generate",null,"Generate")}
                        </button>
                    </div>
                    
                    ${s.errors.general?et`
                        <div class="cl-po--ai-error">
                            ${s.errors.general}
                        </div>
                    `:null}
                </div>
                `:null}
            `:null}
                
                ${(s.aiEdit||s.aiRemoveBg)&&s.selectedImage||s.editingMode?et`
                    <div class="cl-po--ai-actions ${Zo({"cl-po--ai-editing":s.editingMode})}">
                        ${s.editingMode?et`
                                <span class="cl-po--ai-edit-icon">✏️</span>
                                ${l.get("product.options.ai.edit.indicator",null,"Editing image")}
                                <button class="cl-po--ai-cancel-edit" @click=${t=>s.onCancelEdit()}>X</button>
                        `:et`
                            ${s.aiEdit?et`
                                <button 
                                    class="cl-po--ai-action-button cl-po--ai-edit-button"
                                    @click=${t=>s.onEditImage(s.selectedImage)}
                                    ?disabled=${s.isLoading}
                                >
                                    <span class="cl-po--ai-edit-icon">✏️</span>
                                    ${l.get("product.options.ai.edit.button",null,"Edit Image")}
                                </button>
                            `:null}
                            
                            ${s.aiRemoveBg?et`
                                <button 
                                    class="cl-po--ai-action-button cl-po--ai-removebg-button ${Zo({"cl-po--ai-bg-removed":s.selectedImage?.backgroundRemoved})}"
                                    @click=${t=>s.removeBackground(s.selectedImage)}
                                    ?disabled=${s.isLoading||s.selectedImage?.backgroundRemoved}
                                >
                                    <span class="cl-po--ai-magic-wand">🪄</span>
                                    ${s.selectedImage?.backgroundRemoved?l.get("product.options.ai.removebg.removed",null,"Background Removed"):l.get("product.options.ai.removebg.button",null,"Remove Background")}
                                </button>
                            `:null}
                        `}
                    </div>
                `:null}

            ${s.uploadImage?.dirty?et`
                <button
                        class="cl-po--ai-action-button cl-po--ai-removebg-button"
                        @click=${t=>{s.uploadImage={...s.originalUploadImage},s.editUpload()}}
                        ?disabled=${s.isLoading}
                >
                    <span class="cl-po--ai-magic-wand">🪄</span>
                    ${l.get("product.options.ai.update.button",null,"Update image")}
                </button>
            `:null}
            
            ${s.isLoading?et`
                <div class="cl-po--ai-loading ${Zo({"cl-po--ai-loading-overlay":s.imageHistory.length>0})}">
                    <div class="cl-po--ai-spinner"></div>
                    <div class="cl-po--ai-loading-text">
                        ${s.editingMode?l.get("product.options.ai.loading.editing",null,"Editing image..."):l.get("product.options.ai.loading.generating",null,"Generating your image...")}
                    </div>
                </div>
            `:null}
            
            ${s.imageHistory.length>0?et`
                <div class="cl-po--ai-images">
                    <div class="cl-po--ai-flex-grid">
                        ${Ii(s.imageHistory.slice(0,s.displayedImagesCount),(t=>t.id),(i=>et`
                            <div class="cl-po--ai-flex-item">
                                <label class="cl-po--ai-image-item ${Zo({"cl-po--ai-image-selected":s.selectedImage===i})}">
                                    <input
                                        type="radio"
                                        name="${No(t)}"
                                        value="${i.img}"
                                        .checked=${s.selectedImage===i}
                                        @change=${t=>s.onImageSelect(t,i)}
                                        ?required=${t.required}
                                        form=${Pi(e.productFormLink)}
                                        class="cl-po--ai-image-input"
                                    >
                                    <div class="cl-po--ai-image-preview">
                                        <img src="${i.img}" />
                                    </div>
                                    <button type="button" class="cl-po--ai-preview-button" @click=${t=>{t.preventDefault(),t.stopPropagation(),s.openOverlay(i)}}>🔍</button>
                                </label>
                            </div>
                        `))}
                    </div>
                    
                    ${s.imageHistory.length>s.displayedImagesCount?et`
                        <div class="cl-po--ai-load-more">
                            <button 
                                class="cl-po--ai-load-more-button"
                                @click=${t=>s.onLoadMore()}
                            >
                                ${l.get("product.options.ai.load_more",null,"Load More")} 
                                (${s.imageHistory.length-s.displayedImagesCount} remaining)
                            </button>
                        </div>
                    `:null}
                </div>
            `:null}
        </div>
    `};const Mn='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" fill="currentColor"><path d="M15 4H5V20H19V8H15V4ZM3 2.9918C3 2.44405 3.44749 2 3.9985 2H16L20.9997 7L21 20.9925C21 21.5489 20.5551 22 20.0066 22H3.9934C3.44476 22 3 21.5447 3 21.0082V2.9918ZM13 12V16H11V12H8L12 8L16 12H13Z"></path></svg>',$n='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" fill="currentColor"><path  d="M21 15V18H24V20H21V23H19V20H16V18H19V15H21ZM21.0082 3C21.556 3 22 3.44495 22 3.9934V13H20V5H4V18.999L14 9L17 12V14.829L14 11.8284L6.827 19H14V21H2.9918C2.44405 21 2 20.5551 2 20.0066V3.9934C2 3.44476 2.45531 3 2.9918 3H21.0082ZM8 7C9.10457 7 10 7.89543 10 9C10 10.1046 9.10457 11 8 11C6.89543 11 6 10.1046 6 9C6 7.89543 6.89543 7 8 7Z"></path></svg>',kn='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" fill="currentColor"><path d="M13 6v15h-2V6H5V4h14v2h-6z"/></svg>',Tn='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" fill="currentColor"><path d="M2 18H12V20H2V18ZM2 11H22V13H2V11ZM2 4H22V6H2V4ZM18 18V15H20V18H23V20H20V23H18V20H15V18H18Z"></path></svg>',An={upload:Mn,"upload-lift":Mn,text:kn,textarea:kn,library:$n,"img-swatch":$n};class Fn{initTemplates(){if(this.option.options){for(let t=0;t<this.option.options.length;t++){let e=n.deepCopy(this.option.options[t]);this._processTemplate(e)}this.option.options.length=0}this._initialized=!0}_reinitTemplates(){this.templates={},this.names=[],this.buttons=[],this._multiSelectTemplates={};for(const t of this.option.options){const e=n.deepCopy(t,["_*"]);this._processTemplate(e)}}_processTemplate(t){this.templates[t.name]=t,this.names.push(t.name),this.buttons.push({name:t.name,type:t.type,label:t.params?.groupEditor?.button||"Add "+t.label}),(!0===t.params?.multiSelect||t.type.includes("swatch")||"library"===t.type||"upload-lift"===t.type)&&(t._isMultiSelect=!0,this._multiSelectTemplates[t.name]={option:t,hasCustomUI:"upload-lift"===t.type})}syncInstances(){if(this.option.options?.length>0&&this.option.options.some((t=>this.names.includes(t.name)))){this._reinitTemplates(),this.option.options.length=0;for(const t of this._instances){const e=t._templateName;if(e&&this.templates[e]){const i=this.templates[e].params||{};t.params=Object.assign({},t.params,i),this.option.options.push(t)}}}else if(this.option.options?.length>0)this._instances=this.option.options;else if(this._instances.length>0){this.option.options=this.option.options||[];for(const t of this._instances){const e=t._templateName;e&&this.templates[e]&&this.option.options.push(t)}}}syncPreviewLayers(){if(!this.config.previewConfig)return;let t=!1,e=[...this.config.previewConfig.layers];if(this.config.previewConfig.gallery&&this.config.previewConfig.views?.length)for(const t of this.config.previewConfig.views)e.push(...t.layers);for(const i of e){const e=i.params.option;if(e&&this.names.includes(e)&&(this.layers[e]=i,i.layers||(i.layers=[]),this.templatesPreview[e]&&!this.config.editorMode||(this.templatesPreview[e]=n.deepCopy(i,["layers","_*"]),this.templatesPreview[e].conditions.length=0,"overlay_values"!==i.type||i._cleared||(this._multiSelectTemplates[e]?(this._multiSelectTemplates[e]._layers=n.deepCopy(i.layers),this._multiSelectTemplates[e].parentLayer=i):this._multiSelectTemplates[e]={option:this.templates[e],_layers:n.deepCopy(i.layers),parentLayer:i},this.templates[e]._isMultiSelect=!0,i.layers=[],i._cleared=!0)),this._layerInstances[e]?.length>0&&0===i.layers.length)){const o=this.templatesPreview[e].params;for(const t of this._layerInstances[e]){const e={option:t.params.option,x:t.params.x,y:t.params.y,scaleX:t.params.scaleX,scaleY:t.params.scaleY};Object.assign(t.params,o),Object.assign(t.params,e),i.layers.push(t)}t=!0}}for(const t of this._instances)if(!t._layer){const e=t._templateName;t._layer=this._layerInstances[e]?.find((e=>e.params.option===t.name))}if(!this._layersBackfilled&&this._instances.length>0){for(const e of this._instances)if(!e._layer&&!this.isMultiSelectTemplate(e._templateName)){const i=e._templateName;if(!this.layers[i]||!this.templatesPreview[i])continue;const o=e.name.split("_").pop();let r=n.deepCopy(this.templatesPreview[i]);r.name+="_"+o,r.params.option=e.name,r.params.optionParent=this.option.name,this.layers[i].layers.push(r),this._layerInstances[i]||(this._layerInstances[i]=[]),this._layerInstances[i].push(r),e._layer=r,t=!0}this._layersBackfilled=!0}t&&this.onChange(this.option)}onAdd(t,e=!0,i=e){if(this.isMultiSelectTemplate(t.name))return;if(!this.canAdd(t.name))return;let o=n.deepCopy(this.templates[t.name],["_*"]);o._templateName=t.name;let r=this._countOptions(t.name)+1;if(o.id+="_"+r,o.name+="_"+r,o.label+=" "+r,this.option.options.push(o),this._sortOptions(),this.layers?.[t.name]){let e=n.deepCopy(this.templatesPreview[t.name]);e.name+="_"+r,e.params.option=o.name,e.params.optionParent=this.option.name,this.layers[t.name].layers.push(e),this._layerInstances[t.name]||(this._layerInstances[t.name]=[]),this._layerInstances[t.name].push(e),o._layer=e}return e&&this.onChange(o),i&&this.focusOption(o),o}onRemove(t){const e=t._templateName;if(!this.canRemove(e))return;if(t._isMultiSelectInstance&&this.hasCustomUI(e)){const i=this.templates[e]._controller;i?.urls&&i._removeByUrl(t.value)}let i=this.option.options.indexOf(t);if(-1!==i){if(this.option.options.splice(i,1),t._layer){let i=this.layers[e],o=i.layers.indexOf(t._layer);-1!==o&&i.layers.splice(o,1);const n=this._layerInstances[e]?.indexOf(t._layer);-1!==n&&this._layerInstances[e].splice(n,1)}i<this.option.options.length&&this._rebuildCounter(e)}this.onChange(this.option)}onDuplicate(t){const e=t._templateName;if(!this.canAdd(e))return;let i=n.deepCopy(t,["_*"]);i._templateName=e,t._isMultiSelectInstance&&(i._isMultiSelectInstance=!0,i._optionValue=t._optionValue);let o=this._countOptions(e)+1;if(this._replaceIdName(i,o),this.option.options.push(i),this._sortOptions(),this.layers?.[e]){const r=t._layer;let s=n.deepCopy(r,["_*"]);r._editor&&Object.assign(s.params,r._editor),s.name=s.name.substring(0,s.name.lastIndexOf("_"))+"_"+o,s.params.option=i.name,s.params.optionParent=this.option.name,r._object&&("upload"===r.type||"overlay"===r.type?(s.params.x+=50,s.params.y+=50):s.params.y+=r._object.height,s._interactive=r._interactive,s._interactiveScaled=r._interactiveScaled,s._duplicate=!0),this.layers[e].layers.push(s),this._layerInstances[e]||(this._layerInstances[e]=[]),this._layerInstances[e].push(s),i._layer=s}this.onChange(i)}onIndexUp(t){if(!t._layer)return;const e=t._templateName,i=this.layers[e].layers,o=i.indexOf(t._layer);-1===o||o>=i.length-1||([i[o],i[o+1]]=[i[o+1],i[o]],this._layerInstances[e]=[...i],this.onChange(this.option))}onIndexDown(t){if(!t._layer)return;const e=t._templateName,i=this.layers[e].layers,o=i.indexOf(t._layer);o<=0||([i[o],i[o-1]]=[i[o-1],i[o]],this._layerInstances[e]=[...i],this.onChange(this.option))}_countOptions(t){let e=0;for(let i=0;i<this.option.options.length;i++)this.option.options[i]._templateName===t&&e++;return e}_getGroupEditor(t){return this.templates[t]?.params?.groupEditor||{}}_getLinkedValue(t){const e=this._getGroupEditor(t);if(e.option&&this.getOption){const t=this.getOption(e.option);if(t&&void 0!==t.value){const e=parseInt(t.value,10);if(!isNaN(e)&&e>=0)return e}}return null}_getMin(t){const e=this._getLinkedValue(t);if(null!==e)return e;return this._getGroupEditor(t).min??1}_getMax(t){const e=this._getLinkedValue(t);if(null!==e)return e;return this._getGroupEditor(t).max??0}_hasLinkedOption(t){return null!==this._getLinkedValue(t)}canAdd(t){const e=this._getMax(t);return 0===e||this._countOptions(t)<e}canRemove(t){const e=this._getMin(t);return this._countOptions(t)>e}syncMinInstances(){let t=!1;for(const e of this.buttons){if(this.isMultiSelectTemplate(e.name))continue;const i=this._getMin(e.name),o=this._countOptions(e.name);if(o<i){const n=i-o;for(let t=0;t<n;t++)this.onAdd(e,!1);t=!0}else if(this._hasLinkedOption(e.name)&&o>i){const n=o-i,r=this.option.options.filter((t=>t._templateName===e.name));for(let t=0;t<n;t++){const e=r[r.length-1-t];this._removeInstance(e)}t=!0}}t&&setTimeout((()=>this.onChange(this.option)))}_removeInstance(t){const e=this.option.options.indexOf(t);if(-1===e)return;this.option.options.splice(e,1);const i=t._templateName;if(t._layer){const e=this.layers[i],o=e?.layers?.indexOf(t._layer);-1!==o&&e.layers.splice(o,1);const n=this._layerInstances[i]?.indexOf(t._layer);-1!==n&&this._layerInstances[i].splice(n,1)}e<this.option.options.length&&this._rebuildCounter(i)}_replaceIdName(t,e){t.id=t.id.substring(0,t.id.lastIndexOf("_"))+"_"+e,t.name=t.name.substring(0,t.name.lastIndexOf("_"))+"_"+e,t.label=t.label.substring(0,t.label.lastIndexOf(" "))+" "+e}_rebuildCounter(t){let e=0;for(const i of this.option.options)i._templateName===t&&(e++,this._replaceIdName(i,e),i._layer&&(i._layer.params.option=i.name))}_sortOptions(){const t=this.buttons.map((t=>t.name));this.option.options.sort(((e,i)=>t.indexOf(e._templateName)-t.indexOf(i._templateName)))}restore(t){if(!t||this._restored)return!1;if(this.option.options.length>0){for(const t of[...this.option.options])if(t._layer){const e=t._templateName,i=this.layers?.[e];if(i?.layers){const e=i.layers.indexOf(t._layer);-1!==e&&i.layers.splice(e,1)}if(this._layerInstances[e]){const i=this._layerInstances[e].indexOf(t._layer);-1!==i&&this._layerInstances[e].splice(i,1)}}this.option.options.length=0,this._instances=[]}let e=!1;for(const i of this.names){const o=this._findInstanceValues(t,i);if(0===o.length)continue;if(this.isMultiSelectTemplate(i)){const t=this.templates[i];if(this.hasCustomUI(i)){const i=o.map((t=>t.value)).join(",");t.value=i,e=!0}else for(const{value:t}of o)this.onMultiSelect(i,t,!1),e=!0;continue}const n=this.buttons.find((t=>t.name===i));if(n)for(const{value:t}of o){const i=this.onAdd(n,!1,!1);i&&(i.value=t,e=!0)}}return e&&(this._restored=!0,this.onChange(this.option)),e}_findInstanceValues(t,e){const i=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),o=new RegExp(`^${i}_(\\d+)$`),n=[];for(const e in t){if(!t.hasOwnProperty(e))continue;const i=e.match(o);i&&t[e]&&n.push({index:parseInt(i[1],10),value:t[e]})}return n.sort(((t,e)=>t.index-e.index)),n}isOpen(t){return!1===this.option.params?.groupCollapse||!0===this._collapseState[t]}setOpen(t,e){this._collapseState[t]=e}toggleOpen(t){this._collapseState[t]=!this._collapseState[t]}getInstancesOfTemplate(t){return this.option.options?.filter((e=>e._templateName===t))||[]}getCardIcon(t){return An[t]||Tn}isMultiSelectTemplate(t){return!!this._multiSelectTemplates[t]}hasCustomUI(t){return this._multiSelectTemplates[t]?.hasCustomUI??!1}onMultiSelect(t,e,i=!0){const o=this._multiSelectTemplates[t];if(!o)return;let r=o.option?.values?.find((t=>t.value===e));!r&&o.option._controller?.image&&(r=o.option._controller?.image),!r&&e&&e.startsWith("http")&&(r={img:e,value:e});let s=n.deepCopy(this.templates[t],["_*"]);s._templateName=t,s._isMultiSelectInstance=!0,s._optionValue=r,s.value=e;let a=this._countOptions(t)+1;if(s.id+="_"+a,s.name+="_"+a,s.label+=" "+a,this.option.options.push(s),this._sortOptions(),o._layers){const i=o._layers.find((i=>i.conditions?.some((i=>i.field===t&&i.value===e))));if(i&&o.parentLayer){let e=n.deepCopy(i);e.name=`${i.name}_${a}`,e.params.option=s.name,e.params.optionParent=this.option.name,e.conditions=[],o.parentLayer.layers.push(e),this._layerInstances[t]||(this._layerInstances[t]=[]),this._layerInstances[t].push(e),s._layer=e}}else if(this.layers?.[t]){let e=n.deepCopy(this.templatesPreview[t]);e.name+="_"+a,e.params.option=s.name,e.params.optionParent=this.option.name,!s.value.startsWith("http")&&r?.img&&(s.value=r.img),this.layers[t].layers.push(e),this._layerInstances[t]||(this._layerInstances[t]=[]),this._layerInstances[t].push(e),s._layer=e}i&&this.onChange(s)}syncMultiSelectFromValue(t,e){const i=e?e.split(",").filter((t=>t.trim())):[],o=this.getInstancesOfTemplate(t),n=o.map((t=>t.value));for(const e of i)n.includes(e)||this._addInstanceFromValue(t,e);for(const t of o)i.includes(t.value)||this._removeInstanceByValue(t)}_addInstanceFromValue(t,e){if(!this._multiSelectTemplates[t])return;let i=n.deepCopy(this.templates[t],["_*"]);i._templateName=t,i._isMultiSelectInstance=!0,i._optionValue={img:e},i.value=e;let o=this._countOptions(t)+1;if(i.id+="_"+o,i.name+="_"+o,i.label+=" "+o,this.option.options.push(i),this._sortOptions(),this.layers?.[t]){let e=n.deepCopy(this.templatesPreview[t]);e.name+="_"+o,e.params.option=i.name,e.params.optionParent=this.option.name,this.layers[t].layers.push(e),this._layerInstances[t]||(this._layerInstances[t]=[]),this._layerInstances[t].push(e),i._layer=e}}_removeInstanceByValue(t){const e=t._templateName;let i=this.option.options.indexOf(t);if(-1!==i){if(this.option.options.splice(i,1),t._layer){let i=this.layers[e],o=i.layers.indexOf(t._layer);-1!==o&&i.layers.splice(o,1);const n=this._layerInstances[e]?.indexOf(t._layer);-1!==n&&this._layerInstances[e].splice(n,1)}i<this.option.options.length&&this._rebuildCounter(e)}}_isOptionEmpty(t){return"library"===t.type&&t._controller?!t._controller.image:void 0===t.value||null===t.value||""===t.value}getFirstEmptyOption(t){return this.getInstancesOfTemplate(t).find((t=>this._isOptionEmpty(t)))||null}_ensureVisible(t){if(!t)return;const e=t.closest(".cl-po--card-panel");if(!e)return;const i=e.previousElementSibling;if(i&&!i.classList.contains("cl-po--open")){e.style.maxHeight=e.scrollHeight+100+"px",i.classList.add("cl-po--open");for(const e of this.buttons)if(this.getInstancesOfTemplate(e.name).some((e=>e.name===t.dataset.option))){this.setOpen(e.name,!0);break}setTimeout((()=>{e.style.maxHeight=null}),500)}}focusOption(t){requestAnimationFrame((()=>{const e=document.querySelector(`[data-option="${t.name}"]`);e&&(this._ensureVisible(e),e.scrollIntoView({behavior:"smooth",block:"center"}),setTimeout((()=>{this._focusByType(e,t.type)}),300))}))}_focusByType(t,e){switch(e){case"upload":case"upload-lift":const e=t.querySelector("input[type=file]");e&&e.click();break;case"library":const i=t.querySelector("[data-library-popup] .cl-po--swatch");i&&i.click();break;default:const o=t.querySelector("input, textarea, select");o&&o.focus({preventScroll:!0})}}constructor(t,e){this.onChange=t,this.getOption=e,this.config=null,this.option=null,this._instances=[],this._initialized=!1,this.templates={},this.names=[],this.buttons=[],this.templatesPreview={},this.layers={},this._layerInstances={},this._collapseState={},this._multiSelectTemplates={}}}co.templates["group-editor"]=(t,e,i,o,n)=>{const r=void 0===t._controller;t._controller=t._controller||new Fn(i,n);const s=t._controller;s.option=t,s.config=e,r&&s.initTemplates();const a=e.previewConfig&&!s._previewLayersSynced;(r||e.editorMode||a)&&(s.syncInstances(),e.previewConfig&&(s.syncPreviewLayers(),s._previewLayersSynced=!0)),e.editorMode||!t._restoreValues||s._restored||(s.restore(t._restoreValues),delete t._restoreValues),s._initialized&&s.syncMinInstances();const c=(t,e)=>{if(!t)return;const i=t.nextElementSibling;t.classList.contains("cl-po--open")||(i.style.maxHeight=i.scrollHeight+100+"px",setTimeout((()=>{i.style.maxHeight&&(i.style.maxHeight=null),e&&e()}),500)),t.classList.toggle("cl-po--open")},p=(t,e)=>et`
        <div class="cl-po--group-editor-actions">
            <button type="button"
                    @click=${()=>e.onDuplicate(t)}
                    data-tippy-content="${l.get("product.options.layer.duplicate",null,"Duplicate")}"
                    data-tippy-placement="bottom">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18"><path d="M6.9998 6V3C6.9998 2.44772 7.44752 2 7.9998 2H19.9998C20.5521 2 20.9998 2.44772 20.9998 3V17C20.9998 17.5523 20.5521 18 19.9998 18H16.9998V20.9991C16.9998 21.5519 16.5499 22 15.993 22H4.00666C3.45059 22 3 21.5554 3 20.9991L3.0026 7.00087C3.0027 6.44811 3.45264 6 4.00942 6H6.9998ZM5.00242 8L5.00019 20H14.9998V8H5.00242ZM8.9998 6H16.9998V16H18.9998V4H8.9998V6Z" fill="currentColor"></path></svg>
            </button>
            ${e.canRemove(t._templateName)?et`
                <button type="button"
                        @click=${()=>e.onRemove(t)}
                        data-tippy-content="${l.get("product.options.layer.delete",null,"Delete")}"
                        data-tippy-placement="bottom">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18"><path d="M17 6H22V8H20V21C20 21.5523 19.5523 22 19 22H5C4.44772 22 4 21.5523 4 21V8H2V6H7V3C7 2.44772 7.44772 2 8 2H16C16.5523 2 17 2.44772 17 3V6ZM18 8H6V20H18V8ZM9 11H11V17H9V11ZM13 11H15V17H13V11ZM9 4V6H15V4H9Z" fill="currentColor"></path></svg>
                </button>
            `:null}
        </div>
    `,d=et`
        <div class="cl-po--group cl-po--group-editor">
            <div class="cl-po--group-editor-cards">
                ${Ii(s.buttons,(t=>t.name),(r=>{const a=s.getInstancesOfTemplate(r.name),l=s.getCardIcon(r.type),d=s.isOpen(r.name),h=s.canAdd(r.name),u=s.isMultiSelectTemplate(r.name)?((t,e,i,o,n,r)=>{const s=e.templates[t.name],a=e.getInstancesOfTemplate(t.name);return et`
            <div class="cl-po--card-body cl-po--multi-select-body">
                <div class="cl-po--multi-select-wrap">
                    ${Vn([s],i,(i=>{e.hasCustomUI(t.name)?e.syncMultiSelectFromValue(t.name,i.value):i.value&&(e.onMultiSelect(t.name,i.value),i.value=""),o(i)}),n,r)}
                </div>
                ${!e.hasCustomUI(t.name)&&a.length>0?et`
                    <div class="cl-po--multi-select-selections">
                        ${Ii(a,(t=>t.name),(t=>et`
                            <div class="cl-po--multi-select-selection" data-option="${t.name}">
                                <input type="hidden" name="${No(t)}" id="${t.id}" value=${t.value} form=${Pi(i.productFormLink)} />
                                <div class="cl-po--selection-thumbnail">
                                    ${t._optionValue?.img?et`<img src="${go(t._optionValue.img,mo("small"))}" alt="${t._optionValue.text||t.value}" />`:t._optionValue?.color?et`<div class="cl-po--selection-color" style="background-color: ${t._optionValue.color}"></div>`:null}
                                </div>
                                <div class="cl-po--selection-label">
                                    ${t._optionValue?.text||t._optionValue?.value||t.value}
                                </div>
                                ${p(t,e)}
                            </div>
                        `))}
                    </div>
                `:null}
            </div>
        `})(r,s,e,i,o,n):et`
                            <div class="cl-po--card-body">
                                ${a.length>0?et`
                                    <div class="cl-po--card-instances">
                                        ${Vn(a,e,i,o,n,(t=>p(t,s)))}
                                    </div>
                                `:null}
                                ${h?et`
                                    <button type="button" class="cl-po--card-add-btn" @click=${()=>s.onAdd(r)}>
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16"><path fill="currentColor" d="M11 11V5h2v6h6v2h-6v6h-2v-6H5v-2z"/></svg>
                                        ${r.label}
                                    </button>
                                `:null}
                            </div>
                        `;return et`
                        <div class="cl-po--card">
                            <div class="cl-po--collapse cl-po--card-collapse ${d?"cl-po--open":""}">
                                ${!1!==t.params?.groupCollapse?et`
                                    <div class="cl-po--card-toggle-zone" @click=${e=>((e,i)=>{if(e.stopPropagation(),!1===t.params?.groupCollapse)return;s.toggleOpen(i);const o=e.currentTarget.closest(".cl-po--collapse");c(o)})(e,r.name)}>
                                        <div class="cl-po--card-chevron">
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20">
                                                <path fill="currentColor" d="M10.828 12l4.95 4.95-1.414 1.414L8 12l6.364-6.364 1.414 1.414z"/>
                                            </svg>
                                        </div>
                                    </div>
                                `:null}
                                <div class="cl-po--card-add-zone ${h?"":"cl-po--disabled"}" @click=${t=>((t,e)=>{if(t.stopPropagation(),s.isMultiSelectTemplate(e.name)){s.toggleOpen(e.name);const i=t.currentTarget.closest(".cl-po--collapse");return void c(i,(()=>s.focusOption(s.templates[e.name])))}const i=s.getFirstEmptyOption(e.name);if(i){if(!s.isOpen(e.name)){s.setOpen(e.name,!0);const i=t.currentTarget.closest(".cl-po--collapse");i&&!i.classList.contains("cl-po--open")&&c(i)}s.focusOption(i)}else if(s.canAdd(e.name)){if(!s.isOpen(e.name)){s.setOpen(e.name,!0);const i=t.currentTarget.closest(".cl-po--collapse");i&&!i.classList.contains("cl-po--open")&&c(i)}s.onAdd(e)}})(t,r)}>
                                    <div class="cl-po--card-icon">${vi(l)}</div>
                                    <div class="cl-po--card-text">
                                        <div class="cl-po--card-title">${r.label}</div>
                                    </div>
                                </div>
                            </div>
                            <div class="cl-po--card-panel">
                                ${u}
                            </div>
                        </div>
                    `}))}
            </div>
        </div>`;return t.params.collapse?Wo(vi(t.params.collapseLabel),d,t.params.collapseOpen):d};const Nn={mode:"both",enter:{active:"cl-po--fade-enter-active",from:"cl-po--fade-enter-from",to:"cl-po--fade-enter-to"},leave:{active:"cl-po--fade-leave-active",from:"cl-po--fade-leave-from",to:"cl-po--fade-leave-to"},duration:500},Dn=t=>et`
    ${vi(t.label)} ${t.value&&t.params.labelValueText?et`<span class="cl-po--value">&nbsp;${bo(wo(t))}</span>`:null} ${t._priceText?et`<span class="cl-po--price">&nbsp;${vi(_o(t._priceText,t.params.priceTemplate))}</span>`:null}    ${t.params.info?et`<span class="cl-po--info" data-tippy-content="${t.params.info}"></span>`:null}
`,Vn=(t,e,i,o,n,r)=>et`
    ${Ii(t,(t=>t.name),((t,s)=>et`

        ${Oi(t.visible?et`
                 <div class="cl-po--option" data-option="${t.name}">
                    
                    ${t.label?(t=>"text"===t.type||"textarea"===t.type||"number"===t.type||"select"===t.type)(t)?et`<label class="cl-po--label" for="${t.id}">${Dn(t)}</label>`:et`<div class="cl-po--label">${Dn(t)}</div>`:null}
                    
                    ${co.templates[t.type]?et`
                      ${co.templates[t.type](t,e,i,o,n)}
                    `:null}
                     
                    ${t.params.help?et`
                    <div class="cl-po--help">${vi(t.params.help)}</div>
                    `:null}
                     
                    ${to(t.errors&&t.errors.length>0?Vi(et`
                    <div class="cl-po--errors">
                        ${Ii(t.errors,((e,i)=>et`
                            <div class="cl-po--error" @click=${i=>o(i,t,e)}>${e}</div>
                        `))}
                    </div>
                    `,`${t.id}-errors`):Vi(et`<span></span>`,"noop"),Nn)}
                   
                     ${r?r(t):null}
                </div>
             `:null)}
    `))}
`;var Rn=(t,e,i,o,n,r)=>et`
    <div class="cl-po--options">

        ${t.length>0?et`
                    ${Vn(t,e,i,o,r)}

                    ${e.editorMode?et`
                        <div class="cl-editor-mode">
                            <p data-live-price="${e.product.id}" ></p>
                            <p data-live-weight="${e.product.id}" ></p>
                            <p data-live-sku="${e.product.id}" ></p>
                            <button class="cl-po--swatch cl-po--swatch-button cl-po--small" @click="${t=>n(t)}">
                                Add to cart (validation test)
                            </button>
                        </div>
                    `:null}
                `:null}
        ${e.idLink?et`
            <input type="hidden" name="properties[${eo.OPTIONS}]" value=${e.uuid} form=${Pi(e.productFormLink)}>
        `:null}
    </div>
`;var jn=(t,e,i,o,n,r)=>et`
<div class="ldcv ${o.className}" >
    <div class="base">
        <div class="inner card">
            <div class="cl-po--popup">
                <div class="cl-po--popup-preview">
                    ${t}
                </div>
                <div class="cl-po--popup-options cl--po-wrapper" id=${o.id}>
                    <div class="options-scroll">
                        ${o.visible?e:null}
                    </div>
                    <div class="options-atc">
                        <div class="atc-wrap">
                            <div class="atc-price">
                                ${i}
                            </div>
                            ${o.option.params.popupQty?et`<div class="atc-quantity">
                                 <input class="cl-po--input cl-po--quantity" type="number" inputmode="numeric" name="quantity" value="1" min="1" form=${Pi(o.productFormLink)} />
                             </div>`:null}
                            <div class="atc-button">
                                <button class="cl-po--swatch cl-po--swatch-button" @click="${t=>n(t)}" style=${Ko(((t,e={})=>(t.params.atcColor&&(e.color=t.params.atcColor),t.params.atcBgColor&&(e.backgroundColor=t.params.atcBgColor),e))(o.option))}>
                                    ${o.option.params.atcText||"Add to Cart"}
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="cl-po--popup-close" @click="${t=>r(t)}">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" ><path fill="none" d="M0 0h24v24H0z"/><path d="M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10-4.477 10-10 10zm0-2a8 8 0 1 0 0-16 8 8 0 0 0 0 16zm0-9.414l2.828-2.829 1.415 1.415L13.414 12l2.829 2.828-1.415 1.415L12 13.414l-2.828 2.829-1.415-1.415L10.586 12 7.757 9.172l1.415-1.415L12 10.586z"/></svg>
            </div>
        </div>
    </div>
</div>
`,Hn={};!function(t){"use strict";var e=t.HTMLCanvasElement&&t.HTMLCanvasElement.prototype,i=t.Blob&&function(){try{return Boolean(new Blob)}catch(t){return!1}}(),o=i&&t.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(t){return!1}}(),n=t.BlobBuilder||t.WebKitBlobBuilder||t.MozBlobBuilder||t.MSBlobBuilder,r=/^data:((.*?)(;charset=.*?)?)(;base64)?,/,s=(i||n)&&t.atob&&t.ArrayBuffer&&t.Uint8Array&&function(t){var e,s,a,l,c,p,d,h,u;if(!(e=t.match(r)))throw new Error("invalid data URI");for(s=e[2]?e[1]:"text/plain"+(e[3]||";charset=US-ASCII"),a=!!e[4],l=t.slice(e[0].length),c=a?atob(l):decodeURIComponent(l),p=new ArrayBuffer(c.length),d=new Uint8Array(p),h=0;h<c.length;h+=1)d[h]=c.charCodeAt(h);return i?new Blob([o?d:p],{type:s}):((u=new n).append(p),u.getBlob(s))};t.HTMLCanvasElement&&!e.toBlob&&(e.mozGetAsFile?e.toBlob=function(t,i,o){var n=this;setTimeout((function(){o&&e.toDataURL&&s?t(s(n.toDataURL(i,o))):t(n.mozGetAsFile("blob",i))}))}:e.toDataURL&&s&&(e.msToBlob?e.toBlob=function(t,i,o){var n=this;setTimeout((function(){(i&&"image/png"!==i||o)&&e.toDataURL&&s?t(s(n.toDataURL(i,o))):t(n.msToBlob(i))}))}:e.toBlob=function(t,e,i){var o=this;setTimeout((function(){t(s(o.toDataURL(e,i)))}))})),"function"==typeof define&&define.amd?define((function(){return s})):Hn?Hn=s:t.dataURLtoBlob=s}(window);var zn=(t,e,i,o)=>et`
<div class="cl-po--preview-crop">
    <button type="button" @click=${t=>i()}>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="30" height="30"><path d="M12 10.586l4.95-4.95 1.414 1.414-4.95 4.95 4.95 4.95-1.414 1.414-4.95-4.95-4.95 4.95-1.414-1.414 4.95-4.95-4.95-4.95L7.05 5.636z"/></svg>
    </button>
    <div>
        <button type="button" @click=${e=>t(!1)} >
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="30" height="30"><path d="M18.031 16.617l4.283 4.282-1.415 1.415-4.282-4.283A8.96 8.96 0 0 1 11 20c-4.968 0-9-4.032-9-9s4.032-9 9-9 9 4.032 9 9a8.96 8.96 0 0 1-1.969 5.617zm-2.006-.742A6.977 6.977 0 0 0 18 11c0-3.868-3.133-7-7-7-3.868 0-7 3.132-7 7 0 3.867 3.132 7 7 7a6.977 6.977 0 0 0 4.875-1.975l.15-.15zM7 10h8v2H7v-2z"/></svg>
        </button>
        <button type="button" @click=${e=>t(!0)} >
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="30" height="30"><path d="M18.031 16.617l4.283 4.282-1.415 1.415-4.282-4.283A8.96 8.96 0 0 1 11 20c-4.968 0-9-4.032-9-9s4.032-9 9-9 9 4.032 9 9a8.96 8.96 0 0 1-1.969 5.617zm-2.006-.742A6.977 6.977 0 0 0 18 11c0-3.868-3.133-7-7-7-3.868 0-7 3.132-7 7 0 3.867 3.132 7 7 7a6.977 6.977 0 0 0 4.875-1.975l.15-.15zM10 10V7h2v3h3v2h-3v3h-2v-3H7v-2h3z"/></svg>
        </button>
        <button type="button" @click=${t=>e(90)} >
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="30" height="30"><path fill="none" d="M0 0h24v24H0z"/><path d="M20 10.586l1.828-1.829 1.415 1.415L19 14.414l-4.243-4.242 1.415-1.415L18 10.586V8a3 3 0 0 0-3-3h-4V3h4a5 5 0 0 1 5 5v2.586zM13 9a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V10a1 1 0 0 1 1-1h10zm-1 2H4v8h8v-8z"/></svg>
        </button>
    </div>
    <button type="button" @click=${t=>o()} style="background:#31cc01;margin-right:1px;">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="30" height="30"><path fill="white" d="M10 15.172l9.192-9.193 1.415 1.414L10 18l-6.364-6.364 1.414-1.414z"/></svg>
    </button>
    <svg class="icon-crop cursor" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
        <path class="cursor-x-y" d="M56 49v-3l4 4-4 4v-3h-5v5h3l-4 4-4-4h3v-5h-5v3l-4-4 4-4v3h5v-5h-3l4-4 4 4h-3v5z" />
    </svg>
    <svg class="icon-crop touch"  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200">
        <path class="hand-x-y" d="M139.93,113.56l-41.12-6.93V76.08a9.25,9.25,0,0,0-9.25-9.25h0a9.25,9.25,0,0,0-9.25,9.25v57.36L71,122.65c-3.61-3.61-8.44-3.89-13.08,0,0,0-7.24,5.84-3.83,9.25l34,34h42.63a9.25,9.25,0,0,0,9.07-7.43l6.82-34.09A9.28,9.28,0,0,0,139.93,113.56Z"/>
    </svg>
</div>
`;class Bn{evaluateConditions(t,e,i){let o=1===e?"OR":"AND",n=s.getLevel();n<=s.levels.TRACE&&s.debug("====> evaluating conditions for: "+i+" in mode "+o,t);let r=!1;if(t.length)for(let i=0;i<t.length;i++){const o=t[i];if(r=this.evaluateCondition(o,this.data),n<=s.levels.TRACE&&s.debug("evaluated condition: ",o,r),1===e){if(r)break}else if(!r)break}else r=!0;return s.debug("======> evaluated conditions for: "+i+" in mode "+o,r),!!r}evaluateCondition(t,e){return"options"===t.data?!0===this.evaluateOptionCondition(t,e.options):"product"===t.data?this.evaluateProductCondition(t,e.product):"variant"===t.data&&this.evaluateVariantCondition(t,e.variant)}evaluateOptionCondition(t,e){for(let i=0;i<e.length;i++){const o=e[i];if(o.name===t.field){let e=o.value;if(o._controller&&"function"==typeof o._controller.conditionValue&&(e=o._controller.conditionValue(o)),t.value&&-1!==t.value.indexOf(",")){let i=t.value.split(",");for(let o=0;o<i.length;o++){const n=i[o];if(this.evaluateOperation(t.operator,n,e))return!0}}if(0!==t.operator.indexOf("!")&&t.value&&e&&o._controller&&o._controller.multiSelect&&-1!==e.indexOf(",")){let i=e.split(",");for(let e=0;e<i.length;e++){const o=i[e];if(this.evaluateOperation(t.operator,t.value,o))return!0}return!1}return this.evaluateOperation(t.operator,t.value,e)}if(o.options&&o.options.length>0){let e=this.evaluateOptionCondition(t,o.options);if(-1!==e)return e}}return-1}evaluateVariantCondition(t,e){if(e)switch(t.field){case"variant":if(t.variants)for(let i=0;i<t.variants.length;i++)if(t.variants[i]&&t.variants[i].id.toString()===e.id.toString())return!0;break;case"variant_title":if(t.value&&-1!==t.value.indexOf(",")){let i=t.value.split(",");for(let o=0;o<i.length;o++){const n=i[o];if(this.evaluateOperation(t.operator,n,e.title))return!0}}else if(this.evaluateOperation(t.operator,t.value,e.title))return!0}return!1}evaluateProductCondition(t,e){switch(t.field){case"product":for(let i=0;i<t.products.length;i++)if(t.products[i]&&t.products[i].id.toString()===e.id.toString())return!0;break;case"product_handle":if(this.evaluateOperation(t.operator,t.value,e.handle))return!0;break;case"product_title":if(this.evaluateOperation(t.operator,t.value,e.title))return!0;break;case"product_type":if(e.type&&this.evaluateOperation(t.operator,t.value,e.type))return!0;if(e.product_type&&this.evaluateOperation(t.operator,t.value,e.product_type))return!0;break;case"product_vendor":if(this.evaluateOperation(t.operator,t.value,e.vendor))return!0;break;case"product_tags":let i;if(Array.isArray(e.tags))i=e.tags;else{if(!e.tags)break;i=e.tags.indexOf(", ")>=0?e.tags.split(", "):[e.tags]}for(let e=0;e<t.tags.length;e++)for(let o=0;o<i.length;o++)if(t.tags[e].toString().toLowerCase().trim()===i[o].toString().toLowerCase().trim())return!0}return!1}evaluateOperation(t,e,i){if(void 0!==i){switch(t){case"equals":return i.toString().toLowerCase().trim()===e?.toString().toLowerCase().trim();case"!equals":return i.toString().toLowerCase().trim()!==e?.toString().toLowerCase().trim();case"contains":return i.toString().toLowerCase().trim().indexOf(e?.toString().toLowerCase().trim())>-1;case"!contains":return-1===i.toString().toLowerCase().trim().indexOf(e?.toString().toLowerCase().trim());case"empty":return!i;case"!empty":return!!i;case"=":return parseFloat(i)===parseFloat(e);case"!=":return parseFloat(i)!==parseFloat(e);case">":return parseFloat(i)>parseFloat(e);case">=":return parseFloat(i)>=parseFloat(e);case"<":return parseFloat(i)<parseFloat(e);case"<=":return parseFloat(i)<=parseFloat(e)}return!1}}constructor(t,e={}){this.settings=n.extend({},t||{}),this.data=e}}Bn.MODE={OR:1,AND:2};var qn=Bn;var Un=class{render(t,e,i){}_getOptions(t,e,i=t.params){let o={visible:!0,selectable:!1,evented:!1,lockUniScaling:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockMovementX:!0,lockMovementY:!0,hasControls:!1,lockScalingFlip:!0};if(o.visible=!0,t.hasOwnProperty("_visible")&&(o.visible=t._visible),o.centeredRotation=!0,i.autoRotate?o.angle=0:void 0!==i.angle&&(o.angle=i.angle%360),i.autoPos&&!t._interactive?(o.left=0,o.top=0):(void 0!==i.x&&(o.left=i.x),void 0!==i.y&&(o.top=i.y)),i.autoScale&&!t._interactiveScaled?(o.scaleX=1,o.scaleY=1):(void 0!==i.scaleX&&(o.scaleX=i.scaleX),void 0!==i.scaleY&&(o.scaleY=i.scaleY)),void 0!==i.width&&(o.width=i.width),void 0!==i.height&&(o.height=i.height),mn.isEditLayer(t,e.editorMode,e.editLayer)&&!e.cropMode){if(!mn.hasRefRect(t)){o.lockMovementX=!0===t.params.autoPos,o.lockMovementY=!0===t.params.autoPos,o.lockScalingX=!0===t.params.autoScale,o.lockScalingY=!0===t.params.autoScale;let e=!t.params.autoPos||!t.params.autoScale;o.hasControls=e,o.selectable=e,o.evented=e,o.lockRotation=!1}}else if(mn.isCropLayer(t,e.cropMode,e.cropLayer)){o.lockMovementX=!1,o.lockMovementY=!1,i.interactive=!1;let t=!1;o.lockScalingX=!t,o.lockScalingY=!t,o.hasControls=t,o.selectable=!0,o.evented=!0,o.borderColor="rgb(178,204,255)",o.borderScaleFactor=1}else t.params.interactive&&!e.cropMode&&(e.editorMode&&mn.hasEditLayer(e.editorMode,e.editLayer)||(o.lockMovementX=!1,o.lockMovementY=!1,"upload"!==t.type||i.autoScaleOverlay||void 0!==i.resizable||(i.resizable=!0),i.rotatable&&(o.lockRotation=!1),i.resizable&&(o.lockScalingX=!1,o.lockScalingY=!1),o.hasControls=i.resizable||i.rotatable,o.hasControls&&(o.transparentCorners=!1,o.cornerStyle="circle",o.cornerSize=window.clPreviewCorner||20,o.cornerColor=t.params.interactiveColor||"rgb(178,204,255)"),o.selectable=!0,o.evented=!0,o.borderColor=t.params.interactiveColor||"rgb(178,204,255)"));if(mn.hasRefRect(t)&&"text"!==t.type&&"textbox"!==t.type&&isNaN(e.canvasRotate)){let i=this._getRefRect(t,e);i.set("absolutePositioned",!0),i.set("strokeWidth",0),o.clipPath=i}return o._layer=t,o}_isEditorMode(t,e){return!!e.editorMode&&(!e.editLayer||!(t.name!==e.editLayer&&!t.name.startsWith(e.editLayer+"_")))}_printObject(t){s.debug("width/height =",t.width,t.height),s.debug("scaled width/height =",t.getScaledWidth(),t.getScaledHeight()),s.debug("left/top = ",t.left,t.top),s.debug("boundingRect = ",t.getBoundingRect()),s.debug("boundingRectAbsolute = ",t.getBoundingRect(!0)),s.debug("boundingRectCalc = ",t.getBoundingRect(!1,!0)),s.debug("boundingRectAbsoluteCalc = ",t.getBoundingRect(!0,!0))}_applyAutoParams(t,e,i,o=e.params){let n=mn.getRefCoordinates(e,i),r=mn.getRefDimensions(e,i),s=mn.getDimensions(t),a=t.width,l=t.height;if(o.autoScale&&!e._interactiveScaled){let i=o.autoScaleRatio,n=o.autoScaleMax,c=o.autoScaleOverlay||!1;"text"===e.type&&(i=!0);let p=1,d=r.width/a,h=r.height/l;(n||s.height>r.height||s.width>r.width)&&(i?(c?(p=Math.max(d,h),o.interactive&&(d>h?t.lockMovementX=!0:t.lockMovementY=!0)):p=Math.min(d,h),t.scaleX=p,t.scaleY=p):(t.scaleY=h,t.scaleX=d),t.setCoords(),s=mn.getDimensions(t)),1!==p&&e.type}if(o.autoPos&&!e._interactive)if(0!==n.angle?t.angle=n.angle:0!==t.angle&&(t.angle=0),o.autoCenter)mn.center(t,s,n,r);else{if(o.autoCenterH)mn.centerHorizontal(t,s,n,r);else if(t.left=n.x,"text"===e.type&&!o.textBox)if("center"===o.textAlign)mn.centerHorizontal(t,s,n,r);else if("right"===o.textAlign){let e=n.x+r.width-s.width;t.left=parseFloat(e.toFixed(2))}if(o.autoCenterV?mn.centerVertical(t,s,n,r):t.top=n.y,0!==t.angle&&(o.autoCenterH||o.autoCenterV)){let i=new fabric.Rect({left:n.x,top:n.y,width:r.width,height:r.height,angle:t.angle}),s=o.autoCenterH?"center":"left",a=o.autoCenterV?"center":"top";"text"!==e.type||o.textBox||("center"===o.textAlign?s="center":"right"===o.textAlign&&(s="right"));let l=i.getPointByOrigin(s,a);t.setPositionByOrigin(l,s,a)}}}_addRefRect(t,e,i,o){if(mn.isEditLayer(e,i.editorMode,i.editLayer)&&!i.cropMode)if(mn.hasRefRect(e)){let t=this._getRefRect(e,i);o.add(t),o.uniformScaling=!1}else o.uniformScaling=!0}_getRefRect(t,e){let i=t._objectRef||new fabric.Rect,o=!("upload"===t.type&&t.params.crop);o||i.setControlsVisibility({mtr:!1});let n={visible:!0,lockUniScaling:!1,lockRotation:!o,lockMovementX:!1,lockMovementY:!1,lockScalingX:!1,lockScalingY:!1,hasControls:!0,lockScalingFlip:!0,selectable:!0,evented:!0};return n.left=void 0!==t.params.refX?t.params.refX:50,n.top=void 0!==t.params.refY?t.params.refY:50,n.width=t.params.refWidth||e.config.width-100,n.height=t.params.refHeight||e.config.height-100,n.scaleX=1,n.scaleY=1,n.angle=o&&void 0!==t.params.refAngle?t.params.refAngle:0,n.fill="#139cf6",n.opacity=.5,n._layerRef=t,i.setOptions(n),t._objectRef=i,i}_getImageUrl(t,e,i){if(i.cdnSize&&uo(t)){let o=mn.getRefDimensions(e,i),n=Math.max(o.width,o.height),r=o.width>o.height;n=200*Math.ceil(n/200);let s=Math.min(3e3,n);return go(t,r?s+"x":"x"+s)}return t}};var Wn=t=>{const e=t.Image.filters,i=t.util.createClass;e.SwapColor=i(e.BaseFilter,{type:"SwapColor",fragmentSource:"\n            precision highp float;\n            uniform sampler2D uTexture;\n            uniform vec4 colorSource;\n            uniform vec4 colorDestination;\n            uniform float tolerance;\n            varying vec2 vTexCoord;\n\n            void main() {\n                vec4 color = texture2D(uTexture, vTexCoord);\n                vec3 sourceRGB = colorSource.rgb;\n                vec3 destRGB = colorDestination.rgb;\n\n                float colorDistance = length(sourceRGB - color.rgb);\n                bool colorMatch = colorDistance < tolerance && color.a > 0.0;\n\n                // Adjust the tolerance for alpha channel\n                if (colorMatch && abs(colorSource.a - color.a) > 0.1) {\n                    colorMatch = false;\n                }\n\n                gl_FragColor = colorMatch ? vec4(destRGB, color.a) : color;\n            }\n        ",colorSource:"rgb(255, 0, 0)",colorDestination:"rgb(0, 255, 0)",tolerance:.1,applyTo2d:function(e){var i,o=e.imageData.data,n=o.length,r=new t.Color(this.colorSource).getSource(),s=new t.Color(this.colorDestination).getSource();if(this.tolerance<=.1)for(i=0;i<n;i+=4)o[i]===r[0]&&o[i+1]===r[1]&&o[i+2]===r[2]&&(o[i]=s[0],o[i+1]=s[1],o[i+2]=s[2]);else for(i=0;i<n;i+=4){var a=o[i],l=o[i+1],c=o[i+2],p=o[i+3];Math.sqrt(Math.pow(r[0]-a,2)+Math.pow(r[1]-l,2)+Math.pow(r[2]-c,2))<this.tolerance&&p>0&&(o[i]=s[0],o[i+1]=s[1],o[i+2]=s[2])}},getUniformLocations:function(t,e){return{uColorSource:t.getUniformLocation(e,"colorSource"),uColorDestination:t.getUniformLocation(e,"colorDestination"),uTolerance:t.getUniformLocation(e,"tolerance")}},sendUniformData:function(e,i){var o=new t.Color(this.colorSource).getSource(),n=new t.Color(this.colorDestination).getSource();o[0]/=255,o[1]/=255,o[2]/=255,n[0]/=255,n[1]/=255,n[2]/=255,e.uniform4fv(i.uColorSource,o),e.uniform4fv(i.uColorDestination,n),e.uniform1f(i.uTolerance,this.tolerance)},isNeutralState:function(){return this.colorSource===this.colorDestination},toObject:function(){return t.util.object.extend(this.callSuper("toObject"),{colorSource:this.colorSource,colorDestination:this.colorDestination})}}),t.Image.filters.SwapColor.fromObject=t.Image.filters.BaseFilter.fromObject};var Gn=class extends Un{render(t,e,i){t._object&&t._object.clipPath&&delete t._object.clipPath;let o={...t.params};if(t.params.option&&t.params.interactive){let i=mn.getProductOption(t.params.option,e.options);i&&(i._layer=t)}if(t.params.optionColor){let i=mn.getProductOption(t.params.optionColor,e.options);if(i&&i.value)if("color"===i.type)o.color=i.value;else if(i.values&&i.values.length){let t=i.values.filter((t=>t.value===i.value));if(t.length){let e=t[0];e.color&&(o.color=e.color),e.img&&(o.urlPattern=e.img)}}}return e.cropMode&&t.params.crop&&"upload"===t.type&&(o.autoScaleOverlay=!0),this._getImage(t,e,i,o).then((async n=>{if(this._addRefRect(n,t,e,i),null==n)return n;o.color&&o.color!==t._color&&(this._colorize(n,o.color),t._color=o.color),o.urlPattern&&"image"!==n.type&&await this._applyColorPattern(n,t,o);let r=this._getOptions(t,e,o);return n.set(r),r.hasControls&&!mn.isEditLayer(t,e.editorMode,e.editLayer)&&n.setControlsVisibility({mt:!1,mb:!1,ml:!1,mr:!1,bl:!r.lockScalingX,br:!r.lockScalingX,tl:!r.lockScalingY,tr:!r.lockScalingY,mtr:!r.lockRotation}),this._applyAutoParams(n,t,e,o),i.add(n),t._object=n,t._object}))}_getOptions(t,e,i=t.params){let o=super._getOptions(t,e,i);return i.opacity&&(o.opacity=i.opacity),o}_getImage(t,e,i,o=t.params){return t._object?Promise.resolve(t._object):new Promise(((i,n)=>{if(o.url&&-1!==o.url.indexOf(".svg"))fabric.loadSVGFromURL(o.url,((t,e)=>{void 0===t&&(s.warn("layer url not found: ",o.url),i(null));let n=fabric.util.groupSVGElements(t,e);i(n)}),null,{crossOrigin:"anonymous"});else{let n=this._getImageUrl(t.params.url,t,e);fabric.Image.fromURL(n,(t=>{if(void 0===t)return s.warn("layer url not found: ",o.url),void i(null);i(t)}),{crossOrigin:"anonymous"})}}))}_colorize(t,e){if("group"===t.type){let i=t.getObjects();for(let t=0;t<i.length;t++){i[t].set("fill",e)}}else if("path"===t.type||"circle"===t.type)t.set("fill",e);else if("image"===t.type&&t.width&&t.height){let i;t.filters&&t.filters.length?i=t.filters[0]:(void 0===fabric.Image.filters.SwapColor&&Wn(fabric),i=new fabric.Image.filters.SwapColor,i.colorSource="#fff",t.filters=[i]),i.colorDestination=e,t.applyFilters()}}_applyColorPattern(t,e,i){return"image"===t.type?Promise.resolve(t):e._pattern&&e._pattern._url===i.urlPattern?(t.set("fill",e._pattern),Promise.resolve(e._object)):new Promise(((o,n)=>{fabric.Image.fromURL(i.urlPattern,(n=>{if(void 0===n)return s.warn("color layer urlPattern not found: ",i.url),void o(null);e._pattern=new fabric.Pattern({source:n._element,repeat:"repeat",offsetY:i.patternOffsetY||0,offsetX:i.patternOffsetX||0}),e._pattern._url=i.urlPattern,t.set("fill",e._pattern),o(e._object)}),{crossOrigin:"anonymous"})}))}};var Yn=class extends Un{render(t,e,i){let o;o=t.params.textBox?t._object&&"textbox"===t._object.type?t._object:new fabric.Textbox("",{editable:!1}):t._object&&"text"===t._object.type?t._object:new fabric.Text("");let r=t.params.text||"",s={...t.params};if(t.params.option){let o=mn.getProductOption(t.params.option,e.options);if(o){o.value&&(r=o.value),o._layer=t;let a=!1;t.params.textEditor?(t._editor?s=n.extend(t.params,o._editor):t._editor=n.extend({},t.params),o._editor&&o._editor===t._editor||(o._editor=t._editor,s=n.extend(t.params,o._editor),a=!0),t._context||(t._context=e,t._canvas=i,a=!0)):o._editor&&(delete o._editor,a=!0),a&&e.productForm&&e.productForm.dispatchEvent(new CustomEvent("options:render",{detail:o,cancelable:!0,bubbles:!0}))}}if(t.params.optionFont){let i=mn.getProductOption(t.params.optionFont,e.options);i&&i.value&&(s.fontFamily=i.value)}if(t.params.optionColor){let i=mn.getProductOption(t.params.optionColor,e.options);if(i&&i.value)if("color"===i.type)s.color=i.value;else if(i.values&&i.values.length){let t=i.values.filter((t=>t.value===i.value));if(t.length){let e=t[0];e.color&&(s.color=e.color),e.img&&s.textPattern&&!s.urlPattern&&(s.urlPattern=e.img)}}}if(t.params.textShadow&&t.params.optionTextShadowColor){let i=mn.getProductOption(t.params.optionTextShadowColor,e.options);if(i&&i.value)if("color"===i.type)s.textShadowColor=i.value;else if(i.values&&i.values.length){let t=i.values.filter((t=>t.value===i.value));t.length&&(s.textShadowColor=t[0].color)}}if(t.params.textStroke&&t.params.optionTextStrokeColor){let i=mn.getProductOption(t.params.optionTextStrokeColor,e.options);if(i&&i.value)if("color"===i.type)s.textStrokeColor=i.value;else if(i.values&&i.values.length){let t=i.values.filter((t=>t.value===i.value));t.length&&(s.textStrokeColor=t[0].color)}}if(s.textVertical){let t=[];for(let e=0;e<r.length;e++)t.push(r.charAt(e));r=t.join("\n")}let a=this._getOptions(t,e,s);return a.text=r.replace(/\\n/g,"\n"),t._interactiveScaled&&t._object&&(t._object.text===a.text&&t._object.fontFamily===a.fontFamily||delete t._interactiveScaled),o.set(a),a.hasControls&&!mn.isEditLayer(t,e.editorMode,e.editLayer)&&o.setControlsVisibility({mt:!1,mb:!1,ml:!1,mr:!1,bl:!a.lockScalingX,br:!a.lockScalingX,tl:!a.lockScalingY,tr:!a.lockScalingY,mtr:!a.lockRotation}),this._applyAutoParams(o,t,e,s),this._addRefRect(o,t,e,i),a.text&&a.text.trim()&&i.add(o),t._object=o,s.textPattern&&s.urlPattern?this._applyTextPattern(o,t,s):Promise.resolve(t._object)}_getOptions(t,e,i=t.params){let o=super._getOptions(t,e,i);if(o.fill=i.color||"#000000",o.fontSize=i.fontSize||10,o.fontFamily=i.fontFamily||"Arial",o.fontStyle=i.fontStyle?i.fontStyle:"normal",o.fontWeight=i.fontWeight?i.fontWeight:"normal",o.textAlign=i.textAlign?i.textAlign:"left",o.lineHeight=i.lineHeight?i.lineHeight:1.16,i.fontSizeFactor&&(o.fontSize*=i.fontSizeFactor),i.textStroke&&(o.stroke=i.textStrokeColor?i.textStrokeColor:"#000000",o.strokeWidth=i.textStrokeWidth?i.textStrokeWidth:1,o.strokeLineJoin=i.textStrokeLine?i.textStrokeLine:"round",o.strokeLineCap=i.textStrokeLine?i.textStrokeLine:"round",o.paintFirst="stroke"),o.charSpacing=i.letterSpacing?100*i.letterSpacing:0,o.shadow=i.textShadow?new fabric.Shadow({color:i.textShadowColor?i.textShadowColor:"#000000",blur:i.textShadowBlur?i.textShadowBlur:1,offsetX:i.textShadowOffsetX?i.textShadowOffsetX:.5,offsetY:i.textShadowOffsetY?i.textShadowOffsetY:.5}):void 0,t.params.textBox&&(mn.hasRefRect(t)&&(i.refWidth||i.refHeight)?(o.width=i.refWidth,o.height=i.refHeight):(o.width=e.config.width,o.height=e.config.height)),t.params.textPath){let n=t.params.path||"",r=t.params.pathSide||"left",s=mn.getRefDimensions(t,e);if("path"===t.params.pathShape)n&&(o.path=new fabric.Path(n,{fill:!1}));else if("circle_top"===t.params.pathShape){let t=Math.min(s.width,s.height)/2;n=this._describeEllipse([0,0],[t,t],[90,359.9],0),r="left",o.path=new fabric.Path(n,{fill:!1}),o.path.width+=2*o.fontSize,o.path.height+=2*o.fontSize}else if("circle_bottom"===t.params.pathShape){let t=Math.min(s.width,s.height)/2;n=this._describeEllipse([0,0],[t,t],[270,359.9],0),r="right",o.path=new fabric.Path(n,{fill:!1})}else"ellipse_top"===t.params.pathShape?(n=this._describeEllipse([0,0],[s.width/2,s.height/2],[90,359.9],0),r="left",o.path=new fabric.Path(n,{fill:!1}),o.path.width+=2*o.fontSize,o.path.height+=2*o.fontSize):"ellipse_bottom"===t.params.pathShape&&(n=this._describeEllipse([0,0],[s.width/2,s.height/2],[270,359.9],0),r="right",o.path=new fabric.Path(n,{fill:!1}));o.path&&(o.pathStartOffset=i.letterSpacing?3*i.letterSpacing:0,o.pathSide=r,mn.isEditLayer(t,e.editorMode,e.editLayer)&&!e.cropMode&&o.path.setOptions({stroke:"rgb(178,204,255)",strokeWidth:2}))}return o}_applyTextPattern(t,e,i){return e._pattern&&e._pattern._url===i.urlPattern?(t.set("fill",e._pattern),Promise.resolve(e._object)):new Promise(((o,n)=>{fabric.Image.fromURL(i.urlPattern,(n=>{if(void 0===n)return s.warn("text layer urlPattern not found: ",i.url),void o(null);e._pattern=new fabric.Pattern({source:n._element,repeat:"repeat",offsetY:i.patternOffsetY||0,offsetX:i.patternOffsetX||0}),e._pattern._url=i.urlPattern,t.set("fill",e._pattern),o(e._object)}),{crossOrigin:"anonymous"})}))}_degreeToRadian(t){return t*Math.PI/180}_describeEllipse([t,e],[i,o],[n,r],s){n=this._degreeToRadian(n),r=this._degreeToRadian(r),s=this._degreeToRadian(s);const a=([[t,e],[i,o]],[n,r])=>[t*n+e*r,i*n+o*r],l=([t,e],[i,o])=>[t+i,e+o];r%=2*Math.PI;const c=(p=s,[[Math.cos(p),-Math.sin(p)],[Math.sin(p),Math.cos(p)]]);var p;const[d,h]=l(a(c,[i*Math.cos(n),o*Math.sin(n)]),[t,e]),[u,m]=l(a(c,[i*Math.cos(n+r),o*Math.sin(n+r)]),[t,e]),g=r>Math.PI?1:0,f=r>0?1:0;return"M "+d+" "+h+" A "+[i,o,s/(2*Math.PI)*360,g,f,u,m].join(" ")}};var Xn=class extends Un{render(t,e,i){if(t.params.maskLayers&&t.params.maskLayers.length>0){i.clipPath&&delete i.clipPath;let o=[];return i.forEachObject((n=>{n._layer&&this._isMaskedLayer(t.params.maskLayers,n._layer.name)&&o.push(this._getClipPath(t,e,i,n).then((t=>{t?n.clipPath=t:delete n.clipPath,n.dirty=!0})))})),Promise.all(o)}return this._getClipPath(t,e,i).then((o=>(o?(e.mask=!0,i.clipPath=o,t._object=o):(delete i.clipPath,delete t._object),o)))}_isMaskedLayer(t,e){if(-1!==t.indexOf(e))return!0;for(let i=0;i<t.length;i++)if(e.startsWith(t[i]+"_"))return!0;return!1}_getClipPath(t,e,i,o){let n=this._getOptions(t,e),r=null;if(t.params.shape)switch(t.params.shape){case"circle":if(t._object&&"circle"!==t._object.type&&delete t._object,r=t._object||new fabric.Circle,t.params.radius)n.radius=t.params.radius;else if(!t.params.maskLayers||0===t.params.maskLayers.length){let t=e.config.width;n.radius=t/2}o&&(t.params.radius||(n.radius=o.width/2),n.left=-n.radius,n.top=-n.radius),r.setOptions(n);break;case"triangle":t._object&&"triangle"!==t._object.type&&delete t._object,r=t._object||new fabric.Triangle,t.params.maskLayers&&0!==t.params.maskLayers.length||(n.width=e.config.width,n.height=e.config.height),o&&(n.width=o.width,n.height=o.height,n.left=-n.width/2,n.top=-n.height/2),r.setOptions(n);break;case"svg":if(t.params.url){let r=null;return r=o&&o.clipPath&&o.clipPath._url===t.params.url?Promise.resolve(o.clipPath):i.clipPath&&i.clipPath._url===t.params.url?Promise.resolve(i.clipPath):new Promise(((e,i)=>{fabric.loadSVGFromURL(t.params.url,((i,o)=>{if(i){let t=fabric.util.groupSVGElements(i,o);e(t)}else s.warn("svg mask not found",t.params.url),e(null)}))})),r.then((i=>{if(i){n._url=t.params.url,n.width=i.width,n.height=i.height;let r=t.params.padding||3;if(t.params.maskLayers&&0!==t.params.maskLayers.length?o&&(n.scaleX=(o.width-r)/i.width,n.scaleY=(o.height-r)/i.height):(n.scaleX=(e.config.width-r)/i.width,n.scaleY=(e.config.height-r)/i.height),t.params.ratio||!0){let t=Math.min(n.scaleX,n.scaleY);n.scaleX=t,n.scaleY=t}o&&(n.left=-i.width*n.scaleX/2,n.top=-i.height*n.scaleY/2),i.setOptions(n)}return i}))}s.warn("svg mask missing url",t)}return Promise.resolve(r)}};var Qn=class extends Gn{_findProductUrl(t,e){let i=e.product;if(t.params.imgPos){let e=parseInt(t.params.imgPos);if(!isNaN(e)&&i.images.length>e-1)return i.images[e-1]}if(t.params.variant&&e.variantId)for(let t=0;t<e.product.variants.length;t++){const i=e.product.variants[t];if(i.id.toString()===e.variantId.toString()){if(i.featured_image&&i.featured_image.src)return i.featured_image.src;break}}return i.featured_image}_getImage(t,e,i,o=t.params){if(e.product){let i=this._findProductUrl(t,e);if(i)return t._object&&t._url===i?Promise.resolve(t._object):new Promise(((o,n)=>{let r=this._getImageUrl(i,t,e);fabric.Image.fromURL(r,(e=>{void 0===e&&(s.warn("product url not found: ",i),o(null)),t._url=i,o(e)}),{crossOrigin:"anonymous"})}))}else s.warn("missing product in render context");return Promise.resolve(null)}};var Zn=class extends Gn{_getImage(t,e,i,o=t.params){if(o.option){let n=mn.getProductOption(o.option,e.options);if(n){if(n._layer=t,n.value){if("{product}"===n.value){let i=tr.renderers.product._findProductUrl(t,e);i&&(n.value=i)}let r=n.value;if(n.params.multiple||-1!==r.indexOf(",")||o.fileIndex){let t=r.split(","),e=o.fileIndex||t.length;if(e-=1,!(t.length>e))return Promise.resolve(null);r=t[e]}let a=!1;if(t.params.layerEditor?t._context||(t._context=e,t._canvas=i,a=!0):t._context&&(delete t._context,a=!0),o.crop&&n.params.optionDimension&&n.params.dimensionCrop){let i=mn.getProductOption(n.params.optionDimension,e.options);if(i&&i.visible&&i._controller&&i._controller.x&&i._controller.y&&(!i.errors||0===i.errors.length)){let o=mn.getRefDimensions(t,e),n=Math.round(o.width/o.height*100)/100,r=Math.round(i._controller.x/i._controller.y*100)/100;n!==r&&(void 0!==t._cropWidth&&void 0!==t._cropHeight||(t._cropWidth=t.params.refRect&&t.params.refWidth||e.config.width,t._cropHeight=t.params.refRect&&t.params.refHeight||e.config.height),r>1?(t.params.refWidth=t._cropWidth,t.params.refHeight=t._cropWidth/r):(t.params.refHeight=t._cropHeight,t.params.refWidth=t._cropHeight*r),void 0!==t._cropX&&void 0!==t._cropY||(t._cropX=t.params.refRect&&t.params.refX||0,t._cropY=t.params.refRect&&t.params.refY||0),t.params.refRect=!0,t.params.refX=t._cropX+t._cropWidth/2-t.params.refWidth/2,t.params.refY=t._cropY+t._cropHeight/2-t.params.refHeight/2,!1!==t._autoCrop?e.autoCrop=t:delete t._autoCrop,!1===t.params.autoCrop&&delete e.autoCrop,io.productCropOverlay=!1)}}return a&&e.productForm&&e.productForm.dispatchEvent(new CustomEvent("options:render",{detail:n,cancelable:!0,bubbles:!0})),!t._object||t._url!==r||!isNaN(t.params.rotate)&&t._rotate!==t.params.rotate||t.params.filters&&t._filters&&t._filters.length!==t.params.filters.length?new Promise(((i,n)=>{t._interactive&&(t._duplicate?delete t._duplicate:(delete t._interactive,delete t._interactiveScaled)),t.params.crop&&(e.autoCrop=t),!1===t.params.autoCrop&&delete e.autoCrop;const a=n=>{if(void 0===n&&(s.warn("upload url not found: ",r),i(null)),t._url=r,t._rotate=0,t.params.autoRotate){let i=mn.getRefDimensions(t,e),o=n;o.width<o.height&&i.width>i.height?t._rotate=90:o.width>o.height&&i.width<i.height&&(t._rotate=-90)}if(isNaN(t.params.rotate)||(t._rotate=t.params.rotate),0!==t._rotate){n.rotate(t._rotate),t.params.rotate=t._rotate,o.canvasRotate&&(e.canvasRotate=-1*t._rotate);let r={multiplier:1,format:-1!==t._url.indexOf(".png")?"png":"jpeg",quality:1},s=n.toDataURL(r);fabric.Image.fromURL(s,(o=>{this._applyFilters(o,t,e).then((()=>{i(o)}))}))}else this._applyFilters(n,t,e).then((()=>{i(n)}))};-1!==r.indexOf(".svg")?fabric.loadSVGFromURL(r,((n,l)=>{if(void 0===n)return s.warn("upload url not found: ",r),void i(null);let c=fabric.util.groupSVGElements(n,l);if(o.color||o.optionColor)return delete t._color,void i(c);if(!o.crop&&!o.filters)return void i(c);let p=Math.max(e.config.width/c.viewBoxWidth,e.config.height/c.viewBoxHeight),d=c.toDataURL({multiplier:Math.min(10,p),format:"png"});fabric.Image.fromURL(d,(t=>{a(t)}))}),null,{crossOrigin:"anonymous"}):fabric.Image.fromURL(r,a,{crossOrigin:"anonymous"})})):(t.params.autoRotate&&0!==t._rotate&&o.canvasRotate&&(e.canvasRotate=-1*t._rotate),Promise.resolve(t._object))}if(t.params.urlPlaceholder)return new Promise(((e,i)=>{fabric.Image.fromURL(t.params.urlPlaceholder,(t=>{e(t)}),{crossOrigin:"anonymous"})}))}else s.warn("no upload option found for layer",t)}else s.warn("missing option for layer",t);return Promise.resolve(null)}_applyFilters(t,e,i){let o=Promise.resolve(null);if(e.params.filters&&e.params.filters.length){let i=[...e.params.filters];if(t.width>fabric.textureSize||t.height>fabric.textureSize){let e=Math.max(t.height,t.width);fabric.textureSize=e>4096?e:4096}if(!e.params.urlFilter||e._urlFilterImage&&e._urlFilter===e.params.urlFilter||(o=o.then((()=>new Promise(((t,i)=>{fabric.Image.fromURL(e.params.urlFilter,(i=>{i&&(e._urlFilter=e.params.urlFilter,e._urlFilterImage=i),t()}),{crossOrigin:"anonymous"})}))))),e.params.urlFilter&&-1!==i.indexOf("pattern")&&(o=o.then((()=>new Promise(((i,o)=>{let n=e._urlFilterImage.getElement(),r=t.getScaledWidth(),s=t.getScaledHeight(),a=new fabric.Rect({width:r,height:s});a.set("fill",new fabric.Pattern({source:n,repeat:"repeat"}));let l=a.toDataURL();fabric.Image.fromURL(l,(t=>{t&&(e._urlFilterImagePattern=t),i()}))})))),-1!==i.indexOf("removeWhite")&&(o=o.then((()=>new Promise(((i,o)=>{t.applyFilters([new fabric.Image.filters.RemoveColor({threshold:.2})]),fabric.Image.fromURL(t.toDataURL(),(t=>{t&&(e._urlFilterImageBlend=t,e._removeWhiteSkip=!0),i()}))})))))),-1!==i.indexOf("removeBg")&&e.params.removeBgKey){let i=t.getSrc(!1),n=i.substring(i.lastIndexOf(".")).toLowerCase();".jpg"!==n&&".jpeg"!==n&&".png"!==n||(o=o.then((()=>new Promise(((o,n)=>{new r("https://api.remove.bg/v1.0/removebg",{method:"POST",responseType:"blob",headers:{"X-API-Key":e.params.removeBgKey,"Content-type":"application/x-www-form-urlencoded"},data:{image_url:i,size:e.params.removeBgSize||window.clRemoveBgSize||"auto",type:"auto"}}).then((i=>{const n=URL.createObjectURL(i.data);let r=new Image;r.onload=()=>{t.setElement(r),e._removeBg=!0,o()},r.src=n})).catch((t=>{s.error(t),o()}))})))))}o.then((()=>{t.filters||(t.filters=[]);for(let o=0;o<i.length;o++){let n;switch(i[o]){case"pattern":if(e._urlFilterImagePattern){let i=e._urlFilterImageBlend;i||(i=new fabric.Image,i.setElement(t.getElement())),t.setElement(e._urlFilterImagePattern.getElement()),n=new fabric.Image.filters.BlendImage({image:i,mode:"mask"}),n._sort=7}break;case"multiply":e._urlFilterImage&&(n=new fabric.Image.filters.BlendImage({image:e._urlFilterImage,mode:"multiply",alpha:e.params.alphaFilter||.5}),n._sort=6);break;case"invert":n=new fabric.Image.filters.Invert,n._sort=2;break;case"grayscale":n=new fabric.Image.filters.Grayscale,n._sort=6;break;case"sepia":n=new fabric.Image.filters.Sepia,n._sort=5;break;case"removeWhite":if(e._removeWhiteSkip)break;n=new fabric.Image.filters.RemoveColor({threshold:.2}),n._sort=1}n&&t.filters.push(n)}t.filters.length&&t.filters.sort(((t,e)=>(t._sort||100)>(e._sort||100)?1:-1)),e._filters=[...i],t.applyFilters()}))}return io.previewImgResize?o.then((()=>{this._applyResizeFilter(t,e,i)})):o}_applyResizeFilter(t,e,i){if(!t||"image"!==t.type)return;if(void 0===fabric.Image.filters.Resize)return void s.debug("Resize filter not available in this Fabric.js version");let o=mn.getRefDimensions(e,i),n=o.width/t.width,r=o.height/t.height,a=Math.min(n,r);e.params.autoScaleOverlay&&(a=Math.max(n,r));let l=window.clResizeThreshold||.5;if(a<l){let e=window.clResizeType||"hermite";t.resizeFilter=new fabric.Image.filters.Resize({resizeType:e}),t.minimumScaleTrigger=l,s.debug("Applied resize filter:",e,"for scale:",a.toFixed(2))}}};var Jn=class extends Gn{_getImage(t,e,i,o=t.params){let n=o.text||"";if(o.option){let t=mn.getProductOption(o.option,e.options);t&&t.value&&(n=t.value)}if(n){let i=s.getLevel();if(i<=s.levels.DEBUG&&console.time("====> QR RENDER"),t._object&&t._qrText===n)return i<=s.levels.DEBUG&&console.timeEnd("====> QR RENDER"),Promise.resolve(t._object);{let r=[e.assets+"/static/lib/easyqrcodejs/easy.qrcode.min.js"];return nn.loadOnce(r,"qrcode",{async:!1}).then((()=>new Promise(((r,a)=>{let l=(e,o)=>{i<=s.levels.DEBUG&&console.timeEnd("====> QR RENDER"),fabric.Image.fromURL(o,(e=>{if(void 0===e)return s.warn("qr image invalid"),void r(null);t._qrText=n,r(e)}))};if(t._qrDiv||(t._qrDiv=document.createElement("div")),e.editorMode&&t._qrCode&&(t._qrCode.clear(),delete t._qrCode),t._qrCode)t._qrCode._htOption.onRenderingEnd=l,t._qrCode._oDrawing._htOption.onRenderingEnd=l,t._qrCode.makeCode(n);else{let i=Math.min(e.config.width/2,1e3),r={text:n,width:i,height:i,onRenderingEnd:l};o.url&&(r.logo=o.url,r.crossOrigin="anonymous"),t._qrCode=new QRCode(t._qrDiv,r)}}))))}}return Promise.resolve(null)}};class Kn{}Kn.renderers={},Kn.renderers.overlay=new Gn,Kn.renderers.text=new Yn,Kn.renderers.mask=new Xn,Kn.renderers.product=new Qn,Kn.renderers.upload=new Zn,Kn.renderers.qrcode=new Jn;var tr=Kn;var er=class{destroy(){this._destroyLayerActionsTooltip(),this.element.removeChild(this._wrapper)}render(){tt((this.settings.product,this.config.uuid,et`
<div class="cl-po--preview"> 
    <canvas class="cl-po--canvas"></canvas>
</div>
`),this._wrapper)}_renderContext(){return{config:this.previewConfig,options:this.config.options,product:this.settings.product,assets:this.settings.assets,productForm:this._productForm,variantId:this.settings.variantId,editorMode:this.settings.editorMode,editLayer:this.settings.editLayer,cropMode:this.settings.cropMode,cropLayer:this.settings.cropLayer,mask:!1,cdnSize:io.previewCdnSize}}renderPreview(){return null==this._renderQueue&&(this._renderQueue=Promise.resolve()),this._renderQueue=this._renderQueue.then((()=>this._loadUsedFonts())).then((()=>this._renderCanvas())),this._renderQueue}_renderCanvas(){let t=s.getLevel();t<=s.levels.DEBUG&&console.time("====> RENDER PREVIEW "+this.previewConfig.position),this._hideLayerActionsTooltip();let e=this._renderContext(),i=null;if(!this.static){let t=this._canvas.getActiveObject();this._canvas.discardActiveObject(),t&&(i=t._layer)}return this._rotateGroup&&this._rotateGroup.forEachObject((t=>{this._rotateGroup.remove(t)})),this._canvas.clear(),this._renderLayers(this.previewConfig.layers,e).then((()=>(this._canvas.clipPath&&!e.mask&&delete this._canvas.clipPath,i?this.selectLayer(i.name,!1):mn.hasEditLayer(this.settings.editorMode,this.settings.editLayer)&&this.selectLayer(this.settings.editLayer,!1),void 0!==e.canvasRotate&&(this._rotateGroup=new fabric.Group(this._canvas.getObjects()),this._rotateGroup.rotate(e.canvasRotate),this._rotateGroup.setCoords()),this._canvas.renderAll(),t<=s.levels.DEBUG&&console.timeEnd("====> RENDER PREVIEW "+this.previewConfig.position),this._responsiveCanvasHeight(),this._syncThemeGallery(),this._triggerEvent("preview:rendered",this),e)))}downloadBlob(t,e){const i=URL.createObjectURL(t),o=document.createElement("a");o.href=i,o.download=e||"download";const n=function(t){setTimeout((()=>{URL.revokeObjectURL(i),this.removeEventListener("click",n)}),150)};return o.addEventListener("click",n,!1),o.click(),o}export(e,i,o,n,r="jpeg",a=.8,l=!0){if(this._canvas){let p=s.getLevel();p<=s.levels.DEBUG&&console.time("====> EXPORT PREVIEW");let h=!1,u=0;const m="function"==typeof n?n:t=>!0===t._layer.params[n];if(this._canvas.forEachObject((t=>{t._layer&&(t.visible?m(t)?(t.visible=!1,t._visible=!0,h=!0):"product"!==t._layer.type&&u++:t._layer.params.exportOnly&&(t.visible=t._layer._visibleCondition,t._visible=!1,m(t)&&(t.visible=!1),h=!0))})),l&&0===u)return s.debug("==> no visible layers - skipping export"),h&&this._canvas.forEachObject((t=>{void 0!==t._visible&&(t.visible=t._visible,delete t._visible)})),null;let g;this._canvas.renderAll();let f=[];if(io.previewImgResize&&"svg"===r&&this._canvas.forEachObject((t=>{"image"===t.type&&t.resizeFilter&&t._element&&(f.push({obj:t,resizedElement:t._element}),t._element=t._filteredEl||t._originalElement)})),"svg"===r){let t={width:e.width,height:e.height};i&&(t.viewBox={x:i.x,y:i.y,width:i.width,height:i.height});let n=this._canvas.toSVG(t);if(io.previewCdnSize){let t,e=/xlink:href="([^"]+)"/g,i=[];for(;t=e.exec(n);)-1!==t[1].indexOf("cdn.shopify.com")&&i.push(t[1]);for(const t of i){let e=t.replace(/_x\d+\./,".").replace(/_\d+x\./,".");e?.startsWith("//cdn.shopify.com")&&(e="https:"+e),e!==t&&(s.debug("SVG export removed size from CDN url: ",t,e),n=n.replace(t,e))}}var c=[];for(let t=0;t<document.styleSheets.length;t++){const e=document.styleSheets[t];e.href&&(-1!==e.href.indexOf("fonts.googleapis.com")?c.push(e.href+"&subset="+(window.clExportFontSubset||"latin-ext,cyrillic-ext,greek-ext,japanese,hebrew")):-1!==e.href.indexOf(d.api)&&c.push(e.href))}if(c.length){let t=`<style type="text/css"><![CDATA[\n                            ${c.map((t=>`@import url("${t}");`)).join("\n")}\n                        ]]></style>`,e=n.indexOf("</defs>");n=n.substring(0,e)+t+n.substring(e)}g=o?new Blob([n],{type:"image/svg+xml"}):n,f.forEach((({obj:t,resizedElement:e})=>{t._element=e}))}else{let n={multiplier:e.width/this._canvas.getWidth(),format:r,quality:a};i&&(n.left=i.x/n.multiplier,n.top=i.y/n.multiplier,n.width=i.width/n.multiplier,n.height=i.height/n.multiplier);let s=this._canvas.toDataURL(n);g=o?t(Hn)(s):s}return h&&(this._canvas.forEachObject((t=>{void 0!==t._visible&&(t.visible=t._visible,delete t._visible)})),this._canvas.renderAll()),p<=s.levels.DEBUG&&console.timeEnd("====> EXPORT PREVIEW"),g}return null}exportLayer(e,i,o="jpeg",n=.8){let r=this._canvas.getObjects();for(let a=0;a<r.length;a++){const l=r[a];if(l._layer&&l._layer.name===e){let e={multiplier:1,withoutTransform:!0,format:o,quality:n},r=l.clipPath;if(r){l.clipPath=null;let t=r.getBoundingRect(!0,!0);s.debug("crop rect",t);let i=l.getBoundingRect(!0,!0);s.debug("bounding rect",i);let o=l.width/l.getScaledWidth();e.left=Math.round((t.left-i.left)*o),e.top=Math.round((t.top-i.top)*o),e.width=Math.round(t.width*o),e.height=Math.round(t.height*o),e.left=Math.max(e.left,0),e.top=Math.max(e.top,0),e.width=Math.min(e.width,l.width-e.left),e.height=Math.min(e.height,l.height-e.top)}let a,c=l.toDataURL(e);return a=i?t(Hn)(c):c,r&&(l.clipPath=r),a}}return null}exportLayerCoords(t){let e=this._canvas.getObjects();for(let i=0;i<e.length;i++){const o=e[i];if(o._layer&&(o._layer.name===t||o._layer.name.startsWith(t+"_")))return{x:Math.round(o.left),y:Math.round(o.top),w:Math.round(o.getScaledWidth()),h:Math.round(o.getScaledHeight()),r:Math.round(o.angle)}}return null}clear(){this._canvas&&this._canvas.clear()}updateConfig(t){let e=!1;return this.previewConfig.width===t.width&&this.previewConfig.height===t.height||(e=!0),this.previewConfig=t,e&&this._setDimensions(),this.renderPreview()}selectLayer(t,e=!0,i=this.previewConfig.layers){for(let o=0;o<i.length;o++){const n=i[o];if(n.layers&&n.layers.length>0&&this.selectLayer(t,e,n.layers))return!0;if(n.name===t&&n._object&&(mn.isEditLayer(n,this.settings.editorMode,this.settings.editLayer)&&(this._canvas.preserveObjectStacking=!1,delete n._interactive),this._canvas.contains(n._object)))return this._canvas.setActiveObject(n._object),e&&this._canvas.renderAll(),!0}return!1}deSelect(t=!0){this._canvas.discardActiveObject(),this.settings.editorMode&&!this._canvas.preserveObjectStacking&&(this._canvas.preserveObjectStacking=!0),t&&this._canvas.renderAll()}_init(){this._wrapper=document.createElement("div"),this._wrapper.className=this.settings.classNamePrefix+"--preview-wrapper",this._wrapper.setAttribute("id",this.config.uuid+"_preview"),this._wrapper.style.width="100%",this.settings.position?(this.element.insertAdjacentElement(this.settings.position,this._wrapper),this.element!==this._wrapper.parentNode&&(this.element=this._wrapper.parentNode)):this.element.appendChild(this._wrapper),this.render(),this._preview=this._wrapper.querySelector("."+this.settings.classNamePrefix+"--preview"),this._preview.classList.add("cl-hide");let t=this._wrapper.querySelector("."+this.settings.classNamePrefix+"--canvas");this.static=this._isStatic(),fabric.devicePixelRatio<2&&(fabric.devicePixelRatio=2),window.clPreviewRatio&&(fabric.devicePixelRatio=parseInt(window.clPreviewRatio)),fabric.Object.NUM_FRACTION_DIGITS=8,fabric.enableGLFiltering=!1,window.clPreviewGLFilter&&(fabric.enableGLFiltering=!0),this.static?(this._canvas=new fabric.StaticCanvas(t),this.settings.zoom?.enabled&&this._watchZoom()):(fabric.isTouchSupported&&this._patchCanvasTouchScroll(),this._updateCanvasControls(),this._canvas=new fabric.Canvas(t,{selection:!1,preserveObjectStacking:!0,allowTouchScrolling:!0}),this._subscribeCanvasEvents()),this._setDimensions(),this.renderPreview().then((()=>{this._watchFormChanges(),this._watchWindowResize(),this._watchWindowScroll(),this._watchPreviewActive(),this._preview.classList.remove("cl-hide")})).catch((t=>{s.error("[live-options] failed render preview",t)}))}_setDimensions(){let t=this._canvas.getZoom();1!==t&&this._canvas.setZoom(1);let e=fabric.devicePixelRatio,i=this.previewConfig.width*this.previewConfig.height,o=window.clPreviewMaxRetina||9e6;e>1&&i>o&&n.isMobile(n.getAgent())&&(this._canvas.enableRetinaScaling=!1),this._canvas.setDimensions({width:this.previewConfig.width,height:this.previewConfig.height}),1!==t&&this._resizeCanvas()}_renderLayers(t,e){let i=Promise.resolve();for(let o=0;o<t.length;o++){const n=t[o];i=i.then((()=>this._renderLayer(n,e)))}return i}_renderLayer(t,e){let i=!0;if(t.conditions&&t.conditions.length&&(i=this.conditionsEngine.evaluateConditions(t.conditions,t.conditionMode||qn.MODE.AND,"layer.name="+t.name)),this.settings.editorMode&&this.visibleEditor.hasOwnProperty(t.name)&&(i=this.visibleEditor[t.name]),this.visible[t.name]=i,t.params.preload&&"overlay"===t.type&&(t._visible=i,i=!0),t.params.exportOnly&&(t._visible=mn.isEditLayer(t,this.settings.editorMode,this.settings.editLayer),t._visibleCondition=i,i=!0),i){if(s.debug("rendering layer: ",t),t.layers&&t.layers.length>0)return this._renderLayers(t.layers,e);let i=tr.renderers[t.type];if(i)return i.render(t,e,this._canvas)}return Promise.resolve()}_loadUsedFonts(){let t=this._findUsedFonts(this.previewConfig.layers);return t.length>0?d.loadFontsByName(t):Promise.resolve(!0)}_findUsedFonts(t,e=[]){for(let i=0;i<t.length;i++){const o=t[i];if("text"===o.type){if(o.params.fontFamily&&e.push(o.params.fontFamily),o.params.option&&o.params.textEditor){let t=mn.getProductOption(o.params.option,this.config.options);t&&t._editor&&t._editor.fontFamily&&e.push(t._editor.fontFamily)}if(o.params.optionFont){let t=mn.getProductOption(o.params.optionFont,this.config.options);t&&t.value&&e.push(t.value)}o.layers&&this._findUsedFonts(o.layers,e)}}return e}_isStatic(){if(this.settings.editorMode)return!1;for(let t=0;t<this.previewConfig.layers.length;t++){const e=this.previewConfig.layers[t];if(e.params.interactive||e.params.crop&&"upload"===e.type)return!1}return!0}_watchFormChanges(){this._productForm?(this._productForm.addEventListener("option:changed",(t=>this._optionChanged(t))),this._productForm.addEventListener("option:crop",(t=>this._optionCrop(t))),this._productForm.addEventListener("option:export",(t=>this._optionExport(t))),this._productForm.addEventListener("option:variant_changed",(t=>this._variantChanged(t)))):s.warn("product-preview no productForm found for config: "+this.config.uuid)}_subscribeCanvasEvents(){let t=s.getLevel();this._canvas.on("object:modified",(e=>{let i=e.target;if(t<=s.levels.TRACE&&s.debug("object:modified",i),i._layer){let e=i._layer,o=e.params;o.x=Math.round(i.left),o.y=Math.round(i.top),t<=s.levels.TRACE&&s.debug("=> layer x,y = ",o.x,o.y),o.crop?(o.scaleX=i.scaleX,o.scaleY=i.scaleY):(o.scaleX=parseFloat(i.scaleX.toFixed(3)),o.scaleY=parseFloat(i.scaleY.toFixed(3))),0!==i.angle&&(o.angle=Math.round(i.angle)),e._editor&&(n.merge(e._editor,e.params,["x","y","scaleX","scaleY","angle"]),this._productForm&&this._productForm.dispatchEvent(new CustomEvent("options:render",{detail:null,cancelable:!0,bubbles:!0}))),this._triggerEvent("layer:changed",e)}else if(i._layerRef){let t=i._layerRef.params;if(t.refX=Math.round(i.left),t.refY=Math.round(i.top),t.refWidth=Math.round(i.getScaledWidth()),t.refHeight=Math.round(i.getScaledHeight()),0!==i.angle){t.refAngle=Math.round(i.angle);let e=4;(t.refAngle<=e||t.refAngle>=360-e)&&(t.refAngle=0)}else t.refAngle=0;s.debug("updated layer rectRef params",t),this._triggerEvent("layer:changed",i._layerRef),this.renderPreview()}})),this._canvas.on("object:moving",(e=>{let i=e.target;if(t<=s.levels.TRACE&&s.debug("object:moving",i),i._layer){let e=i._layer,o=e.params,n=mn.isCropLayer(e,this.settings.cropLayer,this.settings.cropLayer);if(n||o.interactive&&!mn.isEditLayer(e,this.settings.editorMode,this.settings.editLayer)){e._interactive=!0;let r={x:0,y:0},a={x:this.previewConfig.width,y:this.previewConfig.height},l={width:this.previewConfig.width,height:this.previewConfig.height};if(mn.hasRefRect(e)){if(o.refAngle){let t=new fabric.Rect({left:o.refX,top:o.refY,width:o.refWidth,height:o.refHeight,angle:o.refAngle}).getBoundingRect();r.x=t.left,r.y=t.top,a.x=t.left+t.width,a.y=t.top+t.height}else r.x=o.refX,r.y=o.refY,a.x=o.refX+o.refWidth,a.y=o.refY+o.refHeight;l.width=o.refWidth,l.height=o.refHeight}let c=i.getBoundingRect(!0,!0);if(t<=s.levels.TRACE&&s.debug("boundingRect = ",c),o.interactiveBox||n){let t=o.autoScaleOverlay||n;t&&e._interactiveScaled&&(c.width<l.width||c.height<l.height)&&(t=!1),t?(r.x-=c.width-l.width,r.y-=c.height-l.height,a.x-=l.width,a.y-=l.height):(a.x-=c.width,a.y-=c.height)}else{let t=50/this._canvas.getZoom();r.x-=c.width-t,r.y-=c.height-t,a.x-=t,a.y-=t}c.left<r.x?(0!==i.angle?i.setPositionByOrigin({x:r.x+c.width/2,y:i.getCenterPoint().y},"center","center"):i.left=r.x,t<=s.levels.TRACE&&s.debug("=> reset object.left  = ",i.left)):c.left>a.x&&(0!==i.angle?i.setPositionByOrigin({x:a.x+c.width/2,y:i.getCenterPoint().y},"center","center"):i.left=a.x,t<=s.levels.TRACE&&s.debug("=> reset object.left  = ",i.left)),c.top<r.y?(0!==i.angle?i.setPositionByOrigin({x:i.getCenterPoint().x,y:r.y+c.height/2},"center","center"):i.top=r.y,t<=s.levels.TRACE&&s.debug("=> reset object.top  = ",i.left)):c.top>a.y&&(0!==i.angle?i.setPositionByOrigin({x:i.getCenterPoint().x,y:a.y+c.height/2},"center","center"):i.top=a.y,t<=s.levels.TRACE&&s.debug("=> reset object.top  = ",i.left))}}this._updateLayerActionsPosition()}));const e=e=>{let i=e.target;if(t<=s.levels.TRACE&&s.debug("object:scaling",i),i._layer){let o=i._layer,n=o.params;if(n.interactive&&!mn.isEditLayer(o,this.settings.editorMode,this.settings.editLayer)&&(o._interactive=!0,o._interactiveScaled=!0,n.resizable&&(i.lockMovementX=!1,i.lockMovementY=!1),n.interactiveBox)){let r={x:0,y:0},a={x:this.previewConfig.width,y:this.previewConfig.height};if(mn.hasRefRect(o))if(n.refAngle){let t=new fabric.Rect({left:n.refX,top:n.refY,width:n.refWidth,height:n.refHeight,angle:n.refAngle}).getBoundingRect();r.x=t.left,r.y=t.top,a.x=t.left+t.width,a.y=t.top+t.height}else r.x=n.refX,r.y=n.refY,a.x=n.refX+n.refWidth,a.y=n.refY+n.refHeight;let l=i.getBoundingRect(!0,!0);t<=s.levels.TRACE&&s.debug("boundingRect = ",l);let c=null,p=20;if(e.transform&&e.transform.corner&&("tr"==e.transform.corner?(r.x-=p,a.y+=p):"tl"==e.transform.corner?(a.x+=p,a.y+=p):"br"==e.transform.corner?(r.x-=p,r.y-=p):"bl"==e.transform.corner&&(a.x+=p,r.y-=p)),Math.floor(l.left)<r.x){c=(i.aCoords.tr.x-r.x)/(l.width/i.scaleX),0!==i.angle?i.setPositionByOrigin({x:r.x+l.width/2,y:i.getCenterPoint().y},"center","center"):i.left=r.x}else if(Math.floor(l.left+l.width)>a.x){let t=a.x-l.left;c=t/(l.width/i.scaleX),0!==i.angle?i.setPositionByOrigin({x:a.x-t+l.width/2,y:i.getCenterPoint().y},"center","center"):i.left=a.x-t}if(Math.floor(l.top)<r.y){c=(l.top+l.height-r.y)/(l.height/i.scaleY),0!==i.angle?i.setPositionByOrigin({x:i.getCenterPoint().x,y:r.y+l.height/2},"center","center"):i.top=r.y}else if(Math.floor(l.top+l.height)>a.y){let t=a.y-l.top;c=t/(l.height/i.scaleY),0!==i.angle?i.setPositionByOrigin({x:i.getCenterPoint().x,y:a.y-t+l.height/2},"center","center"):i.top=a.y-t}null!=c&&(i.scaleX=c,i.scaleY=c,i.setCoords(),this._canvas.requestRenderAll(),t<=s.levels.TRACE&&s.debug("=> reset object.scale  = ",c))}}this._updateLayerActionsPosition()};this._canvas.on("object:scaling",e),this._canvas.on("object:scaled",e),this._canvas.on("selection:created",(e=>{if(this.settings.cropMode)return;let i=e.selected?e.selected[0]:null;t<=s.levels.TRACE&&s.debug("selection:created",i);let o=i?._layer;o&&(e.e&&this._triggerEvent("layer:selected",o),this._showLayerActionsTooltip(o))})),this._canvas.on("selection:updated",(e=>{if(this.settings.cropMode)return;let i=e.selected?e.selected[0]:null;t<=s.levels.TRACE&&s.debug("selection:updated",i);let o=i?._layer;o&&(e.e&&this._triggerEvent("layer:selected",o),this._showLayerActionsTooltip(o))})),this._canvas.on("selection:cleared",(e=>{if(!e.e)return;let i=e.deselected?e.deselected[0]:null;t<=s.levels.TRACE&&s.debug("selection:cleared",i);let o=i?._layer;o&&this._triggerEvent("layer:deselected",o),this._hideLayerActionsTooltip()})),this._canvas.on("selection:cleared",(e=>{t<=s.levels.TRACE&&s.debug("selection:cleared")})),this.element.addEventListener("layer:action:centerH",(t=>{this._centerLayer(t.detail,"horizontal"),this._updateLayerActionsPosition()})),this.element.addEventListener("layer:action:centerV",(t=>{this._centerLayer(t.detail,"vertical"),this._updateLayerActionsPosition()}))}_variantChanged(t){this.settings.variantId=t.detail.variantId,this._clearVisibleEditor(),this.renderPreview().then((e=>{this.static||!this.settings.cropMode&&e.autoCrop&&this._optionCrop(t,e.autoCrop)}))}_optionChanged(t){let e=t.detail;this._clearVisibleEditor(),this.renderPreview().then((i=>{this.static||(!this.settings.cropMode&&i.autoCrop?this._optionCrop(t,i.autoCrop):e._layer&&e._layer.params.interactive&&this.selectLayer(e._layer.name,!1))}))}_optionCrop(t,e){let i=t.detail;if(this.active){if(!e){let t=this._canvas.getObjects();for(let o=0;o<t.length;o++){const n=t[o];if(n._layer&&n._layer.params.option===i.name&&n._layer.params.crop){e=n._layer;break}}}if(this.settings.cropMode){this.settings.cropMode=!1,this.settings.cropLayer="";let t=this._getContainerWidth()/this.previewConfig.width;this.settings.maxHeight&&(t=this.settings.maxHeight/this.previewConfig.height),this._canvas.setViewportTransform([t,0,0,t,0,0]),this._highlight(!1),this._wrapper.removeChild(this._cropEl),delete this._cropEl}else{if(!e)return;this.settings.cropMode=!0,this.settings.cropLayer=e.name;let t=e.params,o={width:this.previewConfig.width,height:this.previewConfig.height},r={x:e._object.left,y:e._object.top,scaleX:e._object.scaleX,scaleY:e._object.scaleY,rotate:0|e.params.rotate},s={_interactive:e._interactive,_interactiveScaled:e._interactiveScaled};if(delete e._interactive,delete e._interactiveScaled,mn.hasRefRect(e)){let i=this._renderContext(),n=mn.getRefDimensions(e,i),r=mn.getRefCoordinates(e,i),s=100;window.innerWidth<500&&(s=50,this.settings.maxHeight&&this.settings.maxHeight<200&&(s=20));let a=Math.min((this._canvas.getWidth()-s)/n.width,(this._canvas.getHeight()-s)/n.height);if(a>this._canvas.getZoom()){a=Math.min(a,2);let t=r.x+n.width/2,e=r.y+n.height/2,i=-t*a+this._canvas.getWidth()/2,o=-e*a+this._canvas.getHeight()/2;this._canvas.setViewportTransform([a,0,0,a,i,o])}o.width=t.refWidth,o.height=t.refHeight}if(this._cropEl=document.createElement("div"),!1!==window.clCropHelp){this._cropEl.classList.add("cl-po--crop-help"),"ontouchstart"in window||navigator.msMaxTouchPoints?this._cropEl.classList.add("touch"):this._cropEl.classList.add("cursor");const t=()=>{this._cropEl&&(this._cropEl.classList.remove("cl-po--crop-help"),this._canvas.off("object:moving",t),window.clCropHelp=!1)};this._canvas.on("object:moving",t),setTimeout(t,9e3)}const a=()=>{e._interactive=!0,e._interactiveScaled=!0,this._canvas.fire("object:modified",{target:e._object}),this._optionCrop({detail:i},e)};this._productForm.addEventListener("option:crop:apply",(t=>{this.settings.cropMode&&a()}),{once:!0}),tt(zn((t=>{let i=e._object;e._interactiveScaled=!0;let n=Math.min(o.width,o.height)/10,r=n/i.width;if(t)i.scaleX+=r,i.scaleY+=r,i.left-=n/2,i.top-=n/2;else{if(i.scaleX-=r,i.scaleY-=r,e.params.autoScaleOverlay&&(Math.round(i.getScaledWidth())<o.width||Math.round(i.getScaledHeight())<o.height))return i.scaleX+=r,void(i.scaleY+=r);i.left+=n/2,i.top+=n/2}this._canvas.fire("object:moving",{target:e._object}),this._canvas.renderAll()}),(t=>{e.params.rotate=e.params.rotate|e._rotate|0,e.params.rotate+=t,e.params.rotate=e.params.rotate%360,this.renderPreview()}),(()=>{n.merge(e.params,r),n.merge(e,s),this._optionCrop({detail:i})}),a),this._cropEl),this._wrapper.appendChild(this._cropEl),this._highlight(!0);let l=this._wrapper.getBoundingClientRect();l.top<0&&window.scrollTo&&window.scrollTo(l.left,l.top+window.scrollY-50)}this._canvas.discardActiveObject(),this.renderPreview().then((()=>{this.settings.cropMode&&this.selectLayer(this.settings.cropLayer)}))}}_optionExport(t){let e=t.detail,i=this.previewConfig;if(e.params.exportView&&e.params.exportView!==i.name)return;let o=!(!i.exportConfig.crop||!i.exportConfig.cropConfig.width)&&i.exportConfig.cropConfig,n=i.exportConfig.originalFormat||"png",r=this.export({width:i.width,height:i.height},o,!0,"excludeOriginal",n,.8,!1);r&&this.downloadBlob(r,(e.params.exportName||i.name)+"."+n)}_clearVisibleEditor(){this.settings.editorMode&&(this.visibleEditor={})}_optionLayerUpdate(t){if(t._layer&&t._layer._object){let e=this._canvas.getObjects().indexOf(t._layer._object);return this._canvas.remove(t._layer._object),this._renderLayer(t._layer).then((t=>{this._canvas.moveTo(t,e)}))}}_watchWindowResize(){let t=n.debounced(200,(t=>{this._resizeCanvas(),this.settings.stickyMode&&this._stickyPreview(!0)}));this._resizeCanvas(),window.addEventListener("resize",t)}_watchWindowScroll(){let t=!1;window.addEventListener("scroll",(()=>{t||(this.settings.sticky||this._highlightEl)&&(window.requestAnimationFrame((()=>{this.settings.sticky&&this._stickyPreview(),this._highlightEl&&this._highlight(!0),t=!1})),t=!0)})),this.settings.sticky&&window.addEventListener("preview:active",(()=>this._stickyPreview()))}_watchPreviewActive(){window.addEventListener("preview:active",(()=>this._hideLayerActionsTooltip()))}_getContainerWidth(){let t=this._wrapper.offsetWidth,e=this._wrapper;for(;0===t&&e.parentNode;)e=e.parentNode,e.offsetWidth>0&&(t=n.findInnerDimensions(e).width);return t}_responsiveCanvasHeight(){if(!this.settings.cropMode){let t=0;this._canvas.forEachObject((e=>{if(e.visible&&e._layer&&e._layer.params.responsive){let i=e.getBoundingRect(),o=i.top+i.height;o>t&&(t=o)}}));let e=this.previewConfig.height*this._canvas.getZoom();t>0&&t<e?this._canvas.setHeight(t):this._canvas.setHeight(e)}}_resizeCanvas(){const t=this._canvas.getWidth()/this._canvas.getHeight(),e=this._getContainerWidth();let i=e/this._canvas.getWidth(),o=this._canvas.getZoom()*i;if(1!==o){let n={width:e,height:e/t};this.settings.maxHeight&&n.height>this.settings.maxHeight&&(n.height=this.settings.maxHeight,n.width=n.height*t,i=n.width/this._canvas.getWidth(),o=this._canvas.getZoom()*i),this._canvas.setDimensions(n),this._canvas.setZoom(o)}this._highlightEl&&this._highlight(!0)}_highlight(t){if(io.productCropOverlay&&!n.findParent(this.element,".cl-po--popup-preview")||(t=!1),!t&&this._highlightEl&&(document.body.removeChild(this._highlightEl),delete this._highlightEl,document.body.classList.remove("cl-highlight")),t){let t=!1;this._highlightEl||(this._highlightEl=document.createElement("div"),this._highlightEl.className="cl-po--preview-highlight",t=!0);let e=n.getCalculatedPosition(this._wrapper);const i=20,o=e.right-e.left+i,r=e.bottom-e.top+i;this._highlightEl.style.display="block",this._highlightEl.style.position="absolute",this._highlightEl.style.width=`${o}px`,this._highlightEl.style.height=`${r}px`,this._highlightEl.style.top=e.top-i/2+"px",this._highlightEl.style.left=e.left-i/2+"px",t&&(document.body.appendChild(this._highlightEl),document.body.classList.add("cl-highlight"))}}_stickyPreview(t=!1){let e=this._canvas.lowerCanvasEl,i=e.getBoundingClientRect(),o=this._stickyMaxTop||0;if(i.top>o||!this.active||this.settings.cropMode||this.settings.zoomMode||0===i.width||0===i.height)this.settings.stickyMode&&(s.debug("----\x3e sticky end",e),this.element.removeEventListener("layer:changed",this._syncSticky),this.element.removeEventListener("preview:rendered",this._syncSticky),document.body.removeChild(this._stickyEl),delete this._stickyEl,delete this._stickyImgEl,delete this._stickyTarget,delete this._stickyMaxTop,this.settings.stickyMode=!1);else{let o,r,a=!1,l=window.clStickyMobileSize||this.settings.stickyMobileSize||25;this._stickyTarget=this._stickyTarget||document.querySelector("#"+this.config.uuid);let c=this._stickyTarget.getBoundingClientRect();if(c.top>i.bottom&&window.innerWidth<=768&&(a=!0,o=window.innerHeight/100*l,r="overlay"===this.settings.stickyMobile?o:0),this.settings.stickyMode){let e=this._stickyEl.getBoundingClientRect();if(c.bottom>0){let t=e.height-c.bottom;this._stickyEl.style.top=t>0?-1*t+"px":"0px"}else this._stickyEl.style.top=-1*(e.height+5)+"px";t&&(a?(this._stickyEl.classList.add("mobile"),this._stickyEl.classList.add(this.settings.stickyMobile),this._stickyEl.style.removeProperty("left"),this._stickyEl.style.removeProperty("width"),this._stickyImgEl.style.maxHeight=o+"px",this._stickyMaxTop=-1*(i.height-r)):(this._stickyEl.classList.remove("mobile"),this._stickyImgEl.style.removeProperty("height"),this._stickyEl.style.left=i.left+"px",this._stickyEl.style.width=i.width+"px"))}else if(s.trace("---\x3e sticky check"+c.bottom+" > "+i.bottom),c.bottom>i.bottom){if(a){if(i.bottom>r)return;this._stickyMaxTop=-1*(i.height-r)}this._stickyEl=document.createElement("div"),this._stickyEl.className="cl-po--preview-sticky",this._stickyEl.style.position="fixed",this._stickyImgEl=document.createElement("img"),a?(this._stickyEl.classList.add("mobile"),this._stickyEl.classList.add(this.settings.stickyMobile),this._stickyImgEl.style.maxHeight=o+"px"):(this._stickyEl.style.left=i.left+"px",this._stickyEl.style.width=i.width+"px"),this._stickyEl.style.top="0px",this._stickyEl.addEventListener("click",(t=>{let i=n.getCalculatedPosition(e);window.scroll({top:i.top-50,behavior:"smooth"})})),this._stickyEl.appendChild(this._stickyImgEl),this._syncSticky(),document.body.appendChild(this._stickyEl),this.element.addEventListener("layer:changed",this._syncSticky),this.element.addEventListener("preview:rendered",this._syncSticky),this.settings.stickyMode=!0,s.debug("--\x3e sticky start",this._stickyEl,this._stickyTarget)}}}_syncThemeGallery(){if(io.themeGallery&&!this.settings.editorMode){if(this.shopifyStore.isTheme("Dawn")){let t=n.findParent(this.element,"media-gallery");if(t&&t.setActiveMedia){let e=n.findParent(this.element,".product__media-item");if(e&&e.dataset.mediaId){this.element.scrollIntoView=function(){},t.setActiveMedia(e.dataset.mediaId,!0);let i=n.findParent(this.element,".slider");return i&&i.scrollTo&&(i.scrollLeft=0),window._scrollTo=window._scrollTo||window.scrollTo,void(window.scrollTo=function(){window.scrollTo=window._scrollTo})}}}else if(this.shopifyStore.isTheme("Horizon")){let t=n.findParent(this.element,"slideshow-component");return void(t&&"function"==typeof t.select&&0!==t.current&&t.select(0,new CustomEvent("lpo")))}try{if(!1!==this._themeGalleryImgEl){if(this._themeGalleryVariant&&this.settings.variantId!==this._themeGalleryVariant)return void(this._themeGalleryVariant=this.settings.variantId);if(!this._themeGalleryImgEl)if(void 0===this.previewConfig.views||this.previewConfig.gallery&&!0!==this.config.previewConfig.galleryConfig.hideThumbnails)this._themeGalleryImgEl=!1;else{let e;if(this.settings.product.media&&this.settings.product.media.length){var t=0;for(let e=0;e<this.previewConfig.layers.length;e++){const i=this.previewConfig.layers[e];if("product"===i.type){this._themeGalleryVariant=this.settings.variantId,i.params.imgPos?this.settings.product.media.length>i.params.imgPos-1&&(t=i.params.imgPos-1):i.params.variant&&delete this._themeGalleryVariant;break}}e=this.settings.product.media[t]}if(e){let t,i=n.pathBaseName(e.src,!1);if(this.settings.selectorThumbnail&&(t=document.querySelectorAll(this.settings.selectorThumbnail),s.debug("found "+t.length+" gallery thumbnails with selector: ",this.settings.selectorThumbnail,t)),!t||0===t.length){t=[];let e=document.querySelectorAll('img[src*="'+i+'"], img[data-src*="'+i+'"], img[data-srcset*="'+i+'"]');if(e.length>0)for(let i=0;i<e.length;i++){const o=e[i];let r=n.findParent(o,"form");null!==r&&-1!==r.action.indexOf("cart")||t.push(o)}s.debug("found "+t.length+" gallery thumbnails with src: ",i,t)}if(t.length){let e=Number.MAX_VALUE;for(let o=0;o<t.length;o++){const r=t[o];let s=(r.src&&-1===r.src.indexOf("data:")?r.src:null)||r.dataset.src||r.dataset.srcset,a=n.pathBaseName(s,!1);a=this.shopifyStore.stripImageDimension(a);let l=a.replace(i,"").length;l<e&&(e=l,this._themeGalleryImgEl=r)}s.debug("selected theme gallery thumbnail: ",this._themeGalleryImgEl)}}}if(this._themeGalleryImgEl&&this._themeGalleryImgEl.click){let t=n.isHidden(this._wrapper);io.themeGalleryTimeout?setTimeout((()=>this._themeGalleryImgEl.click()),300):this._themeGalleryImgEl.click(),t&&setTimeout((()=>window.dispatchEvent(new Event("resize"))),500)}}}catch(t){s.error("error syncing theme gallery ",t)}}}_triggerEvent(t,e){const i=new CustomEvent(t,{detail:e,cancelable:!0,bubbles:!0});this.element.dispatchEvent(i)}_patchCanvasTouchScroll(){window.clCanvasTouchStart||(window.clCanvasTouchStart=fabric.Canvas.prototype._onTouchStart,fabric.util.object.extend(fabric.Canvas.prototype,{_onTouchStart:function(t){var e=this.findTarget(t);(!this.allowTouchScrolling||e||this.isDrawingMode)&&window.clCanvasTouchStart.call(this,t)}}))}_updateCanvasControls(){var t="#b2ccff";const e=t=>("#"===t.charAt(0)&&(t="%23"+t.substring(1)),"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' width='24' height='24'%3E%3Cpath d='M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10-4.477 10-10 10zm4.82-4.924a7 7 0 1 0-1.852 1.266l-.975-1.755A5 5 0 1 1 17 12h-3l2.82 5.076z' fill='"+t+"'/%3E%3C/svg%3E"),i=(t,e,i,n,r)=>{t.save(),t.translate(e,i),t.rotate(fabric.util.degreesToRadians(n.angle)),t.drawImage(o,-r/2,-r/2,r,r),t.restore()};var o=document.createElement("img");o.src=e(t),o.dataset.fill=t,fabric.Object.prototype.controls.mtr=new fabric.Control({x:0,y:-.5,offsetY:-40,cursorStyle:"crosshair",actionHandler:fabric.controlsUtils.rotationWithSnapping,actionName:"rotate",render:function(t,n,r,s,a){const l=1.5*a.cornerSize;o.dataset.fill!=t.fillStyle&&(o.onload=function(){i(t,n,r,a,l)},o.dataset.fill=t.fillStyle,o.src=e(t.fillStyle)),i(t,n,r,!1,l)},cornerSize:28,withConnection:!0})}_watchZoom(){let t=this._canvas.getElement(),e=t.parentElement;this.settings.zoom.factor>fabric.devicePixelRatio&&(fabric.devicePixelRatio=Math.min(4,this.settings.zoom.factor));const i=i=>{if(!this.settings.zoomMode){e.style.width=t.style.width,e.style.height=t.style.height;let i=this._canvas.enableRetinaScaling?fabric.devicePixelRatio:1,o=t.width/i*this.settings.zoom.factor,n=t.height/i*this.settings.zoom.factor,r=e.offsetWidth,a=e.offsetHeight;this._zoomCalc={xRatio:(e.offsetWidth-o)/r,yRatio:(e.offsetHeight-n)/a,offset:e.getBoundingClientRect()},t.style.width=o+"px",t.style.height=o+"px",e.classList.add("cl-po--zoom"),this.settings.zoomMode=!0,s.debug("----\x3e zoom start",t,this._zoomCalc)}let o,n;if("touchstart"==i.type||"touchmove"==i.type){let t=i.touches[0]||i.changedTouches[0];o=t.pageX-this._zoomCalc.offset.left,n=t.pageY-this._zoomCalc.offset.top,i.preventDefault()}else o=i.pageX-this._zoomCalc.offset.left,n=i.pageY-this._zoomCalc.offset.top;t.style.left=o*this._zoomCalc.xRatio+"px",t.style.top=n*this._zoomCalc.yRatio+"px"},o=i=>{e.classList.remove("cl-po--zoom"),t.style.width=e.style.width,t.style.height=e.style.height,e.style.width="",e.style.height="",t.style.left="",t.style.top="",this.settings.zoomMode=!1,s.debug("----\x3e zoom end",t)};t.addEventListener("mousemove",i),t.addEventListener("mouseleave",o),fabric.isTouchSupported&&this.settings.zoom.mobile&&(t.addEventListener("touchstart",i),t.addEventListener("touchmove",i),t.addEventListener("touchend",o))}_initLayerActionsTooltip(t){const e=this._createLayerActionsContent(t);this._layerActionsTippy=gi(document.createElement("div"),{content:e,allowHTML:!0,interactive:!0,theme:"cl-actions",trigger:"manual",placement:"bottom",appendTo:document.body,offset:[0,8],hideOnClick:!1,zIndex:9999,getReferenceClientRect:()=>this._getLayerActionsRect(),onHide:()=>{this._currentActionsLayer=null}})}_createLayerActionsContent(t){const e=document.createElement("div");e.className="cl-layer-actions";const i=t.params.interactiveActions,o=!0===i?{edit:!0,duplicate:!0,delete:!0,center:!0,index:!0}:i;return e.innerHTML=`\n            ${o.edit?'\n            <button type="button" class="cl-layer-action" data-action="edit" title="Edit">\n                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18">\n                    <path d="M15.7279 9.57627L14.3137 8.16206L5 17.4758V18.89H6.41421L15.7279 9.57627ZM17.1421 8.16206L18.5563 6.74785L17.1421 5.33363L15.7279 6.74785L17.1421 8.16206ZM7.24264 20.89H3V16.6473L16.435 3.21231C16.8256 2.82179 17.4587 2.82179 17.8492 3.21231L20.6777 6.04074C21.0682 6.43126 21.0682 7.06443 20.6777 7.45495L7.24264 20.89Z" fill="currentColor"/>\n                </svg>\n            </button>':""}\n            ${o.center?'\n            <button type="button" class="cl-layer-action" data-action="centerH" title="Center Horizontal">\n                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18">\n                    <path d="M11 2H13V7H21V10H13V14H18V17H13V22H11V17H6V14H11V10H3V7H11V2Z" fill="currentColor"/>\n                </svg>\n            </button>':""}\n            ${o.center?'\n            <button type="button" class="cl-layer-action" data-action="centerV" title="Center Vertical">\n                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18">\n                    <path d="M22 11V13H17V21H14V13H10V18H7V13H2V11H7V6H10V11H14V3H17V11H22Z" fill="currentColor"/>\n                </svg>\n            </button>':""}\n            ${o.index?'\n            <button type="button" class="cl-layer-action" data-action="indexDown" title="Send Backward">\n                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18">\n                <path d="M14 3C14.5523 3 15 3.44772 15 4V9H20C20.5523 9 21 9.44772 21 10V20C21 20.5523 20.5523 21 20 21H10C9.44772 21 9 20.5523 9 20V15H4C3.44772 15 3 14.5523 3 14V4C3 3.44772 3.44772 3 4 3H14ZM13 5H5V13H9V10C9 9.44772 9.44772 9 10 9H13V5Z" fill="currentColor"></path>\n                </svg>\n            </button>':""}\n            ${o.index?'\n            <button type="button" class="cl-layer-action" data-action="indexUp" title="Bring Forward">\n              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18">\n                <path d="M14 3C14.5523 3 15 3.44772 15 4V9H20C20.5523 9 21 9.44772 21 10V20C21 20.5523 20.5523 21 20 21H10C9.44772 21 9 20.5523 9 20V15H4C3.44772 15 3 14.5523 3 14V4C3 3.44772 3.44772 3 4 3H14ZM13 5H5V13H13V5Z" fill="currentColor"></path>\n              </svg>\n            </button>':""}\n            ${o.duplicate?'\n            <button type="button" class="cl-layer-action" data-action="duplicate" title="Duplicate">\n                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18">\n                    <path d="M6.9998 6V3C6.9998 2.44772 7.44752 2 7.9998 2H19.9998C20.5521 2 20.9998 2.44772 20.9998 3V17C20.9998 17.5523 20.5521 18 19.9998 18H16.9998V20.9991C16.9998 21.5519 16.5499 22 15.993 22H4.00666C3.45059 22 3 21.5554 3 20.9991L3.0026 7.00087C3.0027 6.44811 3.45264 6 4.00942 6H6.9998ZM5.00242 8L5.00019 20H14.9998V8H5.00242ZM8.9998 6H16.9998V16H18.9998V4H8.9998V6Z" fill="currentColor"/>\n                </svg>\n            </button>':""}\n            ${o.delete?'\n            <button type="button" class="cl-layer-action cl-layer-action-delete" data-action="delete" title="Delete">\n                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18">\n                    <path d="M17 6H22V8H20V21C20 21.5523 19.5523 22 19 22H5C4.44772 22 4 21.5523 4 21V8H2V6H7V3C7 2.44772 7.44772 2 8 2H16C16.5523 2 17 2.44772 17 3V6ZM18 8H6V20H18V8ZM9 11H11V17H9V11ZM13 11H15V17H13V11ZM9 4V6H15V4H9Z" fill="currentColor"/>\n                </svg>\n            </button>':""}\n        `,e.querySelectorAll(".cl-layer-action").forEach((t=>{t.addEventListener("click",(e=>{e.stopPropagation(),this._handleLayerAction(t.dataset.action)}))})),e}_getLayerActionsRect(){if(!this._currentActionsLayer||!this._currentActionsLayer._object)return{top:0,left:0,bottom:0,right:0,width:0,height:0};const t=this._currentActionsLayer._object,e=t.hasControls?t.getBoundingRect():t.getBoundingRect(!1,!0),i=this._canvas.lowerCanvasEl.getBoundingClientRect();let o=i.left+e.left+e.width/2,n=i.top+e.top+e.height+4;return o=Math.max(i.left+60,Math.min(o,i.right-60)),n=Math.max(i.top,Math.min(n,i.bottom-40)),{top:n,left:o,bottom:n,right:o,width:0,height:0}}_showLayerActionsTooltip(t){if(t?.params?.interactiveActions&&this.active){if(!this.settings.cropMode){if(this._currentActionsLayer=t,this._layerActionsTippy){const e=this._createLayerActionsContent(t);this._layerActionsTippy.setContent(e)}else this._initLayerActionsTooltip(t);this._layerActionsTippy.show()}}else this._hideLayerActionsTooltip()}_hideLayerActionsTooltip(){this._layerActionsTippy&&this._layerActionsTippy.hide(),this._currentActionsLayer=null}_updateLayerActionsPosition(){this._layerActionsTippy&&this._layerActionsTippy.state.isVisible&&this._layerActionsTippy.popperInstance?.update()}_handleLayerAction(t){const e=this._currentActionsLayer;e&&(this._triggerEvent(`layer:action:${t}`,e),"delete"!==t&&"duplicate"!==t||this._hideLayerActionsTooltip())}_centerLayer(t,e){if(!t?._object)return;const i=this._renderContext(),o=mn.getRefDimensions(t,i),n=mn.getRefCoordinates(t,i),r=t._object;if("horizontal"===e){const t=n.x+o.width/2,e=r.getScaledWidth();r.set("left",t-e/2),r.setCoords()}else{const t=n.y+o.height/2,e=r.getScaledHeight();r.set("top",t-e/2),r.setCoords()}t.params.x=r.left,t.params.y=r.top,this._canvas.renderAll(),this._triggerEvent("layer:centered",t)}_destroyLayerActionsTooltip(){this._layerActionsTippy&&(this._layerActionsTippy.destroy(),this._layerActionsTippy=null),this._currentActionsLayer=null}constructor(t,e,i,o,r){wn(this,"_syncSticky",(()=>{let t={format:"png",multiplier:this.previewConfig.width/this._canvas.getWidth()};this._stickyImgEl.src=this._canvas.toDataURL(t),this._canvas.requestRenderAll()}));let a={api:"https://api.cloudlift.app",assets:"https://assets.cloudlift.app",queryParams:{},selector:".cl-preview",selectorThumbnail:"",position:"",classNamePrefix:"cl-po",product:{},variantId:null,editorMode:!1,editLayer:mn.editLayer,cropMode:!1,cropLayer:"",sticky:!1,stickyMobile:"overlay",stickyMobileSize:25,stickyMode:!1,maxHeight:0,zoom:{enabled:!1,factor:2,mobile:!0},zoomMode:!1};this.config=t,this.previewConfig=e,this.active=!0,this.settings=n.extend(a,r||{}),this.visible={},this.visibleEditor={},this.shopifyStore=u.getInstance(),this._productForm=i,this.conditionsEngine=o,this._layerActionsTippy=null,this._currentActionsLayer=null,null!==this.settings.selector&&(n.isElement(this.settings.selector)?this.element=this.settings.selector:this.element=document.querySelector(this.settings.selector)),null!=this.element?(s.info("--\x3e new product-preview: ",this.element),this.resources=[this.settings.assets+"/static/lib/fabricjs/fabric.min.js"],this.ready=nn.loadOnce(this.resources,"product-preview",{async:!1}).then((()=>this._init()))):s.warn("no elements with selector found: ",this.settings.selector)}};class ir{static generateId(){return Date.now().toString()}static getItem(t){return ir.storage.hasOwnProperty(t)||(ir.storage[t]=ir.parseItem(t)),ir.storage[t]}static storeItem(t,e){ir.storage[t]=e,window.localStorage&&localStorage.setItem(ir.keyPrefix+t,JSON.stringify(e))}static parseItem(t){if(window.localStorage){let e=localStorage.getItem(ir.keyPrefix+t);if(e)return JSON.parse(e)}return{}}}ir.storage={},ir.keyPrefix="cl_";var or=ir;var nr=class{_init(){let t=[],e=null,i=document.querySelector("[data-live-variant-options-ids]");i&&(i.hasAttribute("data-variant-observer")&&(io.productVariantObserver=!0,this.observerParent=i.getAttribute("data-variant-observer")),e=JSON.parse(i.textContent));for(let i=0;i<this.settings.product.options.length;i++){const o=this.settings.product.options[i];let r={name:o.name,label:o.name,type:"select",id:"option_"+this.settings.product.id+"_"+o.name.replace(/^[^a-zA-Z]+|[^\w]+/g,""),params:{name:"v_"+o.name},visible:!0,values:[],_variantOption:o,_themeEl:null};if(e?.hasOwnProperty(o.position)){const t=e[o.position];o.valuesIds=[];for(let e=0;e<o.values.length;e++){const i=o.values[e];for(let e=0;e<t.length;e++){const n=t[e];if(n.name===i){o.valuesIds.push(String(n.id));break}}}}let s=!1;for(let t=0;t<this.config.variantOptions.length;t++){let e=this.config.variantOptions[t];if(e.name===o.name){n.merge(r,e),s=!0;break}}s||this.config.variantOptions.length>i&&n.merge(r,this.config.variantOptions[i]),this.settings.variant.id?r.value=this.settings.variant["option"+o.position]:r.value=o.values[0];let a=r.values.length>0,l=[];for(let t=0;t<o.values.length;t++){let e=o.values[t],i=null;if(a)for(let t=0;t<r.values.length;t++){const o=r.values[t];if(o&&o.value===e){i=o;break}}i||(i={text:e,value:e},a&&r.values.length>t&&r.values[t].img&&(i.img=r.values[t].img)),l.push(i)}r.values=l,t.push(r)}this.config.variantOptions=t,this.settings.editorMode||this.resolveThemeElements()}resolveThemeElements(t=!1){for(let e=0;e<this.config.variantOptions.length;e++){const i=this.config.variantOptions[e],o=i._variantOption;if(i._themeEl=this._productForm.querySelectorAll('[data-live-variant-option="'+o.position+'"]'),0===i._themeEl.length?i._themeEl=null:1===i._themeEl.length&&"SELECT"===i._themeEl[0].tagName&&(i._themeEl=i._themeEl[0]),!i._themeEl){let e=this._productForm.querySelectorAll("select");t&&(e=Array.from(e).filter((t=>null===t.closest(".cl-po--option"))));const n=t=>{if(t.length===o.values.length){for(let e=0;e<t.length;e++){const i=t[e];if(-1===o.values.indexOf(i)){if(o.valuesIds&&-1!==o.valuesIds.indexOf(i)){this._idMatch=!0;continue}return!1}}return!0}return!1};for(let t=0;t<e.length;t++){const r=e[t];if(o.name&&r.getAttribute("name")?.includes(o.name)){i._themeEl=r;break}if(r.dataset.index&&-1!==r.dataset.index.indexOf(o.position.toString())){i._themeEl=r;break}{let t=[],e=r.querySelectorAll("option");for(let i=0;i<e.length;i++){const o=e[i];t.push(this._decodeValue(o.value))}n(t)&&(i._themeEl=r)}}if(!i._themeEl){let e=this._productForm.querySelectorAll("input[type=radio]");t&&(e=Array.from(e).filter((t=>null===t.closest(".cl-po--option"))));let r=[];for(let t=0;t<e.length;t++){const s=e[t];if(-1===r.indexOf(s.name)){let t;r.push(s.name);const e=s.name.trim();if(t=e!==s.name?this._productForm.querySelectorAll('input[name*="'+e+'"]'):this._productForm.querySelectorAll('input[name="'+e+'"]'),o.name&&s.getAttribute("name")?.includes(o.name)){i._themeEl=t;break}if(s.dataset.index&&-1!==s.dataset.index.indexOf(o.position.toString())){i._themeEl=t;break}{let e=[];for(let i=0;i<t.length;i++){const o=t[i];e.push(this._decodeValue(o.value))}if(n(e)){i._themeEl=t;break}}}}}}if(i._themeEl&&io.productVariantHide){let t=i._themeEl;n.isNodeList(i._themeEl)&&(t=t[0]);let e=t;for(;e.parentNode!==this._productForm&&-1===e.textContent.indexOf(o.name);)e=e.parentNode;e.style.display="none"}s.debug("resolved theme variantOption",i)}let e=this._productForm.querySelector("[data-live-variant-options]");null!=e&&(e.style.display="none")}watchVariantElements(){const t=()=>this.config.variantOptions.filter((t=>t._themeEl)).map((t=>n.isNodeList(t._themeEl)?t._themeEl[0]:t._themeEl));let e=null,i=t();if(i.length)if(this.observerParent)e=i[0].closest(this.observerParent);else{if(e=i[0].closest("variant-selects, variant-picker"),e=e?.closest('[data-block-type="variant-picker"]')||e,!e)for(e=i[0].parentNode;e!==document.body;){let t=!0;for(let o=0;o<i.length;o++)if(!e.contains(i[o])){t=!1;break}if(t)break;e=e.parentNode}e=e?.parentNode}e&&(this.observer=new MutationObserver((e=>{for(const o of e)if("childList"===o.type&&o.removedNodes.length)for(let e=0;e<o.removedNodes.length;e++){if(1===o.removedNodes.length&&(1!==o.removedNodes[0].nodeType||"STYLE"===o.removedNodes[0].tagName))continue;const e=Array.from(o.removedNodes);for(let o=0;o<i.length;o++){const n=i[o];if(e.indexOf(n)>-1||e.some((t=>t.contains(n))))return s.trace("variant option removed",n),this.resolveThemeElements(!0),void(i=t())}}})),s.debug("watching variant elements",e),this.observer.observe(e,{subtree:!0,childList:!0}))}syncVariantChanges(t){if(t._themeEl){const e=e=>{if(t._variantOption.valuesIds){let i=t._variantOption.values.indexOf(e);if(-1!==i)return t._variantOption.valuesIds[i]}return e},i=(t,i)=>t.value==i||this._decode&&this._decodeValue(t.value)==i||this._idMatch&&t.value==e(i);if(n.isNodeList(t._themeEl))for(let e=0;e<t._themeEl.length;e++){const o=t._themeEl[e];if(i(o,t.value)){o.checked=!0,o.dispatchEvent(new Event("change",{bubbles:!0}));break}}else if("SELECT"===t._themeEl.tagName){for(let e=0;e<t._themeEl.options.length;e++){if(i(t._themeEl.options[e],t.value)){t._themeEl.selectedIndex=e;break}}t._themeEl.dispatchEvent(new Event("change",{bubbles:!0}))}}}syncAllVariantOptions(){for(let t=0;t<this.config.variantOptions.length;t++){const e=this.config.variantOptions[t];this.syncVariantChanges(e)}}findSelectedVariant(){this.settings.variant=null;for(let t=0;t<this.settings.product.variants.length;t++){const e=this.settings.product.variants[t];let i=!0;for(let t=0;t<this.config.variantOptions.length;t++){const o=this.config.variantOptions[t];if(e["option"+o._variantOption.position]!=o.value){i=!1;break}}if(i){this.settings.variant=e;break}}return this.settings.variant}resetVariant(t){let e=null,i=-1;for(let o=0;o<this.settings.product.variants.length;o++){const n=this.settings.product.variants[o];if(!n.available)continue;let r=!0,s=0;for(let o=0;o<this.config.variantOptions.length;o++){const a=this.config.variantOptions[o];if(n["option"+a._variantOption.position]!=a.value){if(r=!1,0===s)break}else s++,t&&t.value==a.value&&s++,s>i&&(e=n,i=s)}}this.settings.variant=e||this.settings.product.variants[0];for(let t=0;t<this.config.variantOptions.length;t++){const e=this.config.variantOptions[t];let i="option"+e._variantOption.position;e.value=this.settings.variant[i]}}filterVariantValues(){let t={};for(let e=0;e<this.config.variantOptions.length;e++){const i=this.config.variantOptions[e];let o="option"+i._variantOption.position,n=i._values||i.values,r=[];for(let e=0;e<n.length;e++){const i=n[e];let s=!1;for(let e=0;e<this.settings.product.variants.length;e++){const n=this.settings.product.variants[e];let r=!0;for(const e in t)if(t.hasOwnProperty(e)&&t[e]!==n[e]){r=!1;break}if(r&&n[o]===i.value&&(s=!0,i.available=n.available,n.available))break}s&&r.push(i)}i._values=n,i.values=r,t[o]=i.value}}_decodeValue(t){let e=t.split("Special_Double_Quote").join('"').split("Special_Slash").join("/");return e!==t?(this._decode=!0,e):t}constructor(t,e,i){this.settings=n.extend({product:{},variant:{},editorMode:!1},i||{}),this.config=t,this._productForm=e,this._init(),"function"==typeof HTMLUpdateUtility?(io.productVariantObserver=!0,n.addStyleElement("variant-selects {display:none!important;}")):u.getInstance().isTheme("Horizon")&&n.addStyleElement("variant-picker {display:none!important;}"),window.clVariantObserverParent&&(io.productVariantObserver=!0,this.observerParent=window.clVariantObserverParent),io.productVariantObserver&&!this.settings.editorMode&&this.watchVariantElements()}};const rr=t=>{if(window.Shopify){function e(){setTimeout((function(){window.ShopifyXR.addModels([t]),window.ShopifyXR.setupXRElements()}),1e3)}window.ShopifyXR?e():window.Shopify.loadFeatures([{name:"shopify-xr",version:"1.0",onLoad:e}])}for(var i,o=t.sources.length-1;o>=0&&"glb"!==(i=t.sources[o]).format;o--);return et`<div class="cl-embed" style="padding-top: 100%;"><model-viewer toggleable="true" src=${i.url} poster=${t.preview_image.src} camera-controls="true" style="--poster-color: transparent;" data-shopify-feature="1.12"></model-viewer></div>
        ${!1!==window.clGalleryXR?et`<button class="button button--full-width product__xr-button cl-xr-button" type="button" data-shopify-xr="" data-shopify-title="Model" data-shopify-model3d-id=${t.id} data-shopify-xr-hidden="">
                <svg xmlns="http://www.w3.org/2000/svg" focusable="false" fill="none" viewBox="0 0 18 21"><path d="M7.67998 20.629L1.28002 16.723C0.886205 16.4784 0.561675 16.1368 0.337572 15.731C0.113468 15.3251 -0.00274623 14.8686 -1.39464e-05 14.405V6.59497C-0.00238367 6.13167 0.113819 5.6755 0.33751 5.26978C0.561202 4.86405 0.884959 4.52227 1.278 4.27698L7.67796 0.377014C8.07524 0.131403 8.53292 0.000877102 8.99999 9.73346e-08C9.46678 -0.000129605 9.92446 0.129369 10.322 0.374024V0.374024L16.722 4.27399C17.1163 4.51985 17.4409 4.86287 17.6647 5.27014C17.8885 5.67742 18.0039 6.13529 18 6.59998V14.409C18.0026 14.8725 17.8864 15.3289 17.6625 15.7347C17.4386 16.1405 17.1145 16.4821 16.721 16.727L10.321 20.633C9.92264 20.8742 9.46565 21.0012 8.99999 21C8.53428 20.9998 8.07761 20.8714 7.67998 20.629V20.629ZM8.72398 2.078L2.32396 5.97803C2.22303 6.04453 2.14066 6.13551 2.08452 6.24255C2.02838 6.34959 2.00031 6.46919 2.00298 6.59003V14.4C2.00026 14.5205 2.02818 14.6396 2.08415 14.7463C2.14013 14.853 2.22233 14.9438 2.32298 15.01L7.99999 18.48V10.919C8.00113 10.5997 8.08851 10.2867 8.25292 10.0129C8.41732 9.73922 8.65267 9.51501 8.93401 9.36401L15.446 5.841L9.28001 2.08002C9.19614 2.02738 9.09901 1.99962 8.99999 2C8.90251 1.99972 8.8069 2.02674 8.72398 2.078V2.078Z" fill="currentColor"></path></svg>
                ${window.clGalleryXRText||"View in your space"}
            </button>`:null}`};var sr=(t,e)=>et`
<div class="cl-po--gallery ${e.layout}">

    <div class="splide cl-po--gallery-main  ${Zo({"hide-thumb-mobile":e.hideThumbnailsMobile})}">
        <div class="splide__track">
            <div class="splide__list">
                ${Ii(t,(t=>t.id),((t,i)=>et`
                    <div class="splide__slide" style=${Ko({aspectRatio:t.aspect_ratio})}>
                        ${"video"===t.media_type||"external_video"===t.media_type||"model"===t.media_type?et`<div class="cl-po--gallery-img" data-media-position=${t.position} >${(t=>{if("model"===t.media_type)return rr(t);var e=void 0!==window.clGalleryAutoplay&&window.clGalleryAutoplay,i={paddingBottom:1/t.aspect_ratio*100+"%"};if("external_video"===t.media_type){if("youtube"===t.host)return et`<div class="cl-embed" style=${Ko(i)}><iframe src="https://www.youtube.com/embed/${t.external_id}?controls=1&amp;enablejsapi=1&amp;modestbranding=1&amp;playsinline=1&amp;rel=0&amp;autoplay=${e?"1":"0"}" loading="lazy" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="allowfullscreen"></iframe></div>`;if("vimeo"===t.host)return et`<div class="cl-embed" style=${Ko(i)}><iframe src="https://player.vimeo.com/video/${t.external_id}?byline=0&amp;controls=1&amp;playsinline=1&amp;title=0" loading="lazy" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="allowfullscreen" ></iframe></div>`}for(var o=[],n=[],r=t.sources.length-1;r>=0;r--){var s=t.sources[r];-1===n.indexOf(s.mime_type)&&(o.push(s),n.push(s.mime_type))}return et`<div class="cl-embed" style=${Ko(i)}><video autoplay=${Pi(e?"autoplay":void 0)} loop=${Pi(e?"loop":void 0)} muted="muted" playsinline="playsinline" controls="controls" preload="none" poster="${t.preview_image.src}">
        ${Ii(o,(t=>et`
            <source src="${t.url}" type="${t.mime_type}">
        `))}
    </video></div>`})(t)}</div>`:et`<img class="cl-po--gallery-img" data-splide-lazy=${((t,e)=>{if(e.width>0){const i=Math.max(window.devicePixelRatio||1,2);let o=e.width*i;return o=200*Math.ceil(o/200),o=Math.min(o,e.maxWidth),go(t,o+"x")}return t})(t.src,e)} alt=${t.alt} data-media-position=${t.position} />`}
                    </div>
                `))}
            </div>
        </div>
    </div>
    ${e.hideThumbnails?null:et`
        <div class="splide cl-po--gallery-thumbnails ${Zo({"cl-hide-mobile":e.hideThumbnailsMobile})}">
            <div class="splide__track">
                <div class="splide__list">
                    ${Ii(t,(t=>t.id),((t,e)=>et`
                    <div class="splide__slide">
                        <img class="cl-po--gallery-thumbnail" data-splide-lazy=${go(t.src||t.preview_image.src,"200x")} alt=${t.alt} data-media-position=${t.position} />
                    </div>
                `))}
                </div>
            </div>
        </div>
    `}
</div>
`;var ar=class{destroy(){if(this._previews)for(let t=0;t<this._previews.length;t++){this._previews[t].destroy()}this.element.removeChild(this._wrapper)}render(){tt(sr(this.media,this.settings.galleryConfig),this._wrapper)}selectPreview(t){this._splideThumbnails.go(this._getMediaIndex(t))}_init(){this._wrapper=document.createElement("div"),this._wrapper.className=this.settings.classNamePrefix+"--gallery-wrapper",this._wrapper.setAttribute("id",this.config.uuid+"_gallery"),this._wrapper.style.width="100%",this.settings.position?(this.element.insertAdjacentElement(this.settings.position,this._wrapper),this.element!==this._wrapper.parentNode&&(this.element=this._wrapper.parentNode)):this.element.appendChild(this._wrapper),io.themeGallery=!1;let t=[this.config.previewConfig];if(this.config.previewConfig.views.length&&t.push(...this.config.previewConfig.views),this._filterProductMedia(t),this.settings.galleryConfig.loader&&this._addLoader(),this.settings.galleryConfig.width=this.element.offsetWidth,0===this.settings.galleryConfig.width&&s.warn("gallery width is 0px media images will not be scaled"),this.render(),this._splideMain=new Splide(this._wrapper.querySelector("."+this.settings.classNamePrefix+"--gallery-main"),{type:"fade",keyboard:"focused",lazyLoad:"nearby",preloadPages:1,drag:!this.settings.editorMode&&!this.settings.galleryConfig.hideThumbnails,rewind:this.settings.galleryConfig.arrows,arrows:this.settings.galleryConfig.arrows,pagination:this.settings.galleryConfig.pagination||this.settings.galleryConfig.paginationMobile,classes:{pagination:"splide__pagination"+(this.settings.galleryConfig.paginationMobile?" mobile":"")}}),this._splideMain.on("lazyload:loaded",((t,e)=>{requestAnimationFrame((()=>{e.slide.querySelector("img")&&(e.slide.style.aspectRatio="")}))})),this.settings.galleryConfig.hideThumbnails)this._splideThumbnails={go:t=>{this._splideMain.go(t),this._selectPreview(t)}},this._splideMain.mount();else{let t="left"===this.settings.galleryConfig.layout||"right"===this.settings.galleryConfig.layout?"ttb":"ltr",e="sequential",i=1;if(this._wrapper.offsetWidth&&!1!==window.clGalleryThumbLazy){let o=window.innerWidth>768?100:66;i=Math.ceil(this._wrapper.offsetWidth/o),"ttb"!==t&&(i=Math.max(i-2,1)),this.media.length>i&&(e="nearby")}this._splideThumbnails=new Splide(this._wrapper.querySelector("."+this.settings.classNamePrefix+"--gallery-thumbnails"),{keyboard:"focused",lazyLoad:e,preloadPages:i,autoWidth:!0,fixedHeight:100,height:"ttb"===t?window.innerWidth>768?600:200:0,direction:t,rewind:this.settings.galleryConfig.arrows,gap:3,arrows:this.settings.galleryConfig.arrowsThumbnails,pagination:this.settings.galleryConfig.paginationThumbnails,isNavigation:!0,breakpoints:{600:{fixedHeight:66}},drag:!1!==window.clGalleryThumbnailDrag,dragMinThreshold:{mouse:30,touch:10}}),this._splideThumbnails.mount(),this._splideMain.sync(this._splideThumbnails).mount(),this._splideThumbnails.on("moved",((t,e)=>{this._selectPreview(t)}))}let e=[];for(let i=0;i<t.length;i++){let o=t[i],n=this._wrapper.querySelector("."+this.settings.classNamePrefix+'--gallery-main [data-media-position="'+o.position+'"]');if(n){let t=n.parentNode;t.removeChild(n);let r=new er(this.config,o,this._productForm,this.conditionsEngine,{api:this.settings.api,assets:this.settings.assets,selector:t,selectorThumbnail:this.settings.selectorThumbnail,sticky:this.settings.sticky,stickyMobile:this.settings.stickyMobile,stickyMobileSize:this.settings.stickyMobileSize,zoom:this.settings.zoom,maxHeight:this.settings.maxHeight,product:this.settings.product,variantId:this.settings.variantId,editorMode:this.settings.editorMode});r.active=1===o.position,0===i&&this.settings.galleryConfig.previewActive&&isNaN(this.settings.galleryConfig.position)&&(r.active=!0),r.active&&(this._preview=r),this.settings.galleryConfig.hideThumbnails||(r._thumbnailEl=this._wrapper.querySelector("."+this.settings.classNamePrefix+'--gallery-thumbnails [data-media-position="'+o.position+'"]')),e.push(r.ready.then((()=>{if(r.element.addEventListener("preview:rendered",(()=>{requestAnimationFrame((()=>{r.element.closest(".splide__slide").style.aspectRatio=""}))}),{once:!0}),r._thumbnailEl){const t=t=>{let e={format:"png",multiplier:200/r._canvas.getHeight()};r._thumbnailEl.src=r._canvas.toDataURL(e),r._canvas.requestRenderAll()};r.element.addEventListener("layer:changed",t),r.element.addEventListener("preview:rendered",t)}}))),this._previews.push(r)}else s.warn("[live-options] gallery - missing media image for view: ",o)}return this._watchFormChanges(),this._splideMain.options.drag&&!this._isStatic(t)&&this._watchPreviewChanges(),this.settings.editorMode&&window.clProductGalleryPosition?(this.selectPreview(window.clProductGalleryPosition),delete window.clProductGalleryPosition):isNaN(this.settings.galleryConfig.position)?this._selectVariantThumbnail(this._getVariantById(this.settings.variantId)):this.selectPreview(this.settings.galleryConfig.position),!this._preview&&this._previews.length&&(this._preview=this._previews[0]),Promise.all(e)}_filterProductMedia(t){this.media=this.settings.product.media.filter((t=>-1===this.settings.galleryConfig.exclude.indexOf(t.position))),this.settings.galleryConfig.hideThumbnails&&(this.media=this.media.filter((e=>{for(let i=0;i<t.length;i++){if(t[i].position===e.position)return!0}return!1})))}_getMediaIndex(t){for(let e=0;e<this.media.length;e++)if(this.media[e].position===t)return e;return-1}_getMediaPosition(t){return t<this.media.length?this.media[t].position:-1}_selectPreview(t){if(this.media.length>t){let e=this.media[t];!this.settings.galleryConfig.previewActive&&this._preview&&(this._preview.active=!1);for(let t=0;t<this._previews.length;t++){const i=this._previews[t];if(i.previewConfig.position===e.position){this._preview&&(this._preview.active=!1),this._preview=i,this._preview.active=!0,this._triggerEvent("preview:active",{position:e.position});break}}"model"===e.media_type?this._splideMain.Components.Drag.disabled||(this._DragRestore=!0,this._splideMain.Components.Drag.disable(!0)):this._DragRestore&&(this._splideMain.Components.Drag.disable(!1),delete this._DragRestore)}}_selectVariantThumbnail(t){if(this._preview&&this._preview.active){let t=this._findProductLayer(this._preview.previewConfig);if(t&&t.params.variant&&!t.params.imgPos)return void(this.settings.galleryConfig.previewActive&&this._splideThumbnails.go(this._getMediaIndex(this._preview.previewConfig.position)))}if(t&&(t.featured_media||t.featured_image)){let e=t.featured_media||t.featured_image,i=this._getMediaIndex(e.position);if(-1!==i)this._splideThumbnails.go(i);else for(let t=0;t<this._previews.length;t++){const e=this._previews[t];let o=this._findProductLayer(e.previewConfig);if(o&&o.params.variant&&(i=this._getMediaIndex(e.previewConfig.position),-1!==i))return void this._splideThumbnails.go(i)}}}_findProductLayer(t){for(let e=0;e<t.layers.length;e++){const i=t.layers[e];if("product"===i.type)return i}return null}_watchFormChanges(){this._productForm&&(this._productForm.addEventListener("option:changed",(t=>this._optionChanged(t))),this._productForm.addEventListener("option:crop",(t=>this._optionChanged(t))),this._productForm.addEventListener("option:variant_changed",(t=>this._variantChanged(t))))}_watchPreviewChanges(){this.element.addEventListener("preview:rendered",(t=>this._checkInteractive(t))),this.element.addEventListener("preview:active",(t=>this._checkInteractive(t)))}_variantChanged(t){this.settings.variantId=t.detail.variantId,this._selectVariantThumbnail(this._getVariantById(this.settings.variantId))}_optionChanged(t){let e=t.detail,i=-1,o=-1,n=this._getMediaPosition(this._splideMain.index);for(let t=0;t<this._previews.length;t++){const r=this._previews[t];if(r._canvas){let t=r._canvas.getObjects();for(let n=0;n<t.length;n++){const s=t[n];if(s._layer&&s._layer.params.option===e.name){r.previewConfig.position!==i&&(i=r.previewConfig.position,-1===o&&(o=i));break}}}if(-1===i){for(let t=0;t<r.previewConfig.layers.length;t++){if(r.previewConfig.layers[t].params.option===e.name){r.previewConfig.position!==i&&(i=r.previewConfig.position,-1===o&&(o=i));break}}if(-1===i)for(let t=0;t<r.previewConfig.layers.length;t++){const n=r.previewConfig.layers[t];if(n.conditions.length){let t=!1;for(let s=0;s<n.conditions.length;s++){const a=n.conditions[s];if(a.field===e.name&&this.conditionsEngine.evaluateOptionCondition(a,[e])&&r.previewConfig.position!==i){if(n.conditions.length>1&&!this.conditionsEngine.evaluateConditions(n.conditions,n.conditionMode||qn.MODE.AND,"gallery_layer.name="+n.name))continue;i=r.previewConfig.position,-1===o&&(o=i),t=!0;break}}if(t)break}}}if(i===n)return;i=-1}-1!==o&&(this.selectPreview(o),t&&"option:crop"===t.type&&this._selectPreview(this._getMediaIndex(o)))}_getVariantById(t){if(this.settings.product.variants&&this.settings.product.variants.length>0)for(let e=0;e<this.settings.product.variants.length;e++){const i=this.settings.product.variants[e];if(i.id.toString()===t.toString())return i}return null}_checkInteractive(t){let e=!1;if(this._preview&&this._preview._canvas)if(this._preview.settings.cropMode)e=!0;else{let t=this._preview._canvas.getObjects();for(let i=0;i<t.length;i++){const o=t[i];if(o._layer&&o._layer.params.interactive){e=!0;break}}}this._splideMain.Components.Drag.disable(e)}_isStatic(t){for(let e=0;e<t.length;e++){const i=t[e];for(let t=0;t<i.layers.length;t++){const e=i.layers[t];if(e.params.interactive||e.params.crop&&"upload"===e.type)return!1}}return!0}_addLoader(){let t="300px",e=this._getMediaIndex(isNaN(this.settings.galleryConfig.position)?1:this.settings.galleryConfig.position);if(-1!==e){let i=this.media[e];if(i){let e=i.aspect_ratio;if(!e&&i.width&&i.height&&(e=i.width/i.height),e){let i=this.element.offsetWidth,o=this._wrapper;for(;0===i&&o.parentNode;)o=o.parentNode,o.offsetWidth>0&&(i=o.offsetWidth);i&&(t=Math.round(i/e)+"px")}}}s.debug("--\x3e product-gallery loader minHeight:",t),this._loader=document.createElement("div"),this._loader.className="cl-po--gallery-loader",this._loader.style.minHeight=t,this._loader.innerHTML='<div class="cl-spinner"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div>',this.element.insertBefore(this._loader,this._wrapper),this._wrapper.style.opacity="0";const i=t=>{this._preview!==t.detail&&this._preview||(this._removeLoader(),this.element.removeEventListener("preview:rendered",i))};this.element.addEventListener("preview:rendered",i)}_removeLoader(){this._wrapper.style.opacity="1",this._loader&&(this.element.removeChild(this._loader),this._loader=null)}_triggerEvent(t,e){const i=new CustomEvent(t,{detail:e,cancelable:!0,bubbles:!0});this.element.dispatchEvent(i)}constructor(t,e,i,o){this.config=t,this.settings=n.extend({api:"https://api.cloudlift.app",assets:"https://assets.cloudlift.app",queryParams:{},selector:".cl-gallery",position:"",sticky:!1,stickyMobile:"overlay",zoom:null,maxHeight:0,classNamePrefix:"cl-po",product:{},variantId:null,galleryConfig:{exclude:[],hideThumbnails:!1,hideThumbnailsMobile:!1,layout:"bottom",arrows:!1,arrowsThumbnails:!1,pagination:!1,paginationMobile:!1,paginationThumbnails:!1,previewActive:!1,loader:!1,maxWidth:2500,width:0}},o||{}),window.clGallery&&(this.settings.galleryConfig=n.extend(this.settings.galleryConfig,window.clGallery)),this._previews=[],this.media=[],this._productForm=e,this.conditionsEngine=i,null!==this.settings.selector&&(n.isElement(this.settings.selector)?this.element=this.settings.selector:this.element=document.querySelector(this.settings.selector)),null!=this.element?(s.info("--\x3e new product-gallery: ",this.element),this.resources=[this.settings.assets+"/static/lib/splidejs/splide.min.js",this.settings.assets+"/static/lib/splidejs/splide.min.css"],this.ready=nn.loadOnce(this.resources,"product-gallery",{async:!1}).then((()=>this._init()))):s.warn("no elements with selector found: ",this.settings.selector)}};var lr=class{translate(){try{let t=JSON.stringify(this.config.options);this.config.variantOption&&(t+=JSON.stringify(this.config.variantOptions));let e=t.indexOf("#");if(-1!==e){let i=/^#[0-9A-F]{6}$/i;for(;-1!==e;){let o=t.substr(e,7);if(!i.test(o))break;s.trace("[config-translate] skipping color:",o),e=t.indexOf("#",e+1)}}-1!==e?(this._translateOptions(this.config.options),this.config.variantOption&&this._translateOptions(this.config.variantOptions,!0),this.config.previewConfig&&this.config.previewConfig.layers?.length&&this._translatePreview(this.config.previewConfig),s.debug("[config-translate] translated options")):s.debug("[config-translate] skipped options translation")}catch(t){s.debug("[config-translate] error in translation",t)}}_translateOptions(t,e=!1){for(let i=0;i<t.length;i++){const o=t[i];if(o.label&&(o.label=l.translate(o.label)),e||(o.name&&(o.name=l.translate(o.name)),o.value&&(o.value=l.translate(o.value))),o.params.info&&(o.params.info=l.translate(o.params.info)),o.params.help&&(o.params.help=l.translate(o.params.help)),o.params.textHelp&&(o.params.textHelp=l.translate(o.params.textHelp)),o.params.placeholder&&(o.params.placeholder=l.translate(o.params.placeholder)),o.params.validationMsg&&(o.params.validationMsg=l.translate(o.params.validationMsg)),o.params.collapseLabel&&(o.params.collapseLabel=l.translate(o.params.collapseLabel)),o.params.textValueSelect&&(o.params.textValueSelect=l.translate(o.params.textValueSelect)),o.params.textSearchValues&&(o.params.textSearchValues=l.translate(o.params.textSearchValues)),o.params.button&&(o.params.button=l.translate(o.params.button)),o.params.atcText&&(o.params.atcText=l.translate(o.params.atcText)),o.params.textDiscountSave&&(o.params.textDiscountSave=l.translate(o.params.textDiscountSave)),o.params.textDiscountBuy&&(o.params.textDiscountBuy=l.translate(o.params.textDiscountBuy)),o.params.labelX&&(o.params.labelX=l.translate(o.params.labelX)),o.params.labelY&&(o.params.labelY=l.translate(o.params.labelY)),o.params.html&&(o.params.html=l.translate(o.params.html)),o.params.groupEditor?.button&&(o.params.groupEditor.button=l.translate(o.params.groupEditor.button)),o.values)for(let t=0;t<o.values.length;t++){const i=o.values[t];i.value&&!e&&(i.value=l.translate(i.value)),i.text&&(i.text=l.translate(i.text))}o.conditions.length&&this._translateConditions(o.conditions),o.options&&o.options.length&&this._translateOptions(o.options)}}_translatePreview(t){let e=[t];t.gallery&&e.push(...t.views);for(let t=0;t<e.length;t++){const i=e[t];this._translateLayers(i.layers)}}_translateLayers(t){for(let i=0;i<t.length;i++){const o=t[i];for(var e in o.params)o.params.hasOwnProperty(e)&&-1!==e.indexOf("option")&&(o.params[e]=l.translate(o.params[e]));o.params.text&&(o.params.text=l.translate(o.params.text)),o.conditions.length&&this._translateConditions(o.conditions),o.layers&&o.layers.length&&this._translateOptions(o.layers)}}_translateConditions(t){for(let e=0;e<t.length;e++){const i=t[e];if(i.field&&(i.field=l.translate(i.field)),i.value&&-1!==i.value.indexOf("#"))if(-1!==i.value.indexOf(",")){let t=i.value.split(",");for(let e=0;e<t.length;e++)t[e]=l.translate(t[e]);i.value=t.join(",")}else i.value=l.translate(i.value)}}constructor(t){this.config=t}};var cr=class{destroy(){this.removeCss(),this.element.removeChild(this._wrapper),this._destroyPreview()}updateVariantOptions(t,e=!0){let i;e&&(i=this._getControllers({},this.config.variantOptions)),this.config.variantOptions=t,this._variantOptions&&(this._variantOptions.settings.variant=this._getVariantById(this._variantId),this._variantOptions._init()),e&&this._setControllers(i,this.config.variantOptions)}updateOptions(t,e=!0,i=!0){let o,n;if(e&&(o=this.getValues()),i&&(n=this._getControllers()),this.config.options.length=0,this.config.options.push(...t),this._generateOptionIds(this.config.options,"option_"+this.settings.product.id+"_"),this._translate.translate(),e){for(const t in o)o[t]||delete o[t];this.setValues(o)}if(i&&this._setControllers(n),this._destroyTooltips(),ao.BUNDLE)return this._variantsInCurrency().then((()=>{this.render()}));this.render()}updatePreview(t){this.config.preview=!0,this._translate._translatePreview(t),this.config.previewConfig=t,this._preview?this._preview.updateConfig(t).then((()=>this.render())):this._initPreview()}updateCss(t){this.removeCss(),this._style=n.addStyleElement(t,this.settings.styleSelector)}removeCss(){this._style&&this._style.parentNode.removeChild(this._style)}updateJs(t){this.removeJs(),t=`window.addEventListener('options:rendered',function(e){ ${t} },{once:true});`,this._script=n.addScriptElement(t)}removeJs(){this._script&&this._script.parentNode.removeChild(this._script)}_isThemeMode(){return this.config.themeId&&"local"!==this.config.themeId}applyTheme(t){let e="";if(Object.keys(t.styles).length){e="#"+this.config.uuid+" {\n";for(const[i,o]of Object.entries(t.styles))"css"!==i&&o&&(e+="  --cl-po-"+i+": "+o+";\n");e+="}\n"}t.css&&(e+="\n"+t.css),e&&this.updateCss(e),t.js&&this.updateJs(t.js)}validate(){let t=this._validateOptions(this.config.options);return s.debug("validated product-options: ",this.config,t),this._triggerEvent("options:validated",{valid:t}),io.productOptionsEmptyId&&(this.settings.idLink=this._hasOptionsValues()),this.render(),t}render(){let t=[];try{this._evaluateOptionValue(this.config.options),this._evaluateOptionConditions(this.config.options),this._evaluateOptionPrice(this.config.options),this._variantIdOption&&t.push(this._variantIdOption),this._variantOptions&&this.config.variantOptions.length&&t.push(...this.config.variantOptions);const e={uuid:this.config.uuid,editorMode:this.settings.editorMode,price:this.price,product:this.settings.product,variant:this.conditionsEngine.data.variant,productForm:this._productForm,productFormLink:this._productFormLink,wrapper:this._wrapper,assets:this.settings.assets,idLink:this.settings.idLink,previewConfig:this.config.preview?this.config.previewConfig:void 0};t.push(...this.config.options),this._triggerEvent("options:pre_render",this),tt(Rn(t,e,this._optionValueChanged.bind(this),this._clearOptionError.bind(this),this.validate.bind(this),this._getOption.bind(this)),this._wrapper),this._triggerEvent("options:rendered",this),this._initTooltips()}catch(e){s.error("failed to render product options",t,e)}}getValues(t={},e=this.config.options){for(let i=0;i<e.length;i++){const o=e[i];o.options&&o.options.length?this.getValues(t,o.options):t[o.name]=o.value}return t}setValues(t,e=this.config.options){for(let i=0;i<e.length;i++){const o=e[i];if(o.options&&o.options.length&&"group-editor"!==o.type)this.setValues(t,o.options);else if(t.hasOwnProperty(o.name))o.value=t[o.name];else if("upload-lift"===o.type){let e=[];for(const i in t)t.hasOwnProperty(i)&&-1!==i.indexOf(o.name+"_")&&e.push(t[i]);e.length&&(o.value=e.join(","))}else"group-editor"===o.type&&(o._restoreValues=t);"library"===o.type&&t.hasOwnProperty("_"+o.name+"_id")&&(o._imageId=t["_"+o.name+"_id"])}}_init(){if(this._wrapper=document.createElement("div"),this._wrapper.className=this.settings.classNamePrefix+"--wrapper",this._wrapper.setAttribute("id",this.config.uuid),this._isThemeMode()){let t=this.settings.themes?.find((t=>t.id===this.config.themeId));t&&this.applyTheme(t)}else this.config.css&&this.updateCss(this.config.css),this.config.js&&this.updateJs(this.config.js);this.settings.position?(this.element.insertAdjacentElement(this.settings.position,this._wrapper),this.element!==this._wrapper.parentNode&&(this.element=this._wrapper.parentNode)):this.element.appendChild(this._wrapper),this._generateOptionIds(this.config.options,"option_"+this.settings.product.id+"_"),io.productOptionsClear&&(this._optionValuesClear=this.getValues()),this._findProductForm()?(this._translate=new lr(this.config),this._translate.translate(),this._productForm.noValidate=!0,this._productForm.addEventListener("options:render",(t=>this.render())),this._productForm.addEventListener("options:validate",(t=>this.validate())),this._watchFormSubmit(),this._watchVariantChanges(),this.config.preview&&this._initPreview(),n.hasQueryParam(window.location.href,"item")?this._restoreCartItem():n.hasQueryParam(window.location.href,"_f")&&this._prefillFromUrl(),window.addEventListener("options:share",(t=>{let e=this._generatePermalink();!1!==t.detail?.url&&window.history.replaceState({},"",e),this._triggerEvent("options:shared",{link:e})}))):s.warn("product-options no product form found for element: ",this.element,this.config)}_variantsInCurrency(t=this.config.options,e=this.settings.lists){let i=[],o={};oo.priceVariant&&i.push(this.shopifyStore.getProduct(oo.priceProductHandle||"product-options").then((t=>{oo.priceVariantValue=t.price/100})).catch((()=>!0)));const n=t=>{let e=t.priceVariant,n=e.handle;!n&&e.title&&(n=e.title.substring(0,e.title.indexOf("-")).trim().replaceAll(" ","-").toLowerCase()),n&&(o[n]=o[n]||this.shopifyStore.getProduct(n),i.push(o[n].then((i=>{if(i.variants)for(let o=0;o<i.variants.length;o++){const n=i.variants[o];if(n.id.toString()===e.id.toString()){t.price=n.price/100,io.productLinkAvailable&&(t.priceVariant?.quantity>1&&(t.hasOwnProperty("_price")||(t._price=t.price),t.price=t._price*t.priceVariant.quantity),t.disabled=!n.available);break}}})).catch((e=>{s.warn("missing linked product for optionValue: ",t,e),io.productLinkAvailable&&(t.disabled=!0)}))))},r=t=>{let i=t.values;if(t.list&&e&&e.hasOwnProperty(t.list)&&(i=e[t.list]),i)for(let t=0;t<i.length;t++){const e=i[t];e.priceVariant&&n(e)}};for(let e=0;e<t.length;e++){let i=t[e];if(r(i),i.options&&i.options.length)for(let t=0;t<i.options.length;t++){r(i.options[t])}}return Promise.all(i)}_validateOptions(t,e=!1){let i=!0;for(let o=0;o<t.length;o++){const r=t[o];if(r.visible)if(r.options&&r.options.length){this._validateOptions(r.options,e)||(i=!1)}else{let t=this.element;if(this._popup&&this._popup.isOn()&&this._popupEl&&(t=this._popupEl),r.errors?.length&&r._errorFormula){r.errors=[],delete r._errorFormula,i=!1;continue}let o=t.querySelector(`#${r.id}`);if(r._controller&&"function"==typeof r._controller.onValidate){r.errors=[],r._controller.onValidate(r)||(i=!1,null==o&&(o=t.querySelector(`[data-option="${r.name}"]`)))}else if(null==o&&(o=t.querySelector(`input[id^=${r.id}-]:not([disabled])`)),null!=o&&!o.checkValidity()){if(i=!1,r.errors=[],r.params.validationMsg){r.errors.push(r.params.validationMsg);continue}for(const t in o.validity)if(o.validity[t]){let e="";e="tooLong"===t?l.get(this.settings.errorPrefix+t,{max:o.maxLength}):"tooShort"===t?l.get(this.settings.errorPrefix+t,{min:o.minLength}):"rangeOverflow"===t?l.get(this.settings.errorPrefix+t,{max:o.max}):"rangeUnderflow"===t?l.get(this.settings.errorPrefix+t,{min:o.min}):"patternMismatch"===t?l.get(this.settings.errorPrefix+t,{pattern:o.pattern}):l.get(this.settings.errorPrefix+t),e&&(-1===e.indexOf(this.settings.errorPrefix)?r.errors.push(e):s.warn("missing translation for "+e))}}if(!i&&o&&!e&&o.scrollIntoView){let t=o.closest(".cl-po--panel");t&&!t.previousElementSibling.classList.contains("cl-po--open")&&t.previousElementSibling.classList.add("cl-po--open");let i=o.closest("[data-option]");n.isScrolledIntoView(i)||(i.style.scrollMargin=window.clOptionScrollOffset||"100px",i.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"}),i.style.scrollMargin="",e=!0)}}}return i}_findProductForm(){if(this._productForm=n.findParent(this.element,this.settings.selectorForm),!this._productForm){let t={srcEl:this.element};this._productForm=this.shopifyStore.findProductFormBestMatch(this.settings.product.id,t),t.parentEl&&(this._productFormParentEl=t.parentEl)}if(this._productFormParent=this._productForm.contains(this._wrapper),!this._productFormParent||this._productFormLinkForce){let t=this._productForm.getAttribute("id");t&&(this._productFormLink=t),this.shopifyStore.findExpressPaymentButtons().length&&(this._buyNowCapture=!0)}let t=document.querySelector("shopify-paypal-button");return t&&(t.style.display="none",s.warn("[live-options] hiding paypal buy now")),null!==this._productForm}_initVariantOptions(){let t=this.shopifyStore.findProductFormVariantId(this._productForm,this._productFormParentEl);if(this.settings.product&&this.settings.product.variants&&(t||(t=this.settings.product.variants[0].id.toString()),this.config.variantOption&&this.settings.product.variants.length>1&&(this._variantOptions=new nr(this.config,this._productFormParentEl||this._productForm,{product:this.settings.product,variant:this._getVariantById(t),editorMode:this.settings.editorMode}),io.productVariantFilter&&this._variantOptions.filterVariantValues()),this.settings.editorMode))if(this._variantIdOption={name:"id",id:"option_"+this.settings.product.id+"_id",value:t,params:{name:"id",info:"<b>Only shown in the App to test conditional options based on the selected variant.</b>"},visible:!0},1===this.settings.product.variants.length||this.config.variantOption)this._variantIdOption.type="hidden";else{this._variantIdOption.label="Variant",this._variantIdOption.type="select",this._variantIdOption.values=[];for(let t=0;t<this.settings.product.variants.length;t++){const e=this.settings.product.variants[t];this._variantIdOption.values.push({text:e.title,value:e.id.toString()})}}return t}_watchVariantChanges(){let t=this._initVariantOptions();return 250===this.settings.product.variants?.length&&this._extendVariants(t),this._onVariantChange(null,t),this._productForm.addEventListener("change",(t=>this._onVariantChange(t))),this._productFormParentEl&&this.shopifyStore.onVariantIdChange(this._productFormParentEl,((t,e)=>this._onVariantChange(t,e))),io.productVariantHistory&&(io.productVariantHistoryPush&&this._watchVariantHistory("pushState"),io.productVariantHistoryReplace&&this._watchVariantHistory("replaceState")),null!==this._variantId}_watchVariantHistory(t){if("function"==typeof window.history[t]){const e=window.history[t],i=this._productForm;window.history[t]=function(t){return setTimeout((function(){i.dispatchEvent(new Event("change"))}),300),e.apply(window.history,arguments)}}}_onVariantChange(t,e){if(e||(e=this.shopifyStore.findProductFormVariantId(this._productForm,this._productFormParentEl)),e!==this._variantId){if(this._variantId=e,delete this.conditionsEngine.data.variant,this._variantId){let t=this._getVariantById(this._variantId);t&&(this.conditionsEngine.data.variant=t),this._clearVisibleEditor(),this._triggerEvent("option:variant_changed",{variantId:this._variantId})}this.render()}}_extendVariants(t){const e=t=>{if(t.detail){let e=null;if(t.detail.variant?.hasOwnProperty("id")?e=t.detail.variant:t.detail.resource?.hasOwnProperty("id")?e=t.detail.resource:t.detail.hasOwnProperty("id")&&(e=t.detail),e){this._getVariantById(e.id)||(this.settings.product.variants.push(e),this._onVariantChange(t,e.id))}}};if(["variant-change","variant:update","variant:change"].forEach((t=>{window.addEventListener(t,e)})),t){if(!this._getVariantById(t)){let e=document.querySelectorAll('script[data-variant], script[data-selected-variant], script[type="application/json"]');if(e.length)for(let i=0;i<e.length;i++){const o=e[i];try{let e=JSON.parse(o.textContent);if(e&&e.id?.toString()===t?.toString()){this.settings.product.variants.push(e);break}}catch(t){}}}}}_getVariantById(t){if(this.settings.product.variants&&this.settings.product.variants.length>0)for(let e=0;e<this.settings.product.variants.length;e++){const i=this.settings.product.variants[e];if(i.id.toString()===t.toString())return i}return null}_triggerEvent(t,e){const i=new CustomEvent(t,{detail:e,cancelable:!0,bubbles:!0});this.element.dispatchEvent(i),this._productFormParent||this._productForm.dispatchEvent(i)}_optionValueChanged(t){t._variantOption&&this._variantOptions&&this._variantOptionValueChanged(t),this._clearVisibleEditor(),t.errors&&t.errors.length&&(t._error?delete t._error:t.errors.length=0),this._triggerEvent("option:changed",t),this.render()}_variantOptionValueChanged(t){let e=this._variantOptions.findSelectedVariant();e||(this._variantOptions.resetVariant(t),this._variantOptions.syncAllVariantOptions()),io.productVariantFilter&&this.config.variantOptions.length>1&&this._variantOptions.filterVariantValues(),this._variantOptions.syncVariantChanges(t),this._variantIdOption&&e&&(this._variantIdOption.value=e.id.toString(),this._onVariantChange(null,this._variantIdOption.value))}_clearVisibleEditor(){this.settings.editorMode&&(this.visibleEditor={})}_clearOptionError(t,e,i){const o=e.errors.indexOf(i);o>-1&&e.errors.splice(o,1),this.render()}_generateOptionIds(t,e,i=!0,o=0){if(i){let i=t.find((t=>"personalize"===t.type));if(i){let t=this._initPersonalize(i);return this._generateOptionIds(t,e,!0,o)}let n=t.find((t=>"tabs"===t.type));if(n){let t=this._initTabs(n);return this._generateOptionIds(t,e,!0,o)}}for(let n=0;n<t.length;n++){const r=t[n];let s=String(o+n);if(r.id=e+s,r.list&&this.settings.lists&&this.settings.lists.hasOwnProperty(r.list)&&(r.values=JSON.parse(JSON.stringify(this.settings.lists[r.list]))),"personalize"===r.type&&i){let t=this._initPersonalize(r);return this._generateOptionIds(t,e,!1,o+1)}r.options&&r.options.length&&this._generateOptionIds(r.options,r.id+"_")}}_evaluateOptionConditions(t){for(let e=0;e<t.length;e++){const i=t[e];let o=!0;i.conditions&&i.conditions.length&&(o=this.conditionsEngine.evaluateConditions(i.conditions,i.conditionMode||qn.MODE.AND,"option.name="+i.name)),this.settings.editorMode&&this.visibleEditor.hasOwnProperty(i.name)&&(o=this.visibleEditor[i.name]),this.visible[i.name]=o,i.visible=o,i.options&&i.options.length&&this._evaluateOptionConditions(i.options)}}_evaluateOptionPrice(t){this.price.options={},this.price.total=0,this.price.totalBase=0,this.price.variants=[],this.price.variantTotal=0,this.price.weight=0,this.price.final=0,this.price.sku=[],this.price.bundle=[],this.price.bundleMain=0,this._pr=this._pp({total:0,totalBase:0,variantTotal:0}),this._evaluateOptionPriceTotal(t),io.productPriceDeductVP&&(this._pr=this._pp({...this._pr,total:this._dVP(this._pr.total,!1),totalBase:this._dVP(this._pr.totalBase)}),this.price.total=this._pr.total,this.price.totalBase=this._pr.totalBase),this._patchProductPriceTotal(),this._patchProductWeightTotal(),this._patchProductSku()}_patchProductPriceTotal(){let t=this._variantPrice;if(this._variantId){let e=this._getVariantById(this._variantId);e&&(t=e.price,this._variantPrice=t,this._variantCompareAtPrice=e.compare_at_price,ao.BUNDLE&&0!==this.price.bundleMain&&(t=100*this.price.bundleMain))}if(!isNaN(t)&&(this.price.final=this.price.total+t/100,0!==this.price.total||this._priceElList&&this._priceElList.length||io.productPriceDeductVP)){if(this._priceElList&&this._priceElList.length)for(let t=0;t<this._priceElList.length;t++)if(!n.isInPage(this._priceElList[t])){delete this._priceElList;break}if((!this._priceElList||0===this._priceElList.length)&&(this._priceElList=document.querySelectorAll('[data-live-price="'+this.settings.product.id+'"]'),0===this._priceElList.length&&io.productPrice&&!this.settings.editorMode)){let e=ho(t,this.shopifyStore.trimMoneyFormatAmount(oo.moneyFormat)),i=n.findElementContainsRegex("*",new RegExp(`^.{0,50}${e}.{0,50}$`,"s"));if(i.length>0&&(i=i.filter((t=>{let e=!n.isHidden(t)&&!this._wrapper.contains(t);return e&&window.Cloudlift.b2b&&(t.closest("[data-b2b-bulk]")||t.closest("[data-b2b-discount]"))&&(e=!1),e}))),0===i.length&&(s.debug("no productPrice elements found for price:",e),io.amountNoDecimals&&(e=ho(t,"{{ amount_no_decimals }}"),s.debug("trying fallback {{ amount_no_decimals }} price: ",e),i=n.findElementContainsRegex("*",new RegExp(`^.{0,50}${e}.{0,50}$`,"s")),i.length>0&&(i=i.filter((t=>!n.isHidden(t)&&!this._wrapper.contains(t)))))),i.length)if(s.debug("found "+i.length+" productPrice elements",i),io.productPriceAll)this._priceElList=i.filter((t=>{for(let e=0;e<i.length;e++){const o=i[e];if(o!==t&&t.contains(o))return!1}return!0}));else{let t=null,e=-1,o=this._wrapper.getBoundingClientRect();for(let n=0;n<i.length;n++){const r=i[n];let s=r.getBoundingClientRect(),a=Math.abs(o.top-s.top)+Math.abs(o.left-s.left);(!t||t.contains(r)||a<e)&&(t=r,e=a)}t&&(this._priceElList=[t])}}const e=()=>{let e=100*this.price.total,i=t+e,o=100*this.price.variantTotal,n=ho(i,oo.moneyFormat);if(this._priceElList&&this._priceElList.length)for(let t=0;t<this._priceElList.length;t++){const e=this._priceElList[t];e.innerHTML=n,io.productPriceObserver&&(e.dataset.liveFormat=e.textContent)}if(this._variantCompareAtPrice){if(this._priceCompareElList=document.querySelectorAll('[data-live-price-compare="'+this.settings.product.id+'"]'),this._priceCompareElList.length){let i=0;if(io.productPriceComparePct&&t&&t>0){const o=(this._variantCompareAtPrice-t)/t*100;let n=t+e;i=Math.round(n*(1+o/100))}else i=this._variantCompareAtPrice+e;let o=ho(i,oo.moneyFormat);for(let t=0;t<this._priceCompareElList.length;t++){const e=this._priceCompareElList[t];e.innerHTML=o,e.dataset.liveFormat=o}}}else this._priceCompareElList=null;this._triggerEvent("options:price",{price:i,priceFormat:n,options:e-o,variants:o})};e(),io.productPriceTimeout&&setTimeout((()=>e()),1e3),io.productPriceObserver&&!this._priceElObserver&&"MutationObserver"in window&&(this._priceElObserver=new MutationObserver((t=>{if(this._priceElList&&this._priceElList.length){s.trace("observer priceEl for removed nodes",this._priceElList);let e=!1;for(let i=0;i<t.length;i++){const o=t[i];if(o.removedNodes.length>0){if(1===o.removedNodes.length&&1!==o.removedNodes[0].nodeType&&3!==o.removedNodes[0].nodeType)continue;const t=Array.from(o.removedNodes);for(let i=0;i<this._priceElList.length;i++){const n=this._priceElList[i];if(o.target===n&&n.dataset.liveFormat){let t=n.textContent;n.dataset.liveFormat!==t&&(s.debug("priceEl was modified (reset to liveFormat):",n),n.innerText=n.dataset.liveFormat)}else if(t.indexOf(n)>-1||t.some((t=>t.contains(n)))){s.debug("priceEl was removed:",n),e=!0;break}}if(!e&&this._priceCompareElList&&this._priceCompareElList.length)for(let i=0;i<this._priceCompareElList.length;i++){const n=this._priceCompareElList[i];if(o.target===n&&n.dataset.liveFormat){let t=n.textContent;n.dataset.liveFormat!==t&&(s.debug("priceCompareEl was modified (reset to liveFormat):",n),n.innerText=n.dataset.liveFormat)}else if(t.indexOf(n)>-1||t.some((t=>t.contains(n)))){s.debug("priceCompareEl was removed:",n),e=!0;break}}}if(e)break}e&&(s.debug("-> triggering patchProductTotal"),this._patchProductPriceTotal())}})),this._priceElObserver.observe(document.body,{subtree:!0,childList:!0}))}}_patchProductWeightTotal(){if((0!==this.price.weight||this._weightElList&&this._weightElList.length)&&(this._weightElList&&0!==this._weightElList.length||(this._weightElList=document.querySelectorAll('[data-live-weight="'+this.settings.product.id+'"]')),this._weightElList&&this._weightElList.length))for(let t=0;t<this._weightElList.length;t++){const e=this._weightElList[t];let i=this.price.weight;if(this._variantId){let t=this._getVariantById(this._variantId);t&&t.weight&&(t.grams?i+=t.grams/1e3:i+=t.weight/1e3)}let o=i.toFixed(2)+"kg",n=e.dataset.liveWeightUnit||"kg";"g"===n?o=Math.round(1e3*i)+"g":"lb"===n?o=(2.205*i).toFixed(2)+"lb":"oz"===n&&(o=(35.274*i).toFixed(2)+"oz"),e.innerHTML=o}}_patchProductSku(){if(this.price.sku.length||this._skuElList&&this._skuElList.length){if(this._variantId){let t=this._getVariantById(this._variantId);t&&t.sku&&this.price.sku.unshift(t.sku)}if(this.sku=this.price.sku.join(this.settings.skuSep),this._skuElList&&0!==this._skuElList.length||(this._skuElList=document.querySelectorAll('[data-live-sku="'+this.settings.product.id+'"]')),this._skuElList&&this._skuElList.length)for(let t=0;t<this._skuElList.length;t++){this._skuElList[t].innerHTML=this.sku}}}_evaluateOptionValue(t){if(ao.FORMULA)for(let e=0;e<t.length;e++){const i=t[e];if("value-formula"===i.type&&i.params.valueFormula){if(!i.visible)continue;if(i._optionValue=i._optionValue||{value:"",priceFormula:i.params.valueFormula},i.value=this._priceValueFormula(i,i._optionValue,!1),i.params.valueCopy){let t=this._getOption(i.params.valueCopy);t&&(t.value=i.value)}}i.options&&i.options.length&&this._evaluateOptionValue(i.options)}}_evaluateOptionPriceTotal(t){for(let e=0;e<t.length;e++){const i=t[e];if(i.visible||io.evaluateOptionPriceHidden){if(i._priceText&&delete i._priceText,void 0!==i.value&&i.values)for(let t=0;t<i.values.length;t++){const e=i.values[t];let o;if(i._controller&&"function"==typeof i._controller.isSelected?o=i._controller.isSelected(i,e):(o=String(e.value).trim()===String(i.value).trim(),e.priceText&&(o=!!i.value),e.priceUpload&&(o=!!i.value)),e.priceType)if(e.hasOwnProperty("_price")||(e._price=e.price),e.priceType===so.PERCENTAGE){let t=this._getVariantById(this._variantId);t&&t.price?e.price=t.price/100/100*e._price:e.price=0}else if(e.priceType===so.LETTER){let t=i.value;if(i.params.priceTextClean){if(!i._priceTextClean)try{i._priceTextClean=new RegExp(i.params.priceTextClean,i.params.textCleanFlags||"ug")}catch(t){s.error("failed to compile priceTextClean pattern for option: ",i.params.priceTextClean,i,t)}i._priceTextClean&&i._priceTextClean.test(t)&&(t=t.replaceAll(i._priceTextClean,""))}let o=t.length;i.params.priceTextMin&&(o=Math.max(0,o-i.params.priceTextMin)),e.price=e._price*o}else if(e.priceType===so.FORMULA&&ao.FORMULA)e.price=this._priceValueFormula(i,e);else if(e.priceType===so.UPLOAD){let t=0;if(i.value){t=i.value.split(",").filter((t=>""!==t.trim())).length}i.params.priceUploadMin&&(t=Math.max(0,t-i.params.priceUploadMin)),e.price=e._price*t}if(e.priceVariant&&!e.bundle&&(e.priceVariantCart&&!this.settings.editorMode&&0!==e.priceVariant.quantity&&this._lookupCartQuantity(e.priceVariant.id).then((t=>{t>0&&(e.priceVariant.quantity=0,e.price=0,this.render())})),e.quantityInput&&!isNaN(e.priceVariant.quantity)&&(e.hasOwnProperty("_price")||(!io.productLinkAvailable&&e.priceVariant.quantity>1&&(e.price=parseFloat(e.priceVariant.price)),e._price=e.price),e.price=e._price*e.priceVariant.quantity)),o){this.settings.priceWeight&&e.weight&&(this.price.weight+=e.weight),this.settings.sku&&e.sku&&this.price.sku.push(e.sku);let t=!1;if(e.priceVariant){if(ao.BUNDLE&&(e.bundle||io.bundlePriceVariant)){let t=null;"object"==typeof e.bundle?(t=e.bundle,"0"===t.id&&(this.price.bundleMain=t.price)):e.priceVariant.quantity>0&&(t={id:e.priceVariant.id,quantity:e.priceVariant.quantity,handle:e.priceVariant.handle},t.price=e._price||e.price),t&&(1!==oo.currencyFactor&&(t.priceBase=Math.round(t.price/oo.currencyFactor)),this.price.bundle.push(t))}else this.price.variants.push(e.priceVariant),e.priceVariantQuantity&&(e.priceVariant.quantity=-1);t=e.priceVariant.exclude||io.productVariantExcludeTotal,e.price&&!t&&(this.price.variantTotal+=e.price,this._pr=this._pp({...this._pr,variantTotal:this._pr.variantTotal+e.price}))}if(e.price){let o,n,r=e.price;e.priceVariant||(n=r,this.price.totalBase+=n,this._pr=this._pp({...this._pr,totalBase:this._pr.totalBase+n}),oo.currencyConvert&&(r=no(n))),this.price.options.hasOwnProperty(i.name)?(o=this.price.options[i.name],o.price+=r,o.priceBase&&(o.priceBase+=n)):o={option:i,price:r,priceBase:n},t||(this.price.total+=r,this._pr=this._pp({...this._pr,total:this._pr.total+r})),o.priceText=ho(100*o.price,oo.moneyFormat),i.label&&i.params.labelPriceText&&(i._priceText=o.priceText),e.priceVariant||(this.price.options[i.name]=o)}}}i.options&&i.options.length&&this._evaluateOptionPriceTotal(i.options)}}}_priceValueFormula(t,e,i=!0){let o=0,n=e.priceFormula;try{if(!e._priceFunction)try{-1===n.indexOf("return")&&(n="return ( "+n+" )"),e._priceFunction=Function('"use strict";return (function(option, value, price, options){ '+n+" })")()}catch(i){s.error("failed to parse optionValue.priceFormula: ",e,n,i),this.settings.editorMode&&(t.errors=t.errors||[],-1===t.errors.indexOf(i.message)&&t.errors.push(i.message))}e._priceFunction&&(this._priceFunctionUtil=this._priceFunctionUtil||{option:t=>this._getOption(t),value:t=>{const e=this._getOption(t);return e?e.value:""},price:t=>{if(this.price.options.hasOwnProperty(t)){let e=this.price.options[t];return e.priceBase||e.price}return 0},controller:t=>{const e=this._getOption(t);return e&&e._controller?e._controller:{}},variant:t=>this._getVariantById(t||this._variantId),weight:(t,e,i)=>{const o=this._getOption(t);if(o)for(let t=0;t<o.values.length;t++){const n=o.values[t];if(n.value==(i||o.value))return isNaN(e)||(n.weight=e),n.weight}return 0},error:(t,e)=>{const i=this._getOption(t);i&&(i.errors=i.errors||[],e=l.translate(e),-1===i.errors.indexOf(e)&&i.errors.push(e),i._errorFormula=!0)},list:t=>{if(this.settings.lists.hasOwnProperty("_name")){let e,i=this.settings.lists._name;for(const o of i)if(o.text===t){e=o.value;break}if(e&&this.settings.lists.hasOwnProperty(e)){const t=this.settings.lists[e];return 1===t.length&&t[0].hasOwnProperty("data")?t[0].data:t}}return[]},lookup:(t,e,i,o)=>{"string"==typeof i&&(o=i,i=null);for(let n=t.length-1;n>=0;n--){let r=t[n],a=parseFloat(r.value);if(e>=a){if(o&&r.text!==o)continue;if(!i||!r.values?.length)return s.info("[live-options] price list lookup:",e,"match:",a,"price:",r.price),r.price;for(let t=r.values.length-1;t>=0;t--){let o=r.values[t],n=parseFloat(o.value);if(i>=n)return s.info("[live-options] price list lookup:",e,i,"match:",a,n,"price: ",o.price),o.price}}}return s.warn("[live-options] price list lookup:",e,"no match"),0}},o=e._priceFunction(t,e.value,e._price,this._priceFunctionUtil),i&&(o?"number"!=typeof o&&(o=parseFloat(o),isNaN(o)&&(o=0)):o=0,o>0&&t.params.priceFormulaDeductVP&&(o=this._dVP(o))))}catch(e){s.error("failed to calculate price with priceFormula: ",n,e),this.settings.editorMode&&(t.errors=t.errors||[],-1===t.errors.indexOf(e.message)&&t.errors.push(e.message))}return o}_watchFormSubmit(){this._productFormSubmit=!1,this._handleCartAdd(),this.shopifyStore.onProductFormSubmit(this._productForm,this._productFormParentEl||this._productForm,(t=>this._handleFormSubmit(t)),io.productFormCapture),(this._productFormParentEl||this._productForm).addEventListener("keypress",(t=>{if(t.target&&"INPUT"===t.target.tagName){13===(t.keyCode||t.which)&&(t.preventDefault(),t.target.blur())}}))}_handleFormSubmit(t){if(!this._productFormSubmit){if(this._productFormSubmit=!0,!this.validate())return this._productFormSubmit=!1,t.preventDefault(),void t.stopImmediatePropagation();io.productOptionsEmptyExclude&&this._disableEmptyOptions();const e=this._pr;let i=this._hasExportPreviews(),o=0!==e.total||this.price.variants.length>0;this._aiUploads=ao.AI?this._getAiUploads():void 0,!i&&this._aiUploads&&Object.keys(this._aiUploads).length>0&&(i=!0),this._buyNowCapture=!0;let n=i||o||this._itemKey||this._buyNowCapture&&this.shopifyStore.isExpressPaymentButton(t.target);n&&(t.preventDefault(),t.stopImmediatePropagation(),this._productFormEvent=t,this._triggerFormDisabled(!0),this._triggerEvent("options:submit_prevent"));let r=[];if(i){let t=Promise.resolve(),e=this._getPreviews();ao.AI&&Object.keys(this._aiUploads).length>0&&(e=[{previewConfig:{ai:!0}},...e]);for(let i=0;i<e.length;i++){const o=e[i];if(this._isExportPreview(o)){let e=document.createElement("progress");e.max=100,e.value=0,e.className="cl-po--preview-progress";let i=this._wrapper;this._popupEl&&(i=this._popupEl.querySelector(".options-atc")),i.appendChild(e);let n=t=>new Promise((function(e,i){setTimeout(i.bind(null,t),1e3)})),r=!1;t=t.then((()=>{let t=Promise.reject();for(let i=0;i<3;i++)t=t.catch((t=>{t&&(r=!0,s.warn("[live-options] preview export error",t),i>1&&(t.try=i),io.previewExportLog&&this._upload._fileMeta.exportFailed(t));try{return this._exportPreview(o,e)}catch(t){return t.sync=!0,Promise.reject(t)}})).catch(n);return t.finally((()=>{i.removeChild(e)})),t})).then((()=>{r&&this._upload._fileMeta.exportFailed({success:!0})})).catch((t=>{if(t&&(s.error("[live-options] preview final failed",t),t.failed=!0,io.previewExportLog&&this._upload._fileMeta.exportFailed(t),t.upload&&(alert(t.error),io.previewExportRequired=!0)),io.previewExportRequired)return this._productFormSubmit=!1,Promise.reject()}))}}r.push(t)}if(o){const t=or.generateId();let i=Promise.resolve();if(this.price.variants.length)for(let t=0;t<this.price.variants.length;t++){const e=this.price.variants[t];let o={};if(0===e.quantity)continue;if(-1===e.quantity){let t=this.shopifyStore.findProductFormQuantity(this._productFormParentEl||this._productForm);if(this._popupEl){let e=this.shopifyStore.findProductFormQuantity(this._popupEl);e>1&&(t=e)}e.quantity=t}let n=this.shopifyCart.toItem(e.id,e.quantity,o);i=i.then((()=>this.shopifyCart.addItem(n))).catch((t=>{let e="Live Product Options: "+(t.description||"")+"\n**please check the linked products on options**";this.shopifyStore.isThemeEditor()?alert(e):console.error(e)}))}const n=this._pp({t:e.total-e.variantTotal});if(n.t>0||n.t<0&&oo.checkout.negative){const i=this._pp({m:Math.round(100*n.t),b:Math.round(100*e.totalBase)});let o={};o[eo.ID]=t;let r=!1;io.checkoutJson&&!oo.checkout.update&&oo.checkout.variantId&&(r={});for(const t in this.price.options)if(this.price.options.hasOwnProperty(t)){const e=this.price.options[t];let i=e.priceText.replace(/(<([^>]+)>)/gi,"");o[e.option.name]=i,e.priceBase&&(o["_"+e.option.name]=e.priceBase,r&&(r[e.option.name]=e.priceBase))}this._setFormProperty(eo.ID,t),this._setFormProperty(eo.PRICE,i.m),oo.currencyConvert&&(this._setFormProperty(eo.CURRENCY,oo.currency),this._setFormProperty(eo.PRICE_BASE,i.b)),oo.checkout.validate&&oo.checkout.key&&this._setFormProperty(eo.PRICE_KEY,this._pk(oo.currencyConvert?i.b:i.m,oo.checkout.key)),or.storeItem(t,{properties:o,currency:oo.currency}),r&&this._setFormProperty(eo.JSON_PRICE,JSON.stringify(r))}else o=!1;r.push(i)}o||(this._removeFormProperty(eo.ID),this._removeFormProperty(eo.PRICE),this._removeFormProperty(eo.PRICE_BASE),this._removeFormProperty(eo.PRICE_KEY),this._removeFormProperty(eo.CURRENCY),this._removeFormProperty(eo.JSON),this._removeFormProperty(eo.JSON_PRICE)),this.settings.priceWeight&&this.price.weight>0?this._setFormProperty(eo.WEIGHT,this.price.weight):this._removeFormProperty(eo.WEIGHT),this.settings.sku&&this.sku?this._setFormProperty(this.settings.skuProp,this.sku):this._removeFormProperty(this.settings.skuProp),this.price.bundle.length?this._setFormProperty(eo.BUNDLE,JSON.stringify(this.price.bundle)):this._removeFormProperty(eo.BUNDLE),n||"cloudlift.cart"!==t.type||(n=!0);let a=null;if(io.checkoutJson&&(!oo.checkout.update&&(o||oo.checkout.image&&i)||this.price.bundle.length)&&(a=()=>{let t=this.shopifyStore.getFormProperties(this._productForm),e=[eo.JSON,eo.JSON_PRICE,eo.PRICE_KEY,eo.BUNDLE,eo.BUNDLE_TITLE];for(const i of e)delete t[i];this._setFormProperty(eo.JSON,JSON.stringify(t))}),n)return Promise.all(r).then((()=>{if(a&&a(),this._itemKey&&-1!==this._itemKey.indexOf(this._variantId)){const e=()=>this.shopifyCart.updateItemById({id:this._itemKey,quantity:this.shopifyStore.findProductFormQuantity(this._productFormParentEl||this._productForm),properties:this.shopifyStore.getFormProperties(this._productForm)}).then((()=>{"function"==typeof window.clOnCartUpdate?window.clOnCartUpdate():window.location.href=this.shopifyStore.settings.api+"/cart"}));if(io.productItemModal){let i="product.options.item.modal.",o=document.createElement("dialog");return o.className="cl-po--dialog",o.innerHTML=`\n                                  <form method="dialog">\n                                    <h4>${l.get(i+"title")}</h4>\n                                    <div class="action">\n                                      <button class="cl-po--swatch cl-po--swatch-button cl-po--small" value="update">${l.get(i+"update")}</button>\n                                      <button class="cl-po--swatch cl-po--swatch-button cl-po--small" value="add">${l.get(i+"add")}</button>\n                                    </div>\n                                  </form>`,void 0!==window.dialogPolyfill&&(window.dialogPolyfill.registerDialog(o),o.style.height="auto"),this._wrapper.appendChild(o),o.showModal(),o.addEventListener("close",(()=>{"update"===o.returnValue?e():"cloudlift.cart"===t.type?(delete this._itemKey,delete this._productFormSubmit,this._handleFormSubmit(t)):this._triggerFormEvent()})),!0}if(io.productItemUpdate)return e()}if(io.productBuyNow&&this.shopifyStore.isExpressPaymentButton(t.target)&&(t=new CustomEvent("cloudlift.cart",{detail:{onSuccess:()=>{window.location.href=this.shopifyStore.settings.api+"/checkout"}},cancelable:!0,bubbles:!1})),"cloudlift.cart"===t.type){let e=this.shopifyStore.findProductFormQuantity(this._productFormParentEl||this._productForm);if(this._popupEl){let t=this.shopifyStore.findProductFormQuantity(this._popupEl);t>1&&(e=t)}return this.shopifyCart.addItem({id:this._variantId,quantity:e,properties:this.shopifyStore.getFormProperties(this._productForm)}).then((()=>(this._productFormSubmit=!1,t.detail&&"function"==typeof t.detail.onSuccess?t.detail.onSuccess():window.location.href=this.shopifyStore.settings.api+"/cart",!0)))}return this._triggerFormEvent(),this._triggerEvent("options:submit"),!0})).catch((t=>(s.error("[live-options] submit handler error",t),422===t.status&&t.description&&alert(t.description),this._productFormSubmit=!1,this._triggerFormDisabled(!1),!1)));a&&a(),setTimeout((()=>{this._triggerEvent("options:submit"),this._productFormSubmit=!1,this._triggerFormDisabled(!1),this._clearOptionValues()}),300)}return Promise.resolve(!1)}_handleCartAdd(){let t=document.querySelectorAll("[data-live-cart-add]");if(t.length){s.debug("found manual cart add btn",t);for(let e=0;e<t.length;e++){const i=t[e];(this._productFormParentEl||this._productForm).contains(i)&&(io.productFormCapture=!1),i.addEventListener("click",(t=>{i.dataset.liveCartAdd&&this.settings.product.id.toString()!==i.dataset.liveCartAdd||(t.preventDefault(),t.stopImmediatePropagation(),this._productFormSubmit=!1,this._handleFormSubmit(new CustomEvent("cloudlift.cart",{detail:{},cancelable:!0,bubbles:!1})))}),{capture:!0})}}}_setFormProperty(t,e){let i;this._formInputs?this._formInputs.hasOwnProperty(t)&&(i=this._formInputs[t]):this._formInputs={},i?i.value=e:(i=document.createElement("input"),i.type="hidden",i.name="properties["+t+"]",i.value=e,this._productForm.appendChild(i)),this._formInputs[t]=i}_removeFormProperty(t){if(this._formInputs&&this._formInputs.hasOwnProperty(t)){let e=this._formInputs[t];e.parentNode.removeChild(e),delete this._formInputs[t]}}_triggerFormEvent(){if(this._triggerFormDisabled(!1),this._productFormEvent){let t=this._productFormEvent;t.target||t.currentTarget?"click"===t.type?t.target&&t.target.click?t.target.click():t.currentTarget&&t.currentTarget.click?t.currentTarget.click():"BUTTON"===t.target.parentNode.tagName&&t.target.parentNode.click():"submit"===t.type&&t.target.submit():(s.error("missing event target - manual form submit"),this._productForm.submit()),this._productFormEvent=null,io.productFormSubmitDelay?setTimeout((()=>{this._productFormSubmit=!1}),window.clSubmitDelay||1e3):this._productFormSubmit=!1}this._clearOptionValues()}_clearOptionValues(){this._optionValuesClear&&setTimeout((()=>{this.setValues(this._optionValuesClear),this.render(),this._renderPreview(),this._popupEl&&this._renderPopup(this._personalizeOption)}),1e3)}_triggerFormDisabled(t){if(io.productFormDisabled)if(t){if(this._productFormEvent){let t=this._productFormEvent.target||this._productFormEvent.currentTarget;t&&("BUTTON"===t.tagName?this._btnDisabled=t:this._btnDisabled=t.closest("button"),this._btnDisabled&&this._btnDisabled.setAttribute("disabled","disabled"))}}else this._btnDisabled&&(this._btnDisabled.removeAttribute("disabled"),delete this._btnDisabled)}_getControllers(t={},e=this.config.options){for(let i=0;i<e.length;i++){const o=e[i];o.options&&o.options.length&&this._getControllers(t,o.options),o._controller&&(t[o.name+"_"+o.type]=o._controller)}return t}_setControllers(t,e=this.config.options){for(let i=0;i<e.length;i++){const o=e[i];o.options&&o.options.length&&this._setControllers(t,o.options),t.hasOwnProperty(o.name+"_"+o.type)&&(o._controller=t[o.name+"_"+o.type])}}_getOption(t,e=this.config.options){for(let i=0;i<e.length;i++){const o=e[i];if(o.name===t)return o;if(o.options&&o.options.length){let e=this._getOption(t,o.options);if(e)return e}}return null}_initPreview(){this.config.previewConfig.gallery?(this._gallery=new ar(this.config,this._productForm,this.conditionsEngine,{api:this.settings.api,assets:this.settings.assets,selector:this.settings.selectorPreview,selectorThumbnail:this.settings.selectorThumbnail,position:this.settings.positionPreview,sticky:this.settings.stickyPreview,stickyMobile:this.settings.stickyPreviewMobile,stickyMobileSize:this.settings.stickyPreviewMobileSize,zoom:this.settings.previewZoom,maxHeight:this.settings.maxHeightPreview,product:this.settings.product,variantId:this._variantId,editorMode:this.settings.editorMode,galleryConfig:this.config.previewConfig.galleryConfig}),this._gallery.ready&&(this._gallery.ready.then((t=>{this._preview=this._gallery._preview})),this._gallery.element.addEventListener("preview:active",(()=>{this._preview=this._gallery._preview})))):this._preview=new er(this.config,this.config.previewConfig,this._productForm,this.conditionsEngine,{api:this.settings.api,assets:this.settings.assets,selector:this.settings.selectorPreview,selectorThumbnail:this.settings.selectorThumbnail,position:this.settings.positionPreview,sticky:this.settings.stickyPreview,stickyMobile:this.settings.stickyPreviewMobile,stickyMobileSize:this.settings.stickyPreviewMobileSize,zoom:this.settings.previewZoom,maxHeight:this.settings.maxHeightPreview,product:this.settings.product,variantId:this._variantId,editorMode:this.settings.editorMode});const t=t=>{if(!t?.params?.option)return null;const e=this._getOption(t.params.option);if(!e)return null;return{option:e,controller:t.params.optionParent&&this._getOption(t.params.optionParent)?._controller||e._controller}};(this._preview||this._gallery).element.addEventListener("layer:action:delete",(e=>{const i=t(e.detail);i?.controller?.onRemove?.(i.option)})),(this._preview||this._gallery).element.addEventListener("layer:action:duplicate",(e=>{const i=t(e.detail);i?.controller?.onDuplicate?.(i.option)})),(this._preview||this._gallery).element.addEventListener("layer:action:indexUp",(e=>{const i=t(e.detail);i?.controller?.onIndexUp?.(i.option)})),(this._preview||this._gallery).element.addEventListener("layer:action:indexDown",(e=>{const i=t(e.detail);i?.controller?.onIndexDown?.(i.option)})),(this._preview||this._gallery).element.addEventListener("layer:action:edit",(e=>{const i=t(e.detail);if(!i)return;if(i.controller?.focusOption)return void i.controller.focusOption(i.option);const o=e.detail,n=document.querySelector(`[data-option="${i.option.name}"]`);if(n)if(o.type.includes("upload")){let t=n.querySelector("input[type=file]");t?.click()}else{n.scrollIntoView({behavior:"smooth",block:"center"});const t=n.querySelector("input, textarea, select");t&&setTimeout((()=>t.focus({preventScroll:!0})),300)}}))}_renderPreview(){this.config.preview&&(this._gallery&&this._gallery.ready?this._gallery.ready.then((()=>this._gallery._previews.forEach((t=>t.renderPreview())))):this._preview&&this._preview.ready&&this._preview.ready.then((()=>this._preview.renderPreview())))}_destroyPreview(){this._gallery?(this._gallery.destroy(),delete this._gallery):this._preview&&this._preview.destroy(),delete this._preview}_getPreviews(){return this._gallery?this._gallery._previews:this._preview?[this._preview]:[]}_isExportPreview(t){let e=t.previewConfig.export&&(t.previewConfig.exportConfig.thumbnail||t.previewConfig.exportConfig.original||ao.EXPORT&&t.previewConfig.exports&&t.previewConfig.exports.length);if(ao.AI&&t.previewConfig.ai)return!0;if(!e)for(let e=0;e<t.previewConfig.layers.length;e++){const i=t.previewConfig.layers[e];if(i.params.crop&&"upload"===i.type)return!0;if(i.params.exportCoords)return!0}return e}_hasExportPreviews(){let t=this._getPreviews();for(let e=0;e<t.length;e++)if(this._isExportPreview(t[e]))return!0;return!1}_getAiUploads(t=this.config.options,e={}){for(let i=0;i<t.length;i++){const o=t[i];"ai"===o.type&&o.value&&(e[o.value]={name:o.name,url:o.value}),o.options&&o.options.length&&this._getAiUploads(o.options,e)}return e}async _uploadPreview(t,e,i=100){return(await this._upload.upload([t],(t=>{if(e&&t.lengthComputable){let o=t.loaded/t.total*100;o=Math.min(o,i),o>e.value&&(e.value=o)}})))[0]}async _exportPreview(t,e){let i=t.previewConfig;if(i.export){if(e.value=15,ao.EXPORT&&i.exports&&i.exports.length){let o="svg",n="excludeOriginal",r=!io.previewBlobs;r&&ao.AI&&Object.keys(this._aiUploads).length&&(r=!1);let s=t.export({width:i.width,height:i.height},!1,r,n,o);if(s){ao.AI&&this._aiUploads&&Object.keys(this._aiUploads).length?s=await this._exportAi(s):io.previewBlobs&&(s=await this._exportBlobs(s));let t=this._upload._fileMeta.fromBlob(s,"preview_export."+o);t.meta.variant="export";let n=i.exportConfig.original?50:80,r=await this._uploadPreview(t,e,n);for(let t=0;t<i.exports.length;t++){const e=i.exports[t];this._setFormProperty(e.property,this._exportConfigUrl(e,r))}}else for(let t=0;t<i.exports.length;t++)this._removeFormProperty(i.exports[t].property)}if(i.exportConfig.thumbnail){let o=t.export({width:i.exportConfig.thumbnailWidth,height:i.exportConfig.thumbnailHeight},!1,!0,"excludeThumbnail","png",.8);if(o){let n=this._upload._fileMeta.fromBlob(o,"preview_thumbnail.png");n.meta.variant="thumbnail";let r=null;if(i.exportConfig.thumbnailActive||window.clExportPreviewActive?(n.meta.property=t.active?"_preview":i.exportConfig.thumbnailProperty,i.exportConfig.thumbnailActiveOnly=!0,i.exportConfig.thumbnailActiveOnly&&!t.active||(r=n)):(n.meta.property=i.exportConfig.thumbnailProperty,r=n),r){let t=i.exportConfig.original?50:80;if(!1){let i=(await this.shopifyCart.addItemFormData({id:this._variantId,properties:{upload:r._file}},(i=>{e.value=t}))).data;await this.shopifyCart.removeItemById(i.key),this._setFormProperty(n.meta.property,i.properties.upload)}else{let i=await this._uploadPreview(r,e,t);this._setFormProperty(i.meta.property,i.url)}}}else this._removeFormProperty(i.exportConfig.thumbnailProperty)}if(i.exportConfig.original){let o=!(!i.exportConfig.crop||!i.exportConfig.cropConfig.width)&&i.exportConfig.cropConfig,n=i.exportConfig.originalFormat||"png",r=t.export({width:i.width,height:i.height},o,!0,"excludeOriginal",n);if(r){let t=this._upload._fileMeta.fromBlob(r,"preview_original."+n);t.meta.variant="original",t.meta.property=i.exportConfig.originalProperty;let o=await this._uploadPreview(t,e);this._setFormProperty(o.meta.property,o.url)}else this._removeFormProperty(i.exportConfig.originalProperty)}}if(t.previewConfig.ai){for(const t in this._aiUploads)if(this._aiUploads.hasOwnProperty(t)){let i=this._aiUploads[t],o=await fetch(t),n=await o.blob(),r=this._upload._fileMeta.fromBlob(n,i.name+"."+n.type.replace("image/",""));r.meta.variant="ai";let s=await this._uploadPreview(r,e);i.url=s.url;let a=i.url,l=i.name;this._setFormProperty(l,a);let c=this._getOption(l);if(c&&c.params.optionUpload&&this._setFormProperty(c.params.optionUpload,a),c.params.aiUpscale){let t=this.settings.api+"/api/ai/image/export/"+s.path;i.url=t,this._setFormProperty(("_"===l.charAt(0)?"":"_")+l+"_x",t)}}}else for(let i=0;i<t.previewConfig.layers.length;i++){const o=t.previewConfig.layers[i];if("upload"===o.type&&(o.params.crop||o._removeBg)){if(o.params.exportCropCoords,!1===o.params.exportCrop)continue;if(o.params.exportCropInteractive&&!o._interactive)continue;let i="jpeg";(o._url&&-1!==o._url.indexOf(".png")||o._removeBg)&&(i="png");let n=t.exportLayer(o.name,!0,i,.8),r=o.params.option||o.name;if(n){let t=this._upload._fileMeta.fromBlob(n,r+"_crop."+i);t.meta.variant="original",t.meta.property=r,o._removeBg&&(t.meta.property="_remove_bg_"+r);let s=await this._uploadPreview(t,e);this._setFormProperty(s.meta.property,s.url)}else this._removeFormProperty(r)}if(o.params.exportCoords){let e=t.exportLayerCoords(o.name);e?this._setFormProperty("_"+o.name,`x:${e.x},y:${e.y},w:${e.w},h:${e.h}`+(0!==e.r?`,r:${e.r}`:"")):this._removeFormProperty("_"+o.name)}}}async _exportAi(t){for(const e in this._aiUploads)if(this._aiUploads.hasOwnProperty(e)){const i=this._aiUploads[e].url;t=t.replace(new RegExp(e,"g"),i)}return new Blob([t],{type:"image/svg+xml"})}async _exportBlobs(t){let e,i=/xlink:href="blob:([^"]+)"/g;for(;e=i.exec(t);){let i=`blob:${e[1]}`,o=await fetch(i),n=await o.blob(),r=this._upload._fileMeta.fromBlob(n,"blob."+n.type.replace("image/",""));r.meta.variant="blob";let s=await this._uploadPreview(r);t=t.replace(i,s.url)}return new Blob([t],{type:"image/svg+xml"})}_exportConfigUrl(t,e){let i=e.path.replace(".svg","."+t.format),o=this.settings.api.replace("api","convert").replace("local","dev")+"/export/"+i,n={w:t.width,h:t.height,u:t.unit,dpi:t.dpi};t.crop&&t.cropConfig&&(n.cW=t.cropConfig.width,n.cH=t.cropConfig.height,n.cX=t.cropConfig.x,n.cY=t.cropConfig.y);let r="?c="+btoa(JSON.stringify(n));return io.previewExportEmbed&&"svg"===t.format&&(r+="&embed"),o+r}_initTooltips(){if(this._tippyInstances&&ao.FORMULA)for(let t=0;t<this._tippyInstances.length;t++){const e=this._tippyInstances[t];let i=e.reference.getAttribute("data-tippy-content");e.props.content!==i&&e.setContent(i)}let t=this._wrapper.querySelectorAll('[data-tippy-content]:not(.init):not([data-tippy-content=""])');if(t.length>0){this._tippyInstances||(this._tippyInstances=[]);for(let e=0;e<t.length;e++){const i=t[e];let o=i.getAttribute("data-tippy-content"),n=-1!==o.indexOf("<")&&-1!==o.indexOf(">"),r="ontouchstart"in window;if(o=o.trim(),o){const t={allowHTML:!0,maxWidth:350,interactive:n,appendTo:io.tooltipBody?document.body:"parent",aria:{content:"auto",expanded:!1}};r&&(t.trigger="click",t.onShow=t=>{setTimeout((function(){t.hide()}),window.clTooltipDuration||3e3)}),this._tippyInstances.push(gi(i,t))}i.classList.add("init")}}}_initPersonalize(t){t._controller={onValidate:t=>!t.required||t.value===t.values[0].value||(t.value=t.values[0].value,this.render(),t.params.popup?this._onPersonalizeChanged(t):t.params.validationMsg&&t.errors.push(t.params.validationMsg),!1),onChange:(t,e)=>{this._optionValueChanged(e),this._onPersonalizeChanged(e)}};let e=[...this.config.options];e.splice(this.config.options.indexOf(t),1),e=e.filter((t=>"personalize"!==t.type));let i=[];if(t.params.pExclude){let o=t.params.pExclude.split(",");e=e.filter((t=>-1===o.indexOf(t.name)||(i.push(t),!1)))}let o=[];o.push(t),t.values&&0!==t.values.length||(t.values=[{value:""}]);let n={data:"options",field:t.name,operator:"equals",value:t.values[0].value};if(o.push({name:"group_personalize",type:"group",value:"",required:!1,conditions:[n],params:{collapseOpen:!1,collapseLabel:"",collapse:!1},options:e,id:"option_group_personalize",visible:!1}),this.settings.editorMode&&t.params.popup&&(t.params.popup=!1),t.params.popup&&(this._productFormLinkForce=!0),this.config.preview){t.params.popup&&(this.config.preview=!1);const e=(t,e)=>{for(let i=0;i<t.length;i++){const o=t[i];o.params.option&&o.conditions.unshift(e)}};if(e(this.config.previewConfig.layers,n),this.config.previewConfig.gallery)for(let t=0;t<this.config.previewConfig.views.length;t++){e(this.config.previewConfig.views[t].layers,n)}}return this.config.options.length=0,i.length&&this.config.options.push(...i),this.config.options.push(...o),this._personalizeOption=t,e}_initTabs(t){let e,i;if(this.config.options.some((t=>"group"===t.type&&"group_personalize"===t.name))){let o=this.config.options.find((t=>"group"===t.type&&"group_personalize"===t.name));i=o.options,e=[...i];let n=i.indexOf(t);-1!==n&&e.splice(n,1),e=e.filter((t=>"tabs"!==t.type)),t.options=e,o.options=[t]}else e=[...this.config.options],e.splice(this.config.options.indexOf(t),1),e=e.filter((t=>"tabs"!==t.type)),t.options=e,this.config.options.length=0,this.config.options.push(t);return e}_onPersonalizeChanged(t){if(t.params.popup)if(t.value===t.values[0].value){this.config.preview=!0,this._personalizeGroupEl||(this._personalizeGroupEl=this._wrapper.querySelector('[data-option="group_personalize"]'),this._personalizeGroupEl.style.display="none");let e=Promise.resolve(!0);if(!nn.isDefined("popup")){let t=[this.settings.assets+"/static/lib/ldcover/ldcv.full.min.css",this.settings.assets+"/static/lib/ldcover/ldcv.min.js"];e=nn.loadOnce(t,"popup",{async:!1})}e.then((()=>{this._popupEl?this._renderPopup(t):(this._popupEl=document.createElement("div"),this._popupPriceEl=document.createElement("span"),this._priceElList?(n.isNodeList(this._priceElList)&&(this._priceElList=Array.prototype.slice.call(this._priceElList)),this._priceElList.push(this._popupPriceEl)):this._priceElList=[this._popupPriceEl],this._renderPopup(t),this._personalizeGroupEl.style.display="",document.body.appendChild(this._popupEl),this._popup=new ldCover({root:this._popupEl.querySelector(".ldcv"),lock:!1}),this._popup.on("toggle.on",(()=>{if(this._preview)this._renderPreview();else{if(window.innerWidth<=768)this.settings.maxHeightPreview=Math.floor(window.innerHeight/4),25!==this.settings.stickyPreviewMobileSize&&(this.settings.maxHeightPreview=Math.floor(window.innerHeight*(this.settings.stickyPreviewMobileSize/100)));else{let t=this.config.previewConfig.gallery&&"bottom"===this.config.previewConfig.galleryConfig.layout;this.settings.maxHeightPreview=t?550:660}this._initPreview()}this.render()}))),this._popup.get().then((e=>{this._popupClose?delete this._popupClose:(t.value=t.values[1].value,this.render(),this._renderPreview(),this._renderPopup(t))})),this._popup.toggle()}))}else this._popup&&this._popup.set(!1,!0)}_renderPopup(t){let e={id:this.config.uuid,product:this.settings.product,productFormLink:this._productFormLink,className:"fade"+(t.params.popupFull?" full":""),option:t,visible:this.config.options[1].visible},i=this.settings.selectorPreview;if(!n.isElement(i)){if(i=document.createElement("img"),i.className="cl-po--gallery-img",this._variantId)for(let t=0;t<this.settings.product.variants.length;t++){const e=this.settings.product.variants[t];if(e.id.toString()===this._variantId.toString()){e.featured_image&&e.featured_image.src&&(i.src=e.featured_image.src);break}}i.src||(i.src=this.settings.product.featured_image)}tt(jn(i,this._personalizeGroupEl,this._popupPriceEl,e,(t=>{this._productFormSubmit=!1;let e=document.querySelector("[data-live-cart-add-popup]");if(e)window.addEventListener("options:submit",(t=>{this._popupClose=!0,this._popup.set("close",!0)}),{once:!0}),e.click();else{let t;"function"==typeof window.clOnCartUpdate&&(t=()=>{this._popup.set("close",!0),window.clOnCartUpdate()}),this._handleFormSubmit(new CustomEvent("cloudlift.cart",{detail:{onSuccess:t},cancelable:!0,bubbles:!1}))}}),(t=>{this._popup.set("close",!0)})),this._popupEl)}_destroyTooltips(){if(null!=this._tippyInstances)for(let t=0;t<this._tippyInstances.length;t++){const e=this._tippyInstances[t];e.reference.classList.remove("init"),e.destroy()}}_restoreCartItem(){let t=n.getQueryParam(window.location.href,"item");this.shopifyCart.getCart(!0).then((e=>{for(let i=0;i<e.items.length;i++){const o=e.items[i];if(o.key===t&&o.properties){if(s.debug("restoring cart item values: ",o.properties),this.setValues(o.properties),this.render(),this._renderPreview(),o.quantity>1){let t=this.shopifyStore.findProductFormQuantityEl(this._productFormParentEl||this._productForm);t&&(t.value=o.quantity)}io.productItemModal&&"function"!=typeof HTMLDialogElement&&(this._dialogPolyfill=nn.loadOnce([this.settings.assets+"/static/lib/dialog/dialog-polyfill.min.js",this.settings.assets+"/static/lib/dialog/dialog-polyfill.min.css"],"dialog",{async:!1})),this._itemKey=t,this._personalizeOption&&this._onPersonalizeChanged(this._personalizeOption);break}}}))}_prefillFromUrl(){let t=n.getQueryParams(window.location.href),e={};for(const i in t)t.hasOwnProperty(i)&&"_f"!==i&&"item"!==i&&(i.includes("%")?e[decodeURIComponent(i)]=t[i]:e[i]=t[i]);Object.keys(e).length>0&&(s.debug("prefilling options from URL: ",e),this.setValues(e),this.render(),this._renderPreview())}_generatePermalink(){let t=this.getValues(),e=window.location.origin+window.location.pathname,i=[];for(const e in t)if(t.hasOwnProperty(e)&&t[e]){let o=t[e];o.includes("googleapis.com")&&(o=o.replace("https://storage.googleapis.com/cloudlift-app-cloud-dev-upload","https://upload.dev.cloudlift.app/s/dev"),o=o.replace("https://storage.googleapis.com/cloudlift-app-cloud-prod-upload","https://upload.cloudlift.app/s")),i.push(encodeURIComponent(e)+"="+encodeURIComponent(o))}return i.length&&(i.unshift("_f"),this._variantId&&i.unshift("variant="+this._variantId),e+="?"+i.join("&")),e}_lookupCartQuantity(t){return new Promise(((e,i)=>{setTimeout((()=>{this.shopifyCart.getCart(!0).then((i=>{let o=0;for(let e=0;e<i.items.length;e++){const n=i.items[e];if(n.variant_id.toString()===t.toString()&&(o+=n.quantity),n.properties.hasOwnProperty(eo.BUNDLE)){let e=JSON.parse(n.properties[eo.BUNDLE]);if(e&&e.length)for(let i=0;i<e.length;i++){const n=e[i];n.id.toString()===t.toString()&&(o+=n.quantity)}}}return e(o)}))}),500)}))}_hasOptionsValues(){let t=this.getValues();for(const e in this.visible)this.visible[e]||delete t[e];return Object.values(t).some((t=>""!==t))}_disableEmptyOptions(){let t=this.getValues(),e=[];for(const i in t)if(!t[i]){let t=document.querySelectorAll(`[name="properties[${i}]"]`);if(t.length)for(let i=0;i<t.length;i++){const o=t[i];o.disabled||(o.disabled=!0,e.push(o))}}e.length&&this.element.addEventListener("options:submit",(t=>{e.forEach((t=>{t.disabled=!1}))}),{once:!0})}_dVP(t,e=!0){let i=this._getVariantById(this._variantId);if(i?.price){let o=i.price/100;e&&oo.currencyConvert&&1!==oo.currencyFactor&&(o*=1/oo.currencyFactor,o=Math.round(100*o)/100),t-=o,oo.checkout.negative||(t=Math.max(t,0))}return t}_pp(t){return new Proxy(t,{set:(t,e,i)=>!0})}_pk(t,e){const i=`${e}:${t}`;let o=0;for(let t=0,e=i.length;t<e;t++){o=(o<<5)-o+i.charCodeAt(t),o>>>=0}return o}constructor(t,e){let i={api:"https://api.cloudlift.app",assets:"https://assets.cloudlift.app",queryParams:{},selector:".cl-options",position:"",selectorPreview:".cl-preview",selectorThumbnail:"",positionPreview:"",stickyPreview:!1,stickyPreviewMobile:"overlay",stickyPreviewMobileSize:25,previewZoom:null,maxHeightPreview:0,selectorForm:'form[action*="/cart/add"]',classNamePrefix:"cl-po",product:{},priceDraft:!0,priceWeight:!1,sku:io.productSKU,skuProp:window.clSKUProp||"SKU",skuSep:"string"==typeof window.clSKUSep?window.clSKUSep:"-",errorPrefix:"product.options.validity.",editorMode:!1,visible:{},visibleEditor:{},lists:null,idLink:!0,themes:[]};this.config=t,this.settings=n.extend(i,e||{}),this.settings.lists=e.lists,this.visible={},this.visibleEditor={},this.shopifyStore=u.getInstance(),this.shopifyCart=g.getInstance(),this.conditionsEngine=new qn({},{product:this.settings.product,options:this.config.options}),this._upload=_n.getInstance({api:this.settings.api,queryParams:this.settings.queryParams,errorPrefix:this.settings.errorPrefix+"upload."}),xn.settings.api=this.settings.api,xn.settings.assets=this.settings.assets,xn.settings.queryParams=this.settings.queryParams,Pn.settings.api=this.settings.api,Pn.settings.assets=this.settings.assets,Pn.settings.queryParams=this.settings.queryParams,this.price={options:{},total:0,totalBase:0,variants:[],variantTotal:0,weight:0,sku:[],bundle:[],bundleMain:0},n.isElement(this.settings.selector)?this.element=this.settings.selector:this.element=document.querySelector(this.settings.selector),null!=this.element?(s.info("--\x3e new product-options: ",this.element),oo.currencyConvert&&1!==oo.currencyFactor||io.productLinkAvailable&&!this.settings.editorMode||ao.BUNDLE?this._variantsInCurrency().then((()=>this._init())):this._init()):s.warn("no elements with selector found: ",this.settings.selector)}};class pr{async restoreOrder(t){const e=new dr({titleText:l.get("product.options.order.loading",null,"Loading order...")});e.show();try{let e=await fetch(`${this.settings.api}/api/order/restore?token=${t}&shop=${this.settings.shop}&app=${this.settings.app}`);if(!e.ok)throw new Error(`${e.status} ${e.statusText}`);let i=await e.json();i.items.reverse(),await this.shopifyCart.clear(),await this.restoreOrderItems(i);let o={from:"LPO"},r=n.getQueryParam(window.location.href,pr.SOURCE_PARAM);r&&(o.from+="_"+r);const a=await this.shopifyCart.addItems(i.items,o);if(s.debug("restored cart items",a),a.length){let t=new URL(window.location.href);t.search="",window.location.href=t.toString()}}finally{e.hide()}}async restoreOrderItems(t){let e=[],i=[];if(t.items.forEach((t=>{if(t.properties){for(let o in t.properties)if(t.properties.hasOwnProperty(o)){let n=t.properties[o];"string"==typeof n&&n.includes("cloudlift.app")&&n.startsWith("http")&&(n.includes("/export/")&&i.push((e=>{e.meta?.exportUrl&&n.includes(e.meta.exportUrl)&&(t.properties[o]=e.url)})),e.push(n))}!oo.checkout.update&&t.properties[eo.OPTIONS]&&(t.properties[eo.JSON]=JSON.stringify(t.properties))}})),e.length){let t=await this.restoreFiles(e);s.debug("restored uploads:",t),i.length&&t.forEach((t=>{i.forEach((e=>e(t)))}))}}async restoreFiles(t){let e=await fetch(`${this.settings.api}/api/upload/restore?archive=1&shop=${this.settings.shop}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});return await e.json()}constructor(t){this.settings=n.extend({api:"",shop:"",app:""},t||{}),this.shopifyCart=g.getInstance()}}pr.RESTORE_PARAM="cl_order",pr.SOURCE_PARAM="source";class dr{createOverlay(){this.overlay=document.createElement("div"),this.overlay.className="cl-overlay";const t=document.createElement("div");t.className="cl-overlay-container";const e=document.createElement("div");e.className="cl-overlay-title",e.textContent=this.options.titleText;const i=document.createElement("div");i.className="cl-spinner",t.appendChild(e),t.appendChild(i),this.overlay.appendChild(t)}setupStyles(){const t=document.createElement("style");t.textContent="\n      .cl-overlay {\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background-color: rgba(0, 0, 0, 0.7);\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        z-index: 999999;\n        visibility: hidden;\n        opacity: 0;\n        transition: opacity 0.3s, visibility 0.3s;\n      }\n\n      .cl-overlay.active {\n        visibility: visible;\n        opacity: 1;\n      }\n      \n      .cl-overlay-container {\n        display: flex;\n        flex-direction: column;\n        align-items: center;\n        gap: 2rem;\n      }\n\n      .cl-overlay-title {\n        color: #fff;\n        font-size: 2rem;\n        font-weight: bold;\n        text-align: center;\n        margin: 0;\n        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);\n      }\n\n      .cl-spinner {\n        display:block !important;\n        width: 50px;\n        height: 50px;\n        border: 5px solid #f3f3f3;\n        border-top: 5px solid #787878;\n        border-radius: 50%;\n        animation: cl-spin 1s linear infinite;\n      }\n\n      @keyframes cl-spin {\n        0% { transform: rotate(0deg); }\n        100% { transform: rotate(360deg); }\n      }\n    ",document.head.appendChild(t)}show(){document.body.contains(this.overlay)||document.body.appendChild(this.overlay),requestAnimationFrame((()=>{this.overlay.classList.add("active")}))}hide(){const t=()=>{document.body.contains(this.overlay)&&document.body.removeChild(this.overlay),this.overlay.removeEventListener("transitionend",t)};this.overlay.addEventListener("transitionend",t),this.overlay.classList.remove("active")}constructor(t={}){this.options={titleText:"Loading...",...t},this.createOverlay(),this.setupStyles()}}var hr=pr;const ur=t=>{t.currentTarget.closest("[data-bundle-collpase]").classList.toggle("cl-bundle-cart-collapsed")};var mr=(t,e,i,o=!1)=>et`
    <div class="cl-bundle-cart-layout ${Zo({"cl-bundle-cart-collapsed":!o})}" data-bundle-collpase>
        <div class="cl-bundle-cart-title" @click=${ur}>
            <span class="cl-bundle-cart-show">${l.get("product.options.bundle.show",{},"Show")} ${i} ${l.get("product.options.bundle.items",{},"items")} <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 14 14"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4.75 7.354 9.396a.5.5 0 0 1-.708 0L2 4.75"></path></svg></span>
            <span class="cl-bundle-cart-hide">${l.get("product.options.bundle.hide",{},"Hide")} ${i} ${l.get("product.options.bundle.items",{},"items")} <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 14 14"><path stroke-linecap="round" stroke-linejoin="round" d="m2 9.25 4.646-4.646a.5.5 0 0 1 .708 0L12 9.25"></path></svg></path></svg></span>
        </div>
        <div class="cl-bundle-cart-items-collapse">
            <div class="cl-bundle-cart-items">
            ${Ii(e,(e=>et`
                <div class="cl-bundle-cart-item">
                    <div class="cl-bundle-item__wrapper">
                        <img class="cl-bundle-item__image" src="${e.img}" alt="${e.title}">
                        <a href="${e.url}" class="cl-bundle-item__title">
                            <span class="cl-bundle-item__quantity">${e.quantity*t.quantity}x</span>
                            ${e.title}
                        </a>
                    </div>
                    <div class="cl-bundle-price cl-bundle-item-price">
                        <span class="cl-bundle-price__current">${e.price>0?ho(100*e.price*(e.quantity*t.quantity),oo.moneyFormat):l.get("product.options.free",{},"FREE")}</span>
                        ${e.priceBefore!==e.price?et`
                            <span class="cl-bundle-price__before">${ho(100*e.priceBefore*(e.quantity*t.quantity),oo.moneyFormat)}</span>
                        `:""}
                    </div>
                </div>`))}
            </div>
        </div>
    </div>
`;var gr=class{setup(t=!1){t&&(u.products={}),this.destroy(),this.shopifyStore.parseProductJsonElements(),this.shopifyStore.tryGetProductMap().then((t=>{for(let e=0;e<this.config.configs.length;e++){const i=this.config.configs[e];if(s.debug("-> evaluating options-config:",i.uuid),0===i.targetMode){let e=[{data:"product",field:"product",products:[i.product]}];for(let o in t)if(t.hasOwnProperty(o)){let n=t[o];this._evaluateProductTargeting(i,n,e,1)}}else if(0===i.conditionMode){if(this.shopifyStore.isProduct()){let e=t[this.shopifyStore.getHandleFromUrl()+".js"];e&&this._evaluateProductTargeting(i,e,[],0)}}else if(i.conditions.length>0)for(let e in t)if(t.hasOwnProperty(e)){let o=t[e];this._evaluateProductTargeting(i,o,i.conditions,i.conditionMode)}}0===this.products.length?this.shopifyStore.isThemeEditor()&&!this.config.lazy&&this._evaluateThemeEditor(t):setTimeout((()=>{this._compatible()}),1e3)})),this.config.setup&&this.config.configs.length>0&&(this._watch||!1===this.config.watch||(this._watchCartItems(),io.checkoutLog&&this._watchFormSubmit(),io.productQuickView&&this._watchQuickView(),this._watch=!0))}destroy(){for(;this.products.length;){this.products.pop().destroy()}}async _evaluateProductTargeting(t,e,i,o){this.conditionsEngine.data.product=e;let n=this.conditionsEngine.evaluateConditions(i,o,"config.uuid="+t.uuid);if(n){this.config.lazy&&(this._lazyFetch&&await this._lazyFetch,this._lazyFetch=this._getConfigLazy(t),await this._lazyFetch);let i="#product_form_"+e.id;i+=', [data-product-form="'+e.id+'"]',n=this._createProductOptions(t,e,i),n||(n=this._createProductOptions(t,e)),n||s.error("no container found options-config:",t.uuid,e)}s.debug("--\x3e evaluated options-config:",t.uuid,e,n)}async _getConfigLazy(t){const e=-1===this.config.api.indexOf("local")?this.config.api.replace("api.","assets."):this.config.api,i=await new r(e+"/api/assets/options.json",{method:"GET",responseType:"json",queryParams:{shop:this.config.shop,config:t.uuid}});if(i.data?.configs){let e=i.data;for(let i=0;i<e.configs.length;i++){const o=e.configs[i];if(o.uuid===t.uuid)return Object.assign(t,o),s.debug("--\x3e lazy fetch options-config:",t.uuid,t),void(e.lists&&(this.config.lists=this.config.lists||{},Object.assign(this.config.lists,e.lists)))}}s.warn("[live-options] lazy config missing:",t.uuid)}_evaluateThemeEditor(t){const e="cl_live_theme";if("0"!==n.readCookie(e))for(let i in t)if(t.hasOwnProperty(i)){let o=t[i],r=this._findOrCreateContainer(null,o,'form[action*="/cart/add"]:not([id*=instal])');if(r){let t=0===this.config.configs.length,i=void 0!==r.dataset.liveOptions;r.classList.add("cl-block");let o=`<style>\n                            .cl-block { padding: 10px;border-radius: 3px;background-color: rgb(55, 167, 220, 1); border: 2px solid #000;margin-bottom: 10px;opacity: 0.75; position: relative; }\n                            .cl-block span { font-size:14px; display: block; margin-bottom:5px; }\n                            .cl-block a, .cl-block span { color:#fff; }\n                            .cl-block a.live { font-size:20px;font-weight:bold;line-height: 1;text-shadow: 1px 1px 1px black;text-decoration: none; }\n                            .cl-block a.link { font-weight:bold;text-shadow: 1px 1px 1px black; }\n                            .cl-block .live-close { position: absolute; right:7px; top:0px; font-size:20px; cursor:pointer; }\n                    </style>\n                    <span class="live-close">✅</span>\n                    <span><a class="live" href="/admin/apps/live-product-options">Live Product Options</a></span>\n                    <span>Custom product options will appear here. ${t?"":"<b>(only shown in editor)</b>"}</span>`;return t?o+="<span><b>NEXT:</b> save the theme & continue with the setup in the app.</span>":i||(o+='<span>To change the location visit: <a class="link" href="https://docs.cloudlift.app/article/126-product-options-block-in-theme-editor" target="_blank">Product Options App Block</a></span>'),r.innerHTML=o,void r.querySelector(".live-close").addEventListener("click",(t=>{r.parentElement.removeChild(r),n.writeCookie(e,"0",30,"/")}))}}}_createProductOptions(t,e,i){for(let i=0;i<this.products.length;i++){const o=this.products[i];if(o.settings.product.id===e.id){s.debug("-> MERGE",t.uuid,"options with existing productOptions for product.id: ",e.id,t.options);const i=()=>{o._generateOptionIds(t.options,"option_"+e.id+"_",!1,o.config.options.length),o._translate&&(o._translate.config=t,o._translate.translate()),o.config.options.push(...t.options),io.productLinkAvailable||ao.BUNDLE?o._variantsInCurrency(t.options,null).then((()=>o.render())):o.render()};return o._wrapper?i():o.element.addEventListener("options:rendered",(()=>{i()}),{once:!0}),!0}}i||(i='form[action*="/cart/add"]:not([id*=instal])');let o=1===this.config.locationMode?this.config.selector:"",r=1===this.config.locationMode?this.config.position:void 0,a=this._findOrCreateContainer(o,e,i);if(this._autoPosition&&(r=this._autoPosition,delete this._autoPosition),a){let i,o=JSON.parse(JSON.stringify(t)),l=1===this.config.previewLocationMode?this.config.previewSelector:"",c=1===this.config.previewLocationMode?this.config.previewPosition:void 0;i=n.isNodeList(a)?a:[a];for(let t=0;t<i.length;t++){const n=i[t],a=o.preview?this._findOrCreatePreviewContainer(l,e,o):void 0,p=new cr(o,{api:this.config.api,assets:this.config.assets,queryParams:{shop:this.config.shop},selector:n,position:r,selectorPreview:a,positionPreview:c,selectorThumbnail:this.config.previewImgThumbnailSelector,stickyPreview:this.config.previewSticky,stickyPreviewMobile:this.config.previewStickyMobile,stickyPreviewMobileSize:this.config.previewStickyMobileSize,previewZoom:this.config.previewZoom,product:e,priceDraft:this.config.priceDraft,priceWeight:this.config.priceWeight,lists:this.config.lists,themes:this.config.themes});this.products.push(p),a&&this.shopifyStore.isTheme("Horizon")&&(o.previewConfig.gallery&&"MEDIA-GALLERY"===a.tagName?a.replaceWith=()=>{s.debug("app gallery no re-init required")}:a.closest(".shopify-section").addEventListener("variant:update",(t=>{setTimeout((()=>{const e=this._findOrCreatePreviewContainer(o.previewSelector,p.settings.product,o);e&&p._preview&&(p._preview.element=e,p._preview._wrapper&&p._preview._wrapper.parentNode&&e.appendChild(p._preview._wrapper),p._preview.renderPreview(),s.debug("re-init preview on variant change:",t.detail.variant,e))}),100)})))}return!0}return!1}_findOrCreateContainer(t,e,i){let o,n;i&&(n=document.querySelector(i));const r=(t,e)=>e&&(o=e.querySelectorAll(t),o.length>0)?(s.debug("using container in form with provided selector:",i,t,o),!0):(o=document.querySelectorAll(t),o.length>0&&(s.debug("using container with provided selector:",t,o),!0));if(t)return r(t,n)?o:(s.debug("no container found with selector:",t),null);if(o=document.querySelector('[data-live-options="'+e.id+'"]'),null!=o)return s.debug("using default container with selector: [data-live-options]"),o;if(this.config.autoSelector&&r(this.config.autoSelector,n))return this.config.autoSelectorPosition&&(this._autoPosition=this.config.autoSelectorPosition),o;if(n&&io.formInject){let t=n.querySelector("[type=submit],.add_to_cart,.btn.add-to-cart");return o=document.createElement("div"),o.className="inject",o.style.width="100%",t?t.parentNode.insertBefore(o,t):n.insertBefore(o,n.firstChild),s.debug("injected container into form:",n),o}return null}_findOrCreatePreviewContainer(t,e,i){let o;if(!t&&this.shopifyStore.isTheme("Dawn")?this.config.autoPreviewSelector||this.config.autoGallerySelector||(i.previewConfig.gallery?document.querySelector(".product media-gallery")?this.config.autoGallerySelector=".product media-gallery":this.config.autoGallerySelector=".product slider-component":this.config.autoPreviewSelector='.product slider-component:not([class*="thumb"]) ul li:first-child'):!t&&this.shopifyStore.isTheme("Horizon")&&(i.previewConfig.gallery?this.config.autoGallerySelector=".product-information media-gallery":this.config.autoPreviewSelector=".product-information media-gallery ul li:first-child, .product-information media-gallery slideshow-slide:first-child"),o=this._checkPersonalizeContainer(i),o)return o;const r=t=>{let i=document.querySelectorAll(t);if(i.length>0){if(i.length>1)for(let r=0;r<i.length;r++)if(io.previewHiddenExclude&&n.isMinSize(i[r]))s.warn("container preview found but hidden:",t,i[r]);else{if(o=i[r],-1!==o.className.indexOf(e.id)||o.dataset.livePreview==e.id)break;if(e.media?.length&&-1!==o.innerHTML.indexOf(e.media[0].id))break}else o=i[0],io.previewHiddenExclude&&n.isMinSize(o)&&(s.warn("container preview found but hidden:",t,o),o=null);s.debug("using container preview with provided selector:",t,o)}};let a=!0;if(t||(t='[data-live-preview="'+e.id+'"]',a=!1),r(t),a&&!o)return s.error("no container preview found with selector:",t),null;if(o||(i.previewConfig.gallery&&this.config.autoGallerySelector?r(this.config.autoGallerySelector):this.config.autoPreviewSelector&&(r(this.config.autoPreviewSelector),!o&&this.shopifyStore.isTheme("Dawn")&&r(".featured-product modal-opener"))),!o){let t;if(e.media&&e.media.length){let o=0;if(i.previewConfig&&i.previewConfig.layers.length)for(let t=0;t<i.previewConfig.layers.length;t++){const n=i.previewConfig.layers[t];if("product"===n.type){n.params.imgPos&&e.media.length>n.params.imgPos-1&&(o=n.params.imgPos-1);break}}t=e.media[o]}else e.featured_image&&(t={src:e.featured_image});if(t){let e=this.config.previewImgParent,i=this.config.previewImgParentSelector,r=n.pathBaseName(t.src,!1),a=[];if(this.config.previewImgMainSelector&&(a=document.querySelectorAll(this.config.previewImgMainSelector)),0===a.length&&(a=document.querySelectorAll('img[src*="'+r+'"], img[data-src*="'+r+'"], img[data-srcset*="'+r+'"]')),a.length&&io.previewHiddenExclude&&(a=Array.prototype.filter.call(a,(function(t){return!n.isHidden(t)}))),a.length>0){if(s.debug("found main product images:",a),1===a.length)o=a[0];else{let t=Number.MAX_VALUE,e=-1;for(let i=0;i<a.length;i++){const s=a[i];let l=s.offsetWidth*s.offsetHeight;if(0===l&&s.src){let t=this.shopifyStore.parseImageDimension(s.src);l=t.x*t.y}let c=s.src&&0!==s.src.indexOf("data:")?s.src:null,p=n.pathBaseName(c||s.dataset.src||s.dataset.srcset||s.src,!1);p=this.shopifyStore.stripImageDimension(p);let d=p.replace(r,"").length;d<t?(t=d,e=l,o=s):d===t&&l>e&&(e=l,o=s)}}let t;if(s.debug("selected auto preview img:",o),i&&(t=n.findParent(o,i)),null!=t)o=t,s.debug("using auto preview container with parent selector:",i,o);else if(o){1===e&&(o.parentElement&&null!==o.parentElement.getAttribute("data-zoom")||-1!==o.parentElement.id.indexOf("Zoom")||-1!==o.parentElement.className.indexOf("modal"))&&(e=2);for(let t=0;t<e;t++)o=o.parentElement;s.debug("using auto preview container with parent:",e,o)}}else s.debug("failed to find main product image:",r)}}if(o){for(o.style.minHeight||(o.style.minHeight="1px");o.firstChild;)o.removeChild(o.lastChild);let t=document.querySelectorAll('[data-live-preview-hide="'+e.id+'"]');if(t.length)for(let e=0;e<t.length;e++){t[e].style.display="none"}}else s.warn("[live-options] no preview container found");return o}_checkPersonalizeContainer(t){for(let e=0;e<t.options.length;e++){const i=t.options[e];if("personalize"===i.type){if(i.params.popup){return document.createElement("div")}break}}return null}_getDiscount(){let t={type:ro.NONE};for(let e=0;e<this._cart.items.length;e++){const i=this._cart.items[e];i.discounts&&i.discounts.length&&(t.type=ro.AUTO,t.code=i.discounts[0].title)}if(0===t.type){let e=this.shopifyStore.getDiscountCode();e&&(t.type=ro.CODE,t.code=e)}return t}_watchFormSubmit(){this.shopifyStore.onCartFormSubmit((t=>{if(t.submitter&&t.submitter.name&&"update"===t.submitter.name)return;let e=JSON.stringify(this._cart),i=this.config.api+"/api/checkout/cart?shop="+this.config.shop;navigator.sendBeacon(i,e)}),io.cartFormCapture)}_watchCartItems(){if(window.theme&&window.theme.Cart&&window.theme.Cart.prototype&&window.theme.Cart.prototype._setProductDetailsList){const t=window.theme.Cart.prototype._setProductDetailsList;window.theme.Cart.prototype._setProductDetailsList=function(e,i){t(e,i.filter((t=>t)))}}this._processCartItems();let t=n.debounced(1e3,(()=>this._processCartItems()));this._processPending=0;v.register((e=>{if(/.*cart.*/.test(e.url)){if((e.method&&"POST"===e.method.toString().toUpperCase()||-1!==e.url.indexOf("/cart/add")||-1!==e.url.indexOf("/cart/change"))&&delete this.shopifyCart.cache,this._processPending++,this._processPending>2)return this._processPending=0,void s.warn("[live-options] cart process skipped to avoid endless loop");t()}}));setTimeout((()=>t()),2e3)}_processCartItems(){return this.shopifyCart.getCart(!0).then((t=>{this._processPending=0,this._cart=t;for(let e=0;e<t.items.length;e++){let i=t.items[e];if(!this._processCartItem(t,i,e))return}this._checkDiscount(t),-1!==oo.moneyFormat.indexOf("class")&&window.dispatchEvent(new Event("resize"));let e=document.querySelectorAll("[data-live-enabled]");if(e.length)for(let t=0;t<e.length;t++){const i=e[t];!0===i.disabled&&(i.disabled=!1),"none"===i.style.display&&(i.style.display="block")}}))}_processCartItem(t,e,i){let o=e.quantity;if(e.properties){let i=!1;if((e.properties.hasOwnProperty(eo.OPTIONS)||e.properties.hasOwnProperty(eo.ID))&&(i=!0),i){if(oo.currencyConvert){let t=or.getItem(e.properties[eo.ID]);t?.currency&&t.currency!==oo.currency&&(this._convertOptionsPriceProperties(t.properties),t.currency=oo.currency,or.storeItem(e.properties[eo.ID],t))}let i=0;e.properties[eo.ID]&&e.properties.hasOwnProperty(eo.OPTIONS)&&e.properties[eo.PRICE]&&(i=parseInt(e.properties[eo.PRICE]));let r=this._resolveCartItemEl(t,e);0===r.length&&s.warn("[live-options] missing cart item element for: ",e);for(let t=0;t<r.length;t++){const i=r[t];if(e.properties.hasOwnProperty(eo.OPTIONS)||(o=0),i){let t="_preview",o=e.properties[t];if(!o&&io.cartItemPreviewViews)for(const i in e.properties)if(e.properties.hasOwnProperty(i)&&i.startsWith(t)&&e.properties[i]){o=e.properties[i];break}if(o){let t=i.querySelector("[data-live-item-image]");if(!t&&io.cartItemPreview){let o=n.pathBaseName(e.image,!1);t=i.querySelector('img[src*="'+o+'"], img[data-src*="'+o+'"], img[data-srcset*="'+o+'"]')}t&&(t.src=o,t.hasAttribute("srcset")&&t.removeAttribute("srcset"),t.hasAttribute("data-srcset")&&t.removeAttribute("data-srcset"),t.hasAttribute("data-src")&&t.removeAttribute("data-src"))}if(!window.Cloudlift.upload)for(const t in e.properties)if(e.properties.hasOwnProperty(t)){let o=e.properties[t];if("string"==typeof o&&-1!==o.indexOf("cloudlift.app")){let t=n.findElementContainsText("*",n.escapeRegex(o),i);if(t.length>0){let e=t[t.length-1],i=document.createElement("span");i.className="cl-prop",i.innerHTML=e.textContent.replace(o,'<a href="'+o+'" target="_blank" style="cursor:pointer;border:0;">'+l.get("product.options.file.link")+"</a>"),e.parentNode.replaceChild(i,e)}}}let r=i.querySelector("[data-live-item-edit]");if(!r&&io.cartItemEdit){let t=this._resolveItemOptionsLocation(e,i),o="afterend";if(!t&&Object.keys(e.properties).filter((t=>!t.startsWith("_")&&e.properties[t])).length&&(t=i.querySelector('a[href*="/cart/change"]'),o="beforebegin"),null!=t){s.debug("---\x3e adding editBtn: "+o,t),r=document.createElement("a"),r.style.padding="5px 10px",r.style.border="1px solid #d1d5db",r.style.borderRadius="3px",r.innerText=l.get("product.options.item.edit"),r.dataset.liveItemEdit="1";let e=document.createElement("div");e.style.padding="10px 0",e.appendChild(r),t.insertAdjacentElement(o,e)}}if(r){s.debug("---\x3e using editBtn element",r);let t=e.url+"&item="+e.key;"A"===r.tagName?r.href=t:r.addEventListener("click",(()=>window.location.href=t))}if(io.cartItemClOptions)for(let t in e.properties)if(e.properties.hasOwnProperty(t)&&t.startsWith(eo.OPTIONS)&&-1!==i.innerHTML.indexOf(t)){let o=n.findElementContainsRegex("*",new RegExp(`${t}.*${e.properties[t]}`,"s"),i);if(o.length>0){let i=o[o.length-1],n=!0;for(let t in e.properties)if(e.properties.hasOwnProperty(t)&&-1!==i.innerHTML.indexOf(t)){n=!1;break}if(n)i.parentNode.removeChild(i);else{let o=String(e.properties[t]),n=i.innerHTML.indexOf(t),r=i.innerHTML.indexOf(o)+o.length;i.innerHTML=i.innerHTML.replace(i.innerHTML.slice(n,r),"")}}}if(e.properties[eo.ID]&&e.properties.hasOwnProperty(eo.OPTIONS)&&io.cartItemPriceOptions&&!e.properties[eo.BUNDLE]){let t=or.getItem(e.properties[eo.ID]);if(t?.properties)for(let o in t.properties)if("_"!==o.charAt(0)&&t.properties.hasOwnProperty(o)&&e.properties.hasOwnProperty(o)){let r=n.findElementContainsRegex("*",new RegExp(`${n.escapeRegex(o)}.*${n.escapeRegex(e.properties[o])}`,"s"),i);if(r.length>0){let i=r[r.length-1],n=o.replace(/^[^a-zA-Z]+|[^\w]+/g,"");const a="p"+n.charAt(0).toUpperCase()+n.slice(1);if(!i.dataset[a]){s.debug("--\x3e found element to display options price for property: "+o,i);let n=e.properties[o];-1!==n.indexOf("&")&&-1!==i.innerHTML.indexOf("&amp;")&&(n=n.replace(/&/g,"&amp;")),i.innerHTML=i.innerHTML.replace(n,n+" | "+t.properties[o]),i.dataset[a]="1"}}}}if(e.has_components&&e.properties[eo.BUNDLE]){let t=i.querySelector("[data-live-item-bundle]");if(!t&&io.bundleCartLayout){let o=r||this._resolveItemOptionsLocation(e,i);null!=o&&(s.debug("---\x3e adding bundle layout: ",o),t=document.createElement("div"),t.dataset.liveItemBundle="1",o.insertAdjacentElement("afterend",t))}t&&this._renderBundleLayout(e,t)}}else e.properties.hasOwnProperty(eo.OPTIONS)&&s.debug("--\x3e no cart item node found for item: ",e)}}}return!0}_resolveCartItemEl(t,e){let i=[],o=['[data-live-item-key="'+e.key+'"]','[data-line-item-key="'+e.key+'"]','[data-cart-item-key="'+e.key+'"]',".cart_item_"+e.id];for(let t=0;t<o.length;t++){const e=o[t];if(i=document.querySelectorAll(e),i.length)return i}if(e.image&&io.cartItem){let i;s.debug("--\x3e [cart-item] image fallback ",e);let o=n.pathBaseName(e.image,!1),r=['img[src*="'+o+'"]','img[data-src*="'+o+'"]','img[data-srcset*="'+o+'"]'];if(this.config.itemImgParentSelector){let t=this.config.itemImgParentSelector.split(","),e=[];for(let i=0;i<t.length;i++){const o=t[i];for(let t=0;t<r.length;t++){const i=r[t];e.push(o+" "+i)}}r=e}let a=document.querySelectorAll(r.join(","));if(a.length>0){for(let o=0;o<a.length;o++){const r=a[o];if(this.config.itemImgParentSelector){let t=n.findParent(r,this.config.itemImgParentSelector);if(t&&!t.dataset.liveItemKey)return t.dataset.liveItemKey=e.key,s.debug("resolved cart item node via parent selector ",this.config.itemImgParentSelector,t),[t]}let l=n.findParent(r,"form");if(!l){if(1===a.length)return i=a[0].parentNode,i.dataset.liveItemKey=e.key,[i];continue}let c=r;for(;c!==l;){if(-1!==c.innerHTML.indexOf(e.key)){let i=!0;if(t.items.length>1)for(let o=0;o<t.items.length;o++){const n=t.items[o];if(n!==e&&-1!==c.innerHTML.indexOf(n.key)){i=!1;break}}if(i)return c.dataset.liveItemKey=e.key,s.debug("auto resolved cart item node ",c),[c];break}c=c.parentElement}}let o=a[0];i=n.findParent(o,"tr")||n.findParent(o,"li")||n.findParent(o,"div")||o.parentNode,i.dataset.liveItemKey=e.key,s.debug("fallback cart item parent ",i)}return[i]}return i}_checkDiscount(){if(this._discountEl=document.querySelector("[data-live-discount]"),!this._discountEl&&io.cartDiscount){if(this.shopifyStore.isTheme("Dawn")){let t=document.querySelector(".cart__blocks, .drawer__footer");t&&(this._discountEl=document.createElement("div"),this._discountEl.dataset.liveDiscount="",t.insertBefore(this._discountEl,t.firstChild))}if(!this._discountEl){let t=this.shopifyStore.trimMoneyFormatAmount(oo.moneyFormat),e=this._findPriceEl('form[action*="/cart"]:not(form[action*="/cart/add"]) *, form[action*="/checkout"] *',this._cart.total_price,t);if(e){let t=e.parentNode;for(;t;){if("P"!==t.tagName){let e=getComputedStyle(t).display;if("block"===e||"flex"===e){this._discountEl=document.createElement("div"),this._discountEl.dataset.liveDiscount="1",t.insertBefore(this._discountEl,t.firstChild);break}}t=t.parentNode}}}}if(null!=this._discountEl){let t=this._getDiscount();if(t.type===ro.AUTO&&(t.valid=!0,delete this._discount),!this._discount||this._discount.code!==t.code){if(this._discount=t,this._discountInput={code:"",loading:!1,button:l.get("product.options.discount.button"),placeholder:l.get("product.options.discount.placeholder")},this._discount.type!==ro.NONE){if(window.localStorage){let t=localStorage.getItem("cl_discount");if(t){let e=JSON.parse(t);e.code===this._discount.code&&(this._discount=e)}}this._discount.valid||(this._discountInput.code=this._discount.code,this._applyDiscount())}let e='form[action*="/cart"]:not(form[action*="/cart/add"]):not([id="cart-notification-form"]), form[action*="/checkout"]',i=n.findParent(this._discountEl,e);if(!i&&(i=document.querySelector(e),i)){let t=i.getAttribute("id");t&&(this._discountInput.cartFormLink=t)}}this._renderDiscount()}}_removeDiscount(t){t&&(t.preventDefault(),t.stopImmediatePropagation()),this._discount.type=ro.NONE,this._discount.code="",this._discount.valid=!1,this.shopifyStore.removeDiscountCode(),this._renderDiscount()}_applyDiscount(t){if(t&&(t.preventDefault(),t.stopImmediatePropagation()),!this._discountInput.code)return;this._discount.type=ro.CODE,this._discount.code=this._discountInput.code,this._discount.valid=!1,this._discountInput.loading=!0,this._discountInput.error="",this._discountInput.success="";let e=[];for(let t=0;t<this._cart.items.length;t++){const i=this._cart.items[t];let o=this.shopifyCart.toItem(i.id,i.quantity,i.properties);o.productId=i.product_id,e.push(o)}const i={items:e,discount:this._discount,currency:this._cart.currency,country:window.Shopify?window.Shopify.country:void 0};let o=new r(this.config.api+"/api/checkout/discount",{method:"POST",data:{checkout:i},responseType:"json",headers:{"Content-type":"application/json"},queryParams:{shop:this.config.shop}});return this._renderDiscount(),o.then((t=>{this._discountInput.loading=!1,t.data?(this._discount=t.data,this._discount.valid=!0,this._discountInput.code="",window.localStorage&&localStorage.setItem("cl_discount",JSON.stringify(this._discount)),this.shopifyStore.saveDiscountCode(this._discount.code),this._discountInput.success=l.get("product.options.discount.valid")):this._discountInput.error=l.get("product.options.discount.invalid"),this._renderDiscount(),s.debug("[live-options-api] checkout discount response",t.data)})).catch((t=>{this._discountInput.loading=!1,this._discountInput.error="Please try again",this._renderDiscount(),s.error("[live-options-api] checkout discount error",t)}))}_renderDiscount(){var t,e,i,o,n;tt((t=this._discount,e=this._discountInput,i=this._applyDiscount.bind(this),o=this._removeDiscount.bind(this),n=t=>{this._discountInput.code=t.target.value,this._discountInput.error&&(this._discountInput.error="",this._renderDiscount())},et`
    
    ${t.type!==ro.AUTO?et`
    <div class="cl-po--discount">
        <div class="cl-po--discount-input">
            <input type="text" placeholder=${e.placeholder} class="${Zo({"cl-po--invalid":e.error})}" .value=${Go(e.code)} @input=${t=>n(t)} />
            <button @click=${t=>i(t)}>
                ${e.loading?et`<svg class="cl-po--icon loading" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M20 10c0 5.523-4.477 10-10 10S0 15.523 0 10 4.477 0 10 0v2c-4.418 0-8 3.582-8 8s3.582 8 8 8 8-3.582 8-8h2z"></path></svg>`:e.button}
            </button>
        </div>
        ${e.error?et` <p class="cl-po--discount-error">${e.error}</p>`:null}
       
        ${t.valid?et`
        <div class="cl-po--discount-wrap">
            <input type="hidden" name="discount" .value=${Go(t.code)} form=${Pi(e.cartFormLink)} />
            
            <div class="cl-po--discount-tag">
                <svg class="cl-po--icon tag" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18"><path d="M17.78 3.09C17.45 2.443 16.778 2 16 2h-5.165c-.535 0-1.046.214-1.422.593l-6.82 6.89c0 .002 0 .003-.002.003-.245.253-.413.554-.5.874L.738 8.055c-.56-.953-.24-2.178.712-2.737L9.823.425C10.284.155 10.834.08 11.35.22l4.99 1.337c.755.203 1.293.814 1.44 1.533z" fill-opacity=".55"></path><path d="M10.835 2H16c1.105 0 2 .895 2 2v5.172c0 .53-.21 1.04-.586 1.414l-6.818 6.818c-.777.778-2.036.782-2.82.01l-5.166-5.1c-.786-.775-.794-2.04-.02-2.828.002 0 .003 0 .003-.002l6.82-6.89C9.79 2.214 10.3 2 10.835 2zM13.5 8c.828 0 1.5-.672 1.5-1.5S14.328 5 13.5 5 12 5.672 12 6.5 12.672 8 13.5 8z"></path></svg>
                <span>${t.code}</span>
                <button @click=${t=>o(t)}>
                    <svg class="cl-po--icon remove" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 13 13"><path d="M1.5 1.5l10.05 10.05M11.5 1.5L1.45 11.55" stroke-width="2" fill="none" fill-rule="evenodd" stroke-linecap="round"></path></svg>
                </button>
            </div>
    
            ${e.success?et` <p class="cl-po--discount-success">${e.success}</p>`:null}
        </div>
        `:null}
    </div>
    `:null}
`),this._discountEl)}_findPriceEl(t,e,i,o){let r,a=ho(e,i);return r=0===e||io.cartPriceRegex?n.findElementContainsRegex(t,new RegExp(`[^0-9]${a}[^0-9]`,"s"),o):n.findElementContainsText(t,a,o),0===r.length&&(s.debug("no price elements found for price:",a,o),io.amountNoDecimals&&(a=ho(e,"{{ amount_no_decimals }}"),s.debug("fallback {{ amount_no_decimals }} price: ",a,o),r=n.findElementContainsText("*",a,o))),r.length?r[r.length-1]:null}_convertOptionsPriceProperties(t){for(let e in t)if("_"!==e.charAt(0)&&t.hasOwnProperty(e)&&t.hasOwnProperty("_"+e)){let i=parseInt(t["_"+e]);i=no(i),t[e]=ho(100*i,oo.moneyFormat).replace(/(<([^>]+)>)/gi,"")}}_resolveItemOptionsLocation(t,e){let i,o=[],r={...t.properties};for(const t in r)"_"!==t.charAt(0)&&""!==r[t]||delete r[t];if(t.options_with_values?.length)for(const e of t.options_with_values)r.hasOwnProperty(e.name)||(r[e.name]=e.value);for(const t in r){let s=n.findElementContainsRegex("*",new RegExp(`${n.escapeRegex(t)}.*${n.escapeRegex(r[t])}`,"s"),e);if(s.length>0)if(o.length){for(let t=s.length-1;t>=0;t--){const e=s[t];if(-1!==o.indexOf(e)){i=e;break}}if(i)break}else o.push(...s)}return!i&&o.length&&(i=o[o.length-1]),i}async _renderBundleLayout(t,e){let i=JSON.parse(t.properties[eo.BUNDLE]),o=i.find((t=>"0"===t.id));o||(o={handle:t.handle,id:"0",quantity:1},i.unshift(o));let n=0,r=0,s=!1;t.properties[eo.PRICE]&&(r=t.properties[eo.PRICE_BASE]?parseFloat(t.properties[eo.PRICE_BASE])/100:parseFloat(t.properties[eo.PRICE])/100,n=no(r)),oo.checkout.variantId&&(n>0&&i.splice(1,0,{handle:oo.priceProductHandle||"product-options",id:oo.checkout.variantId,quantity:o.quantity,price:r}),s=!0);let a=[];for(let e of i){let i=e.handle,o=e.id;"0"===e.id&&(i=t.handle,o=t.variant_id),a.push(this.shopifyStore.getProduct(i).then((t=>{let i=t.variants.find((t=>t.id===Number(o)));if(!i)return null;if(e={...e,title:i.name,img:go(i.featured_image?.src||t.featured_image,"200x"),url:`${t.url}?variant=${i.id}`,priceBefore:i.price/100},e.price){let t=e.price;e.priceBase&&(t=e.priceBase),e.price=no(t)}if("0"===e.id)if(e.price||(e.price=e.priceBefore),s){if(e.price<0){let t=e.priceBefore,i=t+Math.abs(e.price);n-=i,e.price=t}}else e.price+=n,e.priceBefore+=n;return e})))}if(i=await Promise.all(a),i=i.filter((t=>t)),s){let t=i.find((t=>t.id===oo.checkout.variantId));if(t){let e=t.price;t.price=n,t.priceBefore=e}}let l=i.reduce(((e,i)=>e+i.quantity*t.quantity),0);tt(mr(t,i,l,!1!==window.clBundleCartOpen),e)}_watchQuickView(){let t=["[data-live-quick-view]",".quick-add__submit"].join(",");document.addEventListener("click",(e=>{e.target&&n.matchesIncludeParent(e.target,t)&&setTimeout((()=>{this.setup(!0)}),1e3)}),{capture:!0})}_compatible(){const t=t=>`[Live Product Options] found incompatible app: ${t} \n**Please reach out to our app support to check your theme**`,e=e=>this.shopifyStore.isThemeEditor()?alert(t(e)):console.error(t(e));"undefined"!=typeof cst_money_formate?e("Customify"):null!==document.querySelector('script[src*="options.ymq"]')?e("YMQ Product Options"):null!==document.querySelector('script[src*="customily"]')&&e("Customily")}constructor(t){this.config=t,this.products=[];let e={};if(l.locale&&String.prototype.startsWith&&window.location.pathname.toLowerCase().startsWith("/"+l.locale.toLowerCase())&&(e.api="/"+l.locale.toLowerCase()),window.Shopify&&window.Shopify.routes&&window.Shopify.routes.root&&"/"!==window.Shopify.routes.root){let t=window.Shopify.routes.root;e.api="/"===t[t.length-1]?t.substr(0,t.length-1):t}if(this.shopifyStore=u.getInstance({api:e.api}),this.shopifyCart=g.getInstance(e),this.conditionsEngine=new qn,this.currency=oo,this.config.theme)for(let t in this.config.theme)this.config.theme.hasOwnProperty(t)&&(io[t]=this.config.theme[t]);this.config.themeId&&window.Shopify&&window.Shopify.theme&&window.Shopify.theme.id&&this.config.themeId!==window.Shopify.theme.id.toString()&&(s.debug("--\x3e theme.id config does not match - reseting custom selectors ",this.config.themeId,window.Shopify.theme.id.toString()),delete this.config.previewImgMainSelector,delete this.config.previewImgThumbnailSelector,delete this.config.itemImgParentSelector),this.shopifyStore.isTheme("Dawn")?(io.themeGallery=void 0===this.config.theme.themeGallery||this.config.theme.themeGallery,io.productPriceObserver=!0,this.config.itemImgParentSelector=".cart-notification, .cart-item"):this.shopifyStore.isTheme("Horizon")&&(io.themeGallery=void 0===this.config.theme.themeGallery||this.config.theme.themeGallery,io.productPriceObserver=!0,io.previewHiddenExclude=!0),window.theme&&window.theme.settings&&window.theme.settings.superScriptPrice&&(io.amountNoDecimals=!0);for(let t in this.config.currencyFormats)if(this.config.currencyFormats.hasOwnProperty(t)){let e=this.config.currencyFormats[t];-1!==e.indexOf("&")&&(e=n.decodeHtml(e)),"moneyWithCurrencyFormat"===t&&(t="moneyFormatWithCurrency"),oo[t]=e}if(oo.priceVariant=!this.config.priceDraft,oo.priceVariantId=this.config.priceVariantId,oo.priceVariantValue=this.config.priceVariantValue,oo.priceProductHandle=this.config.priceProductHandle,oo.currencyConvert=window.theme&&Array.isArray(window.theme.currencies)?window.theme.currencies.length>1:this.config.currencyConvert,window.Shopify&&window.Shopify.currency&&(oo.currency=window.Shopify.currency.active,oo.currencyConvert)){let t=parseFloat(window.Shopify.currency.rate);isNaN(t)||1===t||(oo.currencyFactor=t)}if(oo.currencyConvert||-1===oo.moneyFormat.indexOf("<")||-1===oo.moneyFormat.indexOf(">")||(io.currencyFormat=!1),io.currencyFormat&&window.theme&&window.theme.moneyFormat&&(oo.moneyFormat=window.theme.moneyFormat,oo.moneyFormatWithCurrency=window.theme.moneyFormatWithCurrency||window.theme.moneyFormat),io.priceVisibleCustomer&&this.config.setup&&(io.priceVisible=null!==this.shopifyStore.getCustomerId()),this.config.checkout&&this.config.checkoutConfig&&(oo.priceVariant=!1,oo.checkout=this.config.checkoutConfig),t.extensions){let e=t.extensions.split(",");for(let t=0;t<e.length;t++){const i=e[t];ao[i.toUpperCase()]=!0}}if(this.config.css&&n.addStyleElement(this.config.css),this.config.js&&n.addScriptElement(this.config.js),this.config.setup&&(/complete|interactive|loaded/.test(document.readyState)?this.setup():(s.debug("---\x3e document not ready ("+document.readyState+") => waiting for DOMContentLoaded"),document.addEventListener("DOMContentLoaded",(()=>this.setup()),!1)),this.shopifyStore.onThemeSectionEvent("load",(t=>{this.setup()})),n.hasQueryParam(window.location.href,hr.RESTORE_PARAM))){new hr({api:this.config.api,shop:this.config.shop,app:"options"}).restoreOrder(n.getQueryParam(window.location.href,hr.RESTORE_PARAM))}}};
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const fr=(t=!1)=>{if(!t&&"content"in document.createElement("template"))return;const e=document.implementation.createHTMLDocument("template"),i=e.body,o={enumerable:!0,configurable:!0},n=Document.prototype.createElement;Document.prototype.createElement=function(t,r){const s=n.call(this,t,r);return"TEMPLATE"===s.tagName&&(t=>{const n=e.createDocumentFragment();Object.defineProperties(t,{content:Object.assign(Object.assign({},o),{get:()=>n}),innerHTML:Object.assign(Object.assign({},o),{set:function(t){i.innerHTML=t,C(n,n.firstChild),x(n,i.firstChild)}})})})(s),s}};let vr=()=>{fr();const t=window.Cloudlift.options.config;s.setDefaultLevel(s.levels.ERROR);let e=s.getLevel();s.setLevel(void 0!==t.log?t.log:e),s.debug("got config",t),window.addEventListener("cloudlift.options.ready",(t=>{s.debug("resources loaded")}));const i=-1===t.api.indexOf("local")?t.api.replace("api.","assets."):t.api;d.fonts=t.fonts,d.api=i+"/api/font",d.apiParams.shop=t.shop,l.translations=t.i18n||{},t.setup?window.clTranslate?l.translations=n.extend(l.translations,window.clTranslate):(l.api=i+"/api/assets/"+t.app+"/translate/{locale}?shop="+t.shop,l.event+="."+t.app,l.locale&&t.locale&&l.locale!=t.locale&&l.fetch(l.locale)):(window.Translate=l,window.FontLoader=d),window.Cloudlift.options.lib={ProductOptions:cr,ProductPreview:er,Translate:l,FontLoader:d},l.ready.then((()=>{window.Cloudlift.options.App=new gr(t)}))};"Promise"in window&&"assign"in Object&&String.prototype.startsWith&&Array.prototype.flat?vr():t(en)(window.Cloudlift.options.config.assets+"/static/lib/core-js/core-js.min.js",vr)}();