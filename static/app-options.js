!function(){function e(e){return e&&e.__esModule?e.default:e}class t{static merge(e,i,r){for(let o in i)!i.hasOwnProperty(o)||null!=r&&-1===r.indexOf(o)||("[object Object]"===Object.prototype.toString.call(i[o])?e[o]=t.merge(e[o],i[o]):void 0!==i[o]&&(e[o]=i[o]));return e}static extend(){let e={},i=function(i){for(let r in i)i.hasOwnProperty(r)&&("[object Object]"===Object.prototype.toString.call(i[r])?e[r]=t.extend(e[r],i[r]):void 0!==i[r]&&(e[r]=i[r]))};for(let e=0;e<arguments.length;e++){i(arguments[e])}return e}static isElement(e){return"object"==typeof e&&void 0!==e.nodeType}static isNodeList(e){let i=Object.prototype.toString.call(e),r="object"==typeof e&&/^\[object (HTMLCollection|NodeList|RadioNodeList|Object)\]$/.test(i)&&"number"==typeof e.length&&(0===e.length||"object"==typeof e[0]&&e[0].nodeType>0);return!r&&Array.isArray(e)&&e.length>0?t.isElement(e[0]):r}static isInPage(e){return e!==document.body&&document.body.contains(e)}static isHidden(e){return 0===e.offsetHeight||0===e.offsetWidth||null===e.offsetParent||"none"===window.getComputedStyle(e).display||1===e.offsetHeight&&1===e.offsetWidth}static isMinSize(e,t=1,i=1){const r=e.getBoundingClientRect();return!(r.width>t||r.height>t)}static isScrolledIntoView(e){let t=e.getBoundingClientRect(),i=t.top,r=t.bottom;return i>=0&&r<=window.innerHeight}static matches(e,t){return Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(e){for(var t=(this.document||this.ownerDocument).querySelectorAll(e),i=t.length;--i>=0&&t.item(i)!==this;);return i>-1}),e.matches(t)}static matchesIncludeParent(e,i){return!(!e||!t.matches(e,i)&&null==t.findParent(e,i))}static findParent(e,i){if("function"==typeof e.closest)return e.closest(i)||null;for(;e;){if(t.matches(e,i))return e;e=e.parentElement}return null}static findInnerDimensions(e){let t=getComputedStyle(e),i=e.clientWidth,r=e.clientHeight;return r-=parseFloat(t.paddingTop)+parseFloat(t.paddingBottom),i-=parseFloat(t.paddingLeft)+parseFloat(t.paddingRight),{height:r,width:i}}static getCalculatedPosition(e){const t=document.body,i=document.documentElement,r=window.pageYOffset||i.scrollTop||t.scrollTop,o=window.pageXOffset||i.scrollLeft||t.scrollLeft,n=e.getBoundingClientRect();return{top:n.top+r,left:n.left+o,right:n.left+o+n.width,bottom:n.top+r+n.height}}static findElementContainsText(e,i,r=document){return t.findElementContainsRegex(e,new RegExp(i),r)}static findElementContainsRegex(e,t,i=document){let r=i.querySelectorAll(e);return Array.prototype.filter.call(r,(function(e){return t.test(e.textContent)}))}static escapeRegex(e){return e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}static readCookie(e){e+="=";for(let t=document.cookie.split(/;\s*/),i=t.length-1;i>=0;i--)if(!t[i].indexOf(e))return t[i].replace(e,"")}static writeCookie(e,t,i,r="/"){let o=new Date;o.setDate(o.getDate()+i);let n=null==i?"":"; expires="+o.toUTCString();document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(t)+n+(r?"; path="+r:"")+";"}static removeCookie(e,t="/"){document.cookie=e+"=; Path="+t+"; Expires=Thu, 01 Jan 1970 00:00:01 GMT;"}static addStyleElement(e,t){t&&"head"!=t||(t=document.head||document.getElementsByTagName("head")[0]);let i=document.createElement("style");return i.appendChild(document.createTextNode(e)),t.appendChild(i),i}static addScriptElement(e,t){t&&"head"!=t||(t=document.head||document.getElementsByTagName("head")[0]);let i=document.createElement("script");return i.appendChild(document.createTextNode(e)),t.appendChild(i),i}static objectKeys(e){if(!Object.keys){let t,i=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&i.push(t);return i}return Object.keys(e)}static hasQueryParam(e,t){return-1!==e.indexOf(t)}static getQueryParam(e,t){let i=new RegExp("[?&]"+t+"=([^&#]*)","i").exec(e);return i?decodeURIComponent(i[1]):null}static getQueryParams(e){let t={},i=document.createElement("a");i.href=e;let r=i.search.substring(1).split("&");for(let e=0;e<r.length;e++){let i=r[e].split("=");t[i[0]]=decodeURIComponent(i[1])}return t}static buildQueryParams(e){return Object.keys(e).map((t=>encodeURIComponent(t)+"="+encodeURIComponent(e[t]))).join("&")}static debounced(e,t){let i;return function(...r){i&&clearTimeout(i),i=setTimeout((()=>{t(...r),i=null}),e)}}static throttled(e,t){let i=0;return function(...r){const o=(new Date).getTime();if(!(o-i<e))return i=o,t(...r)}}static decodeHtml(e){const t=document.createElement("textarea");return t.innerHTML=e,t.value}static pathBaseName(e,t=!0){let i=e.split("/").pop();return t||(i=i.substring(0,i.lastIndexOf("."))),i}static getAgent(){return navigator.userAgent||navigator.vendor||window.opera}static isInApp(e){return e.indexOf("FBAN")>-1||e.indexOf("FBAV")>-1||e.indexOf("Instagram")>-1}static isFacebook(e){return e.indexOf("FBAN")>-1||e.indexOf("FBAV")>-1}static isInstagram(e){return e.indexOf("Instagram")>-1}static isIOS(e){return(e=e.toLowerCase()).indexOf("iphone")>-1||e.indexOf("ipad")>-1}static isAndroid(e){return(e=e.toLowerCase()).indexOf("android")>-1}static isMobile(e){return this.isAndroid(e)||this.isIOS(e)}static getImageSize(e){return new Promise(((t,i)=>{const r=new Image;r.onload=()=>{t({width:r.width,height:r.height})},r.onerror=i,r.src=e}))}static convertSizeToUnit(e,t,o){let n=e.width/t,a=e.height/t;switch(o){case"mm":return{width:Number((n*i*10).toFixed(2)),height:Number((a*i*10).toFixed(2))};case"cm":return{width:Number((n*i).toFixed(2)),height:Number((a*i).toFixed(2))};case"m":return{width:Number((n*i/100).toFixed(2)),height:Number((a*i/100).toFixed(2))};case"inch":return{width:Number(n.toFixed(2)),height:Number(a.toFixed(2))};case"feet":return{width:Number((n/r).toFixed(2)),height:Number((a/r).toFixed(2))}}return null}}const i=2.54,r=12;var o=t;var n=class{supports(){return"XMLHttpRequest"in window&&"JSON"in window&&"Promise"in window}parse(e){let t;if("text"!==this.settings.responseType&&""!==this.settings.responseType){let t=e.response;if("json"===this.settings.responseType&&"string"==typeof t)try{t=JSON.parse(t)}catch(e){}return{data:t,xhr:e}}try{t=JSON.parse(e.responseText)}catch(i){t=e.responseText}return{data:t,xhr:e}}param(e){if("string"==typeof e||"[object FormData]"===Object.prototype.toString.call(e)||"[object File]"===Object.prototype.toString.call(e)||"[object Blob]"===Object.prototype.toString.call(e))return e;if(/application\/json/i.test(this.settings.headers["Content-type"])||"[object Array]"===Object.prototype.toString.call(e))return JSON.stringify(e);let t=[];for(let i in e)e.hasOwnProperty(i)&&t.push(encodeURIComponent(i)+"="+encodeURIComponent(e[i]));return t.join("&")}addQueryParams(e){if(this.settings.queryParams){let t=[];for(let e in this.settings.queryParams)this.settings.queryParams.hasOwnProperty(e)&&t.push(e+"="+this.settings.queryParams[e]);if(t.length>0){let i=t.join("&");return-1===e.indexOf("?")?e+"?"+i:e+"&"+i}}return e}xhr(e){const t=new XMLHttpRequest,i=new Promise(((i,r)=>{t.onreadystatechange=()=>{if(4!==t.readyState)return;let e=this.parse(t);t.status>=200&&t.status<300?i(e):r(e)},e=this.addQueryParams(e),t.open(this.settings.method,e,!0,this.settings.username,this.settings.password),t.responseType=this.settings.responseType;for(let e in this.settings.headers)this.settings.headers.hasOwnProperty(e)&&t.setRequestHeader(e,this.settings.headers[e]);this.settings.timeout&&(t.timeout=this.settings.timeout,t.ontimeout=e=>{r({status:408,statusText:"Request timeout"})}),this.settings.withCredentials&&(t.withCredentials=!0),this.settings.onProgress&&(t.upload.onprogress=this.settings.onProgress),t.send(this.param(this.settings.data))}));return i.cancel=()=>{t.abort()},i}constructor(e,t){if(!this.supports())throw"This browser is not supported";return this.settings=o.extend({method:"GET",username:null,password:null,data:{},queryParams:{},headers:{},responseType:"text",timeout:null,withCredentials:!1,onProgress:null},t||{}),this.xhr(e)}},a={};!function(e,t){"use strict";"function"==typeof define&&define.amd?define(t):a?a=t():e.log=t()}(a,(function(){"use strict";var e=function(){},t="undefined",i=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),r=["trace","debug","info","warn","error"];function o(e,t){var i=e[t];if("function"==typeof i.bind)return i.bind(e);try{return Function.prototype.bind.call(i,e)}catch(t){return function(){return Function.prototype.apply.apply(i,[e,arguments])}}}function n(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function a(t,i){for(var o=0;o<r.length;o++){var n=r[o];this[n]=o<t?e:this.methodFactory(n,t,i)}this.log=this.debug}function s(e,i,r){return function(){typeof console!==t&&(a.call(this,i,r),this[e].apply(this,arguments))}}function l(r,a,l){return function(r){return"debug"===r&&(r="log"),typeof console!==t&&("trace"===r&&i?n:void 0!==console[r]?o(console,r):void 0!==console.log?o(console,"log"):e)}(r)||s.apply(this,arguments)}function c(e,i,o){var n,s=this;i=null==i?"WARN":i;var c="loglevel";function p(){var e;if(typeof window!==t&&c){try{e=window.localStorage[c]}catch(e){}if(typeof e===t)try{var i=window.document.cookie,r=i.indexOf(encodeURIComponent(c)+"=");-1!==r&&(e=/^([^;]+)/.exec(i.slice(r))[1])}catch(e){}return void 0===s.levels[e]&&(e=void 0),e}}"string"==typeof e?c+=":"+e:"symbol"==typeof e&&(c=void 0),s.name=e,s.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},s.methodFactory=o||l,s.getLevel=function(){return n},s.setLevel=function(i,o){if("string"==typeof i&&void 0!==s.levels[i.toUpperCase()]&&(i=s.levels[i.toUpperCase()]),!("number"==typeof i&&i>=0&&i<=s.levels.SILENT))throw"log.setLevel() called with invalid level: "+i;if(n=i,!1!==o&&function(e){var i=(r[e]||"silent").toUpperCase();if(typeof window!==t&&c){try{return void(window.localStorage[c]=i)}catch(e){}try{window.document.cookie=encodeURIComponent(c)+"="+i+";"}catch(e){}}}(i),a.call(s,i,e),typeof console===t&&i<s.levels.SILENT)return"No console available for logging"},s.setDefaultLevel=function(e){i=e,p()||s.setLevel(e,!1)},s.resetLevel=function(){s.setLevel(i,!1),function(){if(typeof window!==t&&c){try{return void window.localStorage.removeItem(c)}catch(e){}try{window.document.cookie=encodeURIComponent(c)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch(e){}}}()},s.enableAll=function(e){s.setLevel(s.levels.TRACE,e)},s.disableAll=function(e){s.setLevel(s.levels.SILENT,e)};var d=p();null==d&&(d=i),s.setLevel(d,!1)}var p=new c,d={};p.getLogger=function(e){if("symbol"!=typeof e&&"string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=d[e];return t||(t=d[e]=new c(e,p.getLevel(),p.methodFactory)),t};var u=typeof window!==t?window.log:void 0;return p.noConflict=function(){return typeof window!==t&&window.log===p&&(window.log=u),p},p.getLoggers=function(){return d},p.default=p,p}));class s{static get(e,t,i){let r=s.translations[e]||i||e;if(t)for(let e in t)t.hasOwnProperty(e)&&(r=r.replace(new RegExp("{"+e+"}","g"),t[e]));return r}static translate(e,t){if(e&&"string"==typeof e){if("#"===e.charAt(0))return s.get(e.substr(1).trim(),t);if(-1!==e.indexOf("#{")){let i=e;for(;-1!==i.indexOf("#{");){let e=i.indexOf("#{"),r=i.indexOf("}"),o=i.substring(e+2,r),n=s.get(o,t);i=i.replace("#{"+o+"}",n)}return i}}return e}static fetch(e){let t=s.api.replace("{locale}",e),i=new n(t,{method:"GET"});return s.ready=i.then((e=>(a.debug("[translate] "+t+" response",e.data),s.update(e.data),s.translations))).catch((e=>(a.error("[translate] "+t+" error",e),s.translations))),s.ready}static update(e){s.translations=o.extend(s.translations,e),s.updated()}static updated(){const e=new CustomEvent(s.event,{detail:{},cancelable:!0,bubbles:!0});window.dispatchEvent(e)}static onUpdated(e){window.addEventListener(s.event,e)}}s.locale=window.Shopify&&window.Shopify.locale?window.Shopify.locale:document.documentElement.lang,s.translations={},s.ready=Promise.resolve(!0),s.event="cloudlift.translate",s.api="";var l=s,c={};!function(){function e(e,t,i){return e.call.apply(e.bind,arguments)}function t(e,t,i){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,r),e.apply(t,i)}}return function(){return e.apply(t,arguments)}}function i(r,o,n){return(i=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?e:t).apply(null,arguments)}var r=Date.now||function(){return+new Date};function o(e,t){this.a=e,this.o=t||e,this.c=this.o.document}var n=!!window.FontFace;function a(e,t,i,r){if(t=e.c.createElement(t),i)for(var o in i)i.hasOwnProperty(o)&&("style"==o?t.style.cssText=i[o]:t.setAttribute(o,i[o]));return r&&t.appendChild(e.c.createTextNode(r)),t}function s(e,t,i){(e=e.c.getElementsByTagName(t)[0])||(e=document.documentElement),e.insertBefore(i,e.lastChild)}function l(e){e.parentNode&&e.parentNode.removeChild(e)}function p(e,t,i){t=t||[],i=i||[];for(var r=e.className.split(/\s+/),o=0;o<t.length;o+=1){for(var n=!1,a=0;a<r.length;a+=1)if(t[o]===r[a]){n=!0;break}n||r.push(t[o])}for(t=[],o=0;o<r.length;o+=1){for(n=!1,a=0;a<i.length;a+=1)if(r[o]===i[a]){n=!0;break}n||t.push(r[o])}e.className=t.join(" ").replace(/\s+/g," ").replace(/^\s+|\s+$/,"")}function d(e,t){for(var i=e.className.split(/\s+/),r=0,o=i.length;r<o;r++)if(i[r]==t)return!0;return!1}function u(e,t,i){function r(){p&&o&&l&&(p(c),p=null)}t=a(e,"link",{rel:"stylesheet",href:t,media:"all"});var o=!1,l=!0,c=null,p=i||null;n?(t.onload=function(){o=!0,r()},t.onerror=function(){o=!0,c=Error("Stylesheet failed to load"),r()}):setTimeout((function(){o=!0,r()}),0),s(e,"head",t)}function h(e,t,i,r){var o=e.c.getElementsByTagName("head")[0];if(o){var n=a(e,"script",{src:t}),s=!1;return n.onload=n.onreadystatechange=function(){s||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(s=!0,i&&i(null),n.onload=n.onreadystatechange=null,"HEAD"==n.parentNode.tagName&&o.removeChild(n))},o.appendChild(n),setTimeout((function(){s||(s=!0,i&&i(Error("Script load timeout")))}),r||5e3),n}return null}function m(){this.a=0,this.c=null}function g(e){return e.a++,function(){e.a--,v(e)}}function f(e,t){e.c=t,v(e)}function v(e){0==e.a&&e.c&&(e.c(),e.c=null)}function y(e){this.a=e||"-"}function _(e,t){this.c=e,this.f=4,this.a="n";var i=(t||"n4").match(/^([nio])([1-9])$/i);i&&(this.a=i[1],this.f=parseInt(i[2],10))}function w(e){var t=[];e=e.split(/,\s*/);for(var i=0;i<e.length;i++){var r=e[i].replace(/['"]/g,"");-1!=r.indexOf(" ")||/^\d/.test(r)?t.push("'"+r+"'"):t.push(r)}return t.join(",")}function b(e){return e.a+e.f}function x(e){var t="normal";return"o"===e.a?t="oblique":"i"===e.a&&(t="italic"),t}function C(e){var t=4,i="n",r=null;return e&&((r=e.match(/(normal|oblique|italic)/i))&&r[1]&&(i=r[1].substr(0,1).toLowerCase()),(r=e.match(/([1-9]00|normal|bold)/i))&&r[1]&&(/bold/i.test(r[1])?t=7:/[1-9]00/.test(r[1])&&(t=parseInt(r[1].substr(0,1),10)))),i+t}function E(e,t){this.c=e,this.f=e.o.document.documentElement,this.h=t,this.a=new y("-"),this.j=!1!==t.events,this.g=!1!==t.classes}function S(e){if(e.g){var t=d(e.f,e.a.c("wf","active")),i=[],r=[e.a.c("wf","loading")];t||i.push(e.a.c("wf","inactive")),p(e.f,i,r)}I(e,"inactive")}function I(e,t,i){e.j&&e.h[t]&&(i?e.h[t](i.c,b(i)):e.h[t]())}function P(){this.c={}}function M(e,t){this.c=e,this.f=t,this.a=a(this.c,"span",{"aria-hidden":"true"},this.f)}function O(e){s(e.c,"body",e.a)}function L(e){return"display:block;position:absolute;top:-9999px;left:-9999px;font-size:300px;width:auto;height:auto;line-height:normal;margin:0;padding:0;font-variant:normal;white-space:nowrap;font-family:"+w(e.c)+";font-style:"+x(e)+";font-weight:"+e.f+"00;"}function k(e,t,i,r,o,n){this.g=e,this.j=t,this.a=r,this.c=i,this.f=o||3e3,this.h=n||void 0}function $(e,t,i,r,o,n,a){this.v=e,this.B=t,this.c=i,this.a=r,this.s=a||"BESbswy",this.f={},this.w=o||3e3,this.u=n||null,this.m=this.j=this.h=this.g=null,this.g=new M(this.c,this.s),this.h=new M(this.c,this.s),this.j=new M(this.c,this.s),this.m=new M(this.c,this.s),e=L(e=new _(this.a.c+",serif",b(this.a))),this.g.a.style.cssText=e,e=L(e=new _(this.a.c+",sans-serif",b(this.a))),this.h.a.style.cssText=e,e=L(e=new _("serif",b(this.a))),this.j.a.style.cssText=e,e=L(e=new _("sans-serif",b(this.a))),this.m.a.style.cssText=e,O(this.g),O(this.h),O(this.j),O(this.m)}y.prototype.c=function(e){for(var t=[],i=0;i<arguments.length;i++)t.push(arguments[i].replace(/[\W_]+/g,"").toLowerCase());return t.join(this.a)},k.prototype.start=function(){var e=this.c.o.document,t=this,i=r(),o=new Promise((function(o,n){!function a(){r()-i>=t.f?n():e.fonts.load(function(e){return x(e)+" "+e.f+"00 300px "+w(e.c)}(t.a),t.h).then((function(e){1<=e.length?o():setTimeout(a,25)}),(function(){n()}))}()})),n=null,a=new Promise((function(e,i){n=setTimeout(i,t.f)}));Promise.race([a,o]).then((function(){n&&(clearTimeout(n),n=null),t.g(t.a)}),(function(){t.j(t.a)}))};var T={D:"serif",C:"sans-serif"},A=null;function F(){if(null===A){var e=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent);A=!!e&&(536>parseInt(e[1],10)||536===parseInt(e[1],10)&&11>=parseInt(e[2],10))}return A}function D(e,t,i){for(var r in T)if(T.hasOwnProperty(r)&&t===e.f[T[r]]&&i===e.f[T[r]])return!0;return!1}function N(e){var t,o=e.g.a.offsetWidth,n=e.h.a.offsetWidth;(t=o===e.f.serif&&n===e.f["sans-serif"])||(t=F()&&D(e,o,n)),t?r()-e.A>=e.w?F()&&D(e,o,n)&&(null===e.u||e.u.hasOwnProperty(e.a.c))?j(e,e.v):j(e,e.B):function(e){setTimeout(i((function(){N(this)}),e),50)}(e):j(e,e.v)}function j(e,t){setTimeout(i((function(){l(this.g.a),l(this.h.a),l(this.j.a),l(this.m.a),t(this.a)}),e),0)}function R(e,t,i){this.c=e,this.a=t,this.f=0,this.m=this.j=!1,this.s=i}$.prototype.start=function(){this.f.serif=this.j.a.offsetWidth,this.f["sans-serif"]=this.m.a.offsetWidth,this.A=r(),N(this)};var V=null;function z(e){0==--e.f&&e.j&&(e.m?((e=e.a).g&&p(e.f,[e.a.c("wf","active")],[e.a.c("wf","loading"),e.a.c("wf","inactive")]),I(e,"active")):S(e.a))}function q(e){this.j=e,this.a=new P,this.h=0,this.f=this.g=!0}function B(e,t,r,o,n){var a=0==--e.h;(e.f||e.g)&&setTimeout((function(){var e=n||null,s=o||{};if(0===r.length&&a)S(t.a);else{t.f+=r.length,a&&(t.j=a);var l,c=[];for(l=0;l<r.length;l++){var d=r[l],u=s[d.c],h=t.a,m=d;if(h.g&&p(h.f,[h.a.c("wf",m.c,b(m).toString(),"loading")]),I(h,"fontloading",m),h=null,null===V)if(window.FontFace){m=/Gecko.*Firefox\/(\d+)/.exec(window.navigator.userAgent);var g=/OS X.*Version\/10\..*Safari/.exec(window.navigator.userAgent)&&/Apple/.exec(window.navigator.vendor);V=m?42<parseInt(m[1],10):!g}else V=!1;h=V?new k(i(t.g,t),i(t.h,t),t.c,d,t.s,u):new $(i(t.g,t),i(t.h,t),t.c,d,t.s,e,u),c.push(h)}for(l=0;l<c.length;l++)c[l].start()}}),0)}function H(e,t){this.c=e,this.a=t}function U(e,t){this.c=e,this.a=t}function W(e,t){this.c=e||Y,this.a=[],this.f=[],this.g=t||""}R.prototype.g=function(e){var t=this.a;t.g&&p(t.f,[t.a.c("wf",e.c,b(e).toString(),"active")],[t.a.c("wf",e.c,b(e).toString(),"loading"),t.a.c("wf",e.c,b(e).toString(),"inactive")]),I(t,"fontactive",e),this.m=!0,z(this)},R.prototype.h=function(e){var t=this.a;if(t.g){var i=d(t.f,t.a.c("wf",e.c,b(e).toString(),"active")),r=[],o=[t.a.c("wf",e.c,b(e).toString(),"loading")];i||r.push(t.a.c("wf",e.c,b(e).toString(),"inactive")),p(t.f,r,o)}I(t,"fontinactive",e),z(this)},q.prototype.load=function(e){this.c=new o(this.j,e.context||this.j),this.g=!1!==e.events,this.f=!1!==e.classes,function(e,t,i){var r=[],o=i.timeout;!function(e){e.g&&p(e.f,[e.a.c("wf","loading")]),I(e,"loading")}(t);r=function(e,t,i){var r,o=[];for(r in t)if(t.hasOwnProperty(r)){var n=e.c[r];n&&o.push(n(t[r],i))}return o}(e.a,i,e.c);var n=new R(e.c,t,o);for(e.h=r.length,t=0,i=r.length;t<i;t++)r[t].load((function(t,i,r){B(e,n,t,i,r)}))}(this,new E(this.c,e),e)},H.prototype.load=function(e){function t(){if(n["__mti_fntLst"+r]){var i,o=n["__mti_fntLst"+r](),a=[];if(o)for(var s=0;s<o.length;s++){var l=o[s].fontfamily;null!=o[s].fontStyle&&null!=o[s].fontWeight?(i=o[s].fontStyle+o[s].fontWeight,a.push(new _(l,i))):a.push(new _(l))}e(a)}else setTimeout((function(){t()}),50)}var i=this,r=i.a.projectId,o=i.a.version;if(r){var n=i.c.o;h(this.c,(i.a.api||"https://fast.fonts.net/jsapi")+"/"+r+".js"+(o?"?v="+o:""),(function(o){o?e([]):(n["__MonotypeConfiguration__"+r]=function(){return i.a},t())})).id="__MonotypeAPIScript__"+r}else e([])},U.prototype.load=function(e){var t,i,r=this.a.urls||[],o=this.a.families||[],n=this.a.testStrings||{},a=new m;for(t=0,i=r.length;t<i;t++)u(this.c,r[t],g(a));var s=[];for(t=0,i=o.length;t<i;t++)if((r=o[t].split(":"))[1])for(var l=r[1].split(","),c=0;c<l.length;c+=1)s.push(new _(r[0],l[c]));else s.push(new _(r[0]));f(a,(function(){e(s,n)}))};var Y="https://fonts.googleapis.com/css";function G(e){this.f=e,this.a=[],this.c={}}var X={latin:"BESbswy","latin-ext":"çöüğş",cyrillic:"йяЖ",greek:"αβΣ",khmer:"កខគ",Hanuman:"កខគ"},Q={thin:"1",extralight:"2","extra-light":"2",ultralight:"2","ultra-light":"2",light:"3",regular:"4",book:"4",medium:"5","semi-bold":"6",semibold:"6","demi-bold":"6",demibold:"6",bold:"7","extra-bold":"8",extrabold:"8","ultra-bold":"8",ultrabold:"8",black:"9",heavy:"9",l:"3",r:"4",b:"7"},Z={i:"i",italic:"i",n:"n",normal:"n"},J=/^(thin|(?:(?:extra|ultra)-?)?light|regular|book|medium|(?:(?:semi|demi|extra|ultra)-?)?bold|black|heavy|l|r|b|[1-9]00)?(n|i|normal|italic)?$/;function K(e,t){this.c=e,this.a=t}var ee={Arimo:!0,Cousine:!0,Tinos:!0};function te(e,t){this.c=e,this.a=t}function ie(e,t){this.c=e,this.f=t,this.a=[]}K.prototype.load=function(e){var t=new m,i=this.c,r=new W(this.a.api,this.a.text),o=this.a.families;!function(e,t){for(var i=t.length,r=0;r<i;r++){var o=t[r].split(":");3==o.length&&e.f.push(o.pop());var n="";2==o.length&&""!=o[1]&&(n=":"),e.a.push(o.join(n))}}(r,o);var n=new G(o);!function(e){for(var t=e.f.length,i=0;i<t;i++){var r=e.f[i].split(":"),o=r[0].replace(/\+/g," "),n=["n4"];if(2<=r.length){var a;if(a=[],s=r[1])for(var s,l=(s=s.split(",")).length,c=0;c<l;c++){var p;if((p=s[c]).match(/^[\w-]+$/))if(null==(d=J.exec(p.toLowerCase())))p="";else{if(p=null==(p=d[2])||""==p?"n":Z[p],null==(d=d[1])||""==d)d="4";else var d=Q[d]||(isNaN(d)?"4":d.substr(0,1));p=[p,d].join("")}else p="";p&&a.push(p)}0<a.length&&(n=a),3==r.length&&(a=[],0<(r=(r=r[2])?r.split(","):a).length&&(r=X[r[0]])&&(e.c[o]=r))}for(e.c[o]||(r=X[o])&&(e.c[o]=r),r=0;r<n.length;r+=1)e.a.push(new _(o,n[r]))}}(n),u(i,function(e){if(0==e.a.length)throw Error("No fonts to load!");if(-1!=e.c.indexOf("kit="))return e.c;for(var t=e.a.length,i=[],r=0;r<t;r++)i.push(e.a[r].replace(/ /g,"+"));return t=e.c+"?family="+i.join("%7C"),0<e.f.length&&(t+="&subset="+e.f.join(",")),0<e.g.length&&(t+="&text="+encodeURIComponent(e.g)),t}(r),g(t)),f(t,(function(){e(n.a,n.c,ee)}))},te.prototype.load=function(e){var t=this.a.id,i=this.c.o;t?h(this.c,(this.a.api||"https://use.typekit.net")+"/"+t+".js",(function(t){if(t)e([]);else if(i.Typekit&&i.Typekit.config&&i.Typekit.config.fn){t=i.Typekit.config.fn;for(var r=[],o=0;o<t.length;o+=2)for(var n=t[o],a=t[o+1],s=0;s<a.length;s++)r.push(new _(n,a[s]));try{i.Typekit.load({events:!1,classes:!1,async:!0})}catch(e){}e(r)}}),2e3):e([])},ie.prototype.load=function(e){var t=this.f.id,i=this.c.o,r=this;t?(i.__webfontfontdeckmodule__||(i.__webfontfontdeckmodule__={}),i.__webfontfontdeckmodule__[t]=function(t,i){for(var o=0,n=i.fonts.length;o<n;++o){var a=i.fonts[o];r.a.push(new _(a.name,C("font-weight:"+a.weight+";font-style:"+a.style)))}e(r.a)},h(this.c,(this.f.api||"https://f.fontdeck.com/s/css/js/")+function(e){return e.o.location.hostname||e.a.location.hostname}(this.c)+"/"+t+".js",(function(t){t&&e([])}))):e([])};var re=new q(window);re.a.c.custom=function(e,t){return new U(t,e)},re.a.c.fontdeck=function(e,t){return new ie(t,e)},re.a.c.monotype=function(e,t){return new H(t,e)},re.a.c.typekit=function(e,t){return new te(t,e)},re.a.c.google=function(e,t){return new K(t,e)};var oe={load:i(re.load,re)};"function"==typeof define&&define.amd?define((function(){return oe})):c?c=oe:(window.WebFont=oe,window.WebFontConfig&&re.load(window.WebFontConfig))}();class p{static getFont(e){for(let t of this.fonts)if(t.name===e)return t}static addFvd(e,t){return t+=":n4",e.files.italic&&(t+=",i4"),e.files.bold&&(t+=",n7"),e.files.bold_italic&&(t+=",i7"),t}static addGoogleFontStyle(e,t){let i=[];if(e.files.regular&&(e.files.regular_300?i.push("300"):i.push("400")),e.files.italic&&(e.files.italic_300?i.push("300italic"):i.push("italic")),e.files.bold&&i.push("bold"),e.files.bold_italic&&i.push("bolditalic"),i.length)return t+":"+i.join(",")}static loadFontsByName(e){let t=[],i=[];return null==this._loadQueue&&(this._loadQueue=Promise.resolve()),this._loadQueue=this._loadQueue.then((()=>{for(let r of e){let e=this.getFont(r);if(e&&!e.loaded)switch(e.type){case 0:e.loaded=!0;break;case 1:let o=this.addGoogleFontStyle(e,r);-1===i.indexOf(o)&&i.push(o);break;case 2:let n=this.addFvd(e,r);-1===t.indexOf(n)&&t.push(n)}}return t.length>0||i.length>0?this.loadFontsByFamilies(t,i):Promise.resolve(!0)})),this._loadQueue}static loadFontsByFamilies(e,t){return new Promise(((i,r)=>{const o={timeout:3e3};if(e&&e.length){let t=e.map((e=>e.substring(0,e.indexOf(":"))));o.custom={families:e,urls:[this.fontCss(t)]}}t&&t.length&&(o.google={families:t}),o.active=()=>{i()},o.inactive=()=>{i()},o.fontactive=(e,t)=>{let i=p.getFont(e);i?i.loaded=!0:p.fonts.push({name:e,loaded:!0})},o.fontinactive=(e,t)=>{let i=p.getFont(e);a.warn("[live-options] failed to load font",i),i.loaded=!0},c.load(o)}))}static fontPreview(e){let t=o.extend(p.apiParams,{name:e});return p.api+"/preview?"+o.buildQueryParams(t)}static fontCss(e){let t=o.extend(p.apiParams,{names:e.join(",")});return p.api+"/css?"+o.buildQueryParams(t)}}p.fonts=[],p.api="",p.apiParams={};var d=p;class u{static getInstance(e){return u._instance||(u._instance=new u(e)),u._instance}fakeProduct(e){this.isProduct=()=>!0,this.getHandleFromUrl=()=>e}isAdmin(){return null!=document.getElementById("admin_bar_iframe")}isProduct(){return-1!==window.location.pathname.indexOf("/products/")||this.isProductPreview()}isProductPreview(){return-1!==window.location.pathname.indexOf("/products_preview")}getDiscountUrl(e,t){return"/discount/"+e+(t?"?redirect="+t:"")}getDiscountCode(){return o.readCookie("discount_code")}saveDiscountCode(e){return o.writeCookie("discount_code",e,null,"/")}removeDiscountCode(){return o.removeCookie("discount_code")}getCustomerId(){return window.theme&&window.theme.customerId?window.theme.customerId:window.meta&&window.meta.page&&window.meta.page.customerId?window.meta.page.customerId:window.ShopifyAnalytics&&window.ShopifyAnalytics.meta&&window.ShopifyAnalytics.meta.page&&window.ShopifyAnalytics.meta.page.customerId?window.ShopifyAnalytics.meta.page.customerId:null}getHandleFromUrl(e=location.pathname){window.Shopify&&window.Shopify.routes&&window.Shopify.routes.root&&"/"!==window.Shopify.routes.root&&(e=e.replace(window.Shopify.routes.root,"/"));let t=e.replace(/\/$/,"").split("/"),i=("products"==t[t.length-2]||"products_preview"===t.pop())&&t[t.length-1].replace(/(.*)?\?.*$/,"$1");return decodeURIComponent(i).toLowerCase()}tryGetProduct(){return this.isProduct()?this.getProduct():new Promise(((e,t)=>{e(null)}))}async tryGetProductMap(){return this.isTheme("Dawn")&&await this.parseOfferJsonElements(),this.isProduct()&&await this.getProduct(),u.products}parseOfferJsonElements(){document.querySelectorAll('.featured-product form[id^="product_form_"]').forEach((e=>{e.setAttribute("id",e.getAttribute("id").replace("product_form_","product-form-installment-featured--")),a.debug("updated featured product form id: ",e,e.id)}));let e=document.querySelectorAll('script[type="application/ld+json"]'),t=[];if(e.length>0)for(let i=0;i<e.length;i++){let r=e[i];try{let e=JSON.parse(r.innerHTML);if(e.offers&&e.url){let i=this.getHandleFromUrl(e.url)+".js";u.products[i]||t.push(new Promise(((t,r)=>new n(e.url+".js",{method:"GET",responseType:"json"}).then((e=>{let r=e.data;u.products[i]=r,t(r)})).catch((e=>{r(e)})))))}}catch(e){a.debug("error parsing ProductOffer: ",r,e)}}return Promise.all(t)}parseProductJsonElements(){let e=document.querySelectorAll('[id^="ProductJson-"]');if(0===e.length&&(e=document.querySelectorAll('[data-product-json], [data-section-type="dynamic-featured-product"]')),e.length>0)for(let t=0;t<e.length;t++){let i=e[t];try{let e=JSON.parse(i.innerHTML);"object"==typeof e.product&&(e=e.product),e.handle&&(u.products[e.handle.toLowerCase()+".js"]=this.convertProductJson(e))}catch(e){a.debug("error parsing ProductJson: ",i,e)}}}convertProductJson(e){if(e.options&&e.options.length&&"object"!=typeof e.options[0]){let t=[];for(let i=0;i<e.options.length;i++){let r={name:e.options[i],position:i+1,values:[]};for(let t=0;t<e.variants.length;t++){let i=e.variants[t]["option"+r.position];i&&-1===r.values.indexOf(i)&&r.values.push(i)}t.push(r)}e.options=t}return e}getProduct(e,t="js"){if(!e&&!(e=this.getHandleFromUrl())&&this.isProductPreview())for(const e in u.products)if(u.products.hasOwnProperty(e))return new Promise(((t,i)=>{t(u.products[e])}));let i,r=e+"."+t;return u.products[r]?new Promise(((e,t)=>{e(u.products[r])})):(e?i=this.settings.api+this.settings.path.products.replace("{handle}",e).replace("{view}",t):this.isProductPreview()&&(i=window.location.href.replace("products_preview","products_preview."+t)),new n(i,{method:"GET",responseType:"json"}).then((e=>{let i=e.data;return"json"===t&&(i=e.data.product),r=i.handle+"."+t,u.products[r]=i,i})).catch((e=>{throw e})))}isTheme(e){if(window.Shopify&&window.Shopify.theme){const t=window.Shopify.theme.theme_store_id;if("Dawn"===e&&(887===t||1368===t||1363===t||1356===t||1431===t||1434===t||1499===t||1500===t||1567===t||1864===t||1841===t||1891===t||2699===t))return!0;if("Expanse"===e&&902===t)return!0;if(window.Shopify.theme.name&&-1!==window.Shopify.theme.name.toLowerCase().indexOf(e.toLowerCase()))return!0}return!1}isThemeEditor(){return window.Shopify&&window.Shopify.designMode}onThemeSectionEvent(e,t){return document.addEventListener("shopify:section:"+e,t)}findProductForms(e=document){return e.querySelectorAll('form[action*="/cart/add"]')}findProductFormBestMatch(e,t){let i="#product_form_"+e,r=document.querySelector(i);if(r&&null!=r.querySelector("shopify-payment-terms")&&(r=null),r&&document.querySelector(`[data-product-form="${e}"]`)&&(r=null),r&&this.isProductFormInstallment(r)&&(r=null),r&&this.isTheme("Dawn")){let t=document.querySelector('[data-type="add-to-cart-form"]');t&&(t.dataset.productForm=e.toString(),r=null)}if(r&&t.srcEl&&t.srcEl.closest(".shopify-app-block")&&(r=null),!r){let i=null;if(t&&t.srcEl){let e=t.srcEl.parentNode;for(;e;){if(i=this.findProductForms(e),i.length){t.parentEl=e;break}e=e.parentNode}}if(null!=i&&0!==i.length||(i=this.findProductForms()),1===i.length)return i[0];if(i.length>1)for(let t=0;t<i.length;t++)if(!this.isProductFormInstallment(i[t])&&(r=i[t],r.dataset.productForm===e.toString()))return r}return r}isProductFormInstallment(e){let t=e.getAttribute("id");return!(!t||(t=t.toLowerCase(),-1===t.indexOf("installment")&&-1===t.indexOf("instalment")&&-1===t.indexOf("quick-add")&&-1===t.indexOf("complementary-")&&-1===e.className.indexOf("installment")&&-1===e.className.indexOf("instalment")&&null==e.querySelector("shopify-payment-terms")))}findProductFormVariantIdEl(e){if(null!=e){let t=e.querySelectorAll('[name=id], [name="id[]"]');for(let e=0;e<t.length;e++){let i=t[e];if(null!=i&&i.value){if(t.length>1){let e=i.closest("form");if(e&&this.isProductFormInstallment(e))continue}return i}}if(e.elements instanceof HTMLFormControlsCollection){let t=e.id;if(t)return t}}return null}findProductFormVariantId(e){let t=this.findProductFormVariantIdEl(e);return t?t.value:null}onVariantIdChange(e,t){let i=this.findProductFormVariantIdEl(e);if(i)if(o.isNodeList(i))for(let e=0;e<i.length;e++){const r=i[e];r.addEventListener("change",(e=>t(e,r.value)))}else i.addEventListener("change",(e=>t(e,i.value)))}findProductFormQuantityEl(e,t){return null!=e?e.querySelector("[name=quantity]")||(t?t.querySelector("[name=quantity]"):null):null}findProductFormQuantity(e,t){let i=this.findProductFormQuantityEl(e,t);return null!=i?parseInt(i.value):1}getFormProperties(e){const t=new FormData(e);return Array.from(t.keys()).reduce(((e,i)=>{if(-1!==i.indexOf("properties")){let r=i.indexOf("["),o=i.indexOf("]");if(-1!==r&&-1!==o){let n=i.substring(r+1,o);if(e.hasOwnProperty(n)){let r=t.getAll(i);e[n]=r[r.length-1]}else e[n]=t.get(i)}}return e}),{})}findExpressPaymentButtons(e=document){return e.querySelectorAll('.shopify-payment-button, [data-shopify="payment-button"]')}findExpressDynamicCheckoutCart(e=document){return e.querySelectorAll('#dynamic-checkout-cart, [data-shopify="dynamic-checkout-cart"]')}isExpressPaymentButton(e){return o.matchesIncludeParent(e,'.shopify-payment-button, [data-shopify="payment-button"]')}onProductFormSubmit(e,t,i,r,n=["[data-live-validate]"]){let s="[type=submit],.add_to_cart,.add-to-cart,.product-addToCart,.addToCart,.addtocart-js";this.isTheme("Dawn")&&(s=s.replace("[type=submit]","[type=submit]:not(.quick-add__submit)"));let l=t.querySelectorAll(n.join(","));if(l.length&&(r=!1),!r){e.addEventListener("submit",i);let t=e.querySelectorAll(s);for(let e=0;e<t.length;e++){t[e].addEventListener("click",i)}let r=t.length,o=this.findExpressPaymentButtons(e);for(let e=0;e<o.length;e++){o[e].addEventListener("click",i,{capture:!0})}for(let e=0;e<l.length;e++){l[e].addEventListener("click",i,{capture:!0}),r=!0}return r||a.warn("[live-options] failed to find add to cart button"),r}{const e=s+',.shopify-payment-button, [data-shopify="payment-button"]';t.addEventListener("click",(t=>{t.target&&o.matchesIncludeParent(t.target,e)&&i(t)}),{capture:!0})}}onCartFormSubmit(e,t,i=["[data-live-checkout]"]){let r='form[action="/cart"], form[action$="/cart"], form[action*="/cart?"], form[action="/checkout"], form[action$="/checkout"], form[action*="/checkout?"]';if(i.push('a[href="/checkout"], a[href$="/checkout"], a[href*="/checkout?"], button[onclick*="/checkout"]'),t){document.addEventListener("submit",(t=>{t.target&&o.matches(t.target,r)&&e(t)}),{capture:!0});const t=i.join(",");document.addEventListener("click",(i=>{i.target&&(o.matches(i.target,t)||null!=o.findParent(i.target,t))&&e(i)}),{capture:!0})}else{let t=document.querySelectorAll(r);if(t.length)for(let i=0;i<t.length;i++){t[i].addEventListener("submit",(t=>{e(t)}))}let o=document.querySelectorAll(i.join(","));for(let t=0;t<o.length;t++){o[t].addEventListener("click",e,{capture:!0})}}}trimMoneyFormatAmount(e){let t=e.indexOf("{"),i=e.lastIndexOf("}");return-1!==t&&-1!==i&&(e=e.substring(t,i+1)),e.trim()}parseImageDimension(e){let t={x:0,y:0},i=/(\d*)x(\d*)/.exec(e);return i&&3===i.length&&(t.x=parseInt(i[1])||0,t.y=i[2]?parseInt(i[2]):t.x),t}stripImageDimension(e){let t=(e=e.replace(/_(\d*)x(\d*)/g,"")).lastIndexOf("@");-1!==t&&(e=e.substring(0,t));let i=e.lastIndexOf(".progressive");return-1!==i&&(e=e.substring(0,i)),e}constructor(e){this.settings=o.extend({api:"",path:{products:"/products/{handle}.{view}"}},e||{})}}u.products={},u.collections={};var h=u;class m{static getInstance(e){return m._instance||(m._instance=new m(e)),m._instance}getCart(e=!1){return e&&this.cache?Promise.resolve(this.cache):this._cart().then((e=>(this.cache=e,e)))}getItemLine(e,t){for(let i=0;i<e.items.length;i++){const r=e.items[i];if(t.key===r.key)return i+1}return-1}toItem(e,t,i){return{id:e,quantity:t,properties:i}}addItem(e){return this._cartAdd(e)}addItems(e){return this._cartAdd({items:e}).then((e=>e.items))}addItemFormData(e,t){const i=new FormData;if(i.append("id",e.id),i.append("quantity",e.quantity?e.quantity:1),i.append("utf8","✓"),i.append("form_type","product"),e.properties)for(let t in e.properties)e.properties.hasOwnProperty(t)&&i.append("properties["+t+"]",e.properties[t]);return new n("/cart/add.js",{method:"POST",responseType:"json",onProgress:t,data:i})}removeItem(e){return this.updateItem(e,this.toItem(null,0))}removeItemById(e){return this.updateItemById(this.toItem(e,0))}updateItem(e,t){return this._cartChange({line:e,quantity:t.quantity,properties:t.properties})}updateItemById(e){return this._cartChange(e)}updateItemQuantitiesById(e){return this._cartUpdate({updates:e})}setNote(e){return this._cartUpdate({note:e})}setAttributes(e){return this._cartUpdate({attributes:e})}clear(){return this._cartClear()}_cart(){return this._cartRequest("/cart.js",{method:"GET"})}_cartAdd(e){return this._cartRequest("/cart/add.js",{method:"POST",data:e})}_cartUpdate(e){return this._cartRequest("/cart/update.js",{method:"POST",data:e})}_cartChange(e){return this._cartRequest("/cart/change.js",{method:"POST",data:e})}_cartClear(){return this._cartRequest("/cart/clear.js",{method:"POST"})}_cartRequest(e,t){let i=o.extend(this.settings.requestOptions,t),r=this.settings.api+e;return new n(r,i).then((e=>(a.debug("[shopify-cart] "+r+" response",e.data),e.data))).catch((e=>{throw a.error("[shopify-cart] "+r+" error",e),e.data}))}constructor(e){this.cache=null,this.settings=o.extend({api:"",requestOptions:{responseType:"json",headers:{"Content-type":"application/json"}}},e||{})}}var g=m;class f{static register(e){return this.listeners.push(e),this.patched||this._patch(),()=>{let t=this.listeners.indexOf(e);-1!==t&&this.listeners.splice(t,1),0===this.listeners.length&&this._unpatch()}}static _callListeners(e){for(let t=0;t<f.listeners.length;t++){(0,f.listeners[t])(e)}}static _patch(){f.originalOpen=XMLHttpRequest.prototype.open,XMLHttpRequest.prototype.open=function(){let e=arguments[0],t=arguments[1];this.addEventListener("readystatechange",(function(){4==this.readyState&&200==this.status&&f._callListeners({method:e,url:t})}),!1),f.originalOpen.apply(this,arguments)},"function"==typeof window.fetch&&(f.originalFetch=window.fetch,window.fetch=function(){let e=arguments[0],t=void 0!==arguments[1]?arguments[1].method:"GET",i=f.originalFetch.apply(this,arguments);return i.then((()=>{"object"==typeof e&&(e.pathname?e=e.pathname+e.search:e.url&&(e=e.url)),f._callListeners({method:t,url:e})})),i}),this.patched=!0}static _unpatch(){f.originalOpen&&(XMLHttpRequest.prototype.open=f.originalOpen),f.originalFetch&&(window.fetch=f.originalFetch),this.patched=!1}}f.patched=!1,f.listeners=[];var v=f;
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const y=new WeakMap,_=e=>(...t)=>{const i=e(...t);return y.set(i,!0),i},w=e=>"function"==typeof e&&y.has(e),b="undefined"!=typeof window&&null!=window.customElements&&void 0!==window.customElements.polyfillWrapFlushCallback,x=(e,t,i=null,r=null)=>{for(;t!==i;){const i=t.nextSibling;e.insertBefore(t,r),t=i}},C=(e,t,i=null)=>{for(;t!==i;){const i=t.nextSibling;e.removeChild(t),t=i}},E={},S={},I=`{{lit-${String(Math.random()).slice(2)}}}`,P=`\x3c!--${I}--\x3e`,M=new RegExp(`${I}|${P}`),O="$lit$";class L{constructor(e,t){this.parts=[],this.element=t;const i=[],r=[],o=document.createTreeWalker(t.content,133,null,!1);let n=0,a=-1,s=0;const{strings:l,values:{length:c}}=e;for(;s<c;){const e=o.nextNode();if(null!==e){if(a++,1===e.nodeType){if(e.hasAttributes()){const t=e.attributes,{length:i}=t;let r=0;for(let e=0;e<i;e++)k(t[e].name,O)&&r++;for(;r-- >0;){const t=l[s],i=A.exec(t)[2],r=i.toLowerCase()+O,o=e.getAttribute(r);e.removeAttribute(r);const n=o.split(M);this.parts.push({type:"attribute",index:a,name:i,strings:n}),s+=n.length-1}}"TEMPLATE"===e.tagName&&(r.push(e),o.currentNode=e.content)}else if(3===e.nodeType){const t=e.data;if(t.indexOf(I)>=0){const r=e.parentNode,o=t.split(M),n=o.length-1;for(let t=0;t<n;t++){let i,n=o[t];if(""===n)i=T();else{const e=A.exec(n);null!==e&&k(e[2],O)&&(n=n.slice(0,e.index)+e[1]+e[2].slice(0,-O.length)+e[3]),i=document.createTextNode(n)}r.insertBefore(i,e),this.parts.push({type:"node",index:++a})}""===o[n]?(r.insertBefore(T(),e),i.push(e)):e.data=o[n],s+=n}}else if(8===e.nodeType)if(e.data===I){const t=e.parentNode;null!==e.previousSibling&&a!==n||(a++,t.insertBefore(T(),e)),n=a,this.parts.push({type:"node",index:a}),null===e.nextSibling?e.data="":(i.push(e),a--),s++}else{let t=-1;for(;-1!==(t=e.data.indexOf(I,t+1));)this.parts.push({type:"node",index:-1}),s++}}else o.currentNode=r.pop()}for(const e of i)e.parentNode.removeChild(e)}}const k=(e,t)=>{const i=e.length-t.length;return i>=0&&e.slice(i)===t},$=e=>-1!==e.index,T=()=>document.createComment(""),A=/([ \x09\x0a\x0c\x0d])([^\0-\x1F\x7F-\x9F "'>=/]+)([ \x09\x0a\x0c\x0d]*=[ \x09\x0a\x0c\x0d]*(?:[^ \x09\x0a\x0c\x0d"'`<>=]*|"[^"]*|'[^']*))$/;class F{update(e){let t=0;for(const i of this.__parts)void 0!==i&&i.setValue(e[t]),t++;for(const e of this.__parts)void 0!==e&&e.commit()}_clone(){const e=b?this.template.element.content.cloneNode(!0):document.importNode(this.template.element.content,!0),t=[],i=this.template.parts,r=document.createTreeWalker(e,133,null,!1);let o,n=0,a=0,s=r.nextNode();for(;n<i.length;)if(o=i[n],$(o)){for(;a<o.index;)a++,"TEMPLATE"===s.nodeName&&(t.push(s),r.currentNode=s.content),null===(s=r.nextNode())&&(r.currentNode=t.pop(),s=r.nextNode());if("node"===o.type){const e=this.processor.handleTextExpression(this.options);e.insertAfterNode(s.previousSibling),this.__parts.push(e)}else this.__parts.push(...this.processor.handleAttributeExpressions(s,o.name,o.strings,this.options));n++}else this.__parts.push(void 0),n++;return b&&(document.adoptNode(e),customElements.upgrade(e)),e}constructor(e,t,i){this.__parts=[],this.template=e,this.processor=t,this.options=i}}
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const D=window.trustedTypes&&trustedTypes.createPolicy("lit-html",{createHTML:e=>e}),N=` ${I} `;class j{getHTML(){const e=this.strings.length-1;let t="",i=!1;for(let r=0;r<e;r++){const e=this.strings[r],o=e.lastIndexOf("\x3c!--");i=(o>-1||i)&&-1===e.indexOf("--\x3e",o+1);const n=A.exec(e);t+=null===n?e+(i?N:P):e.substr(0,n.index)+n[1]+n[2]+O+n[3]+I}return t+=this.strings[e],t}getTemplateElement(){const e=document.createElement("template");let t=this.getHTML();return void 0!==D&&(t=D.createHTML(t)),e.innerHTML=t,e}constructor(e,t,i,r){this.strings=e,this.values=t,this.type=i,this.processor=r}}const R=e=>null===e||!("object"==typeof e||"function"==typeof e),V=e=>Array.isArray(e)||!(!e||!e[Symbol.iterator]);class z{_createPart(){return new q(this)}_getValue(){const e=this.strings,t=e.length-1,i=this.parts;if(1===t&&""===e[0]&&""===e[1]){const e=i[0].value;if("symbol"==typeof e)return String(e);if("string"==typeof e||!V(e))return e}let r="";for(let o=0;o<t;o++){r+=e[o];const t=i[o];if(void 0!==t){const e=t.value;if(R(e)||!V(e))r+="string"==typeof e?e:String(e);else for(const t of e)r+="string"==typeof t?t:String(t)}}return r+=e[t],r}commit(){this.dirty&&(this.dirty=!1,this.element.setAttribute(this.name,this._getValue()))}constructor(e,t,i){this.dirty=!0,this.element=e,this.name=t,this.strings=i,this.parts=[];for(let e=0;e<i.length-1;e++)this.parts[e]=this._createPart()}}class q{setValue(e){e===E||R(e)&&e===this.value||(this.value=e,w(e)||(this.committer.dirty=!0))}commit(){for(;w(this.value);){const e=this.value;this.value=E,e(this)}this.value!==E&&this.committer.commit()}constructor(e){this.value=void 0,this.committer=e}}class B{appendInto(e){this.startNode=e.appendChild(T()),this.endNode=e.appendChild(T())}insertAfterNode(e){this.startNode=e,this.endNode=e.nextSibling}appendIntoPart(e){e.__insert(this.startNode=T()),e.__insert(this.endNode=T())}insertAfterPart(e){e.__insert(this.startNode=T()),this.endNode=e.endNode,e.endNode=this.startNode}setValue(e){this.__pendingValue=e}commit(){if(null===this.startNode.parentNode)return;for(;w(this.__pendingValue);){const e=this.__pendingValue;this.__pendingValue=E,e(this)}const e=this.__pendingValue;e!==E&&(R(e)?e!==this.value&&this.__commitText(e):e instanceof j?this.__commitTemplateResult(e):e instanceof Node?this.__commitNode(e):V(e)?this.__commitIterable(e):e===S?(this.value=S,this.clear()):this.__commitText(e))}__insert(e){this.endNode.parentNode.insertBefore(e,this.endNode)}__commitNode(e){this.value!==e&&(this.clear(),this.__insert(e),this.value=e)}__commitText(e){const t=this.startNode.nextSibling,i="string"==typeof(e=null==e?"":e)?e:String(e);t===this.endNode.previousSibling&&3===t.nodeType?t.data=i:this.__commitNode(document.createTextNode(i)),this.value=e}__commitTemplateResult(e){const t=this.options.templateFactory(e);if(this.value instanceof F&&this.value.template===t)this.value.update(e.values);else{const i=new F(t,e.processor,this.options),r=i._clone();i.update(e.values),this.__commitNode(r),this.value=i}}__commitIterable(e){Array.isArray(this.value)||(this.value=[],this.clear());const t=this.value;let i,r=0;for(const o of e)i=t[r],void 0===i&&(i=new B(this.options),t.push(i),0===r?i.appendIntoPart(this):i.insertAfterPart(t[r-1])),i.setValue(o),i.commit(),r++;r<t.length&&(t.length=r,this.clear(i&&i.endNode))}clear(e=this.startNode){C(this.startNode.parentNode,e.nextSibling,this.endNode)}constructor(e){this.value=void 0,this.__pendingValue=void 0,this.options=e}}class H{setValue(e){this.__pendingValue=e}commit(){for(;w(this.__pendingValue);){const e=this.__pendingValue;this.__pendingValue=E,e(this)}if(this.__pendingValue===E)return;const e=!!this.__pendingValue;this.value!==e&&(e?this.element.setAttribute(this.name,""):this.element.removeAttribute(this.name),this.value=e),this.__pendingValue=E}constructor(e,t,i){if(this.value=void 0,this.__pendingValue=void 0,2!==i.length||""!==i[0]||""!==i[1])throw new Error("Boolean attributes can only contain a single expression");this.element=e,this.name=t,this.strings=i}}class U extends z{_createPart(){return new W(this)}_getValue(){return this.single?this.parts[0].value:super._getValue()}commit(){this.dirty&&(this.dirty=!1,this.element[this.name]=this._getValue())}constructor(e,t,i){super(e,t,i),this.single=2===i.length&&""===i[0]&&""===i[1]}}class W extends q{}let Y=!1;(()=>{try{const e={get capture(){return Y=!0,!1}};window.addEventListener("test",e,e),window.removeEventListener("test",e,e)}catch(e){}})();class G{setValue(e){this.__pendingValue=e}commit(){for(;w(this.__pendingValue);){const e=this.__pendingValue;this.__pendingValue=E,e(this)}if(this.__pendingValue===E)return;const e=this.__pendingValue,t=this.value,i=null==e||null!=t&&(e.capture!==t.capture||e.once!==t.once||e.passive!==t.passive),r=null!=e&&(null==t||i);i&&this.element.removeEventListener(this.eventName,this.__boundHandleEvent,this.__options),r&&(this.__options=X(e),this.element.addEventListener(this.eventName,this.__boundHandleEvent,this.__options)),this.value=e,this.__pendingValue=E}handleEvent(e){"function"==typeof this.value?this.value.call(this.eventContext||this.element,e):this.value.handleEvent(e)}constructor(e,t,i){this.value=void 0,this.__pendingValue=void 0,this.element=e,this.eventName=t,this.eventContext=i,this.__boundHandleEvent=e=>this.handleEvent(e)}}const X=e=>e&&(Y?{capture:e.capture,passive:e.passive,once:e.once}:e.capture);const Q=new class{handleAttributeExpressions(e,t,i,r){const o=t[0];if("."===o){return new U(e,t.slice(1),i).parts}if("@"===o)return[new G(e,t.slice(1),r.eventContext)];if("?"===o)return[new H(e,t.slice(1),i)];return new z(e,t,i).parts}handleTextExpression(e){return new B(e)}};
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */function Z(e){let t=J.get(e.type);void 0===t&&(t={stringsArray:new WeakMap,keyString:new Map},J.set(e.type,t));let i=t.stringsArray.get(e.strings);if(void 0!==i)return i;const r=e.strings.join(I);return i=t.keyString.get(r),void 0===i&&(i=new L(e,e.getTemplateElement()),t.keyString.set(r,i)),t.stringsArray.set(e.strings,i),i}const J=new Map,K=new WeakMap,ee=(e,t,i)=>{let r=K.get(t);void 0===r&&(C(t,t.firstChild),K.set(t,r=new B(Object.assign({templateFactory:Z},i))),r.appendInto(t)),r.setValue(e),r.commit()};"undefined"!=typeof window&&(window.litHtmlVersions||(window.litHtmlVersions=[])).push("1.4.1");const te=(e,...t)=>new j(e,t,"html",Q);
/**!
* tippy.js v6.3.7
* (c) 2017-2021 atomiks
* MIT License
*/
function ie(e){return e?(e.nodeName||"").toLowerCase():null}function re(e){if(null==e)return window;if("[object Window]"!==e.toString()){var t=e.ownerDocument;return t&&t.defaultView||window}return e}function oe(e){return e instanceof re(e).Element||e instanceof Element}function ne(e){return e instanceof re(e).HTMLElement||e instanceof HTMLElement}function ae(e){return"undefined"!=typeof ShadowRoot&&(e instanceof re(e).ShadowRoot||e instanceof ShadowRoot)}var se={name:"applyStyles",enabled:!0,phase:"write",fn:function(e){var t=e.state;Object.keys(t.elements).forEach((function(e){var i=t.styles[e]||{},r=t.attributes[e]||{},o=t.elements[e];ne(o)&&ie(o)&&(Object.assign(o.style,i),Object.keys(r).forEach((function(e){var t=r[e];!1===t?o.removeAttribute(e):o.setAttribute(e,!0===t?"":t)})))}))},effect:function(e){var t=e.state,i={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(t.elements.popper.style,i.popper),t.styles=i,t.elements.arrow&&Object.assign(t.elements.arrow.style,i.arrow),function(){Object.keys(t.elements).forEach((function(e){var r=t.elements[e],o=t.attributes[e]||{},n=Object.keys(t.styles.hasOwnProperty(e)?t.styles[e]:i[e]).reduce((function(e,t){return e[t]="",e}),{});ne(r)&&ie(r)&&(Object.assign(r.style,n),Object.keys(o).forEach((function(e){r.removeAttribute(e)})))}))}},requires:["computeStyles"]},le=Math.max,ce=Math.min,pe=Math.round;function de(){var e=navigator.userAgentData;return null!=e&&e.brands?e.brands.map((function(e){return e.brand+"/"+e.version})).join(" "):navigator.userAgent}function ue(){return!/^((?!chrome|android).)*safari/i.test(de())}function he(e,t,i){void 0===t&&(t=!1),void 0===i&&(i=!1);var r=e.getBoundingClientRect(),o=1,n=1;t&&ne(e)&&(o=e.offsetWidth>0&&pe(r.width)/e.offsetWidth||1,n=e.offsetHeight>0&&pe(r.height)/e.offsetHeight||1);var a=(oe(e)?re(e):window).visualViewport,s=!ue()&&i,l=(r.left+(s&&a?a.offsetLeft:0))/o,c=(r.top+(s&&a?a.offsetTop:0))/n,p=r.width/o,d=r.height/n;return{width:p,height:d,top:c,right:l+p,bottom:c+d,left:l,x:l,y:c}}function me(e){var t=re(e);return{scrollLeft:t.pageXOffset,scrollTop:t.pageYOffset}}function ge(e){return((oe(e)?e.ownerDocument:e.document)||window.document).documentElement}function fe(e){return he(ge(e)).left+me(e).scrollLeft}function ve(e){return re(e).getComputedStyle(e)}function ye(e){var t=ve(e),i=t.overflow,r=t.overflowX,o=t.overflowY;return/auto|scroll|overlay|hidden/.test(i+o+r)}function _e(e,t,i){void 0===i&&(i=!1);var r,o,n=ne(t),a=ne(t)&&function(e){var t=e.getBoundingClientRect(),i=pe(t.width)/e.offsetWidth||1,r=pe(t.height)/e.offsetHeight||1;return 1!==i||1!==r}(t),s=ge(t),l=he(e,a,i),c={scrollLeft:0,scrollTop:0},p={x:0,y:0};return(n||!n&&!i)&&(("body"!==ie(t)||ye(s))&&(c=(r=t)!==re(r)&&ne(r)?{scrollLeft:(o=r).scrollLeft,scrollTop:o.scrollTop}:me(r)),ne(t)?((p=he(t,!0)).x+=t.clientLeft,p.y+=t.clientTop):s&&(p.x=fe(s))),{x:l.left+c.scrollLeft-p.x,y:l.top+c.scrollTop-p.y,width:l.width,height:l.height}}function we(e){var t=he(e),i=e.offsetWidth,r=e.offsetHeight;return Math.abs(t.width-i)<=1&&(i=t.width),Math.abs(t.height-r)<=1&&(r=t.height),{x:e.offsetLeft,y:e.offsetTop,width:i,height:r}}function be(e){return"html"===ie(e)?e:e.assignedSlot||e.parentNode||(ae(e)?e.host:null)||ge(e)}function xe(e){return["html","body","#document"].indexOf(ie(e))>=0?e.ownerDocument.body:ne(e)&&ye(e)?e:xe(be(e))}function Ce(e,t){var i;void 0===t&&(t=[]);var r=xe(e),o=r===(null==(i=e.ownerDocument)?void 0:i.body),n=re(r),a=o?[n].concat(n.visualViewport||[],ye(r)?r:[]):r,s=t.concat(a);return o?s:s.concat(Ce(be(a)))}function Ee(e){return["table","td","th"].indexOf(ie(e))>=0}function Se(e){return ne(e)&&"fixed"!==ve(e).position?e.offsetParent:null}function Ie(e){for(var t=re(e),i=Se(e);i&&Ee(i)&&"static"===ve(i).position;)i=Se(i);return i&&("html"===ie(i)||"body"===ie(i)&&"static"===ve(i).position)?t:i||function(e){var t=/firefox/i.test(de());if(/Trident/i.test(de())&&ne(e)&&"fixed"===ve(e).position)return null;var i=be(e);for(ae(i)&&(i=i.host);ne(i)&&["html","body"].indexOf(ie(i))<0;){var r=ve(i);if("none"!==r.transform||"none"!==r.perspective||"paint"===r.contain||-1!==["transform","perspective"].indexOf(r.willChange)||t&&"filter"===r.willChange||t&&r.filter&&"none"!==r.filter)return i;i=i.parentNode}return null}(e)||t}var Pe="top",Me="bottom",Oe="right",Le="left",ke="auto",$e=[Pe,Me,Oe,Le],Te="start",Ae="end",Fe="clippingParents",De="viewport",Ne="popper",je="reference",Re=$e.reduce((function(e,t){return e.concat([t+"-"+Te,t+"-"+Ae])}),[]),Ve=[].concat($e,[ke]).reduce((function(e,t){return e.concat([t,t+"-"+Te,t+"-"+Ae])}),[]),ze=["beforeRead","read","afterRead","beforeMain","main","afterMain","beforeWrite","write","afterWrite"];function qe(e){var t=new Map,i=new Set,r=[];function o(e){i.add(e.name),[].concat(e.requires||[],e.requiresIfExists||[]).forEach((function(e){if(!i.has(e)){var r=t.get(e);r&&o(r)}})),r.push(e)}return e.forEach((function(e){t.set(e.name,e)})),e.forEach((function(e){i.has(e.name)||o(e)})),r}function Be(e){var t=qe(e);return ze.reduce((function(e,i){return e.concat(t.filter((function(e){return e.phase===i})))}),[])}function He(e){var t=e.reduce((function(e,t){var i=e[t.name];return e[t.name]=i?Object.assign({},i,t,{options:Object.assign({},i.options,t.options),data:Object.assign({},i.data,t.data)}):t,e}),{});return Object.keys(t).map((function(e){return t[e]}))}var Ue={placement:"bottom",modifiers:[],strategy:"absolute"};function We(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return!t.some((function(e){return!(e&&"function"==typeof e.getBoundingClientRect)}))}function Ye(e){void 0===e&&(e={});var t=e,i=t.defaultModifiers,r=void 0===i?[]:i,o=t.defaultOptions,n=void 0===o?Ue:o;return function(e,t,i){void 0===i&&(i=n);var o,a,s={placement:"bottom",orderedModifiers:[],options:Object.assign({},Ue,n),modifiersData:{},elements:{reference:e,popper:t},attributes:{},styles:{}},l=[],c=!1,p={state:s,setOptions:function(i){var o="function"==typeof i?i(s.options):i;d(),s.options=Object.assign({},n,s.options,o),s.scrollParents={reference:oe(e)?Ce(e):e.contextElement?Ce(e.contextElement):[],popper:Ce(t)};var a=Be(He([].concat(r,s.options.modifiers)));return s.orderedModifiers=a.filter((function(e){return e.enabled})),s.orderedModifiers.forEach((function(e){var t=e.name,i=e.options,r=void 0===i?{}:i,o=e.effect;if("function"==typeof o){var n=o({state:s,name:t,instance:p,options:r}),a=function(){};l.push(n||a)}})),p.update()},forceUpdate:function(){if(!c){var e=s.elements,t=e.reference,i=e.popper;if(We(t,i)){s.rects={reference:_e(t,Ie(i),"fixed"===s.options.strategy),popper:we(i)},s.reset=!1,s.placement=s.options.placement,s.orderedModifiers.forEach((function(e){return s.modifiersData[e.name]=Object.assign({},e.data)}));for(var r=0;r<s.orderedModifiers.length;r++)if(!0!==s.reset){var o=s.orderedModifiers[r],n=o.fn,a=o.options,l=void 0===a?{}:a,d=o.name;"function"==typeof n&&(s=n({state:s,options:l,name:d,instance:p})||s)}else s.reset=!1,r=-1}}},update:(o=function(){return new Promise((function(e){p.forceUpdate(),e(s)}))},function(){return a||(a=new Promise((function(e){Promise.resolve().then((function(){a=void 0,e(o())}))}))),a}),destroy:function(){d(),c=!0}};if(!We(e,t))return p;function d(){l.forEach((function(e){return e()})),l=[]}return p.setOptions(i).then((function(e){!c&&i.onFirstUpdate&&i.onFirstUpdate(e)})),p}}var Ge={passive:!0};function Xe(e){return e.split("-")[0]}function Qe(e){return e.split("-")[1]}function Ze(e){return["top","bottom"].indexOf(e)>=0?"x":"y"}function Je(e){var t,i=e.reference,r=e.element,o=e.placement,n=o?Xe(o):null,a=o?Qe(o):null,s=i.x+i.width/2-r.width/2,l=i.y+i.height/2-r.height/2;switch(n){case Pe:t={x:s,y:i.y-r.height};break;case Me:t={x:s,y:i.y+i.height};break;case Oe:t={x:i.x+i.width,y:l};break;case Le:t={x:i.x-r.width,y:l};break;default:t={x:i.x,y:i.y}}var c=n?Ze(n):null;if(null!=c){var p="y"===c?"height":"width";switch(a){case Te:t[c]=t[c]-(i[p]/2-r[p]/2);break;case Ae:t[c]=t[c]+(i[p]/2-r[p]/2)}}return t}var Ke={top:"auto",right:"auto",bottom:"auto",left:"auto"};function et(e){var t,i=e.popper,r=e.popperRect,o=e.placement,n=e.variation,a=e.offsets,s=e.position,l=e.gpuAcceleration,c=e.adaptive,p=e.roundOffsets,d=e.isFixed,u=a.x,h=void 0===u?0:u,m=a.y,g=void 0===m?0:m,f="function"==typeof p?p({x:h,y:g}):{x:h,y:g};h=f.x,g=f.y;var v=a.hasOwnProperty("x"),y=a.hasOwnProperty("y"),_=Le,w=Pe,b=window;if(c){var x=Ie(i),C="clientHeight",E="clientWidth";if(x===re(i)&&"static"!==ve(x=ge(i)).position&&"absolute"===s&&(C="scrollHeight",E="scrollWidth"),o===Pe||(o===Le||o===Oe)&&n===Ae)w=Me,g-=(d&&x===b&&b.visualViewport?b.visualViewport.height:x[C])-r.height,g*=l?1:-1;if(o===Le||(o===Pe||o===Me)&&n===Ae)_=Oe,h-=(d&&x===b&&b.visualViewport?b.visualViewport.width:x[E])-r.width,h*=l?1:-1}var S,I=Object.assign({position:s},c&&Ke),P=!0===p?function(e){var t=e.x,i=e.y,r=window.devicePixelRatio||1;return{x:pe(t*r)/r||0,y:pe(i*r)/r||0}}({x:h,y:g}):{x:h,y:g};return h=P.x,g=P.y,l?Object.assign({},I,((S={})[w]=y?"0":"",S[_]=v?"0":"",S.transform=(b.devicePixelRatio||1)<=1?"translate("+h+"px, "+g+"px)":"translate3d("+h+"px, "+g+"px, 0)",S)):Object.assign({},I,((t={})[w]=y?g+"px":"",t[_]=v?h+"px":"",t.transform="",t))}var tt={left:"right",right:"left",bottom:"top",top:"bottom"};function it(e){return e.replace(/left|right|bottom|top/g,(function(e){return tt[e]}))}var rt={start:"end",end:"start"};function ot(e){return e.replace(/start|end/g,(function(e){return rt[e]}))}function nt(e,t){var i=re(e),r=ge(e),o=i.visualViewport,n=r.clientWidth,a=r.clientHeight,s=0,l=0;if(o){n=o.width,a=o.height;var c=ue();(c||!c&&"fixed"===t)&&(s=o.offsetLeft,l=o.offsetTop)}return{width:n,height:a,x:s+fe(e),y:l}}function at(e){var t,i=ge(e),r=me(e),o=null==(t=e.ownerDocument)?void 0:t.body,n=le(i.scrollWidth,i.clientWidth,o?o.scrollWidth:0,o?o.clientWidth:0),a=le(i.scrollHeight,i.clientHeight,o?o.scrollHeight:0,o?o.clientHeight:0),s=-r.scrollLeft+fe(e),l=-r.scrollTop;return"rtl"===ve(o||i).direction&&(s+=le(i.clientWidth,o?o.clientWidth:0)-n),{width:n,height:a,x:s,y:l}}function st(e,t){var i=t.getRootNode&&t.getRootNode();if(e.contains(t))return!0;if(i&&ae(i)){var r=t;do{if(r&&e.isSameNode(r))return!0;r=r.parentNode||r.host}while(r)}return!1}function lt(e){return Object.assign({},e,{left:e.x,top:e.y,right:e.x+e.width,bottom:e.y+e.height})}function ct(e,t,i){return t===De?lt(nt(e,i)):oe(t)?function(e,t){var i=he(e,!1,"fixed"===t);return i.top=i.top+e.clientTop,i.left=i.left+e.clientLeft,i.bottom=i.top+e.clientHeight,i.right=i.left+e.clientWidth,i.width=e.clientWidth,i.height=e.clientHeight,i.x=i.left,i.y=i.top,i}(t,i):lt(at(ge(e)))}function pt(e,t,i,r){var o="clippingParents"===t?function(e){var t=Ce(be(e)),i=["absolute","fixed"].indexOf(ve(e).position)>=0&&ne(e)?Ie(e):e;return oe(i)?t.filter((function(e){return oe(e)&&st(e,i)&&"body"!==ie(e)})):[]}(e):[].concat(t),n=[].concat(o,[i]),a=n[0],s=n.reduce((function(t,i){var o=ct(e,i,r);return t.top=le(o.top,t.top),t.right=ce(o.right,t.right),t.bottom=ce(o.bottom,t.bottom),t.left=le(o.left,t.left),t}),ct(e,a,r));return s.width=s.right-s.left,s.height=s.bottom-s.top,s.x=s.left,s.y=s.top,s}function dt(e){return Object.assign({},{top:0,right:0,bottom:0,left:0},e)}function ut(e,t){return t.reduce((function(t,i){return t[i]=e,t}),{})}function ht(e,t){void 0===t&&(t={});var i=t,r=i.placement,o=void 0===r?e.placement:r,n=i.strategy,a=void 0===n?e.strategy:n,s=i.boundary,l=void 0===s?Fe:s,c=i.rootBoundary,p=void 0===c?De:c,d=i.elementContext,u=void 0===d?Ne:d,h=i.altBoundary,m=void 0!==h&&h,g=i.padding,f=void 0===g?0:g,v=dt("number"!=typeof f?f:ut(f,$e)),y=u===Ne?je:Ne,_=e.rects.popper,w=e.elements[m?y:u],b=pt(oe(w)?w:w.contextElement||ge(e.elements.popper),l,p,a),x=he(e.elements.reference),C=Je({reference:x,element:_,strategy:"absolute",placement:o}),E=lt(Object.assign({},_,C)),S=u===Ne?E:x,I={top:b.top-S.top+v.top,bottom:S.bottom-b.bottom+v.bottom,left:b.left-S.left+v.left,right:S.right-b.right+v.right},P=e.modifiersData.offset;if(u===Ne&&P){var M=P[o];Object.keys(I).forEach((function(e){var t=[Oe,Me].indexOf(e)>=0?1:-1,i=[Pe,Me].indexOf(e)>=0?"y":"x";I[e]+=M[i]*t}))}return I}function mt(e,t){void 0===t&&(t={});var i=t,r=i.placement,o=i.boundary,n=i.rootBoundary,a=i.padding,s=i.flipVariations,l=i.allowedAutoPlacements,c=void 0===l?Ve:l,p=Qe(r),d=p?s?Re:Re.filter((function(e){return Qe(e)===p})):$e,u=d.filter((function(e){return c.indexOf(e)>=0}));0===u.length&&(u=d);var h=u.reduce((function(t,i){return t[i]=ht(e,{placement:i,boundary:o,rootBoundary:n,padding:a})[Xe(i)],t}),{});return Object.keys(h).sort((function(e,t){return h[e]-h[t]}))}function gt(e,t,i){return le(e,ce(t,i))}function ft(e,t,i){var r=gt(e,t,i);return r>i?i:r}var vt=function(e,t){return dt("number"!=typeof(e="function"==typeof e?e(Object.assign({},t.rects,{placement:t.placement})):e)?e:ut(e,$e))};function yt(e,t,i){return void 0===i&&(i={x:0,y:0}),{top:e.top-t.height-i.y,right:e.right-t.width+i.x,bottom:e.bottom-t.height+i.y,left:e.left-t.width-i.x}}function _t(e){return[Pe,Oe,Me,Le].some((function(t){return e[t]>=0}))}var wt=Ye({defaultModifiers:[{name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function(e){var t=e.state,i=e.instance,r=e.options,o=r.scroll,n=void 0===o||o,a=r.resize,s=void 0===a||a,l=re(t.elements.popper),c=[].concat(t.scrollParents.reference,t.scrollParents.popper);return n&&c.forEach((function(e){e.addEventListener("scroll",i.update,Ge)})),s&&l.addEventListener("resize",i.update,Ge),function(){n&&c.forEach((function(e){e.removeEventListener("scroll",i.update,Ge)})),s&&l.removeEventListener("resize",i.update,Ge)}},data:{}},{name:"popperOffsets",enabled:!0,phase:"read",fn:function(e){var t=e.state,i=e.name;t.modifiersData[i]=Je({reference:t.rects.reference,element:t.rects.popper,strategy:"absolute",placement:t.placement})},data:{}},{name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function(e){var t=e.state,i=e.options,r=i.gpuAcceleration,o=void 0===r||r,n=i.adaptive,a=void 0===n||n,s=i.roundOffsets,l=void 0===s||s,c={placement:Xe(t.placement),variation:Qe(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:o,isFixed:"fixed"===t.options.strategy};null!=t.modifiersData.popperOffsets&&(t.styles.popper=Object.assign({},t.styles.popper,et(Object.assign({},c,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:a,roundOffsets:l})))),null!=t.modifiersData.arrow&&(t.styles.arrow=Object.assign({},t.styles.arrow,et(Object.assign({},c,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:l})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})},data:{}},se,{name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function(e){var t=e.state,i=e.options,r=e.name,o=i.offset,n=void 0===o?[0,0]:o,a=Ve.reduce((function(e,i){return e[i]=function(e,t,i){var r=Xe(e),o=[Le,Pe].indexOf(r)>=0?-1:1,n="function"==typeof i?i(Object.assign({},t,{placement:e})):i,a=n[0],s=n[1];return a=a||0,s=(s||0)*o,[Le,Oe].indexOf(r)>=0?{x:s,y:a}:{x:a,y:s}}(i,t.rects,n),e}),{}),s=a[t.placement],l=s.x,c=s.y;null!=t.modifiersData.popperOffsets&&(t.modifiersData.popperOffsets.x+=l,t.modifiersData.popperOffsets.y+=c),t.modifiersData[r]=a}},{name:"flip",enabled:!0,phase:"main",fn:function(e){var t=e.state,i=e.options,r=e.name;if(!t.modifiersData[r]._skip){for(var o=i.mainAxis,n=void 0===o||o,a=i.altAxis,s=void 0===a||a,l=i.fallbackPlacements,c=i.padding,p=i.boundary,d=i.rootBoundary,u=i.altBoundary,h=i.flipVariations,m=void 0===h||h,g=i.allowedAutoPlacements,f=t.options.placement,v=Xe(f),y=l||(v===f||!m?[it(f)]:function(e){if(Xe(e)===ke)return[];var t=it(e);return[ot(e),t,ot(t)]}(f)),_=[f].concat(y).reduce((function(e,i){return e.concat(Xe(i)===ke?mt(t,{placement:i,boundary:p,rootBoundary:d,padding:c,flipVariations:m,allowedAutoPlacements:g}):i)}),[]),w=t.rects.reference,b=t.rects.popper,x=new Map,C=!0,E=_[0],S=0;S<_.length;S++){var I=_[S],P=Xe(I),M=Qe(I)===Te,O=[Pe,Me].indexOf(P)>=0,L=O?"width":"height",k=ht(t,{placement:I,boundary:p,rootBoundary:d,altBoundary:u,padding:c}),$=O?M?Oe:Le:M?Me:Pe;w[L]>b[L]&&($=it($));var T=it($),A=[];if(n&&A.push(k[P]<=0),s&&A.push(k[$]<=0,k[T]<=0),A.every((function(e){return e}))){E=I,C=!1;break}x.set(I,A)}if(C)for(var F=function(e){var t=_.find((function(t){var i=x.get(t);if(i)return i.slice(0,e).every((function(e){return e}))}));if(t)return E=t,"break"},D=m?3:1;D>0;D--){if("break"===F(D))break}t.placement!==E&&(t.modifiersData[r]._skip=!0,t.placement=E,t.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}},{name:"preventOverflow",enabled:!0,phase:"main",fn:function(e){var t=e.state,i=e.options,r=e.name,o=i.mainAxis,n=void 0===o||o,a=i.altAxis,s=void 0!==a&&a,l=i.boundary,c=i.rootBoundary,p=i.altBoundary,d=i.padding,u=i.tether,h=void 0===u||u,m=i.tetherOffset,g=void 0===m?0:m,f=ht(t,{boundary:l,rootBoundary:c,padding:d,altBoundary:p}),v=Xe(t.placement),y=Qe(t.placement),_=!y,w=Ze(v),b="x"===w?"y":"x",x=t.modifiersData.popperOffsets,C=t.rects.reference,E=t.rects.popper,S="function"==typeof g?g(Object.assign({},t.rects,{placement:t.placement})):g,I="number"==typeof S?{mainAxis:S,altAxis:S}:Object.assign({mainAxis:0,altAxis:0},S),P=t.modifiersData.offset?t.modifiersData.offset[t.placement]:null,M={x:0,y:0};if(x){if(n){var O,L="y"===w?Pe:Le,k="y"===w?Me:Oe,$="y"===w?"height":"width",T=x[w],A=T+f[L],F=T-f[k],D=h?-E[$]/2:0,N=y===Te?C[$]:E[$],j=y===Te?-E[$]:-C[$],R=t.elements.arrow,V=h&&R?we(R):{width:0,height:0},z=t.modifiersData["arrow#persistent"]?t.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},q=z[L],B=z[k],H=gt(0,C[$],V[$]),U=_?C[$]/2-D-H-q-I.mainAxis:N-H-q-I.mainAxis,W=_?-C[$]/2+D+H+B+I.mainAxis:j+H+B+I.mainAxis,Y=t.elements.arrow&&Ie(t.elements.arrow),G=Y?"y"===w?Y.clientTop||0:Y.clientLeft||0:0,X=null!=(O=null==P?void 0:P[w])?O:0,Q=T+W-X,Z=gt(h?ce(A,T+U-X-G):A,T,h?le(F,Q):F);x[w]=Z,M[w]=Z-T}if(s){var J,K="x"===w?Pe:Le,ee="x"===w?Me:Oe,te=x[b],ie="y"===b?"height":"width",re=te+f[K],oe=te-f[ee],ne=-1!==[Pe,Le].indexOf(v),ae=null!=(J=null==P?void 0:P[b])?J:0,se=ne?re:te-C[ie]-E[ie]-ae+I.altAxis,pe=ne?te+C[ie]+E[ie]-ae-I.altAxis:oe,de=h&&ne?ft(se,te,pe):gt(h?se:re,te,h?pe:oe);x[b]=de,M[b]=de-te}t.modifiersData[r]=M}},requiresIfExists:["offset"]},{name:"arrow",enabled:!0,phase:"main",fn:function(e){var t,i=e.state,r=e.name,o=e.options,n=i.elements.arrow,a=i.modifiersData.popperOffsets,s=Xe(i.placement),l=Ze(s),c=[Le,Oe].indexOf(s)>=0?"height":"width";if(n&&a){var p=vt(o.padding,i),d=we(n),u="y"===l?Pe:Le,h="y"===l?Me:Oe,m=i.rects.reference[c]+i.rects.reference[l]-a[l]-i.rects.popper[c],g=a[l]-i.rects.reference[l],f=Ie(n),v=f?"y"===l?f.clientHeight||0:f.clientWidth||0:0,y=m/2-g/2,_=p[u],w=v-d[c]-p[h],b=v/2-d[c]/2+y,x=gt(_,b,w),C=l;i.modifiersData[r]=((t={})[C]=x,t.centerOffset=x-b,t)}},effect:function(e){var t=e.state,i=e.options.element,r=void 0===i?"[data-popper-arrow]":i;null!=r&&("string"!=typeof r||(r=t.elements.popper.querySelector(r)))&&st(t.elements.popper,r)&&(t.elements.arrow=r)},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]},{name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function(e){var t=e.state,i=e.name,r=t.rects.reference,o=t.rects.popper,n=t.modifiersData.preventOverflow,a=ht(t,{elementContext:"reference"}),s=ht(t,{altBoundary:!0}),l=yt(a,r),c=yt(s,o,n),p=_t(l),d=_t(c);t.modifiersData[i]={referenceClippingOffsets:l,popperEscapeOffsets:c,isReferenceHidden:p,hasPopperEscaped:d},t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-reference-hidden":p,"data-popper-escaped":d})}}]}),bt="tippy-box",xt="tippy-content",Ct="tippy-backdrop",Et="tippy-arrow",St="tippy-svg-arrow",It={passive:!0,capture:!0},Pt=function(){return document.body};function Mt(e,t,i){if(Array.isArray(e)){var r=e[t];return null==r?Array.isArray(i)?i[t]:i:r}return e}function Ot(e,t){var i={}.toString.call(e);return 0===i.indexOf("[object")&&i.indexOf(t+"]")>-1}function Lt(e,t){return"function"==typeof e?e.apply(void 0,t):e}function kt(e,t){return 0===t?e:function(r){clearTimeout(i),i=setTimeout((function(){e(r)}),t)};var i}function $t(e){return[].concat(e)}function Tt(e,t){-1===e.indexOf(t)&&e.push(t)}function At(e){return e.split("-")[0]}function Ft(e){return[].slice.call(e)}function Dt(e){return Object.keys(e).reduce((function(t,i){return void 0!==e[i]&&(t[i]=e[i]),t}),{})}function Nt(){return document.createElement("div")}function jt(e){return["Element","Fragment"].some((function(t){return Ot(e,t)}))}function Rt(e){return Ot(e,"MouseEvent")}function Vt(e){return!(!e||!e._tippy||e._tippy.reference!==e)}function zt(e){return jt(e)?[e]:function(e){return Ot(e,"NodeList")}(e)?Ft(e):Array.isArray(e)?e:Ft(document.querySelectorAll(e))}function qt(e,t){e.forEach((function(e){e&&(e.style.transitionDuration=t+"ms")}))}function Bt(e,t){e.forEach((function(e){e&&e.setAttribute("data-state",t)}))}function Ht(e){var t,i=$t(e)[0];return null!=i&&null!=(t=i.ownerDocument)&&t.body?i.ownerDocument:document}function Ut(e,t,i){var r=t+"EventListener";["transitionend","webkitTransitionEnd"].forEach((function(t){e[r](t,i)}))}function Wt(e,t){for(var i=t;i;){var r;if(e.contains(i))return!0;i=null==i.getRootNode||null==(r=i.getRootNode())?void 0:r.host}return!1}var Yt={isTouch:!1},Gt=0;function Xt(){Yt.isTouch||(Yt.isTouch=!0,window.performance&&document.addEventListener("mousemove",Qt))}function Qt(){var e=performance.now();e-Gt<20&&(Yt.isTouch=!1,document.removeEventListener("mousemove",Qt)),Gt=e}function Zt(){var e=document.activeElement;if(Vt(e)){var t=e._tippy;e.blur&&!t.state.isVisible&&e.blur()}}var Jt=!!("undefined"!=typeof window&&"undefined"!=typeof document)&&!!window.msCrypto;var Kt={animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},ei=Object.assign({appendTo:Pt,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},Kt,{allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999}),ti=Object.keys(ei);function ii(e){var t=(e.plugins||[]).reduce((function(t,i){var r,o=i.name,n=i.defaultValue;o&&(t[o]=void 0!==e[o]?e[o]:null!=(r=ei[o])?r:n);return t}),{});return Object.assign({},e,t)}function ri(e,t){var i=Object.assign({},t,{content:Lt(t.content,[e])},t.ignoreAttributes?{}:function(e,t){return(t?Object.keys(ii(Object.assign({},ei,{plugins:t}))):ti).reduce((function(t,i){var r=(e.getAttribute("data-tippy-"+i)||"").trim();if(!r)return t;if("content"===i)t[i]=r;else try{t[i]=JSON.parse(r)}catch(e){t[i]=r}return t}),{})}(e,t.plugins));return i.aria=Object.assign({},ei.aria,i.aria),i.aria={expanded:"auto"===i.aria.expanded?t.interactive:i.aria.expanded,content:"auto"===i.aria.content?t.interactive?null:"describedby":i.aria.content},i}var oi=function(){return"innerHTML"};function ni(e,t){e[oi()]=t}function ai(e){var t=Nt();return!0===e?t.className=Et:(t.className=St,jt(e)?t.appendChild(e):ni(t,e)),t}function si(e,t){jt(t.content)?(ni(e,""),e.appendChild(t.content)):"function"!=typeof t.content&&(t.allowHTML?ni(e,t.content):e.textContent=t.content)}function li(e){var t=e.firstElementChild,i=Ft(t.children);return{box:t,content:i.find((function(e){return e.classList.contains(xt)})),arrow:i.find((function(e){return e.classList.contains(Et)||e.classList.contains(St)})),backdrop:i.find((function(e){return e.classList.contains(Ct)}))}}function ci(e){var t=Nt(),i=Nt();i.className=bt,i.setAttribute("data-state","hidden"),i.setAttribute("tabindex","-1");var r=Nt();function o(i,r){var o=li(t),n=o.box,a=o.content,s=o.arrow;r.theme?n.setAttribute("data-theme",r.theme):n.removeAttribute("data-theme"),"string"==typeof r.animation?n.setAttribute("data-animation",r.animation):n.removeAttribute("data-animation"),r.inertia?n.setAttribute("data-inertia",""):n.removeAttribute("data-inertia"),n.style.maxWidth="number"==typeof r.maxWidth?r.maxWidth+"px":r.maxWidth,r.role?n.setAttribute("role",r.role):n.removeAttribute("role"),i.content===r.content&&i.allowHTML===r.allowHTML||si(a,e.props),r.arrow?s?i.arrow!==r.arrow&&(n.removeChild(s),n.appendChild(ai(r.arrow))):n.appendChild(ai(r.arrow)):s&&n.removeChild(s)}return r.className=xt,r.setAttribute("data-state","hidden"),si(r,e.props),t.appendChild(i),i.appendChild(r),o(e.props,e.props),{popper:t,onUpdate:o}}ci.$$tippy=!0;var pi=1,di=[],ui=[];function hi(e,t){var i,r,o,n,a,s,l,c,p=ri(e,Object.assign({},ei,ii(Dt(t)))),d=!1,u=!1,h=!1,m=!1,g=[],f=kt(Y,p.interactiveDebounce),v=pi++,y=(c=p.plugins).filter((function(e,t){return c.indexOf(e)===t})),_={id:v,reference:e,popper:Nt(),popperInstance:null,props:p,state:{isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},plugins:y,clearDelayTimeouts:function(){clearTimeout(i),clearTimeout(r),cancelAnimationFrame(o)},setProps:function(t){if(_.state.isDestroyed)return;T("onBeforeUpdate",[_,t]),U();var i=_.props,r=ri(e,Object.assign({},i,Dt(t),{ignoreAttributes:!0}));_.props=r,H(),i.interactiveDebounce!==r.interactiveDebounce&&(D(),f=kt(Y,r.interactiveDebounce));i.triggerTarget&&!r.triggerTarget?$t(i.triggerTarget).forEach((function(e){e.removeAttribute("aria-expanded")})):r.triggerTarget&&e.removeAttribute("aria-expanded");F(),$(),x&&x(i,r);_.popperInstance&&(Z(),K().forEach((function(e){requestAnimationFrame(e._tippy.popperInstance.forceUpdate)})));T("onAfterUpdate",[_,t])},setContent:function(e){_.setProps({content:e})},show:function(){var e=_.state.isVisible,t=_.state.isDestroyed,i=!_.state.isEnabled,r=Yt.isTouch&&!_.props.touch,o=Mt(_.props.duration,0,ei.duration);if(e||t||i||r)return;if(M().hasAttribute("disabled"))return;if(T("onShow",[_],!1),!1===_.props.onShow(_))return;_.state.isVisible=!0,P()&&(b.style.visibility="visible");$(),V(),_.state.isMounted||(b.style.transition="none");if(P()){var n=L();qt([n.box,n.content],0)}s=function(){var e;if(_.state.isVisible&&!m){if(m=!0,b.offsetHeight,b.style.transition=_.props.moveTransition,P()&&_.props.animation){var t=L(),i=t.box,r=t.content;qt([i,r],o),Bt([i,r],"visible")}A(),F(),Tt(ui,_),null==(e=_.popperInstance)||e.forceUpdate(),T("onMount",[_]),_.props.animation&&P()&&function(e,t){q(e,t)}(o,(function(){_.state.isShown=!0,T("onShown",[_])}))}},function(){var e,t=_.props.appendTo,i=M();e=_.props.interactive&&t===Pt||"parent"===t?i.parentNode:Lt(t,[i]);e.contains(b)||e.appendChild(b);_.state.isMounted=!0,Z()}()},hide:function(){var e=!_.state.isVisible,t=_.state.isDestroyed,i=!_.state.isEnabled,r=Mt(_.props.duration,1,ei.duration);if(e||t||i)return;if(T("onHide",[_],!1),!1===_.props.onHide(_))return;_.state.isVisible=!1,_.state.isShown=!1,m=!1,d=!1,P()&&(b.style.visibility="hidden");if(D(),z(),$(!0),P()){var o=L(),n=o.box,a=o.content;_.props.animation&&(qt([n,a],r),Bt([n,a],"hidden"))}A(),F(),_.props.animation?P()&&function(e,t){q(e,(function(){!_.state.isVisible&&b.parentNode&&b.parentNode.contains(b)&&t()}))}(r,_.unmount):_.unmount()},hideWithInteractivity:function(e){O().addEventListener("mousemove",f),Tt(di,f),f(e)},enable:function(){_.state.isEnabled=!0},disable:function(){_.hide(),_.state.isEnabled=!1},unmount:function(){_.state.isVisible&&_.hide();if(!_.state.isMounted)return;J(),K().forEach((function(e){e._tippy.unmount()})),b.parentNode&&b.parentNode.removeChild(b);ui=ui.filter((function(e){return e!==_})),_.state.isMounted=!1,T("onHidden",[_])},destroy:function(){if(_.state.isDestroyed)return;_.clearDelayTimeouts(),_.unmount(),U(),delete e._tippy,_.state.isDestroyed=!0,T("onDestroy",[_])}};if(!p.render)return _;var w=p.render(_),b=w.popper,x=w.onUpdate;b.setAttribute("data-tippy-root",""),b.id="tippy-"+_.id,_.popper=b,e._tippy=_,b._tippy=_;var C=y.map((function(e){return e.fn(_)})),E=e.hasAttribute("aria-expanded");return H(),F(),$(),T("onCreate",[_]),p.showOnCreate&&ee(),b.addEventListener("mouseenter",(function(){_.props.interactive&&_.state.isVisible&&_.clearDelayTimeouts()})),b.addEventListener("mouseleave",(function(){_.props.interactive&&_.props.trigger.indexOf("mouseenter")>=0&&O().addEventListener("mousemove",f)})),_;function S(){var e=_.props.touch;return Array.isArray(e)?e:[e,0]}function I(){return"hold"===S()[0]}function P(){var e;return!(null==(e=_.props.render)||!e.$$tippy)}function M(){return l||e}function O(){var e=M().parentNode;return e?Ht(e):document}function L(){return li(b)}function k(e){return _.state.isMounted&&!_.state.isVisible||Yt.isTouch||n&&"focus"===n.type?0:Mt(_.props.delay,e?0:1,ei.delay)}function $(e){void 0===e&&(e=!1),b.style.pointerEvents=_.props.interactive&&!e?"":"none",b.style.zIndex=""+_.props.zIndex}function T(e,t,i){var r;(void 0===i&&(i=!0),C.forEach((function(i){i[e]&&i[e].apply(i,t)})),i)&&(r=_.props)[e].apply(r,t)}function A(){var t=_.props.aria;if(t.content){var i="aria-"+t.content,r=b.id;$t(_.props.triggerTarget||e).forEach((function(e){var t=e.getAttribute(i);if(_.state.isVisible)e.setAttribute(i,t?t+" "+r:r);else{var o=t&&t.replace(r,"").trim();o?e.setAttribute(i,o):e.removeAttribute(i)}}))}}function F(){!E&&_.props.aria.expanded&&$t(_.props.triggerTarget||e).forEach((function(e){_.props.interactive?e.setAttribute("aria-expanded",_.state.isVisible&&e===M()?"true":"false"):e.removeAttribute("aria-expanded")}))}function D(){O().removeEventListener("mousemove",f),di=di.filter((function(e){return e!==f}))}function N(t){if(!Yt.isTouch||!h&&"mousedown"!==t.type){var i=t.composedPath&&t.composedPath()[0]||t.target;if(!_.props.interactive||!Wt(b,i)){if($t(_.props.triggerTarget||e).some((function(e){return Wt(e,i)}))){if(Yt.isTouch)return;if(_.state.isVisible&&_.props.trigger.indexOf("click")>=0)return}else T("onClickOutside",[_,t]);!0===_.props.hideOnClick&&(_.clearDelayTimeouts(),_.hide(),u=!0,setTimeout((function(){u=!1})),_.state.isMounted||z())}}}function j(){h=!0}function R(){h=!1}function V(){var e=O();e.addEventListener("mousedown",N,!0),e.addEventListener("touchend",N,It),e.addEventListener("touchstart",R,It),e.addEventListener("touchmove",j,It)}function z(){var e=O();e.removeEventListener("mousedown",N,!0),e.removeEventListener("touchend",N,It),e.removeEventListener("touchstart",R,It),e.removeEventListener("touchmove",j,It)}function q(e,t){var i=L().box;function r(e){e.target===i&&(Ut(i,"remove",r),t())}if(0===e)return t();Ut(i,"remove",a),Ut(i,"add",r),a=r}function B(t,i,r){void 0===r&&(r=!1),$t(_.props.triggerTarget||e).forEach((function(e){e.addEventListener(t,i,r),g.push({node:e,eventType:t,handler:i,options:r})}))}function H(){var e;I()&&(B("touchstart",W,{passive:!0}),B("touchend",G,{passive:!0})),(e=_.props.trigger,e.split(/\s+/).filter(Boolean)).forEach((function(e){if("manual"!==e)switch(B(e,W),e){case"mouseenter":B("mouseleave",G);break;case"focus":B(Jt?"focusout":"blur",X);break;case"focusin":B("focusout",X)}}))}function U(){g.forEach((function(e){var t=e.node,i=e.eventType,r=e.handler,o=e.options;t.removeEventListener(i,r,o)})),g=[]}function W(e){var t,i=!1;if(_.state.isEnabled&&!Q(e)&&!u){var r="focus"===(null==(t=n)?void 0:t.type);n=e,l=e.currentTarget,F(),!_.state.isVisible&&Rt(e)&&di.forEach((function(t){return t(e)})),"click"===e.type&&(_.props.trigger.indexOf("mouseenter")<0||d)&&!1!==_.props.hideOnClick&&_.state.isVisible?i=!0:ee(e),"click"===e.type&&(d=!i),i&&!r&&te(e)}}function Y(e){var t=e.target,i=M().contains(t)||b.contains(t);if("mousemove"!==e.type||!i){var r=K().concat(b).map((function(e){var t,i=null==(t=e._tippy.popperInstance)?void 0:t.state;return i?{popperRect:e.getBoundingClientRect(),popperState:i,props:p}:null})).filter(Boolean);(function(e,t){var i=t.clientX,r=t.clientY;return e.every((function(e){var t=e.popperRect,o=e.popperState,n=e.props.interactiveBorder,a=At(o.placement),s=o.modifiersData.offset;if(!s)return!0;var l="bottom"===a?s.top.y:0,c="top"===a?s.bottom.y:0,p="right"===a?s.left.x:0,d="left"===a?s.right.x:0,u=t.top-r+l>n,h=r-t.bottom-c>n,m=t.left-i+p>n,g=i-t.right-d>n;return u||h||m||g}))})(r,e)&&(D(),te(e))}}function G(e){Q(e)||_.props.trigger.indexOf("click")>=0&&d||(_.props.interactive?_.hideWithInteractivity(e):te(e))}function X(e){_.props.trigger.indexOf("focusin")<0&&e.target!==M()||_.props.interactive&&e.relatedTarget&&b.contains(e.relatedTarget)||te(e)}function Q(e){return!!Yt.isTouch&&I()!==e.type.indexOf("touch")>=0}function Z(){J();var t=_.props,i=t.popperOptions,r=t.placement,o=t.offset,n=t.getReferenceClientRect,a=t.moveTransition,l=P()?li(b).arrow:null,c=n?{getBoundingClientRect:n,contextElement:n.contextElement||M()}:e,p={name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(e){var t=e.state;if(P()){var i=L().box;["placement","reference-hidden","escaped"].forEach((function(e){"placement"===e?i.setAttribute("data-placement",t.placement):t.attributes.popper["data-popper-"+e]?i.setAttribute("data-"+e,""):i.removeAttribute("data-"+e)})),t.attributes.popper={}}}},d=[{name:"offset",options:{offset:o}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!a}},p];P()&&l&&d.push({name:"arrow",options:{element:l,padding:3}}),d.push.apply(d,(null==i?void 0:i.modifiers)||[]),_.popperInstance=wt(c,b,Object.assign({},i,{placement:r,onFirstUpdate:s,modifiers:d}))}function J(){_.popperInstance&&(_.popperInstance.destroy(),_.popperInstance=null)}function K(){return Ft(b.querySelectorAll("[data-tippy-root]"))}function ee(e){_.clearDelayTimeouts(),e&&T("onTrigger",[_,e]),V();var t=k(!0),r=S(),o=r[0],n=r[1];Yt.isTouch&&"hold"===o&&n&&(t=n),t?i=setTimeout((function(){_.show()}),t):_.show()}function te(e){if(_.clearDelayTimeouts(),T("onUntrigger",[_,e]),_.state.isVisible){if(!(_.props.trigger.indexOf("mouseenter")>=0&&_.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(e.type)>=0&&d)){var t=k(!1);t?r=setTimeout((function(){_.state.isVisible&&_.hide()}),t):o=requestAnimationFrame((function(){_.hide()}))}}else z()}}function mi(e,t){void 0===t&&(t={});var i=ei.plugins.concat(t.plugins||[]);document.addEventListener("touchstart",Xt,It),window.addEventListener("blur",Zt);var r=Object.assign({},t,{plugins:i}),o=zt(e).reduce((function(e,t){var i=t&&hi(t,r);return i&&e.push(i),e}),[]);return jt(e)?o[0]:o}mi.defaultProps=ei,mi.setDefaultProps=function(e){Object.keys(e).forEach((function(t){ei[t]=e[t]}))},mi.currentInput=Yt;Object.assign({},se,{effect:function(e){var t=e.state,i={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(t.elements.popper.style,i.popper),t.styles=i,t.elements.arrow&&Object.assign(t.elements.arrow.style,i.arrow)}});mi.setDefaultProps({render:ci});var gi=mi;
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const fi=new WeakMap,vi=_((e=>t=>{if(!(t instanceof B))throw new Error("unsafeHTML can only be used in text bindings");const i=fi.get(t);if(void 0!==i&&R(e)&&e===i.value&&t.value===i.fragment)return;const r=document.createElement("template");r.innerHTML=e;const o=document.importNode(r.content,!0);t.setValue(o),fi.set(t,{value:e,fragment:o})})),yi=(e,t)=>{const i=e.startNode.parentNode,r=void 0===t?e.endNode:t.startNode,o=i.insertBefore(T(),r);i.insertBefore(T(),r);const n=new B(e.options);return n.insertAfterNode(o),n},_i=(e,t)=>(e.setValue(t),e.commit(),e),wi=(e,t,i)=>{const r=e.startNode.parentNode,o=i?i.startNode:e.endNode,n=t.endNode.nextSibling;n!==o&&x(r,t.startNode,n,o)},bi=e=>{C(e.startNode.parentNode,e.startNode,e.endNode.nextSibling)},xi=(e,t,i)=>{const r=new Map;for(let o=t;o<=i;o++)r.set(e[o],o);return r},Ci=new WeakMap,Ei=new WeakMap,Si=_(((e,t,i)=>{let r;return void 0===i?i=t:void 0!==t&&(r=t),t=>{if(!(t instanceof B))throw new Error("repeat can only be used in text bindings");const o=Ci.get(t)||[],n=Ei.get(t)||[],a=[],s=[],l=[];let c,p,d=0;for(const t of e)l[d]=r?r(t,d):d,s[d]=i(t,d),d++;let u=0,h=o.length-1,m=0,g=s.length-1;for(;u<=h&&m<=g;)if(null===o[u])u++;else if(null===o[h])h--;else if(n[u]===l[m])a[m]=_i(o[u],s[m]),u++,m++;else if(n[h]===l[g])a[g]=_i(o[h],s[g]),h--,g--;else if(n[u]===l[g])a[g]=_i(o[u],s[g]),wi(t,o[u],a[g+1]),u++,g--;else if(n[h]===l[m])a[m]=_i(o[h],s[m]),wi(t,o[h],o[u]),h--,m++;else if(void 0===c&&(c=xi(l,m,g),p=xi(n,u,h)),c.has(n[u]))if(c.has(n[h])){const e=p.get(l[m]),i=void 0!==e?o[e]:null;if(null===i){const e=yi(t,o[u]);_i(e,s[m]),a[m]=e}else a[m]=_i(i,s[m]),wi(t,i,o[u]),o[e]=null;m++}else bi(o[h]),h--;else bi(o[u]),u++;for(;m<=g;){const e=yi(t,a[g+1]);_i(e,s[m]),a[m++]=e}for(;u<=h;){const e=o[u++];null!==e&&bi(e)}Ci.set(t,a),Ei.set(t,l)}}));
/**
 * @license
 * Copyright (c) 2018 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class Ii{add(e){this.classes.add(e),this.changed=!0}remove(e){this.classes.delete(e),this.changed=!0}commit(){if(this.changed){let e="";this.classes.forEach((t=>e+=t+" ")),this.element.setAttribute("class",e)}}constructor(e){this.classes=new Set,this.changed=!1,this.element=e;const t=(e.getAttribute("class")||"").split(/\s+/);for(const e of t)this.classes.add(e)}}const Pi=new WeakMap,Mi=_((e=>t=>{if(!(t instanceof q)||t instanceof W||"class"!==t.committer.name||t.committer.parts.length>1)throw new Error("The `classMap` directive must be used in the `class` attribute and must be the only part in the attribute.");const{committer:i}=t,{element:r}=i;let o=Pi.get(t);void 0===o&&(r.setAttribute("class",i.strings.join(" ")),Pi.set(t,o=new Set));const n=r.classList||new Ii(r);o.forEach((t=>{t in e||(n.remove(t),o.delete(t))}));for(const t in e){const i=e[t];i!=o.has(t)&&(i?(n.add(t),o.add(t)):(n.remove(t),o.delete(t)))}"function"==typeof n.commit&&n.commit()})),Oi=new WeakMap,Li=_((e=>t=>{if(!(t instanceof q)||t instanceof W||"style"!==t.committer.name||t.committer.parts.length>1)throw new Error("The `styleMap` directive must be used in the style attribute and must be the only part in the attribute.");const{committer:i}=t,{style:r}=i.element;let o=Oi.get(t);void 0===o&&(r.cssText=i.strings.join(" "),Oi.set(t,o=new Set)),o.forEach((t=>{t in e||(o.delete(t),-1===t.indexOf("-")?r[t]=null:r.removeProperty(t))}));for(const t in e)o.add(t),-1===t.indexOf("-")?r[t]=e[t]:r.setProperty(t,e[t])})),ki=new WeakMap,$i=_((e=>t=>{if(!(t instanceof B))throw new Error("cache can only be used in text bindings");let i=ki.get(t);void 0===i&&(i=new WeakMap,ki.set(t,i));const r=t.value;if(r instanceof F){if(e instanceof j&&r.template===t.options.templateFactory(e))return void t.setValue(e);{let e=i.get(r.template);void 0===e&&(e={instance:r,nodes:document.createDocumentFragment()},i.set(r.template,e)),x(e.nodes,t.startNode.nextSibling,t.endNode)}}if(e instanceof j){const r=t.options.templateFactory(e),o=i.get(r);void 0!==o&&(t.setValue(o.nodes),t.commit(),t.value=o.instance)}t.setValue(e)})),Ti=new WeakMap,Ai=_((e=>t=>{const i=Ti.get(t);if(void 0===e&&t instanceof q){if(void 0!==i||!Ti.has(t)){const e=t.committer.name;t.committer.element.removeAttribute(e)}}else e!==i&&t.setValue(e);Ti.set(t,e)})),Fi=_((e=>t=>{let i;if(t instanceof G||t instanceof B)throw new Error("The `live` directive is not allowed on text or event bindings");if(t instanceof H)Di(t.strings),i=t.element.hasAttribute(t.name),t.value=i;else{const{element:r,name:o,strings:n}=t.committer;if(Di(n),t instanceof W){if(i=r[o],i===e)return}else t instanceof q&&(i=r.getAttribute(o));if(i===String(e))return}t.setValue(e)})),Di=e=>{if(2!==e.length||""!==e[0]||""!==e[1])throw new Error("`live` bindings can only contain a single expression")};class Ni{add(e){this.classes.add(e),this.commit()}remove(e){this.classes.delete(e),this.commit()}commit(){let e="";this.classes.forEach((t=>e+=t+" ")),this.element.setAttribute("class",e)}constructor(e){this.classes=new Set,this.element=e;const t=(e.getAttribute("class")||"").split(/\s+/);for(const e of t)this.classes.add(e)}}let ji=!1;function Ri(e){return ji?new Ni(e):e.classList||new Ni(e)}function Vi(e=1){return new Promise((t=>0==--e?requestAnimationFrame((()=>t())):t(Vi(e))))}function zi(e){let t=e;for(;t=t.parentNode||t.host;)if(t instanceof HTMLElement)return t;return null}function qi(e,t,i=!0){return new Promise((r=>{const o=new MutationObserver((async()=>{o.disconnect(),i&&await Vi(),r()}));o.observe(e,{attributes:!0,attributeFilter:["class"]}),t&&t()}))}function Bi(e){let t=function(e){const t=[];let i=e.startNode.nextSibling;for(;i!==e.endNode;)t.push(i),i=i.nextSibling;return t}(e),i=t.filter((e=>{return!("#text"===(t=e).nodeName&&!(null===(i=t.nodeValue)||void 0===i?void 0:i.trim()));var t,i}));if(1!=i.length)throw new Error(`lit-transition directive expects exactly one child node,\n      but was passed ${i.map((e=>e.nodeName)).join(", ")}`);return i[0]}const Hi=new WeakMap;function Ui(e,t){return Hi.set(e,t),e}function Wi(e,t){const i=zi(e);if(i){if("absolute"===(()=>{const e=document.createElement("div"),r=Ri(e),o=i.shadowRoot||i;var n;n=t,Array.isArray(n)?n.forEach((e=>r.add(e))):r.add(n),o.appendChild(e);const a=window.getComputedStyle(e).position;return o.removeChild(e),a})()){return"relative"===window.getComputedStyle(i).position}}return!1}function Yi(e){const t=e.getBoundingClientRect();let i=0,r=0;{let t=e.offsetParent;for(;e&&e!==document&&!(e instanceof DocumentFragment)&&e!==t;)i+=e.offsetTop-(e.scrollTop||0),r+=e.offsetLeft-(e.scrollLeft||0),e=zi(e)}return{left:r,top:i,width:t.width,height:t.height}}let Gi;function Xi(e=!document.hidden){Gi=e}Xi(),document.addEventListener("visibilitychange",(()=>Xi()),!1);const Qi=new WeakMap;function Zi(e){return function(t,i){return async r=>{if(!(r instanceof B))throw new Error("The `transition` directive can only be used on nodes");t||(t=te`<div></div>`),"string"!=typeof t&&"number"!=typeof t||(t=te`<div style="display: inline-block">${t}</div>`);const o=(n=t,Hi.get(n));var n;const{enter:a,leave:s,onEnter:l,onLeave:c,onAfterEnter:p,onAfterLeave:d,mode:u="in-out"}=i;let h=Qi.get(r);function m(e){const t=new B(r.options);return t.appendIntoPart(r),t.setValue(e),t.commit(),t}function g(e){const{startNode:t,endNode:i}=e;try{t&&e.clear()}catch(i){}t&&t.parentNode&&t.parentNode.removeChild(t),i&&i.parentNode&&i.parentNode.removeChild(i)}if(!Gi)return h&&h.last&&g(h.last),c&&await c(),d&&await d(),l&&await l(),h&&(h.last=m(t)),void(p&&await p());async function f(t){l&&await l(),a&&await e.transition(t,a,i),p&&await p()}async function v(t){c&&await c(),s&&await e.transition(t,s,i),g(t),d&&await d()}if(h||Qi.set(r,h={children:new Map,styles:new Map,transition:i}),e.init&&e.init({transition:i,data:h,add:m,remove:g}),h.last&&o&&o===h.name)h.last.setValue(t),h.last.commit();else if(h.name=o,"in-out"===u){const e=h.last;await f(h.last=m(t)),e&&await v(e)}else if("out-in"===u){const e=h.last;e&&await v(e),await f(h.last=m(t))}else h.last&&v(h.last),await f(h.last=m(t))}}}var Ji,Ki,er,tr;function ir(e={}){const{css:t,duration:i,enter:r={},leave:o={},mode:n=Ji.Both,onAfterEnter:a,onAfterLeave:s,onEnter:l,onLeave:c,skipHidden:p=!0}=e;return{duration:i,skipHidden:p,css:te`<style>${t}</style>`,enter:0!=r&&(Array.isArray(r)||"string"==typeof r?{active:r}:Object.assign({active:"enter-active",from:"enter-from",to:"enter-to"},r)),leave:0!=o&&(Array.isArray(o)||"string"==typeof o?{active:o,lock:false}:Object.assign({active:"leave-active",from:"leave-from",to:"leave-to",lock:false},o)),onEnter:l,onLeave:c,onAfterEnter:a,onAfterLeave:s,mode:n}}function rr(e,t){const i=t();for(let e in i)t[e]=i[e];return Object.defineProperty(t,"name",{get:()=>e}),t}function or(e,t){for(var i in t)try{t[i].constructor==Object?e[i]=or(e[i],t[i]):e[i]=t[i]}catch(r){e[i]=t[i]}return e}(Ki=Ji||(Ji={})).InOut="in-out",Ki.OutIn="out-in",Ki.Both="both",(tr=er||(er={}))[tr.None=0]="None",tr[tr.Lock=1]="Lock",tr.Auto="auto";const nr=rr("fade",(function(e={}){const{duration:t=500,ease:i="ease-out",opacity:r=0}=e;return or({enter:{active:"fade-enter-active",from:"fade-enter-from",to:"fade-enter-to"},leave:{active:"fade-leave-active",from:"fade-leave-from",to:"fade-leave-to",lock:!0},css:`\n    .fade-leave-active {\n      position: fixed;\n      transition: opacity ${t}ms ${i}, transform ${t}ms ${i};\n    }\n    .fade-enter-active {\n      transition: opacity ${t}ms ${i}, transform ${t}ms ${i};\n    }\n  .fade-enter-from, .fade-leave-to {\n    opacity: ${r};\n  }\n  .fade-enter-to, .fade-leave-from {\n    opacity: 1;\n  }\n  `},e)})),ar={async transition(e,t,i){const{duration:r=i.duration,active:o,from:n,to:a,lock:s}=t,l=Bi(e);if(!l)return;let c;s&&(s!==er.Auto||o&&Wi(l,o))&&(c=Yi(l)),await new Promise((async e=>{const t=Ri(l),i=e=>Array.isArray(e)?e.forEach((e=>t.add(e))):t.add(e),s=e=>Array.isArray(e)?e.forEach((e=>t.remove(e))):t.remove(e);var p,d;function u(t){if(t){if(t.target!==l)return;t.preventDefault(),t.stopPropagation()}["transitionend","transitioncancel","animationend","animationcancel"].filter((e=>!t||e!==t.type)).forEach((e=>l.removeEventListener(e,u))),o&&s(o),n&&s(n),a&&s(a),e()}c&&(d=c,(p=l).style.marginLeft="0px",p.style.marginTop="0px",p.style.left=d.left+"px",p.style.top=d.top+"px",p.style.width=d.width+"px",p.style.height=d.height+"px");const h={once:!0};r?setTimeout(u,r):(l.addEventListener("transitionrun",(function(){l.addEventListener("transitionend",u,h),l.addEventListener("transitioncancel",u,h)}),h),l.addEventListener("animationstart",(function(){l.addEventListener("animationend",u,h),l.addEventListener("animationcancel",u,h)}),h)),n&&await qi(l,(()=>i(n))),o&&await qi(l,(()=>i(o))),n&&s(n),a&&i(a)}))},init({data:e,remove:t,add:i,transition:r}){if(e._cssSource!==r.css&&(e.css&&t(e.css),r.css)){e._cssSource=r.css;let t=r.css;t="string"==typeof t?te`<style>${t}</style>`:t,e.css=i(t)}}},sr=(rr("land",(function(e={}){const{duration:t=500,ease:i="ease-out",opacity:r=0}=e;return or({enter:{active:"land1-enter-active",from:"land1-enter-from",to:"land1-enter-to"},leave:{active:"land1-leave-active",from:"land1-leave-from",to:"land1-leave-to"},mode:"both",css:`\n      .land1-enter-active {\n        transform-origin: 50% 50%;\n        transition: transform ${t}ms ${i}, opacity ${t}ms ${i};\n      }\n      .land1-leave-active {\n        transform-origin: 50% 50%;\n        position: absolute;\n        transition: transform ${t}ms ${i}, opacity ${t}ms ${i};\n      }\n      .land1-enter-from {\n        opacity: ${r};\n        transform: translate(0px, 0px) scale(3);\n      }\n      .land1-leave-to {\n        transform: translate(0px, 100px);\n        opacity: ${r};\n      }`},e)})),rr("slide",(function(e={}){const{left:t,right:i,up:r,down:o}=e;let n={};t&&(n={x:"-100%",x1:"100%"}),i&&(n={x:"100%",x1:"-100%"}),r&&(n={y:"100%",y1:"-100%"}),o&&(n={y:"-100%",y1:"100%"});let{mode:a,duration:s=500,x:l="100%",y:c="0%",x1:p="",y1:d="",ease:u="ease-out",leavePosition:h="",opacity:m=0}=Object.assign(Object.assign({},n),e);return p=p||l,d=d||c,or({enter:{active:"slide-enter-active",from:"slide-enter-from"},leave:{active:"slide-leave-active",to:"slide-leave-to",lock:er.Auto},css:`\n    .slide-enter-active {\n      transition: transform ${s}ms ${u}, opacity ${s}ms ${u};\n    }\n    .slide-leave-active {\n      position: ${h||(a!==Ji.OutIn?"absolute":"initial")};\n      transition: transform ${s}ms ${u}, opacity ${s}ms ${u};\n    }\n    .slide-leave-to {\n      opacity: ${m};\n      transform: translate(${l}, ${c});\n    }\n    .slide-enter-from {\n      opacity: ${m};\n      transform: translate(${p}, ${d});\n    }`,mode:a},e)})),_((function(e,t=nr){return"function"==typeof t&&(t=t()),Zi(ar)(e,ir(t))}))),lr="${{amount}}";function cr(e,t){"string"==typeof e&&(e=e.replace(".",""));let i="";const r=/\{\{\s*(\w+)\s*\}\}/,o=t||lr;function n(e,t=2,i=",",r="."){if(isNaN(e)||null==e)return 0;const o=(e=(e/100).toFixed(t)).split(".");return o[0].replace(/(\d)(?=(\d\d\d)+(?!\d))/g,`$1${i}`)+(o[1]?r+o[1]:"")}switch(o.match(r)[1]){case"amount":i=n(e,2);break;case"amount_no_decimals":i=n(e,0);break;case"amount_with_comma_separator":i=n(e,2,".",",");break;case"amount_no_decimals_with_comma_separator":i=n(e,0,".",",")}return o.replace(r,i)}const pr={OPTIONS:"_cl_options",ID:"_cl_options_id",BUNDLE:"_cl_options_bundle",PRICE:"_cl_options_price",PRICE_BASE:"_cl_options_price_base",PRICE_KEY:"_cl_options_price_key",CURRENCY:"_cl_options_currency",WEIGHT:"_cl_options_weight",QUANTITY_ID:"_cl_options_quantity_id",QUANTITY_DISCOUNT:"_cl_options_quantity_discount",QUANTITY_MIN:"_cl_options_quantity_min",JSON:"_cl_options_json",JSON_PRICE:"_cl_options_json_price"},dr={cartItem:!0,cartItemPreview:!0,cartItemPreviewViews:!0,cartItemPrice:!0,cartItemPriceOptions:!0,cartItemEdit:!1,cartItemClOptions:!0,cartItemPriceRemove:!0,cartCount:!0,cartTotal:!0,cartFormCapture:!0,cartDiscount:!1,cartPriceRegex:!1,checkoutDomain:!1,productFormCapture:!0,productFormDisabled:!0,productBuyNow:!0,productPrice:!0,productPriceAll:!1,productVariantHide:!0,productVariantFilter:!0,productVariantObserver:!1,productVariantHistory:!1,productVariantHistoryPush:!0,productVariantHistoryReplace:!0,productLinkAvailable:!1,productVariantExcludeTotal:!1,productPriceDeductVP:!1,productPriceTimeout:!1,productPriceObserver:!1,productItemUpdate:!0,productItemModal:!1,productOptionsClear:!1,productOptionsEmptyId:!1,productOptionsEmptyExclude:!1,productAddonBundle:!1,productCropOverlay:!0,productSKU:!1,productQuickView:!1,amountNoDecimals:!1,themeGallery:!1,themeGalleryTimeout:!1,previewHiddenExclude:!1,tooltipBody:!0,currencyFormat:!0,priceVisible:!0,priceVisibleCustomer:!1,previewCdnSize:!0,previewExportLog:!0,previewExportRequired:!1,previewBlobs:!1,checkoutLog:!1,checkoutQuantityValidate:!1},ur={currency:"",currencyConvert:!1,currencyFactor:1,moneyFormat:"$ {{amount}}",moneyFormatWithCurrency:"${{amount}} USD",priceVariant:!1,priceVariantValue:.01,priceVariantId:"",priceProductHandle:"",checkout:{key:"",update:!1,negative:!1}},hr=e=>{if(1!==ur.currencyFactor)if(e*=ur.currencyFactor,ur.priceVariant){let t=Math.round(e/ur.priceVariantValue);e=ur.priceVariantValue*t,e=Math.round(100*e)/100}else e=ur.currencyFactor>100&&e>100?100*Math.ceil(e/100):Math.ceil(e);return e},mr={NONE:0,CODE:1,AUTO:2},gr={ABSOLUTE:1,PERCENTAGE:2,LETTER:3,FORMULA:4},fr={EXPORT:!1,FORMULA:!1,QUANTITY:!1},vr=e=>e&&-1!==e.indexOf("//cdn.shopify.com/"),yr=(e,t="200x")=>"small"===e?"100x":"medium"===e?"200x":"large"===e?"400x":t,_r=(e,t)=>{if(vr(e)){let i=e.substring(e.lastIndexOf(".")+1);return"svg"===i?e:e.replace("."+i,"")+"_"+t+"."+i}return e};class wr{}wr.templates={};var br=wr;var xr=class{upload(e,t){const i=[],r=[];for(let o=0;o<e.length;o++){const a=e[o];i.push(new Promise(((e,i)=>{this._getSignedUrl(a).then((s=>{const l={method:"PUT",headers:{"Content-type":a.mimeType},data:a._file};0===o&&(l.onProgress=t);const c=new n(s.upload,l);r.push(c),c.then((t=>{a.url=s.download,a.path=s.path;let i=parseInt(t.xhr.getResponseHeader("x-goog-stored-content-length"));isNaN(i)||a.meta&&(a.meta.contentLength=i),e(a)})).catch((e=>{i(e)}))})).catch((e=>{i(e)}))})))}let o=Promise.all(i).then((e=>(a.info(e),e)));return o.cancel=()=>{for(let e=0;e<r.length;e++){r[e].cancel()}},o}_getSignedUrl(e){let t=this.settings.api+this.settings.path,i=o.extend(this.settings.queryParams,{name:encodeURIComponent(e.name),type:encodeURIComponent(e.mimeType),public:"1",cb:1e18*Math.random()+""});return new n(t,{method:"GET",queryParams:i}).then((e=>e.data))}constructor(e){this.settings=o.extend({api:"",path:"/api/storage",queryParams:{}},e||{})}};var Cr=class{findToken(){let e=o.readCookie("token");e&&(this.settings.queryParams.token=e)}blobToFile(e,t){return new File([e],t,{lastModified:(new Date).getTime(),type:e.type})}fromBlob(e,t){return{name:t,size:e.size,mimeType:e.type,meta:{},_file:e}}fromNative(e){return{name:e.name?e.name:"",size:e.size,mimeType:e.type,meta:{},_file:e}}saveFile(e){return this.settings.queryParams.token||this.findToken(),this.settings.origin&&(e.origin=this.settings.origin),new n(this.settings.api+this.settings.path,{method:"POST",responseType:"json",headers:{"Content-type":"application/json"},data:e,queryParams:this.settings.queryParams}).then((e=>{if(!this.settings.queryParams.token&&e.data.token){let t=e.data.token;o.writeCookie("token",t,10,"/"),this.settings.queryParams.token=t}return e.data})).catch((e=>{throw e}))}removeFile(e){return Promise.resolve()}exportFailed(e){return"object"==typeof e&&(e.xhr&&(e.xhr={url:e.xhr._url,status:e.xhr.status,statusText:e.xhr.statusText}),e=JSON.stringify(e,Object.getOwnPropertyNames(e))),new n(this.settings.api+this.settings.path+"/export",{method:"POST",responseType:"text",headers:{"Content-type":"application/json"},data:e,queryParams:this.settings.queryParams}).then((e=>e.data)).catch((e=>{throw e}))}constructor(e){this.settings=o.extend({api:"",path:"/api/upload",queryParams:{}},e||{}),this.findToken()}};class Er{static getInstance(e){return Er._instance||(Er._instance=new Er(e)),Er._instance}controller(e,t,i,r){let n={files:[],inputs:[],onValidate:e=>{i.dispatchEvent(new CustomEvent("option:crop:apply",{detail:e,cancelable:!0,bubbles:!0}));let t=!0;return e.required&&0===n.files.length&&(e.errors.push(l.get("product.options.validity.upload.required")),t=!1),t},onChange:(e,t,i,a,s)=>{let c=e.target;if(c.value&&c.files.length>0){const e=c.files;let i=[];for(let r=0;r<e.length;r++){const o=e[r];let n=t.params.maxMb||10;const a=1048576*n;if(o.size>a)return c.value="",t.errors=t.errors||[],t.errors.push(l.get("product.options.validity.upload.max",{max:n})),void c.dispatchEvent(new CustomEvent("options:render",{detail:t,cancelable:!0,bubbles:!0}));i.push(this._fileMeta.fromNative(o))}let p=o.findParent(c,".cl-po--upload"),d=p.querySelector("progress");d.max=100,d.value=0,d.style.display="block",this.upload(i,(e=>{if(e.lengthComputable){let t=e.loaded/e.total*100;t>d.value&&(d.value=t)}})).then((e=>{d.style.display="none";for(let e=0;e<n.files.length;e++){const t=n.files[e];t.uuid&&this._fileMeta.removeFile(t)}for(let e=0;e<n.inputs.length;e++){const t=n.inputs[e];t.parentNode&&t.parentNode.removeChild(t)}n.inputs.length=0,n.files=e;let i="";for(let e=0;e<n.files.length;e++){const r=n.files[e];i+=this._corsUrl(r.url);let o=e+1;o<n.files.length&&(i+=",");let s=document.createElement("input");s.type="hidden",t.params.multiple?s.name="properties["+t.name+"_"+o+"]":s.name="properties["+t.name+"]",s.value=r.url,a&&s.setAttribute("form",a),p.appendChild(s),n.inputs.push(s)}t.value=i,c.value="",s(t),t.params.optionDimension&&this._dimensionUpdate(t,r(t.params.optionDimension),i)})).catch((e=>{alert(e.error),d.style.display="none",c.value=""}))}},update:(e,t,i)=>{if(e.value){if(0===n.inputs.length){n.files.push({url:e.value,name:"file"+e.value.substring(e.value.lastIndexOf(".")),meta:{}});let t=document.createElement("input");t.type="hidden",t.name="properties["+e.name+"]",t.value=e.value,e.value=this._corsUrl(e.value),i&&t.setAttribute("form",i),document.querySelector('[data-option="'+e.name+'"] .cl-po--upload').appendChild(t),n.inputs.push(t)}}else if(n.inputs.length>0){for(let e=0;e<n.inputs.length;e++){const t=n.inputs[e];t.parentNode&&t.parentNode.removeChild(t)}n.inputs.length=0,n.files.length=0}},remove:(e,t,i,r)=>{for(let t=0;t<n.files.length;t++)if(n.files[t]===i){this._fileMeta.removeFile(i),n.files.splice(t,1);for(let e=0;e<n.inputs.length;e++)if(n.inputs[e].value==i.url){let t=n.inputs[e];t.parentNode&&t.parentNode.removeChild(t),n.inputs.splice(e,1)}e.value="",r(e);break}},crop:(e,t)=>{t.dispatchEvent(new CustomEvent("option:crop",{detail:e,cancelable:!0,bubbles:!0}))}};return this._migrateDimensionParams(e),n}controllerLift(e,t,i,r,o){let n={option:e,selector:`.cl-po--upload-lift-${e.id}`,container:null,field:null,urls:[],onValidate:e=>{if(e._controller._cropConfig)return n.updateCrop(),!1;let t=!0;if(e.required&&0===n.urls.length)e.errors.push(l.get("product.options.validity.upload.required")),t=!1;else if(n.field)return n.field.validate();return t},syncValue:()=>{let e="";for(let t=0;t<n.urls.length;t++){e+=this._corsUrl(n.urls[t]),t+1<n.urls.length&&(e+=",")}n.option.value=e,r(n.option)},watchUploads:()=>{n.container=document.querySelector(n.selector),n.container&&(n.container.addEventListener("upload:added",(async e=>{var t=e.detail;const i=n.option.params;let r=i.variant||"original";t.url&&t.meta.variant===r&&(n.urls.push(t.url),n.syncValue(),i.optionDimension&&this._dimensionUpdate(n.option,o(i.optionDimension),this._corsUrl(t.url)))})),n.container.addEventListener("upload:removed",(e=>{var t=e.detail;let i=n.option.params.variant||"original";if(t?.url&&t.meta.variant===i){let e=n.urls.indexOf(t.url);-1!==e&&(n.urls.splice(e,1),n.syncValue())}})))},watchCrop:(t,i)=>{e._controller.optionChanged&&t.removeEventListener("option:changed",e._controller.optionChanged);const r=()=>{let r=i(e.params.optionDimension);r&&(a.debug("init crop dimension based on option",r),o(r,!0),e._controller.optionChanged=t=>{t.detail.name===e.params.optionDimension&&(a.debug("updating crop dimension based on option",r),o(t.detail))},t.addEventListener("option:changed",e._controller.optionChanged),n.container.addEventListener("upload:removed",(t=>{e._controller._cropConfig&&e._controller.updateCrop()})))},o=(t,i=!1)=>{if(t._controller&&t._controller.x&&t._controller.y&&(!t.errors||0===t.errors.length)){void 0===e._controller._cropRatio&&(e._controller._cropRatio=-1);let r,o=e._controller._cropRatio;if(r=e._controller.field.config.imageEditorPintura?Math.round(t._controller.x/t._controller.y*1e4)/1e4:Math.round(t._controller.y/t._controller.x*1e4)/1e4,o!==r){e._controller._cropRatioCurrent=r;let t={imageSizeValidate:!0,imageEditorCropRestrict:!0,imageEditorCropRatios:[{label:"Dimension",value:r}]};a.debug("updating upload-lift crop dimension",t),e._controller._cropConfig=t,!i&&e.value||e._controller.updateCrop()}else delete e._controller._cropConfig}};n.field._upload?r():n.field.element.addEventListener("upload:ready",r)},updateCrop:()=>{e._controller._cropRatio=e._controller._cropRatioCurrent,e._controller.field.updateConfig(e._controller._cropConfig),delete e._controller._cropConfig},update:(e,t)=>{e.value?0===n.urls.length&&e._controller.ready.then((()=>{if(e.value){let t=e.value.split(",");e._controller.field.restore(t),e.value=""}})):n.urls.length>0&&e._controller.field&&e._controller.field.clearFiles()},crop:(e,t)=>{e._controller._cropConfig?e._controller.updateCrop():!e.params.cropEdit||e._layer&&e._layer.params.crop?t.dispatchEvent(new CustomEvent("option:crop",{detail:e,cancelable:!0,bubbles:!0})):e._controller.field.editFile()}};n.ready=new Promise(((e,t)=>{n.onReady=e}));return i.addEventListener("options:rendered",(r=>{const a=()=>{let r=window.Cloudlift.upload.App;if(r.fields.length>0)for(let t=0;t<r.fields.length;t++){const i=r.fields[t];i.config.uuid==e.params.uuid&&(i.destroy(),r.fields.splice(t,1))}else r.config.setup=!1;for(let a=0;a<window.Cloudlift.upload.config.fields.length;a++){const s=window.Cloudlift.upload.config.fields[a];if(s.uuid===e.params.uuid){const a=JSON.parse(JSON.stringify(s));a.field=e.name,a.fileFetch=!1,a.selector=n.selector,r._createUploadField(a,t);const l=r.fields.length-1;n.field=r.fields[l],n.field._productForm=i,r.fields.splice(l,1),n.field.element.addEventListener("upload:ready",(()=>{e._controller.onReady(n.field)})),this._migrateDimensionParams(e),e.params.optionDimension&&e.params.dimensionCrop&&n.watchCrop(i,o)}}n.field||(n.notfound=!0)};let s=()=>{setTimeout((()=>{window.Cloudlift.upload.App?n.field||a():s()}),300)};window.Cloudlift&&window.Cloudlift.upload&&(window.Cloudlift.upload.App?a():s());window.addEventListener("cloudlift.upload.ready",(e=>{window.Cloudlift.upload.App?n.field||a():s()}),{once:!0}),n.watchUploads()}),{once:!0}),n}_corsUrl(e){return e=(e=e.replace("https://upload.dev.cloudlift.app/s/dev","https://storage.googleapis.com/cloudlift-app-cloud-dev-upload")).replace("https://upload.cloudlift.app/s","https://storage.googleapis.com/cloudlift-app-cloud-prod-upload")}_migrateDimensionParams(e){let t=e.params;t.optionCrop&&(t.optionDimension=t.optionCrop,t.dimensionCrop=!0,delete t.optionCrop)}async _dimensionUpdate(e,t,i){let r=e.params;if(t&&r.dimensionUpdate){let n=!1;e._layer?.params.crop&&(e._layer.params.crop=!1,n=!0);let a=await o.getImageSize(i);const s=Math.round(a.width/a.height*100)/100;r.dimensionRatio&&(t.params.ratio=s),r.dimensionCrop&&"upload-lift"===e.type&&void 0===e._controller._cropRatio&&(e._controller.field.config.imageEditorPintura?e._controller._cropRatio=s:e._controller._cropRatio=Math.round(a.height/a.width*100)/100),r.dimensionUnit&&(a=o.convertSizeToUnit(a,r.dimensionDpi||72,r.dimensionUnit)),t._controller.xInput=String(a.width),t._controller.yInput=String(a.height),n&&(e._layer.params.crop=!0,r.dimensionCrop&&(e._layer._autoCrop=!1)),t._controller.onChange(null,t,!0)}}upload(e,t){try{let i=this._provider.upload(e,t);const r=new Promise(((e,t)=>{i.then((i=>{for(let e=0;e<i.length;e++)delete i[e]._file;let r=i[0];if(void 0!==r.meta.contentLength&&r.size!==r.meta.contentLength)return dr.previewExportLog&&this._fileMeta.exportFailed({upload:!0,contentLength:r.meta.contentLength,size:r.size}),void t({upload:!0,error:"Upload failed - please try again"});this._fileMeta.saveFile(r).then((t=>{const r=[];for(let e=1;e<i.length;e++){const o=i[e];o.parent=t.uuid,r.push(this._fileMeta.saveFile(o).then((e=>e)))}Promise.all(r).then((i=>{i.unshift(t),e(i)}))})).catch((e=>{t(e)}))})),i.catch((e=>{t(e)}))}));return r.cancel=()=>{i.cancel()},r}catch(e){return Promise.reject(e)}}constructor(e){this.settings=o.extend({api:"",queryParams:{}},e||{}),this._fileMeta=new Cr({api:this.settings.api,queryParams:this.settings.queryParams,origin:4}),this._provider=new xr({api:this.settings.api,queryParams:this.settings.queryParams})}}var Sr=Er;class Ir{static getProductOption(e,t){for(let i=0;i<t.length;i++){const r=t[i];if(r.name===e)return r;if(r.options&&r.options.length>0){let t=this.getProductOption(e,r.options);if(null!=t)return t}}return null}static hasEditLayer(e,t){return e&&t&&t!==Ir.editLayer}static isEditLayer(e,t,i){return!!t&&(!i||!(e.name!==i&&!e.name.startsWith(i+"_")))}static isCropLayer(e,t,i){return!(!t||e.name!==i)}static hasRefRect(e){return e.params.refRect&&(e.params.autoScale||e.params.autoPos)}static getRefDimensions(e,t){return Ir.hasRefRect(e)?{width:e.params.refWidth||t.config.width-100,height:e.params.refHeight||t.config.height-100}:{width:t.config.width,height:t.config.height}}static getRefCoordinates(e,t){return Ir.hasRefRect(e)?{x:void 0!==e.params.refX?e.params.refX:50,y:void 0!==e.params.refY?e.params.refY:50,angle:void 0!==e.params.refAngle?e.params.refAngle:0}:e.params.autoPos?{x:0,y:0,angle:0}:{x:0|e.params.x,y:0|e.params.y,angle:0}}static getDimensions(e,t=!1){return t?{height:e.getScaledWidth(),width:e.getScaledHeight()}:{width:e.getScaledWidth(),height:e.getScaledHeight()}}static center(e,t,i,r){this.centerHorizontal(e,t,i,r),this.centerVertical(e,t,i,r)}static centerHorizontal(e,t,i,r){let o=i.x+r.width/2-t.width/2;e.left=parseFloat(o.toFixed(2))}static centerVertical(e,t,i,r){let o=i.y+r.height/2-t.height/2;e.top=parseFloat(o.toFixed(2))}}Ir.editLayer="_";var Pr=Ir;var Mr,Or=class{static moveX(e,t){e._object.left+=t,this.updateMoving(e)}static moveY(e,t){e._object.top+=t,this.updateMoving(e)}static scale(e,t){e._object.scaleX+=t,e._object.scaleY+=t,this.updateScaling(e)}static rotate(){}static center(e,t){let i=Pr.getDimensions(e._object),r=Pr.getRefCoordinates(e,e._context),o=Pr.getRefDimensions(e,e._context);"h"===t?Pr.centerHorizontal(e._object,i,r,o):"v"===t?Pr.centerVertical(e._object,i,r,o):Pr.center(e._object,i,r,o),this.updateMoving(e)}static updateMoving(e){e._canvas&&(e._canvas.fire("object:moving",{target:e._object}),e._canvas.fire("object:modified",{target:e._object}),e._canvas.requestRenderAll())}static updateScaling(e){e._canvas&&(e._canvas.fire("object:scaling",{target:e._object}),e._canvas.fire("object:modified",{target:e._object}),e._canvas.requestRenderAll())}},Lr={};Mr=function(){var e=function(){},t={},i={},r={};function o(e,t){if(e){var o=r[e];if(i[e]=t,o)for(;o.length;)o[0](e,t),o.splice(0,1)}}function n(t,i){t.call&&(t={success:t}),i.length?(t.error||e)(i):(t.success||e)(t)}function a(t,i,r,o){var n,s,l=document,c=r.async,p=(r.numRetries||0)+1,d=r.before||e,u=t.replace(/[\?|#].*$/,""),h=t.replace(/^(css|img)!/,"");o=o||0,/(^css!|\.css$)/.test(u)?((s=l.createElement("link")).rel="stylesheet",s.href=h,(n="hideFocus"in s)&&s.relList&&(n=0,s.rel="preload",s.as="style")):/(^img!|\.(png|gif|jpg|svg|webp)$)/.test(u)?(s=l.createElement("img")).src=h:((s=l.createElement("script")).src=t,s.async=void 0===c||c),s.onload=s.onerror=s.onbeforeload=function(e){var l=e.type[0];if(n)try{s.sheet.cssText.length||(l="e")}catch(e){18!=e.code&&(l="e")}if("e"==l){if((o+=1)<p)return a(t,i,r,o)}else if("preload"==s.rel&&"style"==s.as)return s.rel="stylesheet";i(t,l,e.defaultPrevented)},!1!==d(t,s)&&l.head.appendChild(s)}function s(e,i,r){var s,l;if(i&&i.trim&&(s=i),l=(s?r:i)||{},s){if(s in t)throw"LoadJS";t[s]=!0}function c(t,i){!function(e,t,i){var r,o,n=(e=e.push?e:[e]).length,s=n,l=[];for(r=function(e,i,r){if("e"==i&&l.push(e),"b"==i){if(!r)return;l.push(e)}--n||t(l)},o=0;o<s;o++)a(e[o],r,i)}(e,(function(e){n(l,e),t&&n({success:t,error:i},e),o(s,e)}),l)}if(l.returnPromise)return new Promise(c);c()}return s.ready=function(e,t){return function(e,t){e=e.push?e:[e];var o,n,a,s=[],l=e.length,c=l;for(o=function(e,i){i.length&&s.push(e),--c||t(s)};l--;)n=e[l],(a=i[n])?o(n,a):(r[n]=r[n]||[]).push(o)}(e,(function(e){n(t,e)})),s},s.done=function(e){o(e,[])},s.reset=function(){t={},i={},r={}},s.isDefined=function(e){return e in t},s},"function"==typeof define&&define.amd?define([],Mr):Lr=Mr();class kr{static load(t,i,r={async:!0}){return r.returnPromise=!0,e(Lr)(t,i,r)}static isReady(t){return Array.isArray(t)||(t=[t]),new Promise(((i,r)=>{e(Lr).ready(t,(()=>{i(t)}))}))}static isDefined(t){return e(Lr).isDefined(t)}static loadOnce(e,t,i={async:!0}){return kr.isDefined(t)?kr.isReady(t):kr.load(e,t,i)}}var $r=kr;function Tr(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class Ar{init(){this.images=[],this.imagesPaged=[],this.imagesHide=!0,this.page=1,this.cache={},this.searchQuery="",this.fuse=null,this.searchLists=!0,this.category=null,this.categoryDefault=null,this.checkExternalImage()}initUI(){if(this.categoryCount=this.option.values?.length||0,this.image&&this.categoryCount--,this.searchHide=0===this.categoryCount,this.pageSize=this.option.params.librarySize||20,!this.category&&this.categoryCount>0&&(1!==this.categoryCount||this.config.editorMode?!0!==this.option.params.categoryGrid&&this.onCategoryChange(null,this.option.values[0]):(this.categoryDefault=this.option.values[0],this.onCategoryChange(null,this.categoryDefault))),this.option.params.optionUpload){let e=this.getOption(this.option.params.optionUpload);this._uploadEvents=e!==this.optionUpload,this.optionUpload=e,void 0!==this.option.params.uploadHide&&this.config.productForm.addEventListener("options:rendered",(e=>{let t=document.querySelector(`[data-option="${this.option.params.optionUpload}"]`);t&&(t.style.display=this.option.params.uploadHide?"none":"")}),{once:!0})}}pageImages(){this.imagesPaged=[],this.page=0,this.imagesHide=!1,this.categoryHide=!0===this.option.params.categoryGrid||null!==this.categoryDefault,this.onMoreImages()}onImageChange(e,t){this.removeImage(),this.category&&this.category.price&&!t.price&&0!==t.price&&(t.price=this.category.price),this.image=t,this.option.values.push(t);let i=t.img;"function"==typeof window.clLibraryGetImage&&(i=window.clLibraryGetImage(t)),this.option.value=i,this.popupOpen&&this._popup.set("close",!0),this.optionUpload&&this.syncUploadLiftImage(i),this.onChange(this.option)}removeImage(){if(this.image){let e=this.option.values.indexOf(this.image);-1!==e&&this.option.values.splice(e,1),this.image=null}this.option.value=""}restoreImage(){let e={id:this.option._imageId,img:this._corsUrl(this.option.value)};this.onImageChange(null,e)}_corsUrl(e){return e=(e=e.replace("https://upload.dev.cloudlift.app/s/dev","https://storage.googleapis.com/cloudlift-app-cloud-dev-upload")).replace("https://upload.cloudlift.app/s","https://storage.googleapis.com/cloudlift-app-cloud-prod-upload")}isSelected(e,t){return this.image===t}conditionValue(e){return this.category?.value||""}onValidate(e){return!(e.required&&!this.image)||(e.errors.push(l.get("product.options.validity.valueMissing")),!1)}showCategories(){this.categoryHide=!1,this.imagesHide=!0,this.renderOptions()}async onCategoryChange(e,t){a.debug("library category changed",e),this.category=t,this.searchQuery="",this.images=await this.getImages(this.category),this.pageImages()}async onMoreImages(){this.page++;let e=(this.page-1)*this.pageSize,t=e+this.pageSize;this.hasMoreImages=t<this.images.length,this.searchQuery?"function"==typeof window.clLibrarySearchImages&&await this.callExternalImages(window.clLibrarySearchImages,t,this.searchQuery,this.page,this.pageSize):"function"==typeof window.clLibraryGetImages&&await this.callExternalImages(window.clLibraryGetImages,t,this.category,this.page,this.pageSize),this.imagesPaged.push(...this.images.slice(e,t)),this.renderOptions()}async callExternalImages(e,t,...i){try{a.debug("call external images using function:",e);let r=await e.apply(this,i);r?.images?.length&&(this.imagesPaged.push(...r?.images),r.total&&(this.hasMoreImages=r.total>t))}catch(e){a.debug("error loading images using function",e)}}checkExternalImage(){let e;if(-1!==window.location.search.indexOf("library.")){let t=new URLSearchParams(window.location.search);e={},t.forEach(((t,i)=>{i.startsWith("library.")&&(e[i.replace("library.","")]=t)}))}else"object"==typeof window.clLibraryImage&&(e=window.clLibraryImage);e?.img&&setTimeout((()=>{this.onImageChange(null,e)}))}async onSearch(e){if(a.debug("library search changed",e),this.searchQuery=e.target.value,!this.fuse&&this.searchLists){let e=await this.fetchAllOptionsLists();if(e.length){await $r.loadOnce(["https://cdn.jsdelivr.net/npm/fuse.js@6.6.2/dist/fuse.basic.min.js"],"fuse-search",{async:!1});const t={threshold:.4,ignoreLocation:!0,includeScore:!0,keys:[{name:"text",weight:2},{name:"value",weight:1}]};this.fuse=new Fuse(e,t)}else this.searchLists=!1}if(this.searchLists){let e=this.fuse.search(this.searchQuery);console.debug("search results:",e),this.images=e.map((function(e){return e.item}))}else this.images=[];""===this.searchQuery&&this.categoryDefault?this.onCategoryChange(null,this.categoryDefault):(this.category=null,this.pageImages())}async getImages(e){let t=[];return e.list&&(t=await this.fetchOptionList(e.list)),t}async fetchAllOptionsLists(){let e=[];for(const t of this.option.values)t.list&&e.push(this.fetchOptionList(t.list));return Promise.all(e).then((e=>e.flat()))}async fetchOptionList(e){if(this.cache[e])return this.cache[e];let t=(await new n(this.settings.api+this.settings.path+"/"+e,{method:"GET",responseType:"json",headers:{"Content-type":"application/json"},queryParams:this.settings.queryParams})).data;return this.cache[e]=t,t}libraryStyleMap(e={}){return this.option.params.popup&&!this.popupOpen&&(e.display="none"),this.option.params.libraryCols&&(e["--library-grid-cols"]=this.option.params.libraryCols),this.option.params.libraryColsM&&(e["--library-grid-cols-m"]=this.option.params.libraryColsM),this.option.params.libraryColsH&&(e["--library-grid-cols-h"]=this.option.params.libraryColsH+"px"),e}async openPopup(){if(this._popupEl)this.renderPopup();else{this._popupEl=document.createElement("div");let e=[this.settings.assets+"/static/lib/ldcover/ldcv.full.min.css",this.settings.assets+"/static/lib/ldcover/ldcv.min.js"];await $r.loadOnce(e,"popup",{async:!1});const t=`[data-option="${this.option.name}"] .cl-po--library`;this._libraryEl=this.config.wrapper.querySelector(t)||document.querySelector(t),this.renderPopup(),document.body.appendChild(this._popupEl),this._popup=new ldCover({root:this._popupEl.querySelector(".ldcv"),lock:!1}),this._popup.on("toggle.on",(()=>{this.popupOpen=!0,this._libraryEl.style.display=""}))}this._popup.get().then((e=>{this.popupOpen=!1})),this._popup.toggle()}renderOptions(){this.config.productForm.dispatchEvent(new CustomEvent("options:render",{detail:this.option,cancelable:!0,bubbles:!0}))}renderPopup(){const e={id:this.config.uuid,className:"popup fade"+(this.option.params.popupFull?" full":"")};ee(br.templates["library-popup"](this._libraryEl,e,(e=>{this._popup.set("close",!0)})),this._popupEl)}crop(){this._fileCrop?(this._syncUpload=!0,this._syncCrop=!0,this.image._img=this.image._preview,this.image._preview=this._preview,this.optionUpload._controller?._cropConfig?this.optionUpload._controller.updateCrop():this._fileCrop.edit()):this.config.productForm.dispatchEvent(new CustomEvent("option:crop",{detail:this.option,cancelable:!0,bubbles:!0}))}syncUploadLiftImage(e){if(this.optionUpload._controller?.field){let t=this.optionUpload._controller.field;a.debug("library image upload-lift sync",t,e),this.image._preview=this._preview,this._uploadEvents&&(delete this._uploadEvents,this.optionUpload._controller.field.element.addEventListener("upload:added",(e=>{if(this._syncUpload&&this.image){let i=e.detail;if("original"===i.meta.variant){this.image._preview=i.url;let e=t._upload._pond.getFile();e&&e.edit&&(this._fileCrop=e),this._updateCropOriginal||(this._updateCropOriginal=this.optionUpload._controller.updateCrop,this.optionUpload._controller.updateCrop=()=>{this._syncUpload=!0,this._syncCrop=!0,this._updateCropOriginal()}),this.onChange(this.option),delete this._syncUpload,delete this._syncCrop}}})),this.optionUpload._controller.field.element.addEventListener("upload:removed",(e=>{!this._syncUpload&&this.image&&(this.removeImage(),delete this._fileCrop,this.onChange(this.option))})),this.optionUpload._controller.field.element.addEventListener("upload:editor:cancel",(e=>{this._syncUpload&&this.image&&(this.image._img&&(this.image._preview=this.image._img,delete this.image._img),this._syncCrop||this.removeImage(),this.onChange(this.option),delete this._syncUpload,delete this._syncCrop)}))),this._syncUpload=!0,this._syncCrop=!1;const i=()=>{this.optionUpload._controller.field.uploadFile(e).then((e=>{a.debug("library image upload-lift complete",e)}))};this.optionUpload._controller.field._upload?.isReady()?i():this.optionUpload._controller.field.element.addEventListener("upload:ready",(()=>i()),{once:!0})}}constructor(e,t){Tr(this,"_preview","data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/Pgo8IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPgo8c3ZnIHdpZHRoPSI0MHB4IiBoZWlnaHQ9IjQwcHgiIHZpZXdCb3g9IjAgMCA0MCA0MCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4bWw6c3BhY2U9InByZXNlcnZlIiBzdHlsZT0iZmlsbC1ydWxlOmV2ZW5vZGQ7Y2xpcC1ydWxlOmV2ZW5vZGQ7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZS1taXRlcmxpbWl0OjEuNDE0MjE7IiB4PSIwcHgiIHk9IjBweCI+CiAgICA8ZGVmcz4KICAgICAgICA8c3R5bGUgdHlwZT0idGV4dC9jc3MiPjwhW0NEQVRBWwogICAgICAgICAgICBALXdlYmtpdC1rZXlmcmFtZXMgc3BpbiB7CiAgICAgICAgICAgICAgZnJvbSB7CiAgICAgICAgICAgICAgICAtd2Via2l0LXRyYW5zZm9ybTogcm90YXRlKDBkZWcpCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHRvIHsKICAgICAgICAgICAgICAgIC13ZWJraXQtdHJhbnNmb3JtOiByb3RhdGUoLTM1OWRlZykKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgQGtleWZyYW1lcyBzcGluIHsKICAgICAgICAgICAgICBmcm9tIHsKICAgICAgICAgICAgICAgIHRyYW5zZm9ybTogcm90YXRlKDBkZWcpCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHRvIHsKICAgICAgICAgICAgICAgIHRyYW5zZm9ybTogcm90YXRlKC0zNTlkZWcpCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHN2ZyB7CiAgICAgICAgICAgICAgICAtd2Via2l0LXRyYW5zZm9ybS1vcmlnaW46IDUwJSA1MCU7CiAgICAgICAgICAgICAgICAtd2Via2l0LWFuaW1hdGlvbjogc3BpbiAxLjVzIGxpbmVhciBpbmZpbml0ZTsKICAgICAgICAgICAgICAgIC13ZWJraXQtYmFja2ZhY2UtdmlzaWJpbGl0eTogaGlkZGVuOwogICAgICAgICAgICAgICAgYW5pbWF0aW9uOiBzcGluIDEuNXMgbGluZWFyIGluZmluaXRlOwogICAgICAgICAgICB9CiAgICAgICAgXV0+PC9zdHlsZT4KICAgIDwvZGVmcz4KICAgIDxnIGlkPSJvdXRlciI+CiAgICAgICAgPGc+CiAgICAgICAgICAgIDxwYXRoIGQ9Ik0yMCwwQzIyLjIwNTgsMCAyMy45OTM5LDEuNzg4MTMgMjMuOTkzOSwzLjk5MzlDMjMuOTkzOSw2LjE5OTY4IDIyLjIwNTgsNy45ODc4MSAyMCw3Ljk4NzgxQzE3Ljc5NDIsNy45ODc4MSAxNi4wMDYxLDYuMTk5NjggMTYuMDA2MSwzLjk5MzlDMTYuMDA2MSwxLjc4ODEzIDE3Ljc5NDIsMCAyMCwwWiIgc3R5bGU9ImZpbGw6YmxhY2s7Ii8+CiAgICAgICAgPC9nPgogICAgICAgIDxnPgogICAgICAgICAgICA8cGF0aCBkPSJNNS44NTc4Niw1Ljg1Nzg2QzcuNDE3NTgsNC4yOTgxNSA5Ljk0NjM4LDQuMjk4MTUgMTEuNTA2MSw1Ljg1Nzg2QzEzLjA2NTgsNy40MTc1OCAxMy4wNjU4LDkuOTQ2MzggMTEuNTA2MSwxMS41MDYxQzkuOTQ2MzgsMTMuMDY1OCA3LjQxNzU4LDEzLjA2NTggNS44NTc4NiwxMS41MDYxQzQuMjk4MTUsOS45NDYzOCA0LjI5ODE1LDcuNDE3NTggNS44NTc4Niw1Ljg1Nzg2WiIgc3R5bGU9ImZpbGw6cmdiKDIxMCwyMTAsMjEwKTsiLz4KICAgICAgICA8L2c+CiAgICAgICAgPGc+CiAgICAgICAgICAgIDxwYXRoIGQ9Ik0yMCwzMi4wMTIyQzIyLjIwNTgsMzIuMDEyMiAyMy45OTM5LDMzLjgwMDMgMjMuOTkzOSwzNi4wMDYxQzIzLjk5MzksMzguMjExOSAyMi4yMDU4LDQwIDIwLDQwQzE3Ljc5NDIsNDAgMTYuMDA2MSwzOC4yMTE5IDE2LjAwNjEsMzYuMDA2MUMxNi4wMDYxLDMzLjgwMDMgMTcuNzk0MiwzMi4wMTIyIDIwLDMyLjAxMjJaIiBzdHlsZT0iZmlsbDpyZ2IoMTMwLDEzMCwxMzApOyIvPgogICAgICAgIDwvZz4KICAgICAgICA8Zz4KICAgICAgICAgICAgPHBhdGggZD0iTTI4LjQ5MzksMjguNDkzOUMzMC4wNTM2LDI2LjkzNDIgMzIuNTgyNCwyNi45MzQyIDM0LjE0MjEsMjguNDkzOUMzNS43MDE5LDMwLjA1MzYgMzUuNzAxOSwzMi41ODI0IDM0LjE0MjEsMzQuMTQyMUMzMi41ODI0LDM1LjcwMTkgMzAuMDUzNiwzNS43MDE5IDI4LjQ5MzksMzQuMTQyMUMyNi45MzQyLDMyLjU4MjQgMjYuOTM0MiwzMC4wNTM2IDI4LjQ5MzksMjguNDkzOVoiIHN0eWxlPSJmaWxsOnJnYigxMDEsMTAxLDEwMSk7Ii8+CiAgICAgICAgPC9nPgogICAgICAgIDxnPgogICAgICAgICAgICA8cGF0aCBkPSJNMy45OTM5LDE2LjAwNjFDNi4xOTk2OCwxNi4wMDYxIDcuOTg3ODEsMTcuNzk0MiA3Ljk4NzgxLDIwQzcuOTg3ODEsMjIuMjA1OCA2LjE5OTY4LDIzLjk5MzkgMy45OTM5LDIzLjk5MzlDMS43ODgxMywyMy45OTM5IDAsMjIuMjA1OCAwLDIwQzAsMTcuNzk0MiAxLjc4ODEzLDE2LjAwNjEgMy45OTM5LDE2LjAwNjFaIiBzdHlsZT0iZmlsbDpyZ2IoMTg3LDE4NywxODcpOyIvPgogICAgICAgIDwvZz4KICAgICAgICA8Zz4KICAgICAgICAgICAgPHBhdGggZD0iTTUuODU3ODYsMjguNDkzOUM3LjQxNzU4LDI2LjkzNDIgOS45NDYzOCwyNi45MzQyIDExLjUwNjEsMjguNDkzOUMxMy4wNjU4LDMwLjA1MzYgMTMuMDY1OCwzMi41ODI0IDExLjUwNjEsMzQuMTQyMUM5Ljk0NjM4LDM1LjcwMTkgNy40MTc1OCwzNS43MDE5IDUuODU3ODYsMzQuMTQyMUM0LjI5ODE1LDMyLjU4MjQgNC4yOTgxNSwzMC4wNTM2IDUuODU3ODYsMjguNDkzOVoiIHN0eWxlPSJmaWxsOnJnYigxNjQsMTY0LDE2NCk7Ii8+CiAgICAgICAgPC9nPgogICAgICAgIDxnPgogICAgICAgICAgICA8cGF0aCBkPSJNMzYuMDA2MSwxNi4wMDYxQzM4LjIxMTksMTYuMDA2MSA0MCwxNy43OTQyIDQwLDIwQzQwLDIyLjIwNTggMzguMjExOSwyMy45OTM5IDM2LjAwNjEsMjMuOTkzOUMzMy44MDAzLDIzLjk5MzkgMzIuMDEyMiwyMi4yMDU4IDMyLjAxMjIsMjBDMzIuMDEyMiwxNy43OTQyIDMzLjgwMDMsMTYuMDA2MSAzNi4wMDYxLDE2LjAwNjFaIiBzdHlsZT0iZmlsbDpyZ2IoNzQsNzQsNzQpOyIvPgogICAgICAgIDwvZz4KICAgICAgICA8Zz4KICAgICAgICAgICAgPHBhdGggZD0iTTI4LjQ5MzksNS44NTc4NkMzMC4wNTM2LDQuMjk4MTUgMzIuNTgyNCw0LjI5ODE1IDM0LjE0MjEsNS44NTc4NkMzNS43MDE5LDcuNDE3NTggMzUuNzAxOSw5Ljk0NjM4IDM0LjE0MjEsMTEuNTA2MUMzMi41ODI0LDEzLjA2NTggMzAuMDUzNiwxMy4wNjU4IDI4LjQ5MzksMTEuNTA2MUMyNi45MzQyLDkuOTQ2MzggMjYuOTM0Miw3LjQxNzU4IDI4LjQ5MzksNS44NTc4NloiIHN0eWxlPSJmaWxsOnJnYig1MCw1MCw1MCk7Ii8+CiAgICAgICAgPC9nPgogICAgPC9nPgo8L3N2Zz4K"),this.onChange=e,this.getOption=t,this.config=null,this.option=null,this.settings=Ar.settings,this.settings.api=-1===this.settings.api.indexOf("local")?this.settings.api.replace("api.","assets."):this.settings.api}}Ar.settings={assets:"",api:"",path:"/api/list",queryParams:{}};var Fr=Ar;const Dr=(e,t)=>{if(e){let i={};i.used=t.value.length,i.min=t.params.min?t.params.min:0,i.max=t.params.max?t.params.max:1e3,i.left=i.max-i.used;for(let t in i)i.hasOwnProperty(t)&&(e=e.replace(new RegExp("{"+t+"}","g"),i[t]));return e}},Nr=e=>e?e.replace(/\\n/g,"\n"):e,jr=(e,t,i)=>{if(dr.priceVisible&&e){let r;return r=t?t.replace(new RegExp("{price}","g"),e):`(+ ${e})`,i&&(-1!==r.indexOf("-")?r=r.replace("-","").replace("+","-"):-1!==r.indexOf("==")&&(r=r.replace("==","").replace("+",""))),ur.checkout.negative&&-1!==r.indexOf("-")&&(r=r.replace("-","").replace("+","-")),r}return""},Rr=e=>{if(e.values){let t=e._controller&&e._controller.multiSelect,i=t?[]:null;for(let r=0;r<e.values.length;r++){const o=e.values[r];if(t&&e._controller.isSelected(e,o))i.push(Vr(o));else if(o.value==e.value)return o}if(i&&i.length)return{text:i.join(",")}}return e.value?{text:e.value}:null},Vr=e=>e?e.text?e.text:e.value||"":"",zr=(e,t,i,r=!1)=>{let o=Vr(t);if(e.params.valuePriceText){let r=qr(e,t,i);r&&(o+=" "+r)}return r&&(o=(e=>e.replace(/(<([^>]+)>)/gi,""))(o)),o},qr=(e,t,i)=>{if(!0===t.disabled){let e=l.get("product.options.disabled",null,"_");if("_"!==e)return`(${e})`}if(t.price&&i)return jr(Br(e,t,i),e.params.priceTemplate,e.params.priceRelative)},Br=(e,t,i)=>{if(t.price&&i){let r=t.price;if(e.params.priceRelative)for(let o=0;o<e.values.length;o++){const n=e.values[o];if(e.value===n.value){if(r-=n.price,0===r){if(e.params.priceRelativeEmpty)return"";r=t.price,i="=="+i}break}}return ur.currencyConvert&&!t.priceVariant&&(r=hr(r)),cr(100*r,i)}return""};let Hr=(e,t,i,r=!1)=>{let o="";if(e.params.imgTooltip&&(o+=`<img src="${_r(t.img,"600x")}" />${o}`),e.params.imgText||(o+=zr(e,t,i,r)),""!==o.trim())return o};const Ur={mode:"both",enter:{active:"cl-po--fade-enter-active",from:"cl-po--fade-enter-from",to:"cl-po--fade-enter-to"},leave:{active:"cl-po--fade-leave-active",from:"cl-po--fade-leave-from",to:"cl-po--fade-leave-to"},duration:500},Wr=()=>{let e=document.createElement("input");return e.type="color",e.value="!","color"===e.type&&"!"!==e.value},Yr=(e,t,i={})=>((t.disabled||e._variantOption&&!1===t.available)&&(i["cl-po--disabled"]=!0),i),Gr=(e,t={})=>(t["cl-po--invalid"]=e.errors&&e.errors.length>0,e._editor&&e._layer.params.collapse&&(t["cl-po--b-radius-0"]=!0),t),Xr=(e,t,i={})=>(e.params.size?i["cl-po--"+e.params.size]=!0:t&&(i["cl-po--"+t]=!0),e.params.shape&&(i["cl-po--"+e.params.shape]=!0),i),Qr=(e,t,i,r)=>{t.params.toggle&&t.value===i.value&&(e.preventDefault(),e.stopImmediatePropagation(),t.value="",r(t))},Zr=(e,t={})=>(e.params.minWidth&&e.params.minWidth>0&&(t.minWidth=e.params.minWidth+"px"),t),Jr=(e,t={})=>(e.params.btnColor&&(t.color=e.params.btnColor),e.params.btnBgColor&&(t.backgroundColor=e.params.btnBgColor),t),Kr=(e,t,i=300)=>0===(i=e.params.debounce||i)?t:o.debounced(i,t),eo=e=>e.params.name?e.params.name:e.params.exclude?"_"+e.name:`properties[${e.name}]`,to=(e,t="noop")=>e.params.autocomplete?e.params.autocomplete:t,io=(e,t)=>{if(e.params.optionFont){let i=t(e.params.optionFont);if(i&&i.value){let e=i.value,t=d.getFont(e);if(t)return t.loaded||d.loadFontsByName([e]),e}}return null},ro=(e,t,i)=>{if(e.target.value){let i=[];if("uppercase"===t.params.textTransform?e.target.value=e.target.value.toUpperCase():"lowercase"===t.params.textTransform&&(e.target.value=e.target.value.toLowerCase()),t.params.rowsMax){let i=e.target.value.split("\n");i.length>t.params.rowsMax&&(i.length=t.params.rowsMax,e.target.value=i.join("\n"))}if(t.params.max&&e.target.value.length>t.params.max&&(e.target.value=e.target.value.substring(0,t.params.max)),t.params.textClean){if(!t._textClean)try{t._textClean=new RegExp(t.params.textClean,t.params.textCleanFlags||"ug")}catch(e){a.error("failed to compile textClean pattern for option: ",t.params.textClean,t,e)}t._textClean&&t._textClean.test(e.target.value)&&(e.target.value=e.target.value.replaceAll(t._textClean,""),i.push(l.get("product.options.validity.textClean",null,t.params.validationMsg||"Input not allowed")))}i.length&&(t.errors=i,t._error=!0)}return oo(e,t,i)},oo=(e,t,i)=>(t.value=e.target.value,i(t)),no=e=>{let t=[];return e._layer.params.editor.font&&t.push("font:"+(e._editor.fontFamily||"")),e._layer.params.editor.style&&(t.push("weight:"+(e._editor.fontWeight||"normal")),t.push("style:"+(e._editor.fontStyle||"normal"))),e._layer.params.editor.align&&t.push("align:"+(e._editor.textAlign||"left")),e._layer.params.editor.size&&t.push("size:"+(e._editor.fontSize||"normal")),e._layer.params.editor.color&&t.push("color:"+(e._editor.color||"#000000")),t.join(",")},ao=(e,t,i)=>({multiSelect:!0,onValidate:e=>{let t=e.value?e.value.split(",").length:0;return e.params.minSelect&&t<e.params.minSelect?(e.errors.push(l.get("product.options.validity.selectMin",{min:e.params.minSelect})),!1):e.params.maxSelect&&t>e.params.maxSelect?(e.errors.push(l.get("product.options.validity.selectMax",{max:e.params.maxSelect})),!1):!(e.required&&!e.value)||(e.errors.push(l.get("product.options.validity.valueMissing")),!1)},onChange:(e,t)=>{let r=document.querySelector("#"+t.id);if(r){let e=document.querySelectorAll('[id^="'+t.id+'"]'),o=[];for(let t=0;t<e.length;t++){const i=e[t];i!==r&&i.checked&&o.push(i.value)}let n=o.join(",");r.value=n,t.value=n,i(t)}},isSelected:(e,t)=>{if(String(t.value).trim()===String(e.value).trim())return!0;if(e.value&&-1!==e.value.indexOf(t.value)){if(-1!==e.value.split(",").indexOf(t.value))return!0}return!1}});br.templates.hidden=(e,t,i)=>te`
    <input type="hidden" id="${e.id}" name="${eo(e)}" .value=${Fi(e.value)} form=${Ai(t.productFormLink)}>
`,br.templates["value-formula"]=(e,t,i)=>te`
        <style>[data-option="${e.name}"] { display:none; }</style>
        ${br.templates.hidden(e,t,i)}}
`;const so=e=>te`
    ${e._layer.params.collapseLabel?te`<span class="cl-po--edit-label">${e._layer.params.collapseLabel}</span>`:null}
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20"><path d="M15.728 9.686l-1.414-1.414L5 17.586V19h1.414l9.314-9.314zm1.414-1.414l1.414-1.414-1.414-1.414-1.414 1.414 1.414 1.414zM7.242 21H3v-4.243L16.435 3.322a1 1 0 0 1 1.414 0l2.829 2.829a1 1 0 0 1 0 1.414L7.243 21z" fill="var(--text-editor-color)"/></svg>
`;br.templates.text=(e,t,i)=>te`
    <input type="text" class="cl-po--input ${Mi(Gr(e))}" id="${e.id}" name="${eo(e)}" .value=${Fi(e.value)} @input=${Kr(e,(t=>ro(t,e,i)))}
      ?required=${e.required} minlength=${Ai(e.params.min)} maxlength=${Ai(e.params.max)} pattern=${Ai(e.params.pattern||void 0)} placeholder=${Ai(e.params.placeholder)} autocomplete="${to(e)}" form=${Ai(t.productFormLink)} style=${Li({textTransform:e.params.textTransform})}>

    ${e._editor?e._layer.params.collapse?te`${co(so(e),br.templates.text_editor(e,t,i),!1,"cl-po--edit")}`:te`${br.templates.text_editor(e,t,i)}`:null}
`,br.templates.textarea=(e,t,i,r,o)=>te`
    <textarea class="cl-po--input ${Mi(Gr(e))}" id="${e.id}" name="${eo(e)}" .value=${Fi(Nr(e.value))} @input=${Kr(e,(t=>ro(t,e,i)))} @keyup=${e.params.textUsage?t=>((e,t)=>{let i=e.target;if(i){let e=i.parentNode.querySelector(".cl-po--text-help");e&&(t.value=i.value,e.innerHTML=Dr(t.params.textHelp,t))}})(t,e):null}
     ?required=${e.required} minlength=${Ai(e.params.min)} maxlength=${Ai(e.params.max)} rows=${Ai(e.params.rows)} placeholder=${Ai(Nr(e.params.placeholder))} style=${Li({textTransform:e.params.textTransform,fontFamily:io(e,o)})} autocomplete="${to(e)}" form=${Ai(t.productFormLink)}>
    </textarea>

    ${e._editor?e._layer.params.collapse?te`${co(so(e),br.templates.text_editor(e,t,i),!1,"cl-po--edit")}`:te`${br.templates.text_editor(e,t,i)}`:null}
        
    ${e.params.textUsage?te`
        <div class="cl-po--help cl-po--text-help"></div>
    `:null}
`,br.templates.text_editor=(e,t,i)=>te`
    <div class="cl-po--text-editor">

        ${br.templates.hidden({id:e.id+"_editor",name:"_"+e.name+"_editor",params:{},value:no(e)},t)}
        
        ${e._layer.params.editor.font?te`
        <div class="cl-po--editor-group cl-po--font-family">
            ${br.templates.font({id:e.id+"_font",name:e.name+"_font",params:{name:e.name+"_font"},value:e._editor.fontFamily},t,(t=>{e._editor.fontFamily=t.value,i(e)}))}
        </div>`:null}
        ${e._layer.params.editor.style?te` 
        <div class="cl-po--editor-group cl-po--font-style">
            <div @click=${t=>{e._editor.fontWeight="bold"===e._editor.fontWeight?"normal":"bold",i(e)}} class="cl-po--swatch cl-po--swatch-button ${"bold"===e._editor.fontWeight?"selected":""}" data-tippy-content="${l.get("product.options.text.style.bold")}" data-tippy-placement="bottom">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path d="M8 11h4.5a2.5 2.5 0 1 0 0-5H8v5zm10 4.5a4.5 4.5 0 0 1-4.5 4.5H6V4h6.5a4.5 4.5 0 0 1 3.256 7.606A4.498 4.498 0 0 1 18 15.5zM8 13v5h5.5a2.5 2.5 0 1 0 0-5H8z" fill="var(--text-editor-color)"/></svg>
            </div>
            <div @click=${t=>{e._editor.fontStyle="italic"===e._editor.fontStyle?"normal":"italic",i(e)}} class="cl-po--swatch cl-po--swatch-button ${"italic"===e._editor.fontStyle?"selected":""}" data-tippy-content="${l.get("product.options.text.style.italic")}" data-tippy-placement="bottom">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path d="M15 20H7v-2h2.927l2.116-12H9V4h8v2h-2.927l-2.116 12H15z" fill="var(--text-editor-color)"/></svg>
            </div>
        </div>`:null}
        ${e._layer.params.editor.align?te` 
        <div class="cl-po--editor-group cl-po--text-align">
            <div @click=${t=>{e._editor.textAlign="left",i(e)}} class="cl-po--swatch cl-po--swatch-button ${"left"===e._editor.textAlign?"selected":""}" data-tippy-content="${l.get("product.options.text.align.left")}" data-tippy-placement="bottom">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path d="M3 4h18v2H3V4zm0 15h14v2H3v-2zm0-5h18v2H3v-2zm0-5h14v2H3V9z" fill="var(--text-editor-color)"/></svg>
            </div>
            <div @click=${t=>{e._editor.textAlign="center",i(e)}} class="cl-po--swatch cl-po--swatch-button ${"center"===e._editor.textAlign?"selected":""}" data-tippy-content="${l.get("product.options.text.align.center")}" data-tippy-placement="bottom">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path d="M3 4h18v2H3V4zm2 15h14v2H5v-2zm-2-5h18v2H3v-2zm2-5h14v2H5V9z" fill="var(--text-editor-color)"/></svg>
            </div>
            <div @click=${t=>{e._editor.textAlign="right",i(e)}} class="cl-po--swatch cl-po--swatch-button ${"right"===e._editor.textAlign?"selected":""}" data-tippy-content="${l.get("product.options.text.align.right")}" data-tippy-placement="bottom">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path d="M3 4h18v2H3V4zm4 15h14v2H7v-2zm-4-5h18v2H3v-2zm4-5h14v2H7V9z" fill="var(--text-editor-color)"/></svg>
            </div>
        </div>`:null}
        ${e._layer.params.editor.size?te` 
        <div class="cl-po--editor-group cl-po--font-size">
            <div @click=${t=>{e._editor.fontSize=Math.max(e._layer.params.fontSizeMin||1,e._editor.fontSize-(e._layer.params.fontSizeStep||1)),i(e)}} class="cl-po--swatch cl-po--swatch-button">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path d="M5 11h14v2H5z" fill="var(--text-editor-color)"/></svg>
            </div>
            <div class="cl-po--swatch cl-po--swatch-button icon" data-tippy-content="${l.get("product.options.text.fontSize")}" data-tippy-placement="bottom">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path d="M11.246 15H4.754l-2 5H.6L7 4h2l6.4 16h-2.154l-2-5zm-.8-2L8 6.885 5.554 13h4.892zM21 12.535V12h2v8h-2v-.535a4 4 0 1 1 0-6.93zM19 18a2 2 0 1 0 0-4 2 2 0 0 0 0 4z" fill="var(--text-editor-color)"/></svg>
            </div>
            <div @click=${t=>{e._editor.fontSize=Math.min(e._layer.params.fontSizeMax||1e5,e._editor.fontSize+(e._layer.params.fontSizeStep||1)),i(e)}} class="cl-po--swatch cl-po--swatch-button">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path d="M11 11V5h2v6h6v2h-6v6h-2v-6H5v-2z" fill="var(--text-editor-color)"/></svg>
            </div>
        </div>`:null}
         ${e._layer.params.editor.color?te` 
        <div class="cl-po--editor-group cl-po--font-color">
            ${br.templates.color({id:e.id+"_color",name:e.name+"_color",params:{name:e.name+"_color"},value:e._editor.color||"#000000"},t,(t=>{e._editor.color=t.value,i(e)}))}
            ${Wr()?te`
            <div class="cl-po--font-color-input">
            ${br.templates.color_input({id:e.id+"_color",name:e.name+"_color",params:{name:e.name+"_color"},value:e._editor.color||"#000000"},t,(t=>{e._editor.color=t.value,i(e)}))}
              </div>`:null}
        </div>`:null}
        
    </div>
`,br.templates.date=(e,t,i)=>{let r=void 0===e._controller;if(e._controller=e._controller||{setup:()=>{if(e._controller.native=(()=>{let e=document.createElement("input");return e.setAttribute("type","date"),e.setAttribute("value","a"),"a"!==e.value})(),e._controller.native)e._controller.ready=Promise.resolve();else{let i=[t.assets+"/static/lib/dateinput/dateinput.min.js"];e._controller.ready=$r.loadOnce(i,"option-date",{async:!1})}},onValidate:()=>{let t=e._controller.dateEl,i=t.checkValidity(),r=!1,o=!1;if(i&&!e._controller.native){if(t.min){let e=new Date(t.min+"T00:00:00");t.valueAsDate<e&&(i=!1,r=!0)}if(t.max){let e=new Date(t.max+"T00:00:00");t.valueAsDate>e&&(i=!1,o=!0)}}if(!i){if(t.validity.rangeUnderflow||r){let i=t.min,r=new Date(i+"T00:00:00");r.setDate(r.getDate()-1),i=e._controller.format(r,e.params.dateFormat||"yyyy-mm-dd"),e.errors.push(l.get("product.options.validity.dateMin",{min:i}))}else if(t.validity.rangeOverflow||o){let i=t.max,r=new Date(i+"T00:00:00");r.setDate(r.getDate()+1),i=e._controller.format(r,e.params.dateFormat||"yyyy-mm-dd"),e.errors.push(l.get("product.options.validity.dateMax",{max:i}))}else e.errors.push(l.get("product.options.validity.valueMissing"));return!1}return!0},onChange:(e,t)=>{t._controller.mapDateValue(t),i(t)},mapDateValue:e=>{if(e._controller.dateEl.value)if(e.params.dateFormat){let t=e._controller.dateEl.valueAsDate,i=new Date(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds());e._controller.el.value=e._controller.format(i,e.params.dateFormat)}else e._controller.el.value=e._controller.dateEl.value;else e._controller.el.value="";e.value=e._controller.el.value},mapOptionValue:()=>{if(e.value&&e.value!==e._controller.el.value){let t,i=e.params.dateFormat;if(i&&"yyyy-mm-dd"!==i){let r;if(-1!==i.indexOf("/")?r=i.startsWith("yyyy")?/(?<year>\d{4})\/(?<month>\d{2})\/(?<day>\d{2})/:/(?<day>\d{2})\/(?<month>\d{2})\/(?<year>\d{4})/:-1!==i.indexOf(".")&&(r=i.startsWith("dd")?/(?<day>\d{2})\.(?<month>\d{2})\.(?<year>\d{4})/:/(?<month>\d{2})\.(?<day>\d{2})\.(?<year>\d{4})/),r){let i=r.exec(e.value);i&&(t=new Date(i.groups.year,i.groups.month-1,i.groups.day))}}else t=new Date(e.value+"T00:00:00");if(t)return e._controller.dateEl.valueAsDate=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate())),!0}return!1},format:(e,t)=>(-1!==t.indexOf("mmmm")?t=t.replace("mmmm",e.toLocaleString("default",{month:"long"})):-1!==t.indexOf("mmm")&&(t=t.replace("mmm",e.toLocaleString("default",{month:"short"}))),t=(t=(t=(t=t.replace("yyyy",e.getFullYear())).replace("yy",e.getFullYear().toString().substr(-2))).replace("mm",("0"+(e.getMonth()+1)).slice(-2))).replace("dd",("0"+e.getDate()).slice(-2))),init:(e,t)=>{t&&(e._controller.options=t),e._controller.ready.then((()=>{if(e._controller.el=document.querySelector("#"+e.id),e._controller.dateEl=document.querySelector("#"+e.id+"-date"),!e._controller.native){if(window.navigator&&window.navigator.language){let t=navigator.language,i=t.substr(0,2);e._controller.dateEl.setAttribute("lang",t),"en"!==i&&e._controller.dateEl.setAttribute("data-first-day","mo")}e.params.dateFormat&&e._controller.dateEl.setAttribute("data-date-format",e.params.dateFormat)}e._controller.mapOptionValue(),e._controller.initMinMax(e)}))},initMinMax:e=>{const r=!isNaN(e.params.maxDays)&&null!=e.params.maxDays,o=!isNaN(e.params.minDays)&&null!=e.params.minDays;if(o||r){const n=t=>{r&&(t=>{if(t.setDate(t.getDate()+e.params.maxDays),e.params.maxDate){let i=new Date(e.params.maxDate+"T00:00:00");t>i&&(t=i)}e._controller.dateEl.max=e._controller.format(t,"yyyy-mm-dd"),e._controller.dateEl.valueAsDate&&e._controller.dateEl.valueAsDate>t&&(e._controller.dateEl.valueAsDate=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate())),e._controller.mapDateValue(e))})(new Date(t.getTime())),o&&(t=>{if(t.setDate(t.getDate()+e.params.minDays),e.params.minDate){let i=new Date(e.params.minDate+"T00:00:00");t<i&&(t=i)}e._controller.dateEl.min=e._controller.format(t,"yyyy-mm-dd"),(!e.value||e._controller.dateEl.valueAsDate&&e._controller.dateEl.valueAsDate<t)&&(e._controller.dateEl.valueAsDate=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate())),e._controller.mapDateValue(e))})(new Date(t.getTime()))};let a=new Date;if(e.params.optionDate){if(e._controller.options)for(let t=0;t<e._controller.options.length;t++){const i=e._controller.options[t];if(i.name===e.params.optionDate&&i._controller&&i._controller.dateEl){a=i._controller.dateEl.valueAsDate;break}}e._controller.optionChanged&&t.productForm.removeEventListener("option:changed",e._controller.optionChanged),e._controller.optionChanged=t=>{let r=t.detail;r.name===e.params.optionDate&&r._controller&&r._controller.dateEl&&(n(r._controller.dateEl.valueAsDate),i(e))},t.productForm.addEventListener("option:changed",e._controller.optionChanged)}n(a)}else if(e._controller.dateEl.min){let t=new Date(e._controller.dateEl.min+"T00:00:00");(!e.value||e._controller.dateEl.valueAsDate&&e._controller.dateEl.valueAsDate<t)&&(e._controller.dateEl.valueAsDate=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate())),e._controller.mapDateValue(e))}}},t.productForm)if(r){e._controller.setup();const i=r=>{let o=r.detail;t.productForm.removeEventListener("options:rendered",i),e._controller.init(e,o.config.options)};t.productForm.addEventListener("options:rendered",i)}else t.editorMode?e._controller.init(e):e._controller.mapOptionValue()&&e._controller.initMinMax(e);return te`
         <input type="hidden" name="${eo(e)}" id="${e.id}" .value=${Fi(e.value)} form=${Ai(t.productFormLink)}  />
         <input type="date" class="cl-po--input ${Mi(Gr(e))}" id="${e.id}-date" @change=${t=>e._controller.onChange(t,e)}
            ?required=${e.required} min=${Ai(null!=e.params.minDate?e.params.minDate:void 0)} max=${Ai(null!=e.params.maxDate?e.params.maxDate:void 0)}>
    `},br.templates.number=(e,t,i)=>e.params.numberSteps?te`
            <div class="cl-po--quantity-wrap cl-po--number-steps">
                <span class="cl-po--quantity-btn" @click=${t=>{e.value=Math.max((parseFloat(e.value)||0)-(e.params.numberStep||1),e.params.min||0),i(e)}}>-</span>
                <input type="number" class="cl-po--input cl-po--quantity ${Mi(Gr(e))}" id="${e.id}" name="${eo(e)}" .value=${Fi(e.value)} @input=${Kr(e,(t=>oo(t,e,i)))}
                       ?required=${e.required} step="any" min=${Ai(e.params.min)} max=${Ai(e.params.max)} placeholder=${Ai(e.params.placeholder)} autocomplete="${to(e)}" form=${Ai(t.productFormLink)}>
                <span class="cl-po--quantity-btn" @click=${t=>{e.value=Math.min((parseFloat(e.value)||0)+(e.params.numberStep||1),e.params.max||Number.MAX_SAFE_INTEGER),i(e)}}>+</span>
            </div>
        `:te`
            <input type="number" class="cl-po--input ${Mi(Gr(e))}" id="${e.id}" name="${eo(e)}" .value=${Fi(e.value)} @input=${Kr(e,(t=>oo(t,e,i)))}
                   ?required=${e.required} step="any" min=${Ai(e.params.min)} max=${Ai(e.params.max)} placeholder=${Ai(e.params.placeholder)} autocomplete="${to(e)}" form=${Ai(t.productFormLink)}>
        `,br.templates.dimension=(e,t,i)=>{let r=void 0===e._controller;if(e._controller=e._controller||{x:0,y:0,area:0,xInput:"",yInput:"",xEl:null,yEl:null,onValidate:e=>!e.required||e.value&&e._controller.x>0&&(e.params.onlyX||e._controller.y>0)?(e._controller.validateDimension(e,e.errors,!e._controller.xInput,!e._controller.yInput),!e.errors.length):(e.errors.push(l.get("product.options.validity.valueMissing")),!1),validateDimension:(e,t,i=!1,r=!1)=>{let o=e._controller.x,n=e._controller.y;if(e.params.bigX&&o<n){let e=o;o=n,n=e}const a=e=>e&&"#"===e[0]?e.substring(1):e;!i&&e.params.minX&&o<e.params.minX&&t.push(l.get(a(e.params.minXKey)||"{label} must be at least {min} {addon}",{label:e.params.labelX,min:e.params.minX,addon:e.params.addonX})),!r&&e.params.minY&&n<e.params.minY&&t.push(l.get(a(e.params.minYKey)||"{label} must be at least {min} {addon}",{label:e.params.labelY,min:e.params.minY,addon:e.params.addonY})),e.params.maxX&&o>e.params.maxX&&t.push(l.get(a(e.params.maxXKey)||"{label} must be at most {max} {addon}",{label:e.params.labelX,max:e.params.maxX,addon:e.params.addonX})),e.params.maxY&&n>e.params.maxY&&t.push(l.get(a(e.params.maxYKey)||"{label} must be at most {max} {addon}",{label:e.params.labelY,max:e.params.maxY,addon:e.params.addonY}))},optionValue:e=>(e.params.valueTemplate||"{x}x{y}").replace(new RegExp("{x}","g"),e._controller.x).replace(new RegExp("{y}","g"),e._controller.y).replace(new RegExp("{area}","g"),e._controller.area.toFixed(2)),onChange:(e,r,o=!1)=>{let n=r._controller;o||(n.xEl=n.xEl||document.querySelector("#"+r.id+"-x"),n.yEl=n.yEl||document.querySelector("#"+r.id+"-y"),null!=r.params.ratio&&(n.xEl.value!==n.xInput?n.yEl.value=parseFloat(n.xEl.value/r.params.ratio).toFixed(2):n.xEl.value=parseFloat(n.yEl.value*r.params.ratio).toFixed(2)),n.xInput=n.xEl.value,n.yInput=n.yEl.value);const s=e=>e?e.replaceAll(",","."):"0";if(n.x=parseFloat(s(n.xInput))||0,n.y=parseFloat(s(n.yInput))||0,r.params.steps){let e=r.params.steps;n.x%e!=0&&(n.x=Math.round(n.x/e)*e),n.y%e!=0&&(n.y=Math.round(n.y/e)*e),(isNaN(r.params.rounding)||null===r.params.rounding)&&(r.params.rounding=0)}if(!isNaN(r.params.rounding)&&null!==r.params.rounding){let t=null==e;if(0!==n.x){let e=n.x.toFixed(r.params.rounding);n.x=parseFloat(e),t?n.xInput=e:(n.xInputBlur=()=>{n.xInput=e,n.xEl.value=n.xInput,delete n.xInputBlur},n.xEl.addEventListener("blur",(e=>{n.xInputBlur&&n.xInputBlur()}),{once:!0}))}if(0!==n.y){let e=n.y.toFixed(r.params.rounding);n.y=parseFloat(e),t?n.yInput=e:(n.yInputBlur=()=>{n.yInput=e,n.yEl.value=n.yInput,delete n.yInputBlur},n.yEl.addEventListener("blur",(e=>{n.yInputBlur&&n.yInputBlur()}),{once:!0}))}n.blurInterval||!n.xInputBlur&&!n.yInputBlur||(n.blurInterval=setInterval((()=>{n.xInputBlur&&document.activeElement!==n.xEl&&n.xInputBlur(),n.yInputBlur&&document.activeElement!==n.yEl&&n.yInputBlur(),n.xInputBlur||n.yInputBlur||(clearInterval(n.blurInterval),delete n.blurInterval)}),500))}if(r.params.areaCalc)try{if(!r._areaFunction)try{r._areaFunction=Function('"use strict";return (function(x,y){ return ('+r.params.areaCalc+") })")()}catch(e){a.error("failed to parse areaCalc: ",r.params.areaCalc,e),t.editorMode&&(r.errors=r.errors||[],r.errors.push(e))}r._areaFunction&&(n.area=r._areaFunction(n.x,n.y),n.area||(n.area=0))}catch(e){a.error("failed to calculate area with areaCalc: ",r.params.areaCalc,e),t.editorMode&&(r.errors=r.errors||[],r.errors.push(e))}else n.area=n.x*n.y;let l=[];n.validateDimension(r,l,!n.xInput,!n.yInput),l.length&&(r.errors=l,r._error=!0),r.value=n.optionValue(r),r.values||(r.values=[]);let c="";if(r.list&&r.values.length&&(c="var lookup=function(x,y,t){return option._controller.lookup(option,x,y,t)};",r.params.priceFormula||(r.values[0].values?r.params.priceFormula="lookup(x, y)":r.params.priceFormula="lookup(area) * area")),r.params.priceFormula)if(r.values.length&&r.values[0]._calc)r.values[0].value=r.value;else{let e="var x=option._controller.x;var y=option._controller.y;var area=option._controller.area;"+c;-1===r.params.priceFormula.indexOf("return")?e+="return ("+r.params.priceFormula+")":e+=r.params.priceFormula;let t={value:r.value,text:"",priceType:gr.FORMULA,priceFormula:e,_calc:!0};r.values.unshift(t)}else r.values.unshift({value:r.value,text:""});i(r)},lookup:(e,t,i,r)=>{"string"==typeof i&&(r=i,i=null);for(let o=e.values.length-1;o>=1;o--){let n=e.values[o],s=parseFloat(n.value);if(t>=s){if(r&&n.text!==r)continue;if(!i||!n.values?.length)return a.info("[live-options] price list lookup:",t,"match:",s,"price:",n.price),n.price;for(let e=n.values.length-1;e>=0;e--){let r=n.values[e],o=parseFloat(r.value);if(i>=o)return a.info("[live-options] price list lookup:",t,i,"match:",s,o,"price: ",r.price),r.price}}}return a.warn("[live-options] price list lookup:",t,"no match"),0},restore:e=>{if(e.value&&e.value!==e._controller.optionValue(e)){let t=(e.params.valueTemplate||"{x}x{y}").replace(".","\\.").replace("*","\\*").replace(new RegExp("{x}","g"),"(?<x>.*)").replace(new RegExp("{y}","g"),"(?<y>.*)").replace(new RegExp("{area}","g"),"(?<area>.*)"),i=new RegExp(t,"g").exec(e.value);if(i&&i.groups)return void 0!==i.groups.x&&(e._controller.xInput=i.groups.x),void 0!==i.groups.y&&(e._controller.yInput=i.groups.y),e._controller.onChange(null,e,!0),!0}return!1},init:(e,t)=>{isNaN(e.params.valueX)||null===e.params.valueX||(e._controller.xInput=String(e.params.valueX)),isNaN(e.params.valueY)||null===e.params.valueY||(e._controller.yInput=String(e.params.valueY)),e.value&&e._controller.restore(e)||(e._controller.xInput||e._controller.yInput)&&e._controller.onChange(null,e,!0)},stepDec(e,t){let i=e._controller[t],r=e.params.numberStep||1,o=isNaN(e.params.rounding)||null===e.params.rounding?null:e.params.rounding,n=Math.round(i/r);const a=Math.pow(10,-10);Math.abs(i-n*r)<a?i-=r:i=Math.floor(i/r)*r,i=Math.max(i,e.params["min"+t.toUpperCase()]||0);let s=e._controller[t+"El"];s||(s=document.querySelector("#"+e.id+"-"+t)),s.value=null!==o?i.toFixed(o):i.toString(),e._controller.onChange(null,e)},stepInc(e,t){let i=e._controller[t],r=e.params.numberStep||1,o=isNaN(e.params.rounding)||null===e.params.rounding?null:e.params.rounding,n=Math.round(i/r);const a=Math.pow(10,-10);Math.abs(i-n*r)<a?i+=r:i=Math.ceil(i/r)*r,i=Math.min(i,e.params["max"+t.toUpperCase()]||Number.MAX_SAFE_INTEGER);let s=e._controller[t+"El"];s||(s=document.querySelector("#"+e.id+"-"+t)),s.value=null!==o?i.toFixed(o):i.toString(),e._controller.onChange(null,e)}},r){const i=()=>{t.productForm.removeEventListener("options:rendered",i),e._controller.init(e)};t.productForm.addEventListener("options:rendered",i)}else e.value&&!e._controller.xEl&&e._controller.restore(e);const o=te`<input type="text" class="cl-po--input ${Mi(Gr(e))}" id="${e.id}-x" name="properties[_${e.name}_x]" 
                .value=${Fi(e._controller.xInput)} @input=${Kr(e,(t=>e._controller.onChange(t,e)))} 
                ?required=${e.required} form=${Ai(t.productFormLink)}>`,n=te`<input type="text" class="cl-po--input ${Mi(Gr(e))}" id="${e.id}-y" name="properties[_${e.name}_y]" 
                .value=${Fi(e._controller.yInput)} @input=${Kr(e,(t=>e._controller.onChange(t,e)))}
                ?required=${e.required&&!e.params.onlyX} form=${Ai(t.productFormLink)}>`;return te`
            <input type="hidden" name="${eo(e)}" id="${e.id}" value=${e.value} form=${Ai(t.productFormLink)} />
            <div class="cl-po--dimension-container">
                 <div class="cl-po--dimension-item ${Mi({full:e.params.onlyX})}">
                     ${e.params.labelX?te`<label class="cl-po--label" for="${e.id}-x">${e.params.labelX}</label>`:null}
                     <div class="cl-po--input-group ${Mi({"cl-po--dimension-steps":e.params.numberSteps,"cl-po--addon":e.params.addonX})}">
                         ${e.params.numberSteps?te`<div class="cl-po--quantity-wrap">
                                <span class="cl-po--quantity-btn" @click=${t=>{e._controller.stepDec(e,"x")}}>-</span>
                                ${o}
                                <span class="cl-po--quantity-btn" @click=${t=>{e._controller.stepInc(e,"x")}}>+</span>
                            </div>`:o}
                         ${e.params.addonX?te`<span class="cl-po--input cl-po--input-addon">${e.params.addonX}</span>`:null}
                     </div>
                 </div>
                <div class="cl-po--dimension-item ${Mi({"cl-hide":e.params.onlyX})}">
                    ${e.params.labelY?te`<label class="cl-po--label" for="${e.id}-y">${e.params.labelY}</label>`:null}
                    <div class="cl-po--input-group ${Mi({"cl-po--dimension-steps":e.params.numberSteps,"cl-po--addon":e.params.addonY})}">
                        ${e.params.numberSteps?te`<div class="cl-po--quantity-wrap">
                                <span class="cl-po--quantity-btn" @click=${t=>{e._controller.stepDec(e,"y")}}>-</span>
                                ${n}
                                <span class="cl-po--quantity-btn" @click=${t=>{e._controller.stepInc(e,"y")}}>+</span>
                            </div>`:n}
                        ${e.params.addonY?te`<span class="cl-po--input cl-po--input-addon">${e.params.addonY}</span>`:null}
                    </div>
                </div>
           </div>
        `},br.templates.color=(e,t,i)=>te`
    ${Wr()?te`
     <input type="color" class="cl-po--input ${Mi(Gr(e))}" id="${e.id}" name="${eo(e)}" .value=${Fi(e.value)} @change=${t=>oo(t,e,i)}
     ?required=${e.required} minlength=${Ai(e.params.min)} maxlength=${Ai(e.params.max)} placeholder=${Ai(e.params.placeholder)} form=${Ai(t.productFormLink)}>
        `:br.templates.color_input(e,t,i)}
`,br.templates.color_input=(e,t,i)=>te`
      <input type="text" class="cl-po--input ${Mi(Gr(e))}" id="${e.id}" name="${eo(e)}" .value=${Fi(e.value)} @change=${t=>oo(t,e,i)} 
      ?required=${e.required} pattern="#[0-9A-Fa-f]{6}" placeholder=${Ai(e.params.placeholder)} autocomplete="${to(e,"color")}" form=${Ai(t.productFormLink)}>
`,br.templates["color-swatch"]=(e,t,i)=>e.params.multiSelect?(e._controller=e._controller||ao(0,0,i),te`
            <div class="cl-po--swatch-container">
                <input type="hidden" name="${eo(e)}" id="${e.id}" value=${e.value} form=${Ai(t.productFormLink)} />
                ${Si(e.values||[],(e=>e.value),((i,r)=>te`
                    <label class="cl-po--swatch-item ${Mi(Yr(e,i,{grow:e.params.grow}))}">
                        <input type="checkbox" class="cl-po--input ${Mi(Gr(e))}" id="${e.id}-${r}"  .value=${i.value} @change=${t=>e._controller.onChange(t,e)}
                               .checked=${Fi(e._controller.isSelected(e,i))} ?disabled=${i.disabled} form=${Ai(t.productFormLink)}>
                        <div class="cl-po--swatch cl-po--swatch-color ${Mi(Xr(e,"small"))}" style=${Li({backgroundColor:i.color})} data-tippy-content="${zr(e,i,ur.moneyFormat)}" data-tippy-placement="bottom">
                        </div>
                        <span class="visually-hidden">${zr(e,i,ur.moneyFormat)}</span>
                    </label>
                    ${e.params.items&&(r+1)%e.params.items==0?te`<div class="cl-po--break" data-index=${r}></div>`:null}
                `))}
            </div>
        `):te`
            <div class="cl-po--swatch-container">
            ${Si(e.values||[],(e=>e.value),((r,o)=>te`
                <label class="cl-po--swatch-item ${Mi(Yr(e,r,{grow:e.params.grow}))}">
                    <input type="radio" class="cl-po--input ${Mi(Gr(e))}" id="${e.id}-${o}" name="${eo(e)}" .value=${r.value} @change=${t=>oo(t,e,i)}
                           .checked=${Fi(e.value==r.value)} ?required=${e.required} ?disabled=${r.disabled} form=${Ai(t.productFormLink)}>
                    <div class="cl-po--swatch cl-po--swatch-color ${Mi(Xr(e,"small"))}" style=${Li({backgroundColor:r.color})} data-tippy-content="${zr(e,r,ur.moneyFormat)}" data-tippy-placement="bottom"
                         @click=${t=>Qr(t,e,r,i)}>
                    </div>
                    <span class="visually-hidden">${zr(e,r,ur.moneyFormat)}</span>
                </label>
                ${e.params.items&&(o+1)%e.params.items==0?te`<div class="cl-po--break" data-index=${o}></div>`:null}
            `))}
            </div>
        `,br.templates["color-img-swatch"]=(e,t,i)=>br.templates["img-swatch"](e,t,i),br.templates["img-swatch"]=(e,t,i)=>e.params.multiSelect?(e._controller=e._controller||ao(0,0,i),te`
            <div class="cl-po--swatch-container">
                <input type="hidden" name="${eo(e)}" id="${e.id}" value=${e.value} form=${Ai(t.productFormLink)} />
                ${Si(e.values||[],(e=>e.value),((i,r)=>te`
                    <label class="cl-po--swatch-item ${Mi(Yr(e,i,{grow:e.params.grow}))}">
                        <input type="checkbox" class="cl-po--input ${Mi(Gr(e))}" id="${e.id}-${r}"  .value=${i.value} @change=${t=>e._controller.onChange(t,e)}
                               .checked=${Fi(e._controller.isSelected(e,i))} ?disabled=${i.disabled} form=${Ai(t.productFormLink)}>
                        <div class="cl-po--swatch cl-po--swatch-img ${Mi(Xr(e,"large"))}" data-tippy-content="${Ai(Hr(e,i,ur.moneyFormat))}" data-tippy-placement="bottom">
                            ${i.img?te`<img src="${_r(i.img,yr(e.params.size||"large"))}" alt="${zr(e,i,ur.moneyFormat)}" />`:null}
                        </div>
                        ${e.params.imgText?te`<span class="cl-po--swatch-text">${vi(zr(e,i,ur.moneyFormat))}</span>`:null}
                        <span class="visually-hidden">${zr(e,i,ur.moneyFormat)}</span>
                    </label>
                    ${e.params.items&&(r+1)%e.params.items==0?te`<div class="cl-po--break" data-index=${r}></div>`:null}
                `))}
            </div>
        `):te`
            <div class="cl-po--swatch-container">
                ${Si(e.values||[],(e=>e.value),((r,o)=>te`
                    <label class="cl-po--swatch-item ${Mi(Yr(e,r,{grow:e.params.grow}))}">
                        <input type="radio" class="cl-po--input ${Mi(Gr(e))}" id="${e.id}-${o}" name="${eo(e)}" .value=${r.value} @change=${t=>oo(t,e,i)}
                               .checked=${Fi(e.value==r.value)} ?required=${e.required} ?disabled=${r.disabled} form=${Ai(t.productFormLink)}>
                        <div class="cl-po--swatch cl-po--swatch-img  ${Mi(Xr(e,"large"))}" data-tippy-content="${Ai(Hr(e,r,ur.moneyFormat))}" data-tippy-placement="bottom"
                             @click=${t=>Qr(t,e,r,i)}>
                            ${r.img?te`<img src="${_r(r.img,yr(e.params.size||"large"))}" alt="${zr(e,r,ur.moneyFormat)}"/>`:null}
                        </div>
                        ${e.params.imgText?te`<span class="cl-po--swatch-text">${vi(zr(e,r,ur.moneyFormat))}</span>`:null}
                        <span class="visually-hidden">${zr(e,r,ur.moneyFormat)}</span>
                    </label>
                    ${e.params.items&&(o+1)%e.params.items==0?te`<div class="cl-po--break" data-index=${o}></div>`:null}
                `))}
            </div>
        `,br.templates["button-swatch"]=(e,t,i)=>e.params.multiSelect?(e._controller=e._controller||ao(0,0,i),te`
            <div class="cl-po--swatch-container">
                <input type="hidden" name="${eo(e)}" id="${e.id}" value=${e.value} form=${Ai(t.productFormLink)} />
                ${Si(e.values||[],(e=>e.value),((i,r)=>te`
                    <label class="cl-po--swatch-item ${Mi(Yr(e,i,{grow:e.params.grow}))}">
                        <input type="checkbox" class="cl-po--input ${Mi(Gr(e))}" id="${e.id}-${r}" .value=${i.value} @change=${t=>e._controller.onChange(t,e)}
                               .checked=${Fi(e._controller.isSelected(e,i))} ?disabled=${i.disabled} form=${Ai(t.productFormLink)}>
                        <div class="cl-po--swatch cl-po--swatch-button ${Mi(Xr(e,"small"))}" style=${Li(Zr(e))} data-tippy-content="${Ai(e.params.valuePriceTooltip?qr(e,i,ur.moneyFormat):void 0)}" data-tippy-placement="bottom">
                            ${vi(zr(e,i,ur.moneyFormat))}
                        </div>
                    </label>
                    ${e.params.items&&(r+1)%e.params.items==0?te`<div class="cl-po--break" data-index=${r}></div>`:null}
                `))}
            </div>
        `):te`
            <div class="cl-po--swatch-container">
                ${Si(e.values||[],(e=>e.value),((r,o)=>te`
                    <label class="cl-po--swatch-item ${Mi(Yr(e,r,{grow:e.params.grow}))}" >
                        <input type="radio" class="cl-po--input ${Mi(Gr(e))}" id="${e.id}-${o}" name="${eo(e)}" .value=${r.value} @change=${t=>oo(t,e,i)}
                               .checked=${Fi(e.value==r.value)} ?required=${e.required} ?disabled=${r.disabled} form=${Ai(t.productFormLink)} >
                        <div class="cl-po--swatch cl-po--swatch-button ${Mi(Xr(e,"small"))}" style=${Li(Zr(e))} data-tippy-content="${Ai(e.params.valuePriceTooltip?qr(e,r,ur.moneyFormat):void 0)}" data-tippy-placement="bottom"
                             @click=${t=>Qr(t,e,r,i)}>
                            ${vi(zr(e,r,ur.moneyFormat))}
                        </div>
                    </label>
                    ${e.params.items&&(o+1)%e.params.items==0?te`<div class="cl-po--break" data-index=${o}></div>`:null}
                `))}
            </div>
          
        `;const lo=(e,t,i)=>{const r={quantity:1,quantityEl:null,quantityElOption:!1,quantityId:"",quantityDiscount:"",quantityMin:null,discount:0,discountType:gr.ABSOLUTE,onValidate:e=>{if(e.params.quantityId){let i=e.params.quantityId;-1!==i.indexOf("{random}")&&(i=i.replace("{random}",String(Math.floor(1e3*Math.random()+1)))),-1!==i.indexOf("{product}")&&(i=i.replace("{product}",String(t.product.id))),-1!==i.indexOf("{variant}")&&(i=i.replace("{variant}",String(t.productForm.id.value))),r.quantityId=i}return!0},onChange:(e,t)=>{r.quantity=parseInt(t.value),r.syncEl(),r.selectDiscount(t),i(t)},selectDiscount:e=>{if(e.values)for(let t=0;t<e.values.length;t++){const i=e.values[t];if(i.value===e.value&&i._discount)return r.discount=i._discount,void(r.discountType=i.priceType)}r.discount=0},syncEl:()=>{r.quantityEl.value=r.quantity},syncValue:e=>{if(r.quantity=parseInt(r.quantityEl.value)||1,e.value="",r.discount=0,e.values)for(let t=0;t<e.values.length;t++){const i=e.values[t];let o=parseInt(i.value);r.quantity>=o&&(i._discount?i._discount>r.discount&&(e.value=i.value):e.value=i.value)}r.selectDiscount(e)},quantityDiscountText(e,t,i,o,n,a=""){const s=r.calcQuantityDiscountVars(e,t,i,o,n);let l=e.params.discountTemplate||"{price} {compare} {discount}";return i||(l=l.replace(new RegExp("{compareP}|{compare}|{discountP}|{discount}","g"),"").trim()),`<span class="_quantity">${e.params.textDiscountBuy||"Buy:"} ${t}${a}</span>${l}`.replace(new RegExp("{compareP}","g"),`<span class="_compare">${cr(100*s.price,ur.moneyFormat)}</span>`).replace(new RegExp("{compare}","g"),`<span class="_compare">${cr(100*s.total,ur.moneyFormat)}</span>`).replace(new RegExp("{priceP}","g"),`<span class="_price">${cr(100*s.productFinal,ur.moneyFormat)}</span>`).replace(new RegExp("{price}","g"),`<span class="_price">${cr(100*s.totalFinal,ur.moneyFormat)}</span>`).replace(new RegExp("{discountP}","g"),`<span class="_save">${s.productSave}</span>`).replace(new RegExp("{discount}","g"),`<span class="_save">${s.totalSave}</span>`)},optionValueDiscountText(e,t,i){let o=parseInt(t.value),n="+",a=e.values.indexOf(t);if(e.values.length>a+1){parseInt(e.values[a+1].value)===o+1&&(n="")}return r.quantityDiscountText(e,o,t._discount,t.priceType,i,n)},calcQuantityDiscountVars(e,t,i,r,o){let n,a,s,l,c=o.price.final-o.price.variantTotal,p=t*c;if(i)if(r===gr.PERCENTAGE)n=c-c*(i/100),s=n*t,a=`${e.params.textDiscountSave||"Save:"} ${i}%`,l=a;else{ur.currencyConvert&&(i=hr(i));let e=Math.min(i,c);n=c-e,a="-"+cr(100*e,ur.moneyFormat);let r=e*t;s=p-r,l="-"+cr(100*r,ur.moneyFormat)}else n=c,a="",s=p,l="";return{price:c,total:p,productFinal:n,productSave:a,totalFinal:s,totalSave:l}},updatePriceElements(e,t){if(r._priceElList&&r._priceElList.length)for(let e=0;e<r._priceElList.length;e++)if(!o.isInPage(r._priceElList[e])){delete this._priceElList;break}if(r._priceElList&&0!==r._priceElList.length||(r._priceElList=document.querySelectorAll('[data-live-price-quantity="'+t.product?.id+'"], [data-live-price-quantity-single="'+t.product?.id+'"]')),r._priceElList.length){const i=r.calcQuantityDiscountVars(e,r.quantity,r.discount,r.discountType,t);r._priceElList.forEach((e=>{const t=void 0!==e.dataset.livePriceQuantitySingle?"productFinal":"totalFinal";let r=cr(100*i[t],ur.moneyFormat);e.dataset.liveFormat&&(e.dataset.liveFormat=r),e.innerHTML=r}))}r.quantityEl&&r.quantityEl.value!==String(r.quantity)&&r.syncEl(e)},init:e=>{let o=[];if(e.values)for(let t=0;t<e.values.length;t++){const i=e.values[t];let n=parseInt(i.value);(i.price||i._price)&&(i._discount=i._price||i.price,i.price=0,i._price=0,isNaN(n)||o.push(n+":"+i._discount+(i.priceType===gr.PERCENTAGE?"%":""))),dr.checkoutQuantityValidate&&!isNaN(n)&&(r.quantityMin=null===r.quantityMin?n:Math.min(r.quantityMin,n))}if(r.quantityId=t.uuid,r.quantityDiscount=o.join(","),!r.quantityEl){const o="[name=quantity]";if(r.quantityEl=t.productForm.querySelector(o)||document.querySelector(o),r.quantityEl&&"hidden"===r.quantityEl.type&&(r.quantityEl.parentNode.removeChild(r.quantityEl),r.quantityEl=null),r.quantityEl)r.syncValue(e),r.quantityEl.addEventListener("change",(()=>{e.visible&&(r.syncValue(e),i(e))}));else if(!r.quantityElOption){r.quantityElOption=!0;const i=o=>{t.productForm.removeEventListener("options:rendered",i),r.quantityEl=document.querySelector("#"+e.id+"-quantity"),r.quantityEl.value="1",r.syncValue(e)};t.productForm.addEventListener("options:rendered",i)}}e.params.selectedQuantity&&!t.editorMode&&setTimeout((()=>{r.quantity=parseInt(e.params.selectedQuantity),r.syncEl(e),r.syncValue(e),i(e)}))}};return r.init(e),r};br.templates["quantity-discount"]=(e,t,i)=>fr.QUANTITY?(e._controller=e._controller||lo(e,t,i),t.editorMode&&e._controller.init(e),e._controller.updatePriceElements(e,t),te`
            ${Si(e.values||[],((i,r)=>te`
                <label class="cl-po--radio-item" >
                    <input type="radio" class="cl-po--input ${Mi(Gr(e))}" id="${e.id}-${r}" .value=${i.value} @change=${t=>oo(t,e,(e=>e._controller.onChange(t,e)))}
                           .checked=${Fi(e.value==i.value)} ?required=${e.required} name="_${e.name}" form=${Ai(t.productFormLink)}>
                    <div class="cl-po--discount-text">${vi(e._controller.optionValueDiscountText(e,i,t))}</div>
                </label>
            `))}

            ${!1!==e.params.discountLine&&e._controller.discount&&e._controller.quantity!==parseInt(e.value)?te`
                <label class="cl-po--radio-item cl-po--discount-text-custom">
                    <input type="radio" class="cl-po--input ${Mi(Gr(e))}" style="opacity:0">
                    <div class="cl-po--discount-text">${vi(e._controller.quantityDiscountText(e,e._controller.quantity,e._controller.discount,e._controller.discountType,t))}</div>
                </label>
            `:null}
           
            ${e._controller.quantityElOption?te`
                <div class="cl-po--quantity-wrap cl-po--quantity-discount-el">
                    <span class="cl-po--quantity-btn" @click=${t=>{e._controller.quantity--,e._controller.syncEl(e),e._controller.syncValue(e),i(e)}}>-</span>
                    <input class="cl-po--input cl-po--quantity" id="${e.id}-quantity" name="quantity" form=${Ai(t.productFormLink)} @change=${t=>{e._controller.syncValue(e),i(e)}}>
                    <span class="cl-po--quantity-btn" @click=${t=>{e._controller.quantity++,e._controller.syncEl(e),e._controller.syncValue(e),i(e)}}>+</span>
                </div>
            `:null}
            
            <input type="hidden" name="properties[${pr.QUANTITY_ID}]" value=${e._controller.quantityId} form=${Ai(t.productFormLink)}>
            <input type="hidden" name="properties[${pr.QUANTITY_DISCOUNT}]" value=${e._controller.quantityDiscount} form=${Ai(t.productFormLink)}>

            ${null!==e._controller.quantityMin?te`
                <input type="hidden" name="properties[${pr.QUANTITY_MIN}]" value=${e._controller.quantityMin} form=${Ai(t.productFormLink)}>
            `:null}
        `):te``;br.templates.personalize=(e,t,i)=>e.params.btnCheckbox?te`
            ${Si(e.values||[],((i,r)=>0===r?te`
                        <label class="cl-po--checkbox-item ${Mi(Yr(e,i))}">
                            <input type="checkbox" class="cl-po--input ${Mi(Gr(e))}" id="${e.id}-${r}" name="${eo(e)}" .value=${i.value} @change=${t=>((e,t,i)=>(t.value=t.value===t.values[0].value?t.values[1].value:t.values[0].value,i(t)))(0,e,(e=>e._controller.onChange(t,e,!0)))}
                                   .checked=${e.value==i.value} ?required=${e.required} form=${Ai(t.productFormLink)}>
                            ${vi(zr(e,i,ur.moneyFormat))}
                        </label>`:te`<input type="checkbox" style="display:none;" name="${eo(e)}" id="${e.id}" value=${i.value} .checked=${e.value==i.value}  form=${Ai(t.productFormLink)} />`))}
        `:te`
            <div class="cl-po--swatch-container">
                ${Si(e.values||[],((r,o)=>te`

                    <label class="cl-po--swatch-item ${Mi({grow:e.params.grow,personalize:e.value==r.value?"none":null})}" >
                        <input type="radio" class="cl-po--input ${Mi(Gr(e))}" id="${e.id}-${o}" name="${eo(e)}" .value=${r.value} @change=${t=>oo(t,e,(e=>e._controller.onChange(t,e)))} 
                               .checked=${e.value==r.value} ?required=${e.required} form=${Ai(t.productFormLink)}>
                        <div class="cl-po--swatch cl-po--swatch-button ${Mi(Xr(e,"small"))}" style=${Li(Zr(e,Jr(e)))} data-tippy-content="${Ai(e.params.valuePriceTooltip?qr(e,r,ur.moneyFormat):void 0)}" data-tippy-placement="bottom"
                             @click=${t=>Qr(t,e,r,i)}>
                            ${vi(zr(e,r,ur.moneyFormat))}
                        </div>
                    </label>
                    ${e.params.items&&(o+1)%e.params.items==0?te`<div class="cl-po--break" data-index=${o}></div>`:null}
                `))}
            </div>
        `,br.templates.download=(e,t,i)=>te`
            <div class="cl-po--swatch-container">
                 <label class="cl-po--swatch-item ${Mi({grow:e.params.grow})}" >
                        <div class="cl-po--swatch cl-po--swatch-button ${Mi(Xr(e,"small"))}" style=${Li(Zr(e,Jr(e)))}
                             @click=${i=>t.productForm.dispatchEvent(new CustomEvent("option:export",{detail:e,cancelable:!0,bubbles:!0}))}>
                             ${e.params.btnText||"Download"}
                        </div>
                 </label>
            </div>
        `,br.templates.radio=(e,t,i)=>te`
    ${Si(e.values||[],(e=>e.value),((r,o)=>te`
        <label class="cl-po--radio-item ${Mi(Yr(e,r))}" >
            <input type="radio" class="cl-po--input ${Mi(Gr(e))}" id="${e.id}-${o}" name="${eo(e)}" .value=${r.value} @change=${t=>oo(t,e,i)}
                   .checked=${Fi(e.value==r.value)} ?required=${e.required} ?disabled=${r.disabled} form=${Ai(t.productFormLink)}>
            ${vi(zr(e,r,ur.moneyFormat))}
        </label>
    `))}
`,br.templates.checkbox=(e,t,i)=>(e._controller=e._controller||ao(0,0,i),te`
        <input type="hidden" name="${eo(e)}" id="${e.id}" value=${e.value} form=${Ai(t.productFormLink)} />
        ${Si(e.values||[],(e=>e.value),((r,o)=>te`
        <label class="cl-po--checkbox-item ${Mi(Yr(e,r))}">
            <input type="checkbox" class="cl-po--input ${Mi(Gr(e))}" id="${e.id}-${o}" .value=${r.value} @change=${t=>e._controller.onChange(t,e)}
                   .checked=${Fi(e._controller.isSelected(e,r))} ?disabled=${r.disabled} form=${Ai(t.productFormLink)}>
            ${vi(zr(e,r,ur.moneyFormat))}
            ${((e,t,i)=>t.quantityInput&&t.priceVariant?te`
            <div class="cl-po--quantity-input">
                <input type="number" class="cl-po--input" min="1" step="1" max="999" .value=${t.priceVariant.quantity} @input=${Kr(e,(r=>{t.priceVariant.quantity=parseInt(r.target.value),i(e)}))}>
            </div>
        `:null)(e,r,i)}
        </label>
    `))}
    `),br.templates.select=(e,t,i)=>{let r=e.params.groupDelimiter?((e,t)=>{let i=[],r=null;const o={};for(let n=0;n<e.length;n++){const a=e[n],s=(a._text||a.text||"").split(t);if(s.length>1){const e=s[0];r&&e===r.groupLabel||(o.hasOwnProperty(e)?r=o[e]:(r={groupLabel:e,values:[]},i.push(r),o[e]=r)),a._text||(a._text=a.text,a.text=s[1]),r.values.push(a)}else i.push(a)}return i})(e.values,e.params.groupDelimiter):null;const o=(t,i)=>te`
        <option class="${Mi(Yr(e,t))}" .value=${t.value} ?selected=${e.value==t.value} ?disabled=${t.disabled}> ${zr(e,t,ur.moneyFormat,!0)}</option>
    `;return te`
    <select class="cl-po--input ${Mi(Gr(e))}" id="${e.id}" .value=${Fi(e.value)} name="${eo(e)}" @change=${t=>oo(t,e,i)} ?required=${e.required} form=${Ai(t.productFormLink)}>
        ${e.value?null:te`
           <option value="" selected>${e.params.textValueSelect||""}</option>`}

        ${r?.length?te`
            ${Si(r,(e=>e.label),((e,t)=>te`
                ${e.groupLabel?te`
                    <optgroup label="${e.groupLabel}">
                        ${Si(e.values,(e=>e.value),o)}
                    </optgroup>`:o(e)}
            `))}`:te`${Si(e.values||[],(e=>e.value),o)}`}
    </select>
    ${e._editor?e._layer.params.collapse?te`${co(so(e),br.templates.text_editor(e,t,i),!1,"cl-po--edit")}`:te`${br.templates.text_editor(e,t,i)}`:null}
`},br.templates.font=(e,t,i)=>{let r;r=e.params.fontFamilies&&e.params.fontFamilies.length?e.params.fontFamilies:d.fonts.map((e=>e.name)),e.params.fontSortAlpha&&r.sort(((e,t)=>e.localeCompare(t))),e.values=r.map((e=>({value:e,text:" ",img:d.fontPreview(e)})));let o="dropdown";return e.params.fontSwatch&&(e.params.grow=!0,e.params.items=e.params.fontSwatchItems||3,o="img-swatch"),te`
        <div class="cl-po--font-selector">
            ${br.templates[o](e,t,i)}
        </div>
    `},br.templates.dropdown=(e,t,i)=>{let r=void 0===e._controller;if(e._controller=e._controller||{setup:()=>{let i=[t.assets+"/static/lib/choicesjs/choices.min.css",t.assets+"/static/lib/choicesjs/choices.min.js"];e._controller.ready=$r.loadOnce(i,"option-dropdown",{async:!1})},mapValues:e=>{let t=e.values?e.values.map((t=>{let i=e.value==t.value;return!i&&e.value&&e._controller.multiSelect&&(i=e._controller.isSelected(e,t)),{value:t.value,label:zr(e,t,ur.moneyFormat),customProperties:t.img,selected:i,disabled:!0===t.disabled}})):[];return e.value||e.params.multiSelect||t.unshift({value:"",label:e.params.textValueSelect||"",selected:!0}),t},init:e=>{e._controller.ready.then((()=>{let t=document.querySelector("#"+e.id);if(e.params.multiSelect){e._controller.optionEl=t,e._controller.selectEl=document.querySelector("#"+e.id+"-select");const r=ao();Object.assign(e._controller,r),e._controller.onChange=(e,t)=>{let r=t._controller.instance.getValue(!0).join(",");t._controller.optionEl.value=r,t.value=r,i(t)}}else e._controller.selectEl=t;const r=e=>{let t=`<span class="o--text">${e.label}</span>`;return e.customProperties?`<img src="${_r(e.customProperties,"200x")}" class="o--img"/> ${t}`:t};e._controller.instance=new Choices(e._controller.selectEl,{choices:e._controller.mapValues(e),itemSelectText:"",noResultsText:"",noChoicesText:"",removeItemButton:!!e.params.multiSelect,maxItemCount:e.params.maxSelect?e.params.maxSelect:-1,maxItemText:e.params.maxSelect?l.get("product.options.validity.selectMax",{max:e.params.maxSelect}):"",searchPlaceholderValue:e.params.textSearchValues||"",searchEnabled:e.params.searchValues||!1,searchChoices:e.params.searchValues||!1,fuseOptions:window.clDropdownFuseOptions||{},shouldSort:!1,callbackOnCreateTemplates:function(t){return{item:(t,i,o)=>{let n=Choices.defaults.templates.item.apply(this,[t,i,o]),a=r(i);return e.params.multiSelect?(n.innerHTML=n.innerHTML.replace(i.label,a),n.lastElementChild.innerHTML="X"):n.innerHTML=a,""===i.value&&n.classList.add("cl-po--placeholder"),n},choice:(e,t,i)=>{let o=Choices.defaults.templates.choice.apply(this,[e,t,i]);return o.innerHTML=r(t),t.disabled&&o.classList.add("cl-po--disabled"),""===t.value&&o.classList.add("cl-po--placeholder"),o}}}})}))},updateChoices:e=>{e._controller.instance&&(e.value&&e.params.multiSelect&&e._controller.instance.clearStore(),e._controller.instance.setChoices(e._controller.mapValues(e),"value","label",!0))},update:e=>{e._controller.instance&&(e.params.multiSelect?e._controller.optionEl&&e.value!==e._controller.optionEl.value&&e._controller.instance.setChoiceByValue(e.value.split(",")):e._controller.selectEl&&e.value!==e._controller.selectEl.value&&e._controller.instance.setChoiceByValue(e.value))}},t.productForm)if(r){e._controller.setup();const i=()=>{t.productForm.removeEventListener("options:rendered",i),e._controller.init(e)};t.productForm.addEventListener("options:rendered",i)}else if(t.editorMode)e._controller.multiSelect!==e.params.multiSelect?(delete e._controller.multiSelect,e._controller.init(e)):e._controller.updateChoices(e);else{if(e._controller.update(e),e.params.valuePriceText){let t=Rr(e);t&&(t._priceFunction||t.priceType===gr.PERCENTAGE)&&e._controller.updateChoices(e)}e._variantOption&&e._controller.updateChoices(e)}return e.params.multiSelect?te`
        <input type="hidden" name="${eo(e)}" id="${e.id}" value=${e.value} form=${Ai(t.productFormLink)} />
        <select class="cl-po--input ${Mi(Gr(e))}" id="${e.id}-select" @change=${t=>e._controller.onChange(t,e)} multiple>
        </select>
        `:te`
        <select class="cl-po--input ${Mi(Gr(e))}" id="${e.id}" name="${eo(e)}" @change=${t=>oo(t,e,i)} ?required=${e.required} form=${Ai(t.productFormLink)}>
        </select>
        `};const co=(e,t,i,r="")=>te`
    <div class="cl-po--collapse ${i?r+" cl-po--open":r}" @click=${e=>(e=>{let t=e.currentTarget,i=-1!==t.className.indexOf("open"),r=t.nextElementSibling;i||(r.style.maxHeight=r.scrollHeight+100+"px",setTimeout((()=>{r.style.maxHeight&&(r.style.maxHeight=null)}),500)),t.classList.toggle("cl-po--open")})(e)}>${e}</div>
    <div class="cl-po--panel ${r}">
        ${t}
    </div>
`;br.templates.group=(e,t,i,r,o)=>{const n=te`
            <div class="cl-po--group" >
                ${e.params.groupLayout?te`
                    <style>${(e=>{let t=`[data-option="${e.name}"] .cl-po--group`;if("grid"===e.params.groupLayout){let i=`${t} {\n          margin: 0 auto;\n          display: grid;\n          gap: 1rem;\n          grid-template-columns: repeat(${e.params.groupCols||2}, 1fr);\n        }`;return e.params.groupColsM&&(i+=` @media only screen and (max-width: 450px) { ${t} {\n              grid-template-columns: repeat(${e.params.groupColsM}, 1fr);\n            } }`),i}return""})(e)}</style>
                `:null}
                ${e.options&&e.options.length>0?te`
                    ${uo(e.options,t,i,r,o)}
                `:null}
            </div>`;return e.params.collapse?co(vi(e.params.collapseLabel),n,e.params.collapseOpen):n},br.templates.html=(e,t,i)=>te`
    ${vi(e.params.html.replace(new RegExp("{product}","g"),t.product.id))}
`,br.templates.layer_editor=(e,t,i)=>te`
    ${e._layer.params.collapseLabel?te`<span class="cl-po--layer-editor-label cl-po--help">${e._layer.params.collapseLabel}</span>`:null}
    <div class="cl-po--text-editor cl-po--layer-editor">
        ${e._layer.params.editor.scale?te`
        <div class="cl-po--editor-group cl-po--layer-scale">
            <div @click=${t=>{Or.scale(e._layer,-(e._layer.params.editor.scaleStep||.1))}} class="cl-po--swatch cl-po--swatch-button" data-tippy-content="${l.get("product.options.layer.scaleDown",null,"Scale down")}" data-tippy-placement="bottom">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path d="M5 11h14v2H5z" fill="var(--text-editor-color)"/></svg>
            </div>
            <div @click=${t=>{Or.scale(e._layer,e._layer.params.editor.scaleStep||.1)}} class="cl-po--swatch cl-po--swatch-button" data-tippy-content="${l.get("product.options.layer.scaleUp",null,"Scale up")}" data-tippy-placement="bottom">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path d="M11 11V5h2v6h6v2h-6v6h-2v-6H5v-2z" fill="var(--text-editor-color)"/></svg>
            </div>
        </div>
        `:null}
        ${e._layer.params.editor.center?te`
        <div class="cl-po--editor-group cl-po--layer-center">
            <div @click=${t=>{Or.center(e._layer,"h")}} class="cl-po--swatch cl-po--swatch-button" data-tippy-content="${l.get("product.options.layer.centerH",null,"Center horizontal")}" data-tippy-placement="bottom">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path d="M16.05,7.05 L21,12 L16.05,16.95 L14.636,15.536 L17.172,12.999 L4,13 L4,11 L17.172,11 L14.636,8.464 L16.05,7.05 Z M7.95,7.05 L9.364,8.464 L6.828,11 L20,11 L20,13 L6.828,13 L9.364,15.536 L7.95,16.95 L3,12 L7.95,7.05 Z" fill="var(--text-editor-color)"></path></svg>
            </div>
            <div @click=${t=>{Or.center(e._layer,"v")}} class="cl-po--swatch cl-po--swatch-button" data-tippy-content="${l.get("product.options.layer.centerV",null,"Center vertical")}" data-tippy-placement="bottom">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><g transform="translate(7, 3)"><path d="M9.95,4.95 L8.536,6.364 L6,3.828 L6,17 L4,17 L4,3.828 L1.465,6.364 L0.05,4.95 L5,0 L9.95,4.95 Z M9.95,13.05 L5,18 L0.05,13.05 L1.464,11.636 L4.001,14.172 L4,1 L6,1 L6,14.172 L8.536,11.636 L9.95,13.05 L9.95,13.05 Z" fill="var(--text-editor-color)"></path></g></svg>
            </div>
            <div @click=${t=>{Or.center(e._layer)}} class="cl-po--swatch cl-po--swatch-button" data-tippy-content="${l.get("product.options.layer.center",null,"Center")}" data-tippy-placement="bottom">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path d="M11 11V5.828L9.172 7.657 7.757 6.243 12 2l4.243 4.243-1.415 1.414L13 5.828V11h5.172l-1.829-1.828 1.414-1.415L22 12l-4.243 4.243-1.414-1.415L18.172 13H13v5.172l1.828-1.829 1.415 1.414L12 22l-4.243-4.243 1.415-1.414L11 18.172V13H5.828l1.829 1.828-1.414 1.415L2 12l4.243-4.243 1.414 1.415L5.828 11z" fill="var(--text-editor-color)"/></svg>
            </div>
        </div>
        `:null}
        ${e._layer.params.editor.move?te`
        <div class="cl-po--editor-group cl-po--layer-move">
            <div @click=${t=>{Or.moveX(e._layer,-(e._layer.params.editor.moveStep||50))}} class="cl-po--swatch cl-po--swatch-button" data-tippy-content="${l.get("product.options.layer.moveLeft",null,"Move left")}" data-tippy-placement="bottom">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path d="M7.828 11H20v2H7.828l5.364 5.364-1.414 1.414L4 12l7.778-7.778 1.414 1.414z" fill="var(--text-editor-color)"/></svg>
            </div>
            <div @click=${t=>{Or.moveX(e._layer,e._layer.params.editor.moveStep||50)}} class="cl-po--swatch cl-po--swatch-button" data-tippy-content="${l.get("product.options.layer.moveRight",null,"Move right")}" data-tippy-placement="bottom">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path d="M16.172 11l-5.364-5.364 1.414-1.414L20 12l-7.778 7.778-1.414-1.414L16.172 13H4v-2z" fill="var(--text-editor-color)"/></svg>
            </div>
            <div @click=${t=>{Or.moveY(e._layer,-(e._layer.params.editor.moveStep||50))}} class="cl-po--swatch cl-po--swatch-button" data-tippy-content="${l.get("product.options.layer.moveUp",null,"Move up")}" data-tippy-placement="bottom">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path d="M13 7.828V20h-2V7.828l-5.364 5.364-1.414-1.414L12 4l7.778 7.778-1.414 1.414L13 7.828z" fill="var(--text-editor-color)"/></svg>
            </div>
            <div @click=${t=>{Or.moveY(e._layer,e._layer.params.editor.moveStep||50)}} class="cl-po--swatch cl-po--swatch-button" data-tippy-content="${l.get("product.options.layer.moveDown",null,"Move down")}" data-tippy-placement="bottom">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path d="M13 16.172l5.364-5.364 1.414 1.414L12 20l-7.778-7.778 1.414-1.414L11 16.172V4h2v12.172z" fill="var(--text-editor-color)"/></svg>
            </div>
        </div>
        `:null}
    </div>
`,br.templates.upload=(e,t,i,r,o)=>{let n=void 0===e._controller;return e._controller=e._controller||Sr.getInstance().controller(e,t.product,t.productForm,o),n||e._controller.update(e,t.productForm,t.productFormLink),te`  
        <div class="cl-po--upload ${Mi(Gr(e))}">
            <div class="cl-po--upload-wrap">
                <label class="cl-po--input cl-po--upload-button">
                 <input type="file" @change=${r=>e._controller.onChange(r,e,t.productForm,t.productFormLink,i)} 
                     ?multiple=${e.params.multiple}  accept=${Ai(e.params.accept)} >
                 <span>${vi(e.params.button||"Choose file")}</span>
                </label>
                ${e.value&&e._layer&&e._layer.params.crop?te`
                    <label class="cl-po--input cl-po--upload-button crop ${Mi({"has-label":e._layer.params.cropLabel})}" @click=${i=>e._controller.crop(e,t.productForm)}>
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M15 17v2H6a1 1 0 0 1-1-1V7H2V5h3V2h2v15h8zm2 5V7H9V5h9a1 1 0 0 1 1 1v11h3v2h-3v3h-2z" /></svg>
                        ${e._layer.params.cropLabel?te`<span class="cl-po--crop-label">${e._layer.params.cropLabel}</span>`:null}
                    </label>
                `:null}
            </div>
            <progress class="cl-po--preview-progress" style="display:none;"></progress>
            <div class="cl-po--upload-files">
             ${Si(e._controller.files,(r=>te`
                   <div>${r.name} <span class="cl-po--remove" @click=${o=>e._controller.remove(e,t.productForm,r,i)}>&times;</span></div>
             `))}
            </div>
            
            ${e.value&&e._layer&&e._layer&&e._layer.params.layerEditor?te`${br.templates.layer_editor(e,t,i)}`:null}
        </div>
    `},br.templates["upload-lift"]=(e,t,i,r,o)=>{if(e.params.uuid){e._controller&&(e._controller.field&&e._controller.field.config.uuid!==e.params.uuid?(e._controller.field.destroy(),delete e._controller):t.editorMode&&e._controller.notfound&&delete e._controller);let r=void 0===e._controller;e._controller=e._controller||Sr.getInstance().controllerLift(e,t.product,t.productForm,i,o),r||e._controller.update(e,t.productForm),e._controller.option=e;let n=e._layer&&e._layer.params.cropLabel?e._layer.params.cropLabel:e.params.cropLabel;return te`
            <div class="cl-po--upload-lift ${Mi(Gr(e))}">
                <div class="cl-po--upload-lift-${e.id}"></div>
                ${e.value&&(e._layer&&e._layer.params.crop||e._controller._cropConfig||e.params.cropEdit)?te`
                    <label class="cl-po--input cl-po--upload-lift-crop ${Mi({"has-label":n})}" @click=${i=>e._controller.crop(e,t.productForm)}>
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20" ><path fill="currentColor" d="M15 17v2H6a1 1 0 0 1-1-1V7H2V5h3V2h2v15h8zm2 5V7H9V5h9a1 1 0 0 1 1 1v11h3v2h-3v3h-2z" /></svg>
                        ${n?te`<span class="cl-po--crop-label">${n}</span>`:null}
                    </label>
                `:null}

                ${e.value&&e._layer&&e._layer.params.layerEditor?te`${br.templates.layer_editor(e,t,i)}`:null}
            </div>`}return null},br.templates.library=(e,t,i,r,o)=>{let n=void 0===e._controller;return e._controller=e._controller||new Fr(i,o),e._controller.option=e,e._controller.config=t,n?e._controller.init():e.value&&!e._controller.image&&-1!==e.value.indexOf("http")&&e._controller.restoreImage(),(n||t.editorMode)&&e._controller.initUI(),te`

          ${e.params.popup?te`<div class="cl-po--swatch-container">
                         <label class="cl-po--swatch-item grow" >
                                <div class="cl-po--swatch cl-po--swatch-button ${Mi(Xr(e,"small"))}" style=${Li(Zr(e,Jr(e)))}
                                     @click=${t=>e._controller.openPopup()}>
                                     ${l.get("product.options.library.button",null,"Select image")}
                                </div>
                         </label>
                    </div>`:null}


          ${e._controller.image?te`<div class="cl-po--swatch-container">

                      ${e._controller.image.id?te`<input type="hidden" id="${e.id}-id" name="properties[_${e.name}_id]" value=${e._controller.image.id} form=${Ai(t.productFormLink)}>`:null}
                       
                       <label class="cl-po--swatch-item ${Mi({"cl-hide":!e.params.popup&&!(e._layer?.params.crop||e._layer?.params.layerEditor||e._controller.optionUpload)})}">
                            <input type="radio" class="cl-po--input ${Mi(Gr(e))}" id="${e.id}" name="${eo(e)}" .value=${e.value}  
                               checked ?required=${e.required} form=${Ai(t.productFormLink)}>
                            <div class="cl-po--swatch cl-po--swatch-img  ${Mi(Xr(e,"large"))}" data-tippy-content="${Ai(Hr(e,e._controller.image,ur.moneyFormat))}" data-tippy-placement="bottom">
                                 ${e._controller.image.img?te`<img src="${e._controller.image._preview?e._controller.image._preview:_r(e._controller.image.img,yr(e.params.size||"large"))}" alt="${zr(e,e._controller.image,ur.moneyFormat)}"/>`:null}
                            </div>
                      </label>

                      ${e._layer?.params.crop||e._controller._fileCrop?te`
                          <div class="cl-po--swatch-item cl-po--upload">
                            <div class="cl-po--input cl-po--upload-button crop ${Mi({"has-label":(e._layer||e._controller.optionUpload?._layer)?.params.cropLabel})}" @click=${t=>e._controller.crop()}>
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M15 17v2H6a1 1 0 0 1-1-1V7H2V5h3V2h2v15h8zm2 5V7H9V5h9a1 1 0 0 1 1 1v11h3v2h-3v3h-2z" /></svg>
                                ${(e._layer||e._controller.optionUpload?._layer)?.params.cropLabel?te`<span class="cl-po--crop-label">${(e._layer||e._controller.optionUpload?._layer)?.params.cropLabel}</span>`:null}
                            </div>
                          </div>
                        `:null}
                      
                      ${e._layer?.params.layerEditor?te`${br.templates.layer_editor(e,t,i)}`:null}
                  </div>`:null}
          
            <div class="cl-po--library" style=${Li(e._controller.libraryStyleMap())}">
                
                <div class="cl-po--library-search ${Mi({"cl-hide":e._controller.searchHide})}"">
                     <input type="text" class="cl-po--input" id="${e.id}_search" name="${e.name}_search" .value=${e._controller.searchQuery}
                            placeholder=${l.get("product.options.library.search.placeholder",null,"Search images")}
                            @input=${Kr(e,(t=>e._controller.onSearch(t)))} >
                </div>
                <div class="cl-po--library-categories ${Mi({"cl-hide":e._controller.categoryHide})}">

                    ${e._controller.categoryCount>0?te`<div class="cl-po--label">${l.get("product.options.library.categories.label",null,"Categories")}</div>`:null}
                    
                    ${e.params.categoryGrid?te`
                        <div class="cl-po--library-grid">
                             ${Si(e.values||[],(e=>e.value),((t,i)=>te`
                                 ${e._controller.image!==t?te`
                                     <div class="cl-po--library-grid-item">
                                         <div class="cl-po--swatch ${Mi({"cl-checked":e._controller.category===t})}" 
                                              @click=${i=>e._controller.onCategoryChange(i,t)}>
                                             ${t.img?te`<img src="${_r(t.img,yr("large"))}" alt="${zr(e,t,ur.moneyFormat)}"/>`:null}
                                             <span class="cl-po--library-category-text">${vi(zr(e,t,ur.moneyFormat))}</span>
                                         </div>
                                     </div>`:null}
                            `))}
                        </div>
                        `:te`
                        <div class="cl-po--swatch-container">
                            ${Si(e.values||[],(e=>e.value),((t,i)=>te`
                                ${e._controller.image!==t?te`
                                    <div class="cl-po--swatch-item" >
                                        <div class="cl-po--swatch cl-po--swatch-button ${Mi(Xr(e,"small",{"cl-checked":e._controller.category===t}))}"
                                             @click=${i=>e._controller.onCategoryChange(i,t)}>
                                            ${vi(zr(e,t,ur.moneyFormat))}
                                        </div>
                                    </div>`:null}
                            `))}
                        </div>`}
                </div>
                ${!e._controller.imagesHide&&e._controller.categoryHide?te`<div class="cl-po--library-images-category" >

                                <div class="cl-po--swatch cl-po--swatch-button cl-po--swatch-button-library ${Mi({"cl-hide":e._controller.categoryCount<=1})}" @click=${t=>e._controller.showCategories()}>
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2C17.52 2 22 6.48 22 12C22 17.52 17.52 22 12 22C6.48 22 2 17.52 2 12C2 6.48 6.48 2 12 2ZM12 20C16.42 20 20 16.42 20 12C20 7.58 16.42 4 12 4C7.58 4 4 7.58 4 12C4 16.42 7.58 20 12 20ZM12 11H16V13H12V16L8 12L12 8V11Z"></path></svg>
                                    ${l.get("product.options.library.categories.button",null,"Show categories")}
                                </div>
                            
                             </div>`:null}
                <div class="cl-po--library-images ${Mi({"cl-hide":e._controller.imagesHide})}">
                    
                    <div class="cl-po--library-grid">
                        ${Si(e._controller.imagesPaged||[],(e=>e.value),((t,i)=>te`
                        <div class="cl-po--library-grid-item">
                            <div class="cl-po--swatch ${Mi({"cl-checked":e._controller.image===t})}" data-tippy-content="${Ai(Hr(e,t,ur.moneyFormat))}" data-tippy-placement="bottom"
                                 @click=${i=>e._controller.onImageChange(i,t)}>
                                ${t.img?te`<img src="${_r(t.img,yr("large"))}" alt="${zr(e,t,ur.moneyFormat)}"/>`:null}
                            </div>
                        </div>
                        `))}
                    </div>

                    ${e._controller.searchQuery&&0===e._controller.imagesPaged.length?te`
                                <div class="cl-po--library-images-more">
                                    <p>${l.get("product.options.library.search.empty",null,"No results found")}</p>
                                </div>
                            `:null}

                    ${e._controller.hasMoreImages?te`
                                <div class="cl-po--library-images-more">
                                    <div class="cl-po--swatch cl-po--swatch-button cl-po--swatch-button-library" @click=${t=>e._controller.onMoreImages()}>
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2C17.52 2 22 6.48 22 12C22 17.52 17.52 22 12 22C6.48 22 2 17.52 2 12C2 6.48 6.48 2 12 2ZM12 20C16.42 20 20 16.42 20 12C20 7.58 16.42 4 12 4C7.58 4 4 7.58 4 12C4 16.42 7.58 20 12 20ZM13 12H16L12 16L8 12H11V8H13V12Z"></path></svg>
                                        ${l.get("product.options.library.images.button",null,"More images")}
                                    </div>
                                </div>
                               `:null}
                    
                </div>
            </div>`},br.templates["library-popup"]=(e,t,i)=>te`
        <div class="ldcv ${t.className}" >
            <div class="base">
                <div class="inner card">
                    <div class="cl-po--popup cl-po--popup-library">
                        <div class="cl-po--popup-options cl--po-wrapper" id=${t.id}>
                            ${e}
                        </div>
                    </div>
                    <div class="cl-po--popup-close" @click="${e=>i(e)}">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" ><path fill="none" d="M0 0h24v24H0z"/><path d="M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10-4.477 10-10 10zm0-2a8 8 0 1 0 0-16 8 8 0 0 0 0 16zm0-9.414l2.828-2.829 1.415 1.415L13.414 12l2.829 2.828-1.415 1.415L12 13.414l-2.828 2.829-1.415-1.415L10.586 12 7.757 9.172l1.415-1.415L12 10.586z"/></svg>
                    </div>
                </div>
            </div>
        </div>
    `;const po=e=>te`
    ${vi(e.label)} ${e.value&&e.params.labelValueText?te`<span class="cl-po--value">&nbsp;${Vr(Rr(e))}</span>`:null} ${e._priceText?te`<span class="cl-po--price">&nbsp;${vi(jr(e._priceText,e.params.priceTemplate))}</span>`:null}    ${e.params.info?te`<span class="cl-po--info" data-tippy-content="${e.params.info}"></span>`:null}
`,uo=(e,t,i,r,o)=>te`
    ${Si(e,(e=>e.name),((e,n)=>te`
            
             ${$i(e.visible?te`
                 <div class="cl-po--option" data-option="${e.name}">
                    
                    ${e.label?(e=>"text"===e.type||"textarea"===e.type||"number"===e.type||"select"===e.type)(e)?te`<label class="cl-po--label" for="${e.id}">${po(e)}</label>`:te`<div class="cl-po--label">${po(e)}</div>`:null}
                    
                    ${br.templates[e.type]?te`
                      ${br.templates[e.type](e,t,i,r,o)}
                    `:null}
                     
                    ${e.params.help?te`
                    <div class="cl-po--help">${vi(e.params.help)}</div>
                    `:null}
                     
                    ${sr(e.errors&&e.errors.length>0?Ui(te`
                    <div class="cl-po--errors">
                        ${Si(e.errors,((t,i)=>te`
                            <div class="cl-po--error" @click=${i=>r(i,e,t)}>${t}</div>
                        `))}
                    </div>
                    `,`${e.id}-errors`):Ui(te`<span></span>`,"noop"),Ur)}
                   
                </div>
             `:null)}
    `))}
`;var ho=(e,t,i,r,o,n)=>te`
<div class="cl-po--options">

${e.length>0?te`
        ${uo(e,t,i,r,n)}
        
        ${t.editorMode?te`  
            <div class="cl-editor-mode">
                <p data-live-price="${t.product.id}" ></p>
                <p data-live-weight="${t.product.id}" ></p>
                <p data-live-sku="${t.product.id}" ></p>
                <button class="cl-po--swatch cl-po--swatch-button cl-po--small" @click="${e=>o(e)}">
                    Add to cart (validation test)
                </button>
            </div>
            `:null}
    `:null}
    ${t.idLink?te`
        <input type="hidden" name="properties[${pr.OPTIONS}]" value=${t.uuid} form=${Ai(t.productFormLink)}>
      `:null}
</div>
`;var mo=(e,t,i,r,o,n)=>te`
<div class="ldcv ${r.className}" >
    <div class="base">
        <div class="inner card">
            <div class="cl-po--popup">
                <div class="cl-po--popup-preview">
                    ${e}
                </div>
                <div class="cl-po--popup-options cl--po-wrapper" id=${r.id}>
                    <div class="options-scroll">
                        ${r.visible?t:null}
                    </div>
                    <div class="options-atc">
                        <div class="atc-wrap">
                            <div class="atc-price">
                                ${i}
                            </div>
                            <div class="atc-button">
                                <button class="cl-po--swatch cl-po--swatch-button" @click="${e=>o(e)}" style=${Li(((e,t={})=>(e.params.atcColor&&(t.color=e.params.atcColor),e.params.atcBgColor&&(t.backgroundColor=e.params.atcBgColor),t))(r.option))}>
                                    ${r.option.params.atcText||"Add to Cart"}
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="cl-po--popup-close" @click="${e=>n(e)}">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" ><path fill="none" d="M0 0h24v24H0z"/><path d="M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10-4.477 10-10 10zm0-2a8 8 0 1 0 0-16 8 8 0 0 0 0 16zm0-9.414l2.828-2.829 1.415 1.415L13.414 12l2.829 2.828-1.415 1.415L12 13.414l-2.828 2.829-1.415-1.415L10.586 12 7.757 9.172l1.415-1.415L12 10.586z"/></svg>
            </div>
        </div>
    </div>
</div>
`,go={};!function(e){"use strict";var t=e.HTMLCanvasElement&&e.HTMLCanvasElement.prototype,i=e.Blob&&function(){try{return Boolean(new Blob)}catch(e){return!1}}(),r=i&&e.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(e){return!1}}(),o=e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||e.MSBlobBuilder,n=/^data:((.*?)(;charset=.*?)?)(;base64)?,/,a=(i||o)&&e.atob&&e.ArrayBuffer&&e.Uint8Array&&function(e){var t,a,s,l,c,p,d,u,h;if(!(t=e.match(n)))throw new Error("invalid data URI");for(a=t[2]?t[1]:"text/plain"+(t[3]||";charset=US-ASCII"),s=!!t[4],l=e.slice(t[0].length),c=s?atob(l):decodeURIComponent(l),p=new ArrayBuffer(c.length),d=new Uint8Array(p),u=0;u<c.length;u+=1)d[u]=c.charCodeAt(u);return i?new Blob([r?d:p],{type:a}):((h=new o).append(p),h.getBlob(a))};e.HTMLCanvasElement&&!t.toBlob&&(t.mozGetAsFile?t.toBlob=function(e,i,r){var o=this;setTimeout((function(){r&&t.toDataURL&&a?e(a(o.toDataURL(i,r))):e(o.mozGetAsFile("blob",i))}))}:t.toDataURL&&a&&(t.msToBlob?t.toBlob=function(e,i,r){var o=this;setTimeout((function(){(i&&"image/png"!==i||r)&&t.toDataURL&&a?e(a(o.toDataURL(i,r))):e(o.msToBlob(i))}))}:t.toBlob=function(e,t,i){var r=this;setTimeout((function(){e(a(r.toDataURL(t,i)))}))})),"function"==typeof define&&define.amd?define((function(){return a})):go?go=a:e.dataURLtoBlob=a}(window);var fo=(e,t,i,r)=>te`
<div class="cl-po--preview-crop">
    <button type="button" @click=${e=>i()}>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="30" height="30"><path d="M12 10.586l4.95-4.95 1.414 1.414-4.95 4.95 4.95 4.95-1.414 1.414-4.95-4.95-4.95 4.95-1.414-1.414 4.95-4.95-4.95-4.95L7.05 5.636z"/></svg>
    </button>
    <div>
        <button type="button" @click=${t=>e(!1)} >
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="30" height="30"><path d="M18.031 16.617l4.283 4.282-1.415 1.415-4.282-4.283A8.96 8.96 0 0 1 11 20c-4.968 0-9-4.032-9-9s4.032-9 9-9 9 4.032 9 9a8.96 8.96 0 0 1-1.969 5.617zm-2.006-.742A6.977 6.977 0 0 0 18 11c0-3.868-3.133-7-7-7-3.868 0-7 3.132-7 7 0 3.867 3.132 7 7 7a6.977 6.977 0 0 0 4.875-1.975l.15-.15zM7 10h8v2H7v-2z"/></svg>
        </button>
        <button type="button" @click=${t=>e(!0)} >
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="30" height="30"><path d="M18.031 16.617l4.283 4.282-1.415 1.415-4.282-4.283A8.96 8.96 0 0 1 11 20c-4.968 0-9-4.032-9-9s4.032-9 9-9 9 4.032 9 9a8.96 8.96 0 0 1-1.969 5.617zm-2.006-.742A6.977 6.977 0 0 0 18 11c0-3.868-3.133-7-7-7-3.868 0-7 3.132-7 7 0 3.867 3.132 7 7 7a6.977 6.977 0 0 0 4.875-1.975l.15-.15zM10 10V7h2v3h3v2h-3v3h-2v-3H7v-2h3z"/></svg>
        </button>
        <button type="button" @click=${e=>t(90)} >
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="30" height="30"><path fill="none" d="M0 0h24v24H0z"/><path d="M20 10.586l1.828-1.829 1.415 1.415L19 14.414l-4.243-4.242 1.415-1.415L18 10.586V8a3 3 0 0 0-3-3h-4V3h4a5 5 0 0 1 5 5v2.586zM13 9a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V10a1 1 0 0 1 1-1h10zm-1 2H4v8h8v-8z"/></svg>
        </button>
    </div>
    <button type="button" @click=${e=>r()} style="background:#31cc01;margin-right:1px;">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="30" height="30"><path fill="white" d="M10 15.172l9.192-9.193 1.415 1.414L10 18l-6.364-6.364 1.414-1.414z"/></svg>
    </button>
    <svg class="icon-crop cursor" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
        <path class="cursor-x-y" d="M56 49v-3l4 4-4 4v-3h-5v5h3l-4 4-4-4h3v-5h-5v3l-4-4 4-4v3h5v-5h-3l4-4 4 4h-3v5z" />
    </svg>
    <svg class="icon-crop touch"  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200">
        <path class="hand-x-y" d="M139.93,113.56l-41.12-6.93V76.08a9.25,9.25,0,0,0-9.25-9.25h0a9.25,9.25,0,0,0-9.25,9.25v57.36L71,122.65c-3.61-3.61-8.44-3.89-13.08,0,0,0-7.24,5.84-3.83,9.25l34,34h42.63a9.25,9.25,0,0,0,9.07-7.43l6.82-34.09A9.28,9.28,0,0,0,139.93,113.56Z"/>
    </svg>
</div>
`;class vo{evaluateConditions(e,t,i){let r=1===t?"OR":"AND",o=a.getLevel();o<=a.levels.TRACE&&a.debug("====> evaluating conditions for: "+i+" in mode "+r,e);let n=!1;if(e.length)for(let i=0;i<e.length;i++){const r=e[i];if(n=this.evaluateCondition(r,this.data),o<=a.levels.TRACE&&a.debug("evaluated condition: ",r,n),1===t){if(n)break}else if(!n)break}else n=!0;return a.debug("======> evaluated conditions for: "+i+" in mode "+r,n),!!n}evaluateCondition(e,t){return"options"===e.data?this.evaluateOptionCondition(e,t.options):"product"===e.data?this.evaluateProductCondition(e,t.product):"variant"===e.data&&this.evaluateVariantCondition(e,t.variant)}evaluateOptionCondition(e,t){for(let i=0;i<t.length;i++){const r=t[i];if(r.name===e.field){let t=r.value;if(r._controller&&"function"==typeof r._controller.conditionValue&&(t=r._controller.conditionValue(r)),e.value&&-1!==e.value.indexOf(",")){let i=e.value.split(",");for(let r=0;r<i.length;r++){const o=i[r];if(this.evaluateOperation(e.operator,o,t))return!0}}if(0!==e.operator.indexOf("!")&&e.value&&t&&r._controller&&r._controller.multiSelect&&-1!==t.indexOf(",")){let i=t.split(",");for(let t=0;t<i.length;t++){const r=i[t];if(this.evaluateOperation(e.operator,e.value,r))return!0}return!1}return this.evaluateOperation(e.operator,e.value,t)}if(r.options&&r.options.length>0){if(this.evaluateOptionCondition(e,r.options))return!0}}return!1}evaluateVariantCondition(e,t){if(t)switch(e.field){case"variant":if(e.variants)for(let i=0;i<e.variants.length;i++)if(e.variants[i]&&e.variants[i].id.toString()===t.id.toString())return!0;break;case"variant_title":if(e.value&&-1!==e.value.indexOf(",")){let i=e.value.split(",");for(let r=0;r<i.length;r++){const o=i[r];if(this.evaluateOperation(e.operator,o,t.title))return!0}}else if(this.evaluateOperation(e.operator,e.value,t.title))return!0}return!1}evaluateProductCondition(e,t){switch(e.field){case"product":for(let i=0;i<e.products.length;i++)if(e.products[i]&&e.products[i].id.toString()===t.id.toString())return!0;break;case"product_handle":if(this.evaluateOperation(e.operator,e.value,t.handle))return!0;break;case"product_title":if(this.evaluateOperation(e.operator,e.value,t.title))return!0;break;case"product_type":if(t.type&&this.evaluateOperation(e.operator,e.value,t.type))return!0;if(t.product_type&&this.evaluateOperation(e.operator,e.value,t.product_type))return!0;break;case"product_vendor":if(this.evaluateOperation(e.operator,e.value,t.vendor))return!0;break;case"product_tags":let i;if(Array.isArray(t.tags))i=t.tags;else{if(!t.tags)break;i=t.tags.indexOf(", ")>=0?t.tags.split(", "):[t.tags]}for(let t=0;t<e.tags.length;t++)for(let r=0;r<i.length;r++)if(e.tags[t].toString().toLowerCase().trim()===i[r].toString().toLowerCase().trim())return!0}return!1}evaluateOperation(e,t,i){if(void 0!==i){switch(e){case"equals":return i.toString().toLowerCase().trim()===t.toString().toLowerCase().trim();case"!equals":return i.toString().toLowerCase().trim()!==t.toString().toLowerCase().trim();case"contains":return i.toString().toLowerCase().trim().indexOf(t.toString().toLowerCase().trim())>-1;case"!contains":return-1===i.toString().toLowerCase().trim().indexOf(t.toString().toLowerCase().trim());case"empty":return!i;case"!empty":return!!i;case"=":return parseFloat(i)===parseFloat(t);case"!=":return parseFloat(i)!==parseFloat(t);case">":return parseFloat(i)>parseFloat(t);case">=":return parseFloat(i)>=parseFloat(t);case"<":return parseFloat(i)<parseFloat(t);case"<=":return parseFloat(i)<=parseFloat(t)}return!1}}constructor(e,t={}){this.settings=o.extend({},e||{}),this.data=t}}vo.MODE={OR:1,AND:2};var yo=vo;var _o=class{render(e,t,i){}_getOptions(e,t,i=e.params){let r={visible:!0,selectable:!1,evented:!1,lockUniScaling:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockMovementX:!0,lockMovementY:!0,hasControls:!1,lockScalingFlip:!0};if(r.visible=!0,e.hasOwnProperty("_visible")&&(r.visible=e._visible),r.centeredRotation=!0,i.autoRotate?r.angle=0:void 0!==i.angle&&(r.angle=i.angle%360),i.autoPos&&!e._interactive?(r.left=0,r.top=0):(void 0!==i.x&&(r.left=i.x),void 0!==i.y&&(r.top=i.y)),i.autoScale&&!e._interactiveScaled?(r.scaleX=1,r.scaleY=1):(void 0!==i.scaleX&&(r.scaleX=i.scaleX),void 0!==i.scaleY&&(r.scaleY=i.scaleY)),void 0!==i.width&&(r.width=i.width),void 0!==i.height&&(r.height=i.height),Pr.isEditLayer(e,t.editorMode,t.editLayer)&&!t.cropMode){if(!Pr.hasRefRect(e)){r.lockMovementX=!0===e.params.autoPos,r.lockMovementY=!0===e.params.autoPos,r.lockScalingX=!0===e.params.autoScale,r.lockScalingY=!0===e.params.autoScale;let t=!e.params.autoPos||!e.params.autoScale;r.hasControls=t,r.selectable=t,r.evented=t,r.lockRotation=!1}}else if(Pr.isCropLayer(e,t.cropMode,t.cropLayer)){r.lockMovementX=!1,r.lockMovementY=!1,i.interactive=!1;let e=!1;r.lockScalingX=!e,r.lockScalingY=!e,r.hasControls=e,r.selectable=!0,r.evented=!0,r.borderColor="rgb(178,204,255)",r.borderScaleFactor=1}else e.params.interactive&&!t.cropMode&&(t.editorMode&&Pr.hasEditLayer(t.editorMode,t.editLayer)||(r.lockMovementX=!1,r.lockMovementY=!1,"upload"!==e.type||i.autoScaleOverlay||void 0!==i.resizable||(i.resizable=!0),i.rotatable&&(r.lockRotation=!1),i.resizable&&(r.lockScalingX=!1,r.lockScalingY=!1),r.hasControls=i.resizable||i.rotatable,r.hasControls&&(r.transparentCorners=!1,r.cornerStyle="circle",r.cornerSize=window.clPreviewCorner||20,r.cornerColor=e.params.interactiveColor||"rgb(178,204,255)"),r.selectable=!0,r.evented=!0,r.borderColor=e.params.interactiveColor||"rgb(178,204,255)"));if(Pr.hasRefRect(e)&&"text"!==e.type&&"textbox"!==e.type&&isNaN(t.canvasRotate)){let i=this._getRefRect(e,t);i.set("absolutePositioned",!0),i.set("strokeWidth",0),r.clipPath=i}return r._layer=e,r}_isEditorMode(e,t){return!!t.editorMode&&(!t.editLayer||!(e.name!==t.editLayer&&!e.name.startsWith(t.editLayer+"_")))}_printObject(e){a.debug("width/height =",e.width,e.height),a.debug("scaled width/height =",e.getScaledWidth(),e.getScaledHeight()),a.debug("left/top = ",e.left,e.top),a.debug("boundingRect = ",e.getBoundingRect()),a.debug("boundingRectAbsolute = ",e.getBoundingRect(!0)),a.debug("boundingRectCalc = ",e.getBoundingRect(!1,!0)),a.debug("boundingRectAbsoluteCalc = ",e.getBoundingRect(!0,!0))}_applyAutoParams(e,t,i,r=t.params){let o=Pr.getRefCoordinates(t,i),n=Pr.getRefDimensions(t,i),a=Pr.getDimensions(e),s=e.width,l=e.height;if(r.autoScale&&!t._interactiveScaled){let i=r.autoScaleRatio,o=r.autoScaleMax,c=r.autoScaleOverlay||!1;"text"===t.type&&(i=!0);let p=1,d=n.width/s,u=n.height/l;(o||a.height>n.height||a.width>n.width)&&(i?(c?(p=Math.max(d,u),r.interactive&&(d>u?e.lockMovementX=!0:e.lockMovementY=!0)):p=Math.min(d,u),e.scaleX=p,e.scaleY=p):(e.scaleY=u,e.scaleX=d),e.setCoords(),a=Pr.getDimensions(e)),1!==p&&t.type}if(r.autoPos&&!t._interactive)if(0!==o.angle?e.angle=o.angle:0!==e.angle&&(e.angle=0),r.autoCenter)Pr.center(e,a,o,n);else{if(r.autoCenterH)Pr.centerHorizontal(e,a,o,n);else if(e.left=o.x,"text"===t.type&&!r.textBox)if("center"===r.textAlign)Pr.centerHorizontal(e,a,o,n);else if("right"===r.textAlign){let t=o.x+n.width-a.width;e.left=parseFloat(t.toFixed(2))}if(r.autoCenterV?Pr.centerVertical(e,a,o,n):e.top=o.y,0!==e.angle&&(r.autoCenterH||r.autoCenterV)){let i=new fabric.Rect({left:o.x,top:o.y,width:n.width,height:n.height,angle:e.angle}),a=r.autoCenterH?"center":"left",s=r.autoCenterV?"center":"top";"text"!==t.type||r.textBox||("center"===r.textAlign?a="center":"right"===r.textAlign&&(a="right"));let l=i.getPointByOrigin(a,s);e.setPositionByOrigin(l,a,s)}}}_addRefRect(e,t,i,r){if(Pr.isEditLayer(t,i.editorMode,i.editLayer)&&!i.cropMode)if(Pr.hasRefRect(t)){let e=this._getRefRect(t,i);r.add(e),r.uniformScaling=!1}else r.uniformScaling=!0}_getRefRect(e,t){let i=e._objectRef||new fabric.Rect,r=!("upload"===e.type&&e.params.crop);r||i.setControlsVisibility({mtr:!1});let o={visible:!0,lockUniScaling:!1,lockRotation:!r,lockMovementX:!1,lockMovementY:!1,lockScalingX:!1,lockScalingY:!1,hasControls:!0,lockScalingFlip:!0,selectable:!0,evented:!0};return o.left=void 0!==e.params.refX?e.params.refX:50,o.top=void 0!==e.params.refY?e.params.refY:50,o.width=e.params.refWidth||t.config.width-100,o.height=e.params.refHeight||t.config.height-100,o.scaleX=1,o.scaleY=1,o.angle=r&&void 0!==e.params.refAngle?e.params.refAngle:0,o.fill="#139cf6",o.opacity=.5,o._layerRef=e,i.setOptions(o),e._objectRef=i,i}_getImageUrl(e,t,i){if(i.cdnSize&&vr(e)){let r=Pr.getRefDimensions(t,i),o=Math.max(r.width,r.height),n=r.width>r.height;o=200*Math.ceil(o/200);let a=Math.min(3e3,o);return _r(e,n?a+"x":"x"+a)}return e}};var wo=e=>{const t=e.Image.filters,i=e.util.createClass;t.SwapColor=i(t.BaseFilter,{type:"SwapColor",fragmentSource:"\n            precision highp float;\n            uniform sampler2D uTexture;\n            uniform vec4 colorSource;\n            uniform vec4 colorDestination;\n            uniform float tolerance;\n            varying vec2 vTexCoord;\n\n            void main() {\n                vec4 color = texture2D(uTexture, vTexCoord);\n                vec3 sourceRGB = colorSource.rgb;\n                vec3 destRGB = colorDestination.rgb;\n\n                float colorDistance = length(sourceRGB - color.rgb);\n                bool colorMatch = colorDistance < tolerance && color.a > 0.0;\n\n                // Adjust the tolerance for alpha channel\n                if (colorMatch && abs(colorSource.a - color.a) > 0.1) {\n                    colorMatch = false;\n                }\n\n                gl_FragColor = colorMatch ? vec4(destRGB, color.a) : color;\n            }\n        ",colorSource:"rgb(255, 0, 0)",colorDestination:"rgb(0, 255, 0)",tolerance:.1,applyTo2d:function(t){var i,r=t.imageData.data,o=r.length,n=new e.Color(this.colorSource).getSource(),a=new e.Color(this.colorDestination).getSource();if(this.tolerance<=.1)for(i=0;i<o;i+=4)r[i]===n[0]&&r[i+1]===n[1]&&r[i+2]===n[2]&&(r[i]=a[0],r[i+1]=a[1],r[i+2]=a[2]);else for(i=0;i<o;i+=4){var s=r[i],l=r[i+1],c=r[i+2],p=r[i+3];Math.sqrt(Math.pow(n[0]-s,2)+Math.pow(n[1]-l,2)+Math.pow(n[2]-c,2))<this.tolerance&&p>0&&(r[i]=a[0],r[i+1]=a[1],r[i+2]=a[2])}},getUniformLocations:function(e,t){return{uColorSource:e.getUniformLocation(t,"colorSource"),uColorDestination:e.getUniformLocation(t,"colorDestination"),uTolerance:e.getUniformLocation(t,"tolerance")}},sendUniformData:function(t,i){var r=new e.Color(this.colorSource).getSource(),o=new e.Color(this.colorDestination).getSource();r[0]/=255,r[1]/=255,r[2]/=255,o[0]/=255,o[1]/=255,o[2]/=255,t.uniform4fv(i.uColorSource,r),t.uniform4fv(i.uColorDestination,o),t.uniform1f(i.uTolerance,this.tolerance)},isNeutralState:function(){return this.colorSource===this.colorDestination},toObject:function(){return e.util.object.extend(this.callSuper("toObject"),{colorSource:this.colorSource,colorDestination:this.colorDestination})}}),e.Image.filters.SwapColor.fromObject=e.Image.filters.BaseFilter.fromObject};var bo=class extends _o{render(e,t,i){e._object&&e._object.clipPath&&delete e._object.clipPath;let r={...e.params};if(e.params.option&&e.params.interactive){let i=Pr.getProductOption(e.params.option,t.options);i&&(i._layer=e)}if(e.params.optionColor){let i=Pr.getProductOption(e.params.optionColor,t.options);if(i&&i.value)if("color"===i.type)r.color=i.value;else if(i.values&&i.values.length){let e=i.values.filter((e=>e.value===i.value));e.length&&(r.color=e[0].color)}}return t.cropMode&&e.params.crop&&"upload"===e.type&&(r.autoScaleOverlay=!0),this._getImage(e,t,i,r).then((o=>{if(this._addRefRect(o,e,t,i),null==o)return o;r.color&&r.color!==e._color&&(this._colorize(o,r.color),e._color=r.color);let n=this._getOptions(e,t,r);return o.set(n),n.hasControls&&!Pr.isEditLayer(e,t.editorMode,t.editLayer)&&o.setControlsVisibility({mt:!1,mb:!1,ml:!1,mr:!1,bl:!n.lockScalingX,br:!n.lockScalingX,tl:!n.lockScalingY,tr:!n.lockScalingY,mtr:!n.lockRotation}),this._applyAutoParams(o,e,t,r),i.add(o),e._object=o,e._object}))}_getOptions(e,t,i=e.params){let r=super._getOptions(e,t,i);return i.opacity&&(r.opacity=i.opacity),r}_getImage(e,t,i,r=e.params){return e._object?Promise.resolve(e._object):new Promise(((i,o)=>{if(r.url&&-1!==r.url.indexOf(".svg"))fabric.loadSVGFromURL(r.url,((e,t)=>{void 0===e&&(a.warn("layer url not found: ",r.url),i(null));let o=fabric.util.groupSVGElements(e,t);i(o)}),null,{crossOrigin:"anonymous"});else{let o=this._getImageUrl(e.params.url,e,t);fabric.Image.fromURL(o,(e=>{if(void 0===e)return a.warn("layer url not found: ",r.url),void i(null);i(e)}),{crossOrigin:"anonymous"})}}))}_colorize(e,t){if("group"===e.type){let i=e.getObjects();for(let e=0;e<i.length;e++){i[e].set("fill",t)}}else if("path"===e.type||"circle"===e.type)e.set("fill",t);else if("image"===e.type&&e.width&&e.height){let i;e.filters&&e.filters.length?i=e.filters[0]:(void 0===fabric.Image.filters.SwapColor&&wo(fabric),i=new fabric.Image.filters.SwapColor,i.colorSource="#fff",e.filters=[i]),i.colorDestination=t,e.applyFilters()}}};var xo=class extends _o{render(e,t,i){let r;r=e.params.textBox?e._object&&"textbox"===e._object.type?e._object:new fabric.Textbox("",{editable:!1}):e._object&&"text"===e._object.type?e._object:new fabric.Text("");let n=e.params.text||"",a={...e.params};if(e.params.option){let i=Pr.getProductOption(e.params.option,t.options);if(i){i.value&&(n=i.value),i._layer=e;let r=!1;e.params.textEditor?(e._editor?a=o.extend(e.params,i._editor):e._editor=o.extend({},e.params),i._editor&&i._editor===e._editor||(i._editor=e._editor,a=o.extend(e.params,i._editor),r=!0)):i._editor&&(delete i._editor,r=!0),r&&t.productForm&&t.productForm.dispatchEvent(new CustomEvent("options:render",{detail:i,cancelable:!0,bubbles:!0}))}}if(e.params.optionFont){let i=Pr.getProductOption(e.params.optionFont,t.options);i&&i.value&&(a.fontFamily=i.value)}if(e.params.optionColor){let i=Pr.getProductOption(e.params.optionColor,t.options);if(i&&i.value)if("color"===i.type)a.color=i.value;else if(i.values&&i.values.length){let e=i.values.filter((e=>e.value===i.value));if(e.length){let t=e[0];t.color&&(a.color=t.color),t.img&&a.textPattern&&!a.urlPattern&&(a.urlPattern=t.img)}}}if(e.params.textShadow&&e.params.optionTextShadowColor){let i=Pr.getProductOption(e.params.optionTextShadowColor,t.options);if(i&&i.value)if("color"===i.type)a.textShadowColor=i.value;else if(i.values&&i.values.length){let e=i.values.filter((e=>e.value===i.value));e.length&&(a.textShadowColor=e[0].color)}}if(e.params.textStroke&&e.params.optionTextStrokeColor){let i=Pr.getProductOption(e.params.optionTextStrokeColor,t.options);if(i&&i.value)if("color"===i.type)a.textStrokeColor=i.value;else if(i.values&&i.values.length){let e=i.values.filter((e=>e.value===i.value));e.length&&(a.textStrokeColor=e[0].color)}}if(a.textVertical){let e=[];for(let t=0;t<n.length;t++)e.push(n.charAt(t));n=e.join("\n")}let s=this._getOptions(e,t,a);return s.text=n.replace(/\\n/g,"\n"),r.set(s),s.hasControls&&!Pr.isEditLayer(e,t.editorMode,t.editLayer)&&r.setControlsVisibility({mt:!1,mb:!1,ml:!1,mr:!1,bl:!s.lockScalingX,br:!s.lockScalingX,tl:!s.lockScalingY,tr:!s.lockScalingY,mtr:!s.lockRotation}),this._applyAutoParams(r,e,t,a),this._addRefRect(r,e,t,i),i.add(r),e._object=r,a.textPattern&&a.urlPattern?this._applyTextPattern(r,e,a):Promise.resolve(e._object)}_getOptions(e,t,i=e.params){let r=super._getOptions(e,t,i);if(r.fill=i.color||"#000000",r.fontSize=i.fontSize||10,r.fontFamily=i.fontFamily||"Arial",r.fontStyle=i.fontStyle?i.fontStyle:"normal",r.fontWeight=i.fontWeight?i.fontWeight:"normal",r.textAlign=i.textAlign?i.textAlign:"left",r.lineHeight=i.lineHeight?i.lineHeight:1.16,i.fontSizeFactor&&(r.fontSize*=i.fontSizeFactor),i.textStroke&&(r.stroke=i.textStrokeColor?i.textStrokeColor:"#000000",r.strokeWidth=i.textStrokeWidth?i.textStrokeWidth:1,r.strokeLineJoin=i.textStrokeLine?i.textStrokeLine:"round",r.strokeLineCap=i.textStrokeLine?i.textStrokeLine:"round",r.paintFirst="stroke"),r.charSpacing=i.letterSpacing?100*i.letterSpacing:0,r.shadow=i.textShadow?new fabric.Shadow({color:i.textShadowColor?i.textShadowColor:"#000000",blur:i.textShadowBlur?i.textShadowBlur:1,offsetX:i.textShadowOffsetX?i.textShadowOffsetX:.5,offsetY:i.textShadowOffsetY?i.textShadowOffsetY:.5}):void 0,e.params.textBox&&(Pr.hasRefRect(e)&&(i.refWidth||i.refHeight)?(r.width=i.refWidth,r.height=i.refHeight):(r.width=t.config.width,r.height=t.config.height)),e.params.textPath){let o=e.params.path||"",n=e.params.pathSide||"left",a=Pr.getRefDimensions(e,t);if("path"===e.params.pathShape)o&&(r.path=new fabric.Path(o,{fill:!1}));else if("circle_top"===e.params.pathShape){let e=Math.min(a.width,a.height)/2;o=this._describeEllipse([0,0],[e,e],[90,359.9],0),n="left",r.path=new fabric.Path(o,{fill:!1}),r.path.width+=2*r.fontSize,r.path.height+=2*r.fontSize}else if("circle_bottom"===e.params.pathShape){let e=Math.min(a.width,a.height)/2;o=this._describeEllipse([0,0],[e,e],[270,359.9],0),n="right",r.path=new fabric.Path(o,{fill:!1})}else"ellipse_top"===e.params.pathShape?(o=this._describeEllipse([0,0],[a.width/2,a.height/2],[90,359.9],0),n="left",r.path=new fabric.Path(o,{fill:!1}),r.path.width+=2*r.fontSize,r.path.height+=2*r.fontSize):"ellipse_bottom"===e.params.pathShape&&(o=this._describeEllipse([0,0],[a.width/2,a.height/2],[270,359.9],0),n="right",r.path=new fabric.Path(o,{fill:!1}));r.path&&(r.pathStartOffset=i.letterSpacing?3*i.letterSpacing:0,r.pathSide=n,Pr.isEditLayer(e,t.editorMode,t.editLayer)&&!t.cropMode&&r.path.setOptions({stroke:"rgb(178,204,255)",strokeWidth:2}))}return r}_applyTextPattern(e,t,i){return t._pattern&&t._pattern._url===i.urlPattern?(e.set("fill",t._pattern),Promise.resolve(t._object)):new Promise(((r,o)=>{fabric.Image.fromURL(i.urlPattern,(o=>{if(void 0===o)return a.warn("text layer urlPattern not found: ",i.url),void r(null);t._pattern=new fabric.Pattern({source:o._element,repeat:"repeat",offsetY:i.patternOffsetY||0,offsetX:i.patternOffsetX||0}),t._pattern._url=i.urlPattern,e.set("fill",t._pattern),r(t._object)}),{crossOrigin:"anonymous"})}))}_degreeToRadian(e){return e*Math.PI/180}_describeEllipse([e,t],[i,r],[o,n],a){o=this._degreeToRadian(o),n=this._degreeToRadian(n),a=this._degreeToRadian(a);const s=([[e,t],[i,r]],[o,n])=>[e*o+t*n,i*o+r*n],l=([e,t],[i,r])=>[e+i,t+r];n%=2*Math.PI;const c=(p=a,[[Math.cos(p),-Math.sin(p)],[Math.sin(p),Math.cos(p)]]);var p;const[d,u]=l(s(c,[i*Math.cos(o),r*Math.sin(o)]),[e,t]),[h,m]=l(s(c,[i*Math.cos(o+n),r*Math.sin(o+n)]),[e,t]),g=n>Math.PI?1:0,f=n>0?1:0;return"M "+d+" "+u+" A "+[i,r,a/(2*Math.PI)*360,g,f,h,m].join(" ")}};var Co=class extends _o{render(e,t,i){if(e.params.maskLayers&&e.params.maskLayers.length>0){i.clipPath&&delete i.clipPath;let r=[];return i.forEachObject((o=>{o._layer&&this._isMaskedLayer(e.params.maskLayers,o._layer.name)&&r.push(this._getClipPath(e,t,i,o).then((e=>{e?o.clipPath=e:delete o.clipPath,o.dirty=!0})))})),Promise.all(r)}return this._getClipPath(e,t,i).then((r=>(r?(t.mask=!0,i.clipPath=r,e._object=r):(delete i.clipPath,delete e._object),r)))}_isMaskedLayer(e,t){if(-1!==e.indexOf(t))return!0;for(let i=0;i<e.length;i++)if(t.startsWith(e[i]+"_"))return!0;return!1}_getClipPath(e,t,i,r){let o=this._getOptions(e,t),n=null;if(e.params.shape)switch(e.params.shape){case"circle":if(e._object&&"circle"!==e._object.type&&delete e._object,n=e._object||new fabric.Circle,e.params.radius)o.radius=e.params.radius;else if(!e.params.maskLayers||0===e.params.maskLayers.length){let e=t.config.width;o.radius=e/2}r&&(e.params.radius||(o.radius=r.width/2),o.left=-o.radius,o.top=-o.radius),n.setOptions(o);break;case"triangle":e._object&&"triangle"!==e._object.type&&delete e._object,n=e._object||new fabric.Triangle,e.params.maskLayers&&0!==e.params.maskLayers.length||(o.width=t.config.width,o.height=t.config.height),r&&(o.width=r.width,o.height=r.height,o.left=-o.width/2,o.top=-o.height/2),n.setOptions(o);break;case"svg":if(e.params.url){let n=null;return n=r&&r.clipPath&&r.clipPath._url===e.params.url?Promise.resolve(r.clipPath):i.clipPath&&i.clipPath._url===e.params.url?Promise.resolve(i.clipPath):new Promise(((t,i)=>{fabric.loadSVGFromURL(e.params.url,((i,r)=>{if(i){let e=fabric.util.groupSVGElements(i,r);t(e)}else a.warn("svg mask not found",e.params.url),t(null)}))})),n.then((i=>{if(i){o._url=e.params.url,o.width=i.width,o.height=i.height;let n=e.params.padding||3;if(e.params.maskLayers&&0!==e.params.maskLayers.length?r&&(o.scaleX=(r.width-n)/i.width,o.scaleY=(r.height-n)/i.height):(o.scaleX=(t.config.width-n)/i.width,o.scaleY=(t.config.height-n)/i.height),e.params.ratio||!0){let e=Math.min(o.scaleX,o.scaleY);o.scaleX=e,o.scaleY=e}r&&(o.left=-i.width*o.scaleX/2,o.top=-i.height*o.scaleY/2),i.setOptions(o)}return i}))}a.warn("svg mask missing url",e)}return Promise.resolve(n)}};var Eo=class extends bo{_findProductUrl(e,t){let i=t.product;if(e.params.imgPos){let t=parseInt(e.params.imgPos);if(!isNaN(t)&&i.images.length>t-1)return i.images[t-1]}if(e.params.variant&&t.variantId)for(let e=0;e<t.product.variants.length;e++){const i=t.product.variants[e];if(i.id.toString()===t.variantId.toString()){if(i.featured_image&&i.featured_image.src)return i.featured_image.src;break}}return i.featured_image}_getImage(e,t,i,r=e.params){if(t.product){let i=this._findProductUrl(e,t);if(i)return e._object&&e._url===i?Promise.resolve(e._object):new Promise(((r,o)=>{let n=this._getImageUrl(i,e,t);fabric.Image.fromURL(n,(t=>{void 0===t&&(a.warn("product url not found: ",i),r(null)),e._url=i,r(t)}),{crossOrigin:"anonymous"})}))}else a.warn("missing product in render context");return Promise.resolve(null)}};var So=class extends bo{_getImage(e,t,i,r=e.params){if(r.option){let o=Pr.getProductOption(r.option,t.options);if(o){if(o._layer=e,o.value){let n=o.value;if(o.params.multiple||-1!==n.indexOf(",")||r.fileIndex){let e=n.split(","),t=r.fileIndex||e.length;if(t-=1,!(e.length>t))return Promise.resolve(null);n=e[t]}let s=!1;if(e.params.layerEditor?e._context||(e._context=t,e._canvas=i,s=!0):e._context&&(delete e._context,s=!0),r.crop&&o.params.optionDimension&&o.params.dimensionCrop){let i=Pr.getProductOption(o.params.optionDimension,t.options);if(i&&i.visible&&i._controller&&i._controller.x&&i._controller.y&&(!i.errors||0===i.errors.length)){let r=Pr.getRefDimensions(e,t),o=Math.round(r.width/r.height*100)/100,n=Math.round(i._controller.x/i._controller.y*100)/100;o!==n&&(e._cropWidth=e._cropWidth||e.params.refWidth||t.config.width,e._cropHeight=e._cropHeight||e.params.refHeight||t.config.height,n>1?(e.params.refWidth=e._cropWidth,e.params.refHeight=e._cropWidth/n):(e.params.refHeight=e._cropHeight,e.params.refWidth=e._cropHeight*n),e.params.refRect=!0,e.params.refX=t.config.width/2-e.params.refWidth/2,e.params.refY=t.config.height/2-e.params.refHeight/2,!1!==e._autoCrop?t.autoCrop=e:delete e._autoCrop,dr.productCropOverlay=!1)}}return s&&t.productForm&&t.productForm.dispatchEvent(new CustomEvent("options:render",{detail:o,cancelable:!0,bubbles:!0})),!e._object||e._url!==n||!isNaN(e.params.rotate)&&e._rotate!==e.params.rotate||e.params.filters&&e._filters&&e._filters.length!==e.params.filters.length?new Promise(((i,o)=>{e._interactive&&(delete e._interactive,delete e._interactiveScaled),e.params.crop&&(t.autoCrop=e);const s=o=>{if(void 0===o&&(a.warn("upload url not found: ",n),i(null)),e._url=n,e._rotate=0,e.params.autoRotate){let i=Pr.getRefDimensions(e,t),r=o;r.width<r.height&&i.width>i.height?e._rotate=90:r.width>r.height&&i.width<i.height&&(e._rotate=-90)}if(isNaN(e.params.rotate)||(e._rotate=e.params.rotate),0!==e._rotate){o.rotate(e._rotate),e.params.rotate=e._rotate,r.canvasRotate&&(t.canvasRotate=-1*e._rotate);let n={multiplier:1,format:-1!==e._url.indexOf(".png")?"png":"jpeg",quality:1},a=o.toDataURL(n);fabric.Image.fromURL(a,(t=>{this._applyFilters(t,e).then((()=>{i(t)}))}))}else this._applyFilters(o,e).then((()=>{i(o)}))};-1!==n.indexOf(".svg")?fabric.loadSVGFromURL(n,((o,l)=>{void 0===o&&(a.warn("upload url not found: ",n),i(null));let c=fabric.util.groupSVGElements(o,l);(r.color||r.optionColor)&&(delete e._color,i(c));let p=Math.max(t.config.width/c.viewBoxWidth,t.config.height/c.viewBoxHeight),d=c.toDataURL({multiplier:Math.min(10,p),format:"png"});fabric.Image.fromURL(d,(e=>{s(e)}))}),null,{crossOrigin:"anonymous"}):fabric.Image.fromURL(n,s,{crossOrigin:"anonymous"})})):(e.params.autoRotate&&0!==e._rotate&&r.canvasRotate&&(t.canvasRotate=-1*e._rotate),Promise.resolve(e._object))}}else a.warn("no upload option found for layer",e)}else a.warn("missing option for layer",e);return Promise.resolve(null)}_applyFilters(e,t){let i=Promise.resolve(null);if(t.params.filters&&t.params.filters.length){let r=[...t.params.filters];if(e.width>fabric.textureSize||e.height>fabric.textureSize){let t=Math.max(e.height,e.width);fabric.textureSize=t>4096?t:4096}if(!t.params.urlFilter||t._urlFilterImage&&t._urlFilter===t.params.urlFilter||(i=i.then((()=>new Promise(((e,i)=>{fabric.Image.fromURL(t.params.urlFilter,(i=>{i&&(t._urlFilter=t.params.urlFilter,t._urlFilterImage=i),e()}),{crossOrigin:"anonymous"})}))))),t.params.urlFilter&&-1!==r.indexOf("pattern")&&(i=i.then((()=>new Promise(((i,r)=>{let o=t._urlFilterImage.getElement(),n=e.getScaledWidth(),a=e.getScaledHeight(),s=new fabric.Rect({width:n,height:a});s.set("fill",new fabric.Pattern({source:o,repeat:"repeat"}));let l=s.toDataURL();fabric.Image.fromURL(l,(e=>{e&&(t._urlFilterImagePattern=e),i()}))})))),-1!==r.indexOf("removeWhite")&&(i=i.then((()=>new Promise(((i,r)=>{e.applyFilters([new fabric.Image.filters.RemoveColor({threshold:.2})]),fabric.Image.fromURL(e.toDataURL(),(e=>{e&&(t._urlFilterImageBlend=e,t._removeWhiteSkip=!0),i()}))})))))),-1!==r.indexOf("removeBg")&&t.params.removeBgKey){let r=e.getSrc(!1),o=r.substring(r.lastIndexOf(".")).toLowerCase();".jpg"!==o&&".jpeg"!==o&&".png"!==o||(i=i.then((()=>new Promise(((i,o)=>{new n("https://api.remove.bg/v1.0/removebg",{method:"POST",responseType:"blob",headers:{"X-API-Key":t.params.removeBgKey,"Content-type":"application/x-www-form-urlencoded"},data:{image_url:r,size:t.params.removeBgSize||window.clRemoveBgSize||"auto",type:"auto"}}).then((r=>{const o=URL.createObjectURL(r.data);let n=new Image;n.onload=()=>{e.setElement(n),t._removeBg=!0,i()},n.src=o})).catch((e=>{a.error(e),i()}))})))))}i.then((()=>{e.filters||(e.filters=[]);for(let i=0;i<r.length;i++){let o;switch(r[i]){case"pattern":if(t._urlFilterImagePattern){let i=t._urlFilterImageBlend;i||(i=new fabric.Image,i.setElement(e.getElement())),e.setElement(t._urlFilterImagePattern.getElement()),o=new fabric.Image.filters.BlendImage({image:i,mode:"mask"}),o._sort=7}break;case"multiply":t._urlFilterImage&&(o=new fabric.Image.filters.BlendImage({image:t._urlFilterImage,mode:"multiply",alpha:t.params.alphaFilter||.5}),o._sort=6);break;case"invert":o=new fabric.Image.filters.Invert,o._sort=2;break;case"grayscale":o=new fabric.Image.filters.Grayscale,o._sort=6;break;case"sepia":o=new fabric.Image.filters.Sepia,o._sort=5;break;case"removeWhite":if(t._removeWhiteSkip)break;o=new fabric.Image.filters.RemoveColor({threshold:.2}),o._sort=1}o&&e.filters.push(o)}e.filters.length&&e.filters.sort(((e,t)=>(e._sort||100)>(t._sort||100)?1:-1)),t._filters=[...r],e.applyFilters()}))}return i}};var Io=class extends bo{_getImage(e,t,i,r=e.params){let o=r.text||"";if(r.option){let e=Pr.getProductOption(r.option,t.options);e&&e.value&&(o=e.value)}if(o){let i=a.getLevel();if(i<=a.levels.DEBUG&&console.time("====> QR RENDER"),e._object&&e._qrText===o)return i<=a.levels.DEBUG&&console.timeEnd("====> QR RENDER"),Promise.resolve(e._object);{let n=[t.assets+"/static/lib/easyqrcodejs/easy.qrcode.min.js"];return $r.loadOnce(n,"qrcode",{async:!1}).then((()=>new Promise(((n,s)=>{let l=(t,r)=>{i<=a.levels.DEBUG&&console.timeEnd("====> QR RENDER"),fabric.Image.fromURL(r,(t=>{if(void 0===t)return a.warn("qr image invalid"),void n(null);e._qrText=o,n(t)}))};if(e._qrDiv||(e._qrDiv=document.createElement("div")),t.editorMode&&e._qrCode&&(e._qrCode.clear(),delete e._qrCode),e._qrCode)e._qrCode._htOption.onRenderingEnd=l,e._qrCode._oDrawing._htOption.onRenderingEnd=l,e._qrCode.makeCode(o);else{let i=Math.min(t.config.width/2,1e3),n={text:o,width:i,height:i,onRenderingEnd:l};r.url&&(n.logo=r.url,n.crossOrigin="anonymous"),e._qrCode=new QRCode(e._qrDiv,n)}}))))}}return Promise.resolve(null)}};class Po{}Po.renderers={},Po.renderers.overlay=new bo,Po.renderers.text=new xo,Po.renderers.mask=new Co,Po.renderers.product=new Eo,Po.renderers.upload=new So,Po.renderers.qrcode=new Io;var Mo=Po;var Oo=class{destroy(){this.element.removeChild(this._wrapper)}render(){ee((this.settings.product,this.config.uuid,te`
<div class="cl-po--preview"> 
    <canvas class="cl-po--canvas"></canvas>
</div>
`),this._wrapper)}_renderContext(){return{config:this.previewConfig,options:this.config.options,product:this.settings.product,assets:this.settings.assets,productForm:this._productForm,variantId:this.settings.variantId,editorMode:this.settings.editorMode,editLayer:this.settings.editLayer,cropMode:this.settings.cropMode,cropLayer:this.settings.cropLayer,mask:!1,cdnSize:dr.previewCdnSize}}renderPreview(){let e=()=>{let e=a.getLevel();e<=a.levels.DEBUG&&console.time("====> RENDER PREVIEW "+this.previewConfig.position);let t=this._renderContext(),i=null;if(!this.static){let e=this._canvas.getActiveObject();this._canvas.discardActiveObject(),e&&(i=e._layer)}return this._rotateGroup&&this._rotateGroup.forEachObject((e=>{this._rotateGroup.remove(e)})),this._canvas.clear(),this._renderLayers(this.previewConfig.layers,t).then((()=>(this._canvas.clipPath&&!t.mask&&delete this._canvas.clipPath,i?this.selectLayer(i.name,!1):Pr.hasEditLayer(this.settings.editorMode,this.settings.editLayer)&&this.selectLayer(this.settings.editLayer,!1),void 0!==t.canvasRotate&&(this._rotateGroup=new fabric.Group(this._canvas.getObjects()),this._rotateGroup.rotate(t.canvasRotate),this._rotateGroup.setCoords()),this._canvas.renderAll(),e<=a.levels.DEBUG&&console.timeEnd("====> RENDER PREVIEW "+this.previewConfig.position),this._responsiveCanvasHeight(),this._syncThemeGallery(),this._triggerEvent("preview:rendered",this),t)))};return null==this._renderQueue&&(this._renderQueue=Promise.resolve()),this._renderQueue=this._renderQueue.then((()=>this._loadUsedFonts())).then((()=>e())),this._renderQueue}downloadBlob(e,t){const i=URL.createObjectURL(e),r=document.createElement("a");r.href=i,r.download=t||"download";const o=function(e){setTimeout((()=>{URL.revokeObjectURL(i),this.removeEventListener("click",o)}),150)};return r.addEventListener("click",o,!1),r.click(),r}export(t,i,r,o,n="jpeg",s=.8,l=!0){if(this._canvas){let p=a.getLevel();p<=a.levels.DEBUG&&console.time("====> EXPORT PREVIEW");let u,h=!1,m=0;if(this._canvas.forEachObject((e=>{e._layer&&(e.visible?!0===e._layer.params[o]?(e.visible=!1,e._visible=!0,h=!0):"product"!==e._layer.type&&m++:e._layer.params.exportOnly&&(e.visible=e._layer._visibleCondition,e._visible=!1,!0===e._layer.params[o]&&(e.visible=!1),h=!0))})),l&&0===m)return a.debug("==> no visible layers - skipping export"),h&&this._canvas.forEachObject((e=>{void 0!==e._visible&&(e.visible=e._visible,delete e._visible)})),null;if(this._canvas.renderAll(),"svg"===n){let e={width:t.width,height:t.height};i&&(e.viewBox={x:i.x,y:i.y,width:i.width,height:i.height});let o=this._canvas.toSVG(e);if(dr.previewCdnSize){let e,t=/xlink:href="([^"]+)"/g,i=[];for(;e=t.exec(o);)-1!==e[1].indexOf("cdn.shopify.com")&&i.push(e[1]);for(const e of i){let t=e.replace(/_x\d+\./,".").replace(/_\d+x\./,".");t!==e&&(a.debug("SVG export removed size from CDN url: ",e,t),o=o.replace(e,t))}}var c=[];for(let e=0;e<document.styleSheets.length;e++){const t=document.styleSheets[e];t.href&&(-1!==t.href.indexOf("fonts.googleapis.com")?c.push(t.href+"&subset="+(window.clExportFontSubset||"latin-ext,cyrillic-ext,greek-ext,japanese,hebrew")):-1!==t.href.indexOf(d.api)&&c.push(t.href))}if(c.length){let e=`<style type="text/css"><![CDATA[\n                            ${c.map((e=>`@import url("${e}");`)).join("\n")}\n                        ]]></style>`,t=o.indexOf("</defs>");o=o.substring(0,t)+e+o.substring(t)}u=r?new Blob([o],{type:"image/svg+xml"}):o}else{let o={multiplier:t.width/this._canvas.getWidth(),format:n,quality:s};i&&(o.left=i.x/o.multiplier,o.top=i.y/o.multiplier,o.width=i.width/o.multiplier,o.height=i.height/o.multiplier);let a=this._canvas.toDataURL(o);u=r?e(go)(a):a}return h&&(this._canvas.forEachObject((e=>{void 0!==e._visible&&(e.visible=e._visible,delete e._visible)})),this._canvas.renderAll()),p<=a.levels.DEBUG&&console.timeEnd("====> EXPORT PREVIEW"),u}return null}exportLayer(t,i,r="jpeg",o=.8){let n=this._canvas.getObjects();for(let s=0;s<n.length;s++){const l=n[s];if(l._layer&&l._layer.name===t){let t={multiplier:1,withoutTransform:!0,format:r,quality:o},n=l.clipPath;if(n){l.clipPath=null;let e=n.getBoundingRect(!0,!0);a.debug("crop rect",e);let i=l.getBoundingRect(!0,!0);a.debug("bounding rect",i);let r=l.width/l.getScaledWidth();t.left=Math.round((e.left-i.left)*r),t.top=Math.round((e.top-i.top)*r),t.width=Math.round(e.width*r),t.height=Math.round(e.height*r),t.left=Math.max(t.left,0),t.top=Math.max(t.top,0),t.width=Math.min(t.width,l.width-t.left),t.height=Math.min(t.height,l.height-t.top)}let s,c=l.toDataURL(t);return s=i?e(go)(c):c,n&&(l.clipPath=n),s}}return null}exportLayerCoords(e){let t=this._canvas.getObjects();for(let i=0;i<t.length;i++){const r=t[i];if(r._layer&&(r._layer.name===e||r._layer.name.startsWith(e+"_")))return{x:Math.round(r.left),y:Math.round(r.top),w:Math.round(r.getScaledWidth()),h:Math.round(r.getScaledHeight()),r:Math.round(r.angle)}}return null}clear(){this._canvas&&this._canvas.clear()}updateConfig(e){let t=!1;return this.previewConfig.width===e.width&&this.previewConfig.height===e.height||(t=!0),this.previewConfig=e,t&&this._setDimensions(),this.renderPreview()}selectLayer(e,t=!0,i=this.previewConfig.layers){for(let r=0;r<i.length;r++){const o=i[r];if(o.layers&&o.layers.length>0&&this.selectLayer(e,t,o.layers))return!0;if(o.name===e&&o._object&&(Pr.isEditLayer(o,this.settings.editorMode,this.settings.editLayer)&&(this._canvas.preserveObjectStacking=!1,delete o._interactive),this._canvas.contains(o._object)))return this._canvas.setActiveObject(o._object),t&&this._canvas.renderAll(),!0}return!1}deSelect(e=!0){this._canvas.discardActiveObject(),this.settings.editorMode&&!this._canvas.preserveObjectStacking&&(this._canvas.preserveObjectStacking=!0),e&&this._canvas.renderAll()}_init(){this._wrapper=document.createElement("div"),this._wrapper.className=this.settings.classNamePrefix+"--preview-wrapper",this._wrapper.setAttribute("id",this.config.uuid+"_preview"),this._wrapper.style.width="100%",this.settings.position?(this.element.insertAdjacentElement(this.settings.position,this._wrapper),this.element!==this._wrapper.parentNode&&(this.element=this._wrapper.parentNode)):this.element.appendChild(this._wrapper),this.render(),this._preview=this._wrapper.querySelector("."+this.settings.classNamePrefix+"--preview"),this._preview.classList.add("cl-hide");let e=this._wrapper.querySelector("."+this.settings.classNamePrefix+"--canvas");this.static=this._isStatic(),fabric.devicePixelRatio<2&&(fabric.devicePixelRatio=2),window.clPreviewRatio&&(fabric.devicePixelRatio=parseInt(window.clPreviewRatio)),fabric.Object.NUM_FRACTION_DIGITS=8,fabric.enableGLFiltering=!1,window.clPreviewGLFilter&&(fabric.enableGLFiltering=!0),this.static?(this._canvas=new fabric.StaticCanvas(e),this.settings.zoom?.enabled&&this._watchZoom()):(fabric.isTouchSupported&&this._patchCanvasTouchScroll(),this._updateCanvasControls(),this._canvas=new fabric.Canvas(e,{selection:!1,preserveObjectStacking:!0,allowTouchScrolling:!0}),this._subscribeCanvasEvents()),this._setDimensions(),this.renderPreview().then((()=>{this._watchFormChanges(),this._watchWindowResize(),this._watchWindowScroll(),this._preview.classList.remove("cl-hide")})).catch((e=>{a.error("[live-options] failed render preview",e)}))}_setDimensions(){let e=this._canvas.getZoom();1!==e&&this._canvas.setZoom(1);let t=fabric.devicePixelRatio,i=this.previewConfig.width*this.previewConfig.height,r=window.clPreviewMaxRetina||9e6;t>1&&i>r&&o.isMobile(o.getAgent())&&(this._canvas.enableRetinaScaling=!1),this._canvas.setDimensions({width:this.previewConfig.width,height:this.previewConfig.height}),1!==e&&this._resizeCanvas()}_renderLayers(e,t){let i=Promise.resolve();for(let r=0;r<e.length;r++){const o=e[r];i=i.then((()=>this._renderLayer(o,t)))}return i}_renderLayer(e,t){let i=!0;if(e.conditions&&e.conditions.length&&(i=this.conditionsEngine.evaluateConditions(e.conditions,e.conditionMode||yo.MODE.AND,"layer.name="+e.name)),this.settings.editorMode&&this.visibleEditor.hasOwnProperty(e.name)&&(i=this.visibleEditor[e.name]),this.visible[e.name]=i,e.params.preload&&"overlay"===e.type&&(e._visible=i,i=!0),e.params.exportOnly&&(e._visible=Pr.isEditLayer(e,this.settings.editorMode,this.settings.editLayer),e._visibleCondition=i,i=!0),i){if(a.debug("rendering layer: ",e),e.layers&&e.layers.length>0)return this._renderLayers(e.layers,t);let i=Mo.renderers[e.type];if(i)return i.render(e,t,this._canvas)}return Promise.resolve()}_loadUsedFonts(){let e=[];for(let t=0;t<this.previewConfig.layers.length;t++){const i=this.previewConfig.layers[t];if("text"===i.type){if(i.params.fontFamily&&e.push(i.params.fontFamily),i.params.option&&i.params.textEditor){let t=Pr.getProductOption(i.params.option,this.config.options);t&&t._editor&&t._editor.fontFamily&&e.push(t._editor.fontFamily)}if(i.params.optionFont){let t=Pr.getProductOption(i.params.optionFont,this.config.options);t&&t.value&&e.push(t.value)}}}return e.length>0?d.loadFontsByName(e):Promise.resolve(!0)}_isStatic(){if(this.settings.editorMode)return!1;for(let e=0;e<this.previewConfig.layers.length;e++){const t=this.previewConfig.layers[e];if(t.params.interactive||t.params.crop&&"upload"===t.type)return!1}return!0}_watchFormChanges(){this._productForm?(this._productForm.addEventListener("option:changed",(e=>this._optionChanged(e))),this._productForm.addEventListener("option:crop",(e=>this._optionCrop(e))),this._productForm.addEventListener("option:export",(e=>this._optionExport(e))),this._productForm.addEventListener("option:variant_changed",(e=>this._variantChanged(e)))):a.warn("product-preview no productForm found for config: "+this.config.uuid)}_subscribeCanvasEvents(){let e=a.getLevel();this._canvas.on("object:modified",(t=>{let i=t.target;if(e<=a.levels.TRACE&&a.debug("object:modified",i),i._layer){let t=i._layer,r=t.params;r.x=Math.round(i.left),r.y=Math.round(i.top),e<=a.levels.TRACE&&a.debug("=> layer x,y = ",r.x,r.y),r.crop?(r.scaleX=i.scaleX,r.scaleY=i.scaleY):(r.scaleX=parseFloat(i.scaleX.toFixed(3)),r.scaleY=parseFloat(i.scaleY.toFixed(3))),0!==i.angle&&(r.angle=Math.round(i.angle)),t._editor&&(o.merge(t._editor,t.params,["x","y","scaleX","scaleY","angle"]),this._productForm&&this._productForm.dispatchEvent(new CustomEvent("options:render",{detail:null,cancelable:!0,bubbles:!0}))),this._triggerEvent("layer:changed",t)}else if(i._layerRef){let e=i._layerRef.params;if(e.refX=Math.round(i.left),e.refY=Math.round(i.top),e.refWidth=Math.round(i.getScaledWidth()),e.refHeight=Math.round(i.getScaledHeight()),0!==i.angle){e.refAngle=Math.round(i.angle);let t=4;(e.refAngle<=t||e.refAngle>=360-t)&&(e.refAngle=0)}else e.refAngle=0;a.debug("updated layer rectRef params",e),this._triggerEvent("layer:changed",i._layerRef),this.renderPreview()}})),this._canvas.on("object:moving",(t=>{let i=t.target;if(e<=a.levels.TRACE&&a.debug("object:moving",i),i._layer){let t=i._layer,r=t.params,o=Pr.isCropLayer(t,this.settings.cropLayer,this.settings.cropLayer);if(o||r.interactive&&!Pr.isEditLayer(t,this.settings.editorMode,this.settings.editLayer)){t._interactive=!0;let n={x:0,y:0},s={x:this.previewConfig.width,y:this.previewConfig.height},l={width:this.previewConfig.width,height:this.previewConfig.height};Pr.hasRefRect(t)&&(n.x=r.refX,n.y=r.refY,s.x=r.refX+r.refWidth,s.y=r.refY+r.refHeight,l.width=r.refWidth,l.height=r.refHeight);let c=i.getBoundingRect(!0,!0);if(e<=a.levels.TRACE&&a.debug("boundingRect = ",c),r.interactiveBox||o){let e=r.autoScaleOverlay||o;e&&t._interactiveScaled&&(c.width<l.width||c.height<l.height)&&(e=!1),e?(n.x-=c.width-l.width,n.y-=c.height-l.height,s.x-=l.width,s.y-=l.height):(s.x-=c.width,s.y-=c.height)}else{let e=50/this._canvas.getZoom();n.x-=c.width-e,n.y-=c.height-e,s.x-=e,s.y-=e}c.left<n.x?(0!==i.angle?i.setPositionByOrigin({x:n.x+c.width/2,y:i.getCenterPoint().y},"center","center"):i.left=n.x,e<=a.levels.TRACE&&a.debug("=> reset object.left  = ",i.left)):c.left>s.x&&(0!==i.angle?i.setPositionByOrigin({x:s.x+c.width/2,y:i.getCenterPoint().y},"center","center"):i.left=s.x,e<=a.levels.TRACE&&a.debug("=> reset object.left  = ",i.left)),c.top<n.y?(0!==i.angle?i.setPositionByOrigin({x:i.getCenterPoint().x,y:n.y+c.height/2},"center","center"):i.top=n.y,e<=a.levels.TRACE&&a.debug("=> reset object.top  = ",i.left)):c.top>s.y&&(0!==i.angle?i.setPositionByOrigin({x:i.getCenterPoint().x,y:s.y+c.height/2},"center","center"):i.top=s.y,e<=a.levels.TRACE&&a.debug("=> reset object.top  = ",i.left))}}}));const t=t=>{let i=t.target;if(e<=a.levels.TRACE&&a.debug("object:scaling",i),i._layer){let r=i._layer,o=r.params;if(o.interactive&&!Pr.isEditLayer(r,this.settings.editorMode,this.settings.editLayer)&&(r._interactive=!0,r._interactiveScaled=!0,o.resizable&&(i.lockMovementX=!1,i.lockMovementY=!1),o.interactiveBox)){let n={x:0,y:0},s={x:this.previewConfig.width,y:this.previewConfig.height};Pr.hasRefRect(r)&&(n.x=o.refX,n.y=o.refY,s.x=o.refX+o.refWidth,s.y=o.refY+o.refHeight);let l=i.getBoundingRect(!0,!0);e<=a.levels.TRACE&&a.debug("boundingRect = ",l);let c=null,p=20;if(t.transform&&t.transform.corner&&("tr"==t.transform.corner?(n.x-=p,s.y+=p):"tl"==t.transform.corner?(s.x+=p,s.y+=p):"br"==t.transform.corner?(n.x-=p,n.y-=p):"bl"==t.transform.corner&&(s.x+=p,n.y-=p)),Math.floor(l.left)<n.x){c=(i.aCoords.tr.x-n.x)/(l.width/i.scaleX),0!==i.angle?i.setPositionByOrigin({x:n.x+l.width/2,y:i.getCenterPoint().y},"center","center"):i.left=n.x}else if(Math.floor(l.left+l.width)>s.x){let e=s.x-l.left;c=e/(l.width/i.scaleX),0!==i.angle?i.setPositionByOrigin({x:s.x-e+l.width/2,y:i.getCenterPoint().y},"center","center"):i.left=s.x-e}if(Math.floor(l.top)<n.y){c=(l.top+l.height-n.y)/(l.height/i.scaleY),0!==i.angle?i.setPositionByOrigin({x:i.getCenterPoint().x,y:n.y+l.height/2},"center","center"):i.top=n.y}else if(Math.floor(l.top+l.height)>s.y){let e=s.y-l.top;c=e/(l.height/i.scaleY),0!==i.angle?i.setPositionByOrigin({x:i.getCenterPoint().x,y:s.y-e+l.height/2},"center","center"):i.top=s.y-e}null!=c&&(i.scaleX=c,i.scaleY=c,i.setCoords(),this._canvas.requestRenderAll(),e<=a.levels.TRACE&&a.debug("=> reset object.scale  = ",c))}}};this._canvas.on("object:scaling",t),this._canvas.on("object:scaled",t),this._canvas.on("selection:created",(t=>{let i=t.selected?t.selected[0]:null;e<=a.levels.TRACE&&a.debug("selection:created",i),i._layer?this._triggerEvent("layer:selected",i._layer):i._layerRef&&this._triggerEvent("layer:selected",i._layerRef)})),this._canvas.on("selection:updated",(t=>{let i=t.selected?t.selected[0]:null;e<=a.levels.TRACE&&a.debug("selection:updated",i),i._layer?this._triggerEvent("layer:selected",i._layer):i._layerRef&&this._triggerEvent("layer:selected",i._layerRef)})),this._canvas.on("selection:cleared",(t=>{e<=a.levels.TRACE&&a.debug("selection:cleared")}))}_variantChanged(e){this.settings.variantId=e.detail.variantId,this._clearVisibleEditor(),this.renderPreview().then((t=>{this.static||!this.settings.cropMode&&t.autoCrop&&this._optionCrop(e,t.autoCrop)}))}_optionChanged(e){let t=e.detail;this._clearVisibleEditor(),this.renderPreview().then((i=>{this.static||(!this.settings.cropMode&&i.autoCrop?this._optionCrop(e,i.autoCrop):t._layer&&t._layer.params.interactive&&this.selectLayer(t._layer.name,!1))}))}_optionCrop(e,t){let i=e.detail;if(this.active){if(!t){let e=this._canvas.getObjects();for(let r=0;r<e.length;r++){const o=e[r];if(o._layer&&o._layer.params.option===i.name&&o._layer.params.crop){t=o._layer;break}}}if(this.settings.cropMode){this.settings.cropMode=!1,this.settings.cropLayer="";let e=this._getContainerWidth()/this.previewConfig.width;this.settings.maxHeight&&(e=this.settings.maxHeight/this.previewConfig.height),this._canvas.setViewportTransform([e,0,0,e,0,0]),this._highlight(!1),this._wrapper.removeChild(this._cropEl),delete this._cropEl}else{if(!t)return;this.settings.cropMode=!0,this.settings.cropLayer=t.name;let e=t.params,r={width:this.previewConfig.width,height:this.previewConfig.height},n={x:t._object.left,y:t._object.top,scaleX:t._object.scaleX,scaleY:t._object.scaleY,rotate:0|t.params.rotate},a={_interactive:t._interactive,_interactiveScaled:t._interactiveScaled};if(delete t._interactive,delete t._interactiveScaled,Pr.hasRefRect(t)){let i=this._renderContext(),o=Pr.getRefDimensions(t,i),n=Pr.getRefCoordinates(t,i),a=100;window.innerWidth<500&&(a=50,this.settings.maxHeight&&this.settings.maxHeight<200&&(a=20));let s=Math.min((this._canvas.getWidth()-a)/o.width,(this._canvas.getHeight()-a)/o.height);if(s>this._canvas.getZoom()){s=Math.min(s,2);let e=n.x+o.width/2,t=n.y+o.height/2,i=-e*s+this._canvas.getWidth()/2,r=-t*s+this._canvas.getHeight()/2;this._canvas.setViewportTransform([s,0,0,s,i,r])}r.width=e.refWidth,r.height=e.refHeight}if(this._cropEl=document.createElement("div"),!1!==window.clCropHelp){this._cropEl.classList.add("cl-po--crop-help"),"ontouchstart"in window||navigator.msMaxTouchPoints?this._cropEl.classList.add("touch"):this._cropEl.classList.add("cursor");const e=()=>{this._cropEl&&(this._cropEl.classList.remove("cl-po--crop-help"),this._canvas.off("object:moving",e),window.clCropHelp=!1)};this._canvas.on("object:moving",e),setTimeout(e,9e3)}const s=()=>{t._interactive=!0,t._interactiveScaled=!0,this._canvas.fire("object:modified",{target:t._object}),this._optionCrop({detail:i},t)};this._productForm.addEventListener("option:crop:apply",(e=>{this.settings.cropMode&&s()}),{once:!0}),ee(fo((e=>{let i=t._object;t._interactiveScaled=!0;let o=Math.min(r.width,r.height)/10,n=o/i.width;if(e)i.scaleX+=n,i.scaleY+=n,i.left-=o/2,i.top-=o/2;else{if(i.scaleX-=n,i.scaleY-=n,t.params.autoScaleOverlay&&(Math.round(i.getScaledWidth())<r.width||Math.round(i.getScaledHeight())<r.height))return i.scaleX+=n,void(i.scaleY+=n);i.left+=o/2,i.top+=o/2}this._canvas.fire("object:moving",{target:t._object}),this._canvas.renderAll()}),(e=>{t.params.rotate=t.params.rotate|t._rotate|0,t.params.rotate+=e,t.params.rotate=t.params.rotate%360,this.renderPreview()}),(()=>{o.merge(t.params,n),o.merge(t,a),this._optionCrop({detail:i})}),s),this._cropEl),this._wrapper.appendChild(this._cropEl),this._highlight(!0);let l=this._wrapper.getBoundingClientRect();l.top<0&&window.scrollTo&&window.scrollTo(l.left,l.top+window.scrollY-50)}this._canvas.discardActiveObject(),this.renderPreview().then((()=>{this.settings.cropMode&&this.selectLayer(this.settings.cropLayer)}))}}_optionExport(e){let t=e.detail,i=this.previewConfig;if(t.params.exportView&&t.params.exportView!==i.name)return;let r=!(!i.exportConfig.crop||!i.exportConfig.cropConfig.width)&&i.exportConfig.cropConfig,o=i.exportConfig.originalFormat||"png",n=this.export({width:i.width,height:i.height},r,!0,"excludeOriginal",o,.8,!1);n&&this.downloadBlob(n,(t.params.exportName||i.name)+"."+o)}_clearVisibleEditor(){this.settings.editorMode&&(this.visibleEditor={})}_optionLayerUpdate(e){if(e._layer&&e._layer._object){let t=this._canvas.getObjects().indexOf(e._layer._object);return this._canvas.remove(e._layer._object),this._renderLayer(e._layer).then((e=>{this._canvas.moveTo(e,t)}))}}_watchWindowResize(){let e=o.debounced(200,(e=>{this._resizeCanvas(),this.settings.stickyMode&&this._stickyPreview(!0)}));this._resizeCanvas(),window.addEventListener("resize",e)}_watchWindowScroll(){let e=!1;window.addEventListener("scroll",(()=>{e||(this.settings.sticky||this._highlightEl)&&(window.requestAnimationFrame((()=>{this.settings.sticky&&this._stickyPreview(),this._highlightEl&&this._highlight(!0),e=!1})),e=!0)})),this.settings.sticky&&window.addEventListener("preview:active",(()=>this._stickyPreview()))}_getContainerWidth(){let e=this._wrapper.offsetWidth,t=this._wrapper;for(;0===e&&t.parentNode;)t=t.parentNode,t.offsetWidth>0&&(e=o.findInnerDimensions(t).width);return e}_responsiveCanvasHeight(){if(!this.settings.cropMode){let e=0;this._canvas.forEachObject((t=>{if(t.visible&&t._layer&&t._layer.params.responsive){let i=t.getBoundingRect(),r=i.top+i.height;r>e&&(e=r)}}));let t=this.previewConfig.height*this._canvas.getZoom();e>0&&e<t?this._canvas.setHeight(e):this._canvas.setHeight(t)}}_resizeCanvas(){const e=this._canvas.getWidth()/this._canvas.getHeight(),t=this._getContainerWidth();let i=t/this._canvas.getWidth(),r=this._canvas.getZoom()*i;if(1!==r){let o={width:t,height:t/e};this.settings.maxHeight&&o.height>this.settings.maxHeight&&(o.height=this.settings.maxHeight,o.width=o.height*e,i=o.width/this._canvas.getWidth(),r=this._canvas.getZoom()*i),this._canvas.setDimensions(o),this._canvas.setZoom(r)}this._highlightEl&&this._highlight(!0)}_highlight(e){if(dr.productCropOverlay&&!o.findParent(this.element,".cl-po--popup-preview")||(e=!1),!e&&this._highlightEl&&(document.body.removeChild(this._highlightEl),delete this._highlightEl,document.body.classList.remove("cl-highlight")),e){let e=!1;this._highlightEl||(this._highlightEl=document.createElement("div"),this._highlightEl.className="cl-po--preview-highlight",e=!0);let t=o.getCalculatedPosition(this._wrapper);const i=20,r=t.right-t.left+i,n=t.bottom-t.top+i;this._highlightEl.style.display="block",this._highlightEl.style.position="absolute",this._highlightEl.style.width=`${r}px`,this._highlightEl.style.height=`${n}px`,this._highlightEl.style.top=t.top-i/2+"px",this._highlightEl.style.left=t.left-i/2+"px",e&&(document.body.appendChild(this._highlightEl),document.body.classList.add("cl-highlight"))}}_stickyPreview(e=!1){let t=this._canvas.lowerCanvasEl,i=t.getBoundingClientRect(),r=this._stickyMaxTop||0;if(i.top>r||!this.active||this.settings.cropMode||this.settings.zoomMode||0===i.width||0===i.height)this.settings.stickyMode&&(a.debug("----\x3e sticky end",t),this.element.removeEventListener("layer:changed",this._syncSticky),this.element.removeEventListener("preview:rendered",this._syncSticky),document.body.removeChild(this._stickyEl),delete this._stickyEl,delete this._stickyImgEl,delete this._stickyTarget,delete this._stickyMaxTop,this.settings.stickyMode=!1);else{let r,n,s=!1,l=window.clStickyMobileSize||this.settings.stickyMobileSize||25;this._stickyTarget=this._stickyTarget||document.querySelector("#"+this.config.uuid);let c=this._stickyTarget.getBoundingClientRect();if(c.top>i.bottom&&window.innerWidth<=768&&(s=!0,r=window.innerHeight/100*l,n="overlay"===this.settings.stickyMobile?r:0),this.settings.stickyMode){let t=this._stickyEl.getBoundingClientRect();if(c.bottom>0){let e=t.height-c.bottom;this._stickyEl.style.top=e>0?-1*e+"px":"0px"}else this._stickyEl.style.top=-1*(t.height+5)+"px";e&&(s?(this._stickyEl.classList.add("mobile"),this._stickyEl.classList.add(this.settings.stickyMobile),this._stickyEl.style.removeProperty("left"),this._stickyEl.style.removeProperty("width"),this._stickyImgEl.style.maxHeight=r+"px",this._stickyMaxTop=-1*(i.height-n)):(this._stickyEl.classList.remove("mobile"),this._stickyImgEl.style.removeProperty("height"),this._stickyEl.style.left=i.left+"px",this._stickyEl.style.width=i.width+"px"))}else if(a.trace("---\x3e sticky check"+c.bottom+" > "+i.bottom),c.bottom>i.bottom){if(s){if(i.bottom>n)return;this._stickyMaxTop=-1*(i.height-n)}this._stickyEl=document.createElement("div"),this._stickyEl.className="cl-po--preview-sticky",this._stickyEl.style.position="fixed",this._stickyImgEl=document.createElement("img"),s?(this._stickyEl.classList.add("mobile"),this._stickyEl.classList.add(this.settings.stickyMobile),this._stickyImgEl.style.maxHeight=r+"px"):(this._stickyEl.style.left=i.left+"px",this._stickyEl.style.width=i.width+"px"),this._stickyEl.style.top="0px",this._stickyEl.addEventListener("click",(e=>{let i=o.getCalculatedPosition(t);window.scroll({top:i.top-50,behavior:"smooth"})})),this._stickyEl.appendChild(this._stickyImgEl),this._syncSticky(),document.body.appendChild(this._stickyEl),this.element.addEventListener("layer:changed",this._syncSticky),this.element.addEventListener("preview:rendered",this._syncSticky),this.settings.stickyMode=!0,a.debug("--\x3e sticky start",this._stickyEl,this._stickyTarget)}}}_syncThemeGallery(){if(dr.themeGallery&&!this.settings.editorMode){if(this.shopifyStore.isTheme("Dawn")){let e=o.findParent(this.element,"media-gallery");if(e&&e.setActiveMedia){let t=o.findParent(this.element,".product__media-item");if(t&&t.dataset.mediaId){this.element.scrollIntoView=function(){},e.setActiveMedia(t.dataset.mediaId,!0);let i=o.findParent(this.element,".slider");return i&&i.scrollTo&&(i.scrollLeft=0),window._scrollTo=window._scrollTo||window.scrollTo,void(window.scrollTo=function(){window.scrollTo=window._scrollTo})}}}try{if(!1!==this._themeGalleryImgEl){if(this._themeGalleryVariant&&this.settings.variantId!==this._themeGalleryVariant)return void(this._themeGalleryVariant=this.settings.variantId);if(!this._themeGalleryImgEl)if(void 0===this.previewConfig.views||this.previewConfig.gallery&&!0!==this.config.previewConfig.galleryConfig.hideThumbnails)this._themeGalleryImgEl=!1;else{let t;if(this.settings.product.media&&this.settings.product.media.length){var e=0;for(let t=0;t<this.previewConfig.layers.length;t++){const i=this.previewConfig.layers[t];if("product"===i.type){this._themeGalleryVariant=this.settings.variantId,i.params.imgPos?this.settings.product.media.length>i.params.imgPos-1&&(e=i.params.imgPos-1):i.params.variant&&delete this._themeGalleryVariant;break}}t=this.settings.product.media[e]}if(t){let e,i=o.pathBaseName(t.src,!1);if(this.settings.selectorThumbnail&&(e=document.querySelectorAll(this.settings.selectorThumbnail),a.debug("found "+e.length+" gallery thumbnails with selector: ",this.settings.selectorThumbnail,e)),!e||0===e.length){e=[];let t=document.querySelectorAll('img[src*="'+i+'"], img[data-src*="'+i+'"], img[data-srcset*="'+i+'"]');if(t.length>0)for(let i=0;i<t.length;i++){const r=t[i];let n=o.findParent(r,"form");null!==n&&-1!==n.action.indexOf("cart")||e.push(r)}a.debug("found "+e.length+" gallery thumbnails with src: ",i,e)}if(e.length){let t=Number.MAX_VALUE;for(let r=0;r<e.length;r++){const n=e[r];let a=(n.src&&-1===n.src.indexOf("data:")?n.src:null)||n.dataset.src||n.dataset.srcset,s=o.pathBaseName(a,!1);s=this.shopifyStore.stripImageDimension(s);let l=s.replace(i,"").length;l<t&&(t=l,this._themeGalleryImgEl=n)}a.debug("selected theme gallery thumbnail: ",this._themeGalleryImgEl)}}}if(this._themeGalleryImgEl&&this._themeGalleryImgEl.click){let e=o.isHidden(this._wrapper);dr.themeGalleryTimeout?setTimeout((()=>this._themeGalleryImgEl.click()),300):this._themeGalleryImgEl.click(),e&&setTimeout((()=>window.dispatchEvent(new Event("resize"))),500)}}}catch(e){a.error("error syncing theme gallery ",e)}}}_triggerEvent(e,t){const i=new CustomEvent(e,{detail:t,cancelable:!0,bubbles:!0});this.element.dispatchEvent(i)}_patchCanvasTouchScroll(){window.clCanvasTouchStart||(window.clCanvasTouchStart=fabric.Canvas.prototype._onTouchStart,fabric.util.object.extend(fabric.Canvas.prototype,{_onTouchStart:function(e){var t=this.findTarget(e);(!this.allowTouchScrolling||t||this.isDrawingMode)&&window.clCanvasTouchStart.call(this,e)}}))}_updateCanvasControls(){var e="#b2ccff";const t=e=>("#"===e.charAt(0)&&(e="%23"+e.substring(1)),"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' width='24' height='24'%3E%3Cpath d='M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10-4.477 10-10 10zm4.82-4.924a7 7 0 1 0-1.852 1.266l-.975-1.755A5 5 0 1 1 17 12h-3l2.82 5.076z' fill='"+e+"'/%3E%3C/svg%3E"),i=(e,t,i,o,n)=>{e.save(),e.translate(t,i),e.rotate(fabric.util.degreesToRadians(o.angle)),e.drawImage(r,-n/2,-n/2,n,n),e.restore()};var r=document.createElement("img");r.src=t(e),r.dataset.fill=e,fabric.Object.prototype.controls.mtr=new fabric.Control({x:0,y:-.5,offsetY:-40,cursorStyle:"crosshair",actionHandler:fabric.controlsUtils.rotationWithSnapping,actionName:"rotate",render:function(e,o,n,a,s){const l=1.5*s.cornerSize;r.dataset.fill!=e.fillStyle&&(r.onload=function(){i(e,o,n,s,l)},r.dataset.fill=e.fillStyle,r.src=t(e.fillStyle)),i(e,o,n,!1,l)},cornerSize:28,withConnection:!0})}_watchZoom(){let e=this._canvas.getElement(),t=e.parentElement;this.settings.zoom.factor>fabric.devicePixelRatio&&(fabric.devicePixelRatio=Math.min(4,this.settings.zoom.factor));const i=i=>{if(!this.settings.zoomMode){t.style.width=e.style.width,t.style.height=e.style.height;let i=this._canvas.enableRetinaScaling?fabric.devicePixelRatio:1,r=e.width/i*this.settings.zoom.factor,o=e.height/i*this.settings.zoom.factor,n=t.offsetWidth,s=t.offsetHeight;this._zoomCalc={xRatio:(t.offsetWidth-r)/n,yRatio:(t.offsetHeight-o)/s,offset:t.getBoundingClientRect()},e.style.width=r+"px",e.style.height=r+"px",t.classList.add("cl-po--zoom"),this.settings.zoomMode=!0,a.debug("----\x3e zoom start",e,this._zoomCalc)}let r,o;if("touchstart"==i.type||"touchmove"==i.type){let e=i.touches[0]||i.changedTouches[0];r=e.pageX-this._zoomCalc.offset.left,o=e.pageY-this._zoomCalc.offset.top,i.preventDefault()}else r=i.pageX-this._zoomCalc.offset.left,o=i.pageY-this._zoomCalc.offset.top;e.style.left=r*this._zoomCalc.xRatio+"px",e.style.top=o*this._zoomCalc.yRatio+"px"},r=i=>{t.classList.remove("cl-po--zoom"),e.style.width=t.style.width,e.style.height=t.style.height,t.style.width="",t.style.height="",e.style.left="",e.style.top="",this.settings.zoomMode=!1,a.debug("----\x3e zoom end",e)};e.addEventListener("mousemove",i),e.addEventListener("mouseleave",r),fabric.isTouchSupported&&this.settings.zoom.mobile&&(e.addEventListener("touchstart",i),e.addEventListener("touchmove",i),e.addEventListener("touchend",r))}constructor(e,t,i,r,n){Tr(this,"_syncSticky",(()=>{let e={format:"png",multiplier:this.previewConfig.width/this._canvas.getWidth()};this._stickyImgEl.src=this._canvas.toDataURL(e),this._canvas.requestRenderAll()}));let s={api:"https://api.cloudlift.app",assets:"https://assets.cloudlift.app",queryParams:{},selector:".cl-preview",selectorThumbnail:"",position:"",classNamePrefix:"cl-po",product:{},variantId:null,editorMode:!1,editLayer:Pr.editLayer,cropMode:!1,cropLayer:"",sticky:!1,stickyMobile:"overlay",stickyMobileSize:25,stickyMode:!1,maxHeight:0,zoom:{enabled:!1,factor:2,mobile:!0},zoomMode:!1};this.config=e,this.previewConfig=t,this.active=!0,this.settings=o.extend(s,n||{}),this.visible={},this.visibleEditor={},this.shopifyStore=h.getInstance(),this._productForm=i,this.conditionsEngine=r,null!==this.settings.selector&&(o.isElement(this.settings.selector)?this.element=this.settings.selector:this.element=document.querySelector(this.settings.selector)),null!=this.element?(a.info("--\x3e new product-preview: ",this.element),this.resources=[this.settings.assets+"/static/lib/fabricjs/fabric.min.js"],this.ready=$r.loadOnce(this.resources,"product-preview",{async:!1}).then((()=>this._init()))):a.warn("no elements with selector found: ",this.settings.selector)}};class Lo{static generateId(){return Date.now().toString()}static getItem(e){return Lo.storage.hasOwnProperty(e)||(Lo.storage[e]=Lo.parseItem(e)),Lo.storage[e]}static storeItem(e,t){Lo.storage[e]=t,window.localStorage&&localStorage.setItem(Lo.keyPrefix+e,JSON.stringify(t))}static parseItem(e){if(window.localStorage){let t=localStorage.getItem(Lo.keyPrefix+e);if(t)return JSON.parse(t)}return{}}}Lo.storage={},Lo.keyPrefix="cl_";var ko=Lo;var $o=class{_init(){let e=[];for(let t=0;t<this.settings.product.options.length;t++){const i=this.settings.product.options[t];let r={name:i.name,label:i.name,type:"select",id:"option_"+this.settings.product.id+"_"+i.name.replace(/^[^a-zA-Z]+|[^\w]+/g,""),params:{name:"v_"+i.name},visible:!0,values:[],_variantOption:i,_themeEl:null},n=!1;for(let e=0;e<this.config.variantOptions.length;e++){let t=this.config.variantOptions[e];if(t.name===i.name){o.merge(r,t),n=!0;break}}n||this.config.variantOptions.length>t&&o.merge(r,this.config.variantOptions[t]),this.settings.variant.id?r.value=this.settings.variant["option"+i.position]:r.value=i.values[0];let a=r.values.length>0,s=[];for(let e=0;e<i.values.length;e++){let t=i.values[e],o=null;if(a)for(let e=0;e<r.values.length;e++){const i=r.values[e];if(i&&i.value===t){o=i;break}}o||(o={text:t,value:t},a&&r.values.length>e&&r.values[e].img&&(o.img=r.values[e].img)),s.push(o)}r.values=s,e.push(r)}this.config.variantOptions=e,this.settings.editorMode||this.resolveThemeElements()}resolveThemeElements(e=!1){for(let t=0;t<this.config.variantOptions.length;t++){const i=this.config.variantOptions[t],r=i._variantOption;if(i._themeEl=this._productForm.querySelector('[data-live-variant-option="'+r.position+'"]'),!i._themeEl){let t=this._productForm.querySelectorAll("select");e&&(t=Array.from(t).filter((e=>null===e.closest(".cl-po--option"))));const o=e=>{if(e.length===r.values.length){for(let t=0;t<e.length;t++){const i=e[t];if(-1===r.values.indexOf(i))return!1}return!0}return!1};for(let e=0;e<t.length;e++){const n=t[e];if(r.name&&n.getAttribute("name")?.includes(r.name)){i._themeEl=n;break}if(n.dataset.index&&-1!==n.dataset.index.indexOf(r.position.toString())){i._themeEl=n;break}{let e=[],t=n.querySelectorAll("option");for(let i=0;i<t.length;i++){const r=t[i];e.push(this._decodeValue(r.value))}o(e)&&(i._themeEl=n)}}if(!i._themeEl){let t=this._productForm.querySelectorAll("input[type=radio]");e&&(t=Array.from(t).filter((e=>null===e.closest(".cl-po--option"))));let n=[];for(let e=0;e<t.length;e++){const a=t[e];if(-1===n.indexOf(a.name)){let e;n.push(a.name);const t=a.name.trim();if(e=t!==a.name?this._productForm.querySelectorAll('input[name*="'+t+'"]'):this._productForm.querySelectorAll('input[name="'+t+'"]'),r.name&&a.getAttribute("name")?.includes(r.name)){i._themeEl=e;break}if(a.dataset.index&&-1!==a.dataset.index.indexOf(r.position.toString())){i._themeEl=e;break}{let t=[];for(let i=0;i<e.length;i++){const r=e[i];t.push(this._decodeValue(r.value))}if(o(t)){i._themeEl=e;break}}}}}}if(i._themeEl&&dr.productVariantHide){let e=i._themeEl;o.isNodeList(i._themeEl)&&(e=e[0]);let t=e;for(;t.parentNode!==this._productForm&&-1===t.textContent.indexOf(r.name);)t=t.parentNode;t.style.display="none"}a.debug("resolved theme variantOption",i)}let t=this._productForm.querySelector("[data-live-variant-options]");null!=t&&(t.style.display="none")}watchVariantElements(){const e=()=>this.config.variantOptions.filter((e=>e._themeEl)).map((e=>o.isNodeList(e._themeEl)?e._themeEl[0]:e._themeEl));let t=null,i=e();if(i.length&&(t=i[0].closest("variant-selects"),!t))for(t=i[0].parentNode;t!==document.body;){let e=!0;for(let r=0;r<i.length;r++)if(!t.contains(i[r])){e=!1;break}if(e)break;t=t.parentNode}t&&(this.observer=new MutationObserver((t=>{for(const r of t)if("childList"===r.type&&r.removedNodes.length)for(let t=0;t<r.removedNodes.length;t++){if(1===r.removedNodes.length&&(1!==r.removedNodes[0].nodeType||"STYLE"===r.removedNodes[0].tagName))continue;const t=Array.from(r.removedNodes);for(let r=0;r<i.length;r++){const o=i[r];if(t.indexOf(o)>-1||t.some((e=>e.contains(o))))return a.trace("variant option removed",o),this.resolveThemeElements(!0),void(i=e())}}})),a.debug("watching variant elements",t),this.observer.observe(t.parentNode,{subtree:!0,childList:!0}))}syncVariantChanges(e){if(e._themeEl)if(o.isNodeList(e._themeEl))for(let t=0;t<e._themeEl.length;t++){const i=e._themeEl[t];(i.value==e.value||this._decode&&this._decodeValue(selectOptionEl.value)==e.value)&&(i.checked=!0,i.dispatchEvent(new Event("change",{bubbles:!0})))}else if("SELECT"===e._themeEl.tagName){for(let t=0;t<e._themeEl.options.length;t++){const i=e._themeEl.options[t];if(i.value==e.value||this._decode&&this._decodeValue(i.value)==e.value){e._themeEl.selectedIndex=t;break}}e._themeEl.dispatchEvent(new Event("change",{bubbles:!0}))}}syncAllVariantOptions(){for(let e=0;e<this.config.variantOptions.length;e++){const t=this.config.variantOptions[e];this.syncVariantChanges(t)}}findSelectedVariant(){this.settings.variant=null;for(let e=0;e<this.settings.product.variants.length;e++){const t=this.settings.product.variants[e];let i=!0;for(let e=0;e<this.config.variantOptions.length;e++){const r=this.config.variantOptions[e];if(t["option"+r._variantOption.position]!=r.value){i=!1;break}}if(i){this.settings.variant=t;break}}return this.settings.variant}resetVariant(e){let t=null,i=-1;for(let r=0;r<this.settings.product.variants.length;r++){const o=this.settings.product.variants[r];if(!o.available)continue;let n=!0,a=0;for(let r=0;r<this.config.variantOptions.length;r++){const s=this.config.variantOptions[r];if(o["option"+s._variantOption.position]!=s.value){if(n=!1,0===a)break}else a++,e&&e.value==s.value&&a++,a>i&&(t=o,i=a)}}this.settings.variant=t||this.settings.product.variants[0];for(let e=0;e<this.config.variantOptions.length;e++){const t=this.config.variantOptions[e];let i="option"+t._variantOption.position;t.value=this.settings.variant[i]}}filterVariantValues(){let e={};for(let t=0;t<this.config.variantOptions.length;t++){const i=this.config.variantOptions[t];let r="option"+i._variantOption.position,o=i._values||i.values,n=[];for(let t=0;t<o.length;t++){const i=o[t];let a=!1;for(let t=0;t<this.settings.product.variants.length;t++){const o=this.settings.product.variants[t];let n=!0;for(const t in e)if(e.hasOwnProperty(t)&&e[t]!==o[t]){n=!1;break}if(n&&o[r]===i.value&&(a=!0,i.available=o.available,o.available))break}a&&n.push(i)}i._values=o,i.values=n,e[r]=i.value}}_decodeValue(e){let t=e.split("Special_Double_Quote").join('"').split("Special_Slash").join("/");return t!==e?(this._decode=!0,t):e}constructor(e,t,i){this.settings=o.extend({product:{},variant:{},editorMode:!1},i||{}),this.config=e,this._productForm=t,this._init(),"function"==typeof HTMLUpdateUtility&&(dr.productVariantObserver=!0,o.addStyleElement("variant-selects {display:none!important;}")),dr.productVariantObserver&&!this.settings.editorMode&&this.watchVariantElements()}};const To=e=>{if(window.Shopify){function t(){setTimeout((function(){window.ShopifyXR.addModels([e]),window.ShopifyXR.setupXRElements()}),1e3)}window.ShopifyXR?t():window.Shopify.loadFeatures([{name:"shopify-xr",version:"1.0",onLoad:t}])}for(var i,r=e.sources.length-1;r>=0&&"glb"!==(i=e.sources[r]).format;r--);return te`<div class="cl-embed" style="padding-top: 100%;"><model-viewer toggleable="true" src=${i.url} poster=${e.preview_image.src} camera-controls="true" style="--poster-color: transparent;" data-shopify-feature="1.12"></model-viewer></div>
        ${!1!==window.clGalleryXR?te`<button class="button button--full-width product__xr-button cl-xr-button" type="button" data-shopify-xr="" data-shopify-title="Model" data-shopify-model3d-id=${e.id} data-shopify-xr-hidden="">
                <svg xmlns="http://www.w3.org/2000/svg" focusable="false" fill="none" viewBox="0 0 18 21"><path d="M7.67998 20.629L1.28002 16.723C0.886205 16.4784 0.561675 16.1368 0.337572 15.731C0.113468 15.3251 -0.00274623 14.8686 -1.39464e-05 14.405V6.59497C-0.00238367 6.13167 0.113819 5.6755 0.33751 5.26978C0.561202 4.86405 0.884959 4.52227 1.278 4.27698L7.67796 0.377014C8.07524 0.131403 8.53292 0.000877102 8.99999 9.73346e-08C9.46678 -0.000129605 9.92446 0.129369 10.322 0.374024V0.374024L16.722 4.27399C17.1163 4.51985 17.4409 4.86287 17.6647 5.27014C17.8885 5.67742 18.0039 6.13529 18 6.59998V14.409C18.0026 14.8725 17.8864 15.3289 17.6625 15.7347C17.4386 16.1405 17.1145 16.4821 16.721 16.727L10.321 20.633C9.92264 20.8742 9.46565 21.0012 8.99999 21C8.53428 20.9998 8.07761 20.8714 7.67998 20.629V20.629ZM8.72398 2.078L2.32396 5.97803C2.22303 6.04453 2.14066 6.13551 2.08452 6.24255C2.02838 6.34959 2.00031 6.46919 2.00298 6.59003V14.4C2.00026 14.5205 2.02818 14.6396 2.08415 14.7463C2.14013 14.853 2.22233 14.9438 2.32298 15.01L7.99999 18.48V10.919C8.00113 10.5997 8.08851 10.2867 8.25292 10.0129C8.41732 9.73922 8.65267 9.51501 8.93401 9.36401L15.446 5.841L9.28001 2.08002C9.19614 2.02738 9.09901 1.99962 8.99999 2C8.90251 1.99972 8.8069 2.02674 8.72398 2.078V2.078Z" fill="currentColor"></path></svg>
                ${window.clGalleryXRText||"View in your space"}
            </button>`:null}`};var Ao=(e,t)=>te`
<div class="cl-po--gallery ${t.layout}">

    <div class="splide cl-po--gallery-main  ${Mi({"hide-thumb-mobile":t.hideThumbnailsMobile})}">
        <div class="splide__track">
            <div class="splide__list">
                ${Si(e,(e=>e.id),((e,i)=>te`
                    <div class="splide__slide" style=${Li({aspectRatio:e.aspect_ratio})}>
                        ${"video"===e.media_type||"external_video"===e.media_type||"model"===e.media_type?te`<div class="cl-po--gallery-img" data-media-position=${e.position} >${(e=>{if("model"===e.media_type)return To(e);var t=void 0!==window.clGalleryAutoplay&&window.clGalleryAutoplay,i={paddingBottom:1/e.aspect_ratio*100+"%"};if("external_video"===e.media_type){if("youtube"===e.host)return te`<div class="cl-embed" style=${Li(i)}><iframe src="https://www.youtube.com/embed/${e.external_id}?controls=1&amp;enablejsapi=1&amp;modestbranding=1&amp;playsinline=1&amp;rel=0&amp;autoplay=${t?"1":"0"}" loading="lazy" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="allowfullscreen"></iframe></div>`;if("vimeo"===e.host)return te`<div class="cl-embed" style=${Li(i)}><iframe src="https://player.vimeo.com/video/${e.external_id}?byline=0&amp;controls=1&amp;playsinline=1&amp;title=0" loading="lazy" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="allowfullscreen" ></iframe></div>`}for(var r=[],o=[],n=e.sources.length-1;n>=0;n--){var a=e.sources[n];-1===o.indexOf(a.mime_type)&&(r.push(a),o.push(a.mime_type))}return te`<div class="cl-embed" style=${Li(i)}><video autoplay=${Ai(t?"autoplay":void 0)} loop=${Ai(t?"loop":void 0)} muted="muted" playsinline="playsinline" controls="controls" preload="none" poster="${e.preview_image.src}">
        ${Si(r,(e=>te`
            <source src="${e.url}" type="${e.mime_type}">
        `))}
    </video></div>`})(e)}</div>`:te`<img class="cl-po--gallery-img" data-splide-lazy=${((e,t)=>{if(t.width>0){let i=2*t.width;return i=200*Math.ceil(i/200),i=Math.min(i,t.maxWidth),_r(e,i+"x")}return e})(e.src,t)} alt=${e.alt} data-media-position=${e.position} />`}
                    </div>
                `))}
            </div>
        </div>
    </div>
    ${t.hideThumbnails?null:te`
        <div class="splide cl-po--gallery-thumbnails ${Mi({"cl-hide-mobile":t.hideThumbnailsMobile})}">
            <div class="splide__track">
                <div class="splide__list">
                    ${Si(e,(e=>e.id),((e,t)=>te`
                    <div class="splide__slide">
                        <img class="cl-po--gallery-thumbnail" data-splide-lazy=${_r(e.src||e.preview_image.src,"200x")} alt=${e.alt} data-media-position=${e.position} />
                    </div>
                `))}
                </div>
            </div>
        </div>
    `}
</div>
`;var Fo=class{destroy(){if(this._previews)for(let e=0;e<this._previews.length;e++){this._previews[e].destroy()}this.element.removeChild(this._wrapper)}render(){ee(Ao(this.media,this.settings.galleryConfig),this._wrapper)}selectPreview(e){this._splideThumbnails.go(this._getMediaIndex(e))}_init(){this._wrapper=document.createElement("div"),this._wrapper.className=this.settings.classNamePrefix+"--gallery-wrapper",this._wrapper.setAttribute("id",this.config.uuid+"_gallery"),this._wrapper.style.width="100%",this.settings.position?(this.element.insertAdjacentElement(this.settings.position,this._wrapper),this.element!==this._wrapper.parentNode&&(this.element=this._wrapper.parentNode)):this.element.appendChild(this._wrapper),dr.themeGallery=!1;let e=[this.config.previewConfig];if(this.config.previewConfig.views.length&&e.push(...this.config.previewConfig.views),this._filterProductMedia(e),this.settings.galleryConfig.loader&&this._addLoader(),this.settings.galleryConfig.width=this.element.offsetWidth,0===this.settings.galleryConfig.width&&a.warn("gallery width is 0px media images will not be scaled"),this.render(),this._splideMain=new Splide(this._wrapper.querySelector("."+this.settings.classNamePrefix+"--gallery-main"),{type:"fade",keyboard:"focused",lazyLoad:"nearby",preloadPages:1,drag:!this.settings.editorMode&&!this.settings.galleryConfig.hideThumbnails,rewind:this.settings.galleryConfig.arrows,arrows:this.settings.galleryConfig.arrows,pagination:this.settings.galleryConfig.pagination||this.settings.galleryConfig.paginationMobile,classes:{pagination:"splide__pagination"+(this.settings.galleryConfig.paginationMobile?" mobile":"")}}),this._splideMain.on("lazyload:loaded",((e,t)=>{requestAnimationFrame((()=>{t.slide.querySelector("img")&&(t.slide.style.aspectRatio="")}))})),this.settings.galleryConfig.hideThumbnails)this._splideThumbnails={go:e=>{this._splideMain.go(e),this._selectPreview(e)}},this._splideMain.mount();else{let e="left"===this.settings.galleryConfig.layout||"right"===this.settings.galleryConfig.layout?"ttb":"ltr",t="sequential",i=1;if(this._wrapper.offsetWidth){let e=window.innerWidth>768?100:66;i=Math.ceil(this._wrapper.offsetWidth/e),i=Math.max(i-2,1),this.media.length>i&&(t="nearby")}this._splideThumbnails=new Splide(this._wrapper.querySelector("."+this.settings.classNamePrefix+"--gallery-thumbnails"),{keyboard:"focused",lazyLoad:t,preloadPages:i,autoWidth:!0,fixedHeight:100,height:"ttb"===e?window.innerWidth>768?600:200:0,direction:e,rewind:this.settings.galleryConfig.arrows,gap:3,arrows:this.settings.galleryConfig.arrowsThumbnails,pagination:this.settings.galleryConfig.paginationThumbnails,isNavigation:!0,breakpoints:{600:{fixedHeight:66}},drag:!1!==window.clGalleryThumbnailDrag,dragMinThreshold:{mouse:30,touch:10}}),this._splideThumbnails.mount(),this._splideMain.sync(this._splideThumbnails).mount(),this._splideThumbnails.on("moved",((e,t)=>{this._selectPreview(e)}))}let t=[];for(let i=0;i<e.length;i++){let r=e[i],o=this._wrapper.querySelector("."+this.settings.classNamePrefix+'--gallery-main [data-media-position="'+r.position+'"]');if(o){let e=o.parentNode;e.removeChild(o);let n=new Oo(this.config,r,this._productForm,this.conditionsEngine,{api:this.settings.api,assets:this.settings.assets,selector:e,selectorThumbnail:this.settings.selectorThumbnail,sticky:this.settings.sticky,stickyMobile:this.settings.stickyMobile,stickyMobileSize:this.settings.stickyMobileSize,zoom:this.settings.zoom,maxHeight:this.settings.maxHeight,product:this.settings.product,variantId:this.settings.variantId,editorMode:this.settings.editorMode});n.active=1===r.position,0===i&&this.settings.galleryConfig.previewActive&&isNaN(this.settings.galleryConfig.position)&&(n.active=!0),n.active&&(this._preview=n),this.settings.galleryConfig.hideThumbnails||(n._thumbnailEl=this._wrapper.querySelector("."+this.settings.classNamePrefix+'--gallery-thumbnails [data-media-position="'+r.position+'"]')),t.push(n.ready.then((()=>{if(n.element.addEventListener("preview:rendered",(()=>{requestAnimationFrame((()=>{n.element.closest(".splide__slide").style.aspectRatio=""}))}),{once:!0}),n._thumbnailEl){const e=e=>{let t={format:"png",multiplier:200/n._canvas.getHeight()};n._thumbnailEl.src=n._canvas.toDataURL(t),n._canvas.requestRenderAll()};n.element.addEventListener("layer:changed",e),n.element.addEventListener("preview:rendered",e)}}))),this._previews.push(n)}else a.warn("[live-options] gallery - missing media image for view: ",r)}return this._watchFormChanges(),this._splideMain.options.drag&&!this._isStatic(e)&&this._watchPreviewChanges(),this.settings.editorMode&&window.clProductGalleryPosition?(this.selectPreview(window.clProductGalleryPosition),delete window.clProductGalleryPosition):isNaN(this.settings.galleryConfig.position)?this._selectVariantThumbnail(this._getVariantById(this.settings.variantId)):this.selectPreview(this.settings.galleryConfig.position),!this._preview&&this._previews.length&&(this._preview=this._previews[0]),Promise.all(t)}_filterProductMedia(e){this.media=this.settings.product.media.filter((e=>-1===this.settings.galleryConfig.exclude.indexOf(e.position))),this.settings.galleryConfig.hideThumbnails&&(this.media=this.media.filter((t=>{for(let i=0;i<e.length;i++){if(e[i].position===t.position)return!0}return!1})))}_getMediaIndex(e){for(let t=0;t<this.media.length;t++)if(this.media[t].position===e)return t;return-1}_getMediaPosition(e){return e<this.media.length?this.media[e].position:-1}_selectPreview(e){if(this.media.length>e){let t=this.media[e];!this.settings.galleryConfig.previewActive&&this._preview&&(this._preview.active=!1);for(let e=0;e<this._previews.length;e++){const i=this._previews[e];if(i.previewConfig.position===t.position){this._preview&&(this._preview.active=!1),this._preview=i,this._preview.active=!0,this._triggerEvent("preview:active",{position:t.position});break}}"model"===t.media_type?this._splideMain.Components.Drag.disabled||(this._DragRestore=!0,this._splideMain.Components.Drag.disabled=!0):this._DragRestore&&(this._splideMain.Components.Drag.disabled=!1,delete this._DragRestore)}}_selectVariantThumbnail(e){if(this._preview&&this._preview.active){let e=this._findProductLayer(this._preview.previewConfig);if(e&&e.params.variant&&!e.params.imgPos)return void(this.settings.galleryConfig.previewActive&&this._splideThumbnails.go(this._getMediaIndex(this._preview.previewConfig.position)))}if(e&&(e.featured_media||e.featured_image)){let t=e.featured_media||e.featured_image,i=this._getMediaIndex(t.position);if(-1!==i)this._splideThumbnails.go(i);else for(let e=0;e<this._previews.length;e++){const t=this._previews[e];let r=this._findProductLayer(t.previewConfig);if(r&&r.params.variant&&(i=this._getMediaIndex(t.previewConfig.position),-1!==i))return void this._splideThumbnails.go(i)}}}_findProductLayer(e){for(let t=0;t<e.layers.length;t++){const i=e.layers[t];if("product"===i.type)return i}return null}_watchFormChanges(){this._productForm&&(this._productForm.addEventListener("option:changed",(e=>this._optionChanged(e))),this._productForm.addEventListener("option:crop",(e=>this._optionChanged(e))),this._productForm.addEventListener("option:variant_changed",(e=>this._variantChanged(e))))}_watchPreviewChanges(){this.element.addEventListener("preview:rendered",(e=>this._checkInteractive(e))),this.element.addEventListener("preview:active",(e=>this._checkInteractive(e)))}_variantChanged(e){this.settings.variantId=e.detail.variantId,this._selectVariantThumbnail(this._getVariantById(this.settings.variantId))}_optionChanged(e){let t=e.detail,i=-1,r=-1,o=this._getMediaPosition(this._splideMain.index);for(let e=0;e<this._previews.length;e++){const n=this._previews[e];if(n._canvas){let e=n._canvas.getObjects();for(let o=0;o<e.length;o++){const a=e[o];if(a._layer&&a._layer.params.option===t.name){n.previewConfig.position!==i&&(i=n.previewConfig.position,-1===r&&(r=i));break}}}if(-1===i){for(let e=0;e<n.previewConfig.layers.length;e++){if(n.previewConfig.layers[e].params.option===t.name){n.previewConfig.position!==i&&(i=n.previewConfig.position,-1===r&&(r=i));break}}if(-1===i)for(let e=0;e<n.previewConfig.layers.length;e++){const o=n.previewConfig.layers[e];if(o.conditions.length){let e=!1;for(let a=0;a<o.conditions.length;a++){const s=o.conditions[a];if(s.field===t.name&&this.conditionsEngine.evaluateOptionCondition(s,[t])&&n.previewConfig.position!==i){i=n.previewConfig.position,-1===r&&(r=i),e=!0;break}}if(e)break}}}if(i===o)return;i=-1}-1!==r&&(this.selectPreview(r),e&&"option:crop"===e.type&&this._selectPreview(this._getMediaIndex(r)))}_getVariantById(e){if(this.settings.product.variants&&this.settings.product.variants.length>0)for(let t=0;t<this.settings.product.variants.length;t++){const i=this.settings.product.variants[t];if(i.id.toString()===e.toString())return i}return null}_checkInteractive(e){let t=!1;if(this._preview&&this._preview._canvas)if(this._preview.settings.cropMode)t=!0;else{let e=this._preview._canvas.getObjects();for(let i=0;i<e.length;i++){const r=e[i];if(r._layer&&r._layer.params.interactive){t=!0;break}}}this._splideMain.Components.Drag.disable(t)}_isStatic(e){for(let t=0;t<e.length;t++){const i=e[t];for(let e=0;e<i.layers.length;e++){const t=i.layers[e];if(t.params.interactive||t.params.crop&&"upload"===t.type)return!1}}return!0}_addLoader(){let e="300px",t=this._getMediaIndex(isNaN(this.settings.galleryConfig.position)?1:this.settings.galleryConfig.position);if(-1!==t){let i=this.media[t];if(i){let t=i.aspect_ratio;if(!t&&i.width&&i.height&&(t=i.width/i.height),t){let i=this.element.offsetWidth,r=this._wrapper;for(;0===i&&r.parentNode;)r=r.parentNode,r.offsetWidth>0&&(i=r.offsetWidth);i&&(e=Math.round(i/t)+"px")}}}a.debug("--\x3e product-gallery loader minHeight:",e),this._loader=document.createElement("div"),this._loader.className="cl-po--gallery-loader",this._loader.style.minHeight=e,this._loader.innerHTML='<div class="cl-spinner"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div>',this.element.insertBefore(this._loader,this._wrapper),this._wrapper.style.opacity="0";const i=e=>{this._preview!==e.detail&&this._preview||(this._removeLoader(),this.element.removeEventListener("preview:rendered",i))};this.element.addEventListener("preview:rendered",i)}_removeLoader(){this._wrapper.style.opacity="1",this._loader&&(this.element.removeChild(this._loader),this._loader=null)}_triggerEvent(e,t){const i=new CustomEvent(e,{detail:t,cancelable:!0,bubbles:!0});this.element.dispatchEvent(i)}constructor(e,t,i,r){this.config=e,this.settings=o.extend({api:"https://api.cloudlift.app",assets:"https://assets.cloudlift.app",queryParams:{},selector:".cl-gallery",position:"",sticky:!1,stickyMobile:"overlay",zoom:null,maxHeight:0,classNamePrefix:"cl-po",product:{},variantId:null,galleryConfig:{exclude:[],hideThumbnails:!1,hideThumbnailsMobile:!1,layout:"bottom",arrows:!1,arrowsThumbnails:!1,pagination:!1,paginationMobile:!1,paginationThumbnails:!1,previewActive:!1,loader:!1,maxWidth:2500,width:0}},r||{}),window.clGallery&&(this.settings.galleryConfig=o.extend(this.settings.galleryConfig,window.clGallery)),this._previews=[],this.media=[],this._productForm=t,this.conditionsEngine=i,null!==this.settings.selector&&(o.isElement(this.settings.selector)?this.element=this.settings.selector:this.element=document.querySelector(this.settings.selector)),null!=this.element?(a.info("--\x3e new product-gallery: ",this.element),this.resources=[this.settings.assets+"/static/lib/splidejs/splide.min.js",this.settings.assets+"/static/lib/splidejs/splide.min.css"],this.ready=$r.loadOnce(this.resources,"product-gallery",{async:!1}).then((()=>this._init()))):a.warn("no elements with selector found: ",this.settings.selector)}};var Do=class{translate(){try{let e=JSON.stringify(this.config.options);this.config.variantOption&&(e+=JSON.stringify(this.config.variantOptions));let t=e.indexOf("#");if(-1!==t){let i=/^#[0-9A-F]{6}$/i;for(;-1!==t;){let r=e.substr(t,7);if(!i.test(r))break;a.trace("[config-translate] skipping color:",r),t=e.indexOf("#",t+1)}}-1!==t?(this._translateOptions(this.config.options),this.config.variantOption&&this._translateOptions(this.config.variantOptions,!0),this.config.preview&&this._translatePreview(this.config.previewConfig),a.debug("[config-translate] translated options")):a.debug("[config-translate] skipped options translation")}catch(e){a.debug("[config-translate] error in translation",e)}}_translateOptions(e,t=!1){for(let i=0;i<e.length;i++){const r=e[i];if(r.label&&(r.label=l.translate(r.label)),t||(r.name&&(r.name=l.translate(r.name)),r.value&&(r.value=l.translate(r.value))),r.params.info&&(r.params.info=l.translate(r.params.info)),r.params.help&&(r.params.help=l.translate(r.params.help)),r.params.textHelp&&(r.params.textHelp=l.translate(r.params.textHelp)),r.params.placeholder&&(r.params.placeholder=l.translate(r.params.placeholder)),r.params.validationMsg&&(r.params.validationMsg=l.translate(r.params.validationMsg)),r.params.collapseLabel&&(r.params.collapseLabel=l.translate(r.params.collapseLabel)),r.params.textValueSelect&&(r.params.textValueSelect=l.translate(r.params.textValueSelect)),r.params.textSearchValues&&(r.params.textSearchValues=l.translate(r.params.textSearchValues)),r.params.button&&(r.params.button=l.translate(r.params.button)),r.params.atcText&&(r.params.atcText=l.translate(r.params.atcText)),r.params.textDiscountSave&&(r.params.textDiscountSave=l.translate(r.params.textDiscountSave)),r.params.textDiscountBuy&&(r.params.textDiscountBuy=l.translate(r.params.textDiscountBuy)),r.params.labelX&&(r.params.labelX=l.translate(r.params.labelX)),r.params.labelY&&(r.params.labelY=l.translate(r.params.labelY)),r.params.html&&(r.params.html=l.translate(r.params.html)),r.values)for(let e=0;e<r.values.length;e++){const i=r.values[e];i.value&&!t&&(i.value=l.translate(i.value)),i.text&&(i.text=l.translate(i.text))}r.conditions.length&&this._translateConditions(r.conditions),r.options&&r.options.length&&this._translateOptions(r.options)}}_translatePreview(e){let t=[e];e.gallery&&t.push(...e.views);for(let e=0;e<t.length;e++){const i=t[e];this._translateLayers(i.layers)}}_translateLayers(e){for(let i=0;i<e.length;i++){const r=e[i];for(var t in r.params)r.params.hasOwnProperty(t)&&-1!==t.indexOf("option")&&(r.params[t]=l.translate(r.params[t]));r.params.text&&(r.params.text=l.translate(r.params.text)),r.conditions.length&&this._translateConditions(r.conditions),r.layers&&r.layers.length&&this._translateOptions(r.layers)}}_translateConditions(e){for(let t=0;t<e.length;t++){const i=e[t];if(i.field&&(i.field=l.translate(i.field)),i.value&&-1!==i.value.indexOf("#"))if(-1!==i.value.indexOf(",")){let e=i.value.split(",");for(let t=0;t<e.length;t++)e[t]=l.translate(e[t]);i.value=e.join(",")}else i.value=l.translate(i.value)}}constructor(e){this.config=e}};var No=class{destroy(){this.removeCss(),this.element.removeChild(this._wrapper),this._destroyPreview()}updateVariantOptions(e,t=!0){let i;t&&(i=this._getControllers({},this.config.variantOptions)),this.config.variantOptions=e,this._variantOptions&&(this._variantOptions.settings.variant=this._getVariantById(this._variantId),this._variantOptions._init()),t&&this._setControllers(i,this.config.variantOptions)}updateOptions(e,t=!0,i=!0){let r,o;if(t&&(r=this.getValues()),i&&(o=this._getControllers()),this.config.options.length=0,this.config.options.push(...e),this._generateOptionIds(this.config.options,"option_"+this.settings.product.id+"_"),this._translate.translate(),t){for(const e in r)r[e]||delete r[e];this.setValues(r)}i&&this._setControllers(o),this._destroyTooltips(),this.render()}updatePreview(e){this.config.preview=!0,this._translate._translatePreview(e),this._preview?this._preview.updateConfig(e).then((()=>this.render())):(this.config.previewConfig=e,this._initPreview())}updateCss(e){this.removeCss(),this._style=o.addStyleElement(e,this.settings.styleSelector)}removeCss(){this._style&&this._style.parentNode.removeChild(this._style)}updateJs(e){this.removeJs(),e=`window.addEventListener('options:rendered',function(e){ ${e} },{once:true});`,this._script=o.addScriptElement(e)}removeJs(){this._script&&this._script.parentNode.removeChild(this._script)}validate(){let e=this._validateOptions(this.config.options);return a.debug("validated product-options: ",this.config,e),dr.productOptionsEmptyId&&(this.settings.idLink=this._hasOptionsValues()),this.render(),e}render(){let e=[];try{this._evaluateOptionValue(this.config.options),this._evaluateOptionConditions(this.config.options),this._evaluateOptionPrice(this.config.options),this._variantIdOption&&e.push(this._variantIdOption),this._variantOptions&&this.config.variantOptions.length&&e.push(...this.config.variantOptions);const t={uuid:this.config.uuid,editorMode:this.settings.editorMode,price:this.price,product:this.settings.product,productForm:this._productForm,productFormLink:this._productFormLink,wrapper:this._wrapper,assets:this.settings.assets,idLink:this.settings.idLink};e.push(...this.config.options),ee(ho(e,t,this._optionValueChanged.bind(this),this._clearOptionError.bind(this),this.validate.bind(this),this._getOption.bind(this)),this._wrapper),this._triggerEvent("options:rendered",this),this._initTooltips()}catch(t){a.error("failed to render product options",e,t)}}getValues(e={},t=this.config.options){for(let i=0;i<t.length;i++){const r=t[i];r.options&&r.options.length?this.getValues(e,r.options):e[r.name]=r.value}return e}setValues(e,t=this.config.options){for(let i=0;i<t.length;i++){const r=t[i];if(r.options&&r.options.length)this.setValues(e,r.options);else if(e.hasOwnProperty(r.name))r.value=e[r.name];else if("upload-lift"===r.type){let t=[];for(const i in e)e.hasOwnProperty(i)&&-1!==i.indexOf(r.name+"_")&&t.push(e[i]);t.length&&(r.value=t.join(","))}"library"===r.type&&e.hasOwnProperty("_"+r.name+"_id")&&(r._imageId=e["_"+r.name+"_id"])}}_init(){this.config.css&&this.updateCss(this.config.css),this.config.js&&this.updateJs(this.config.js),this._wrapper=document.createElement("div"),this._wrapper.className=this.settings.classNamePrefix+"--wrapper",this._wrapper.setAttribute("id",this.config.uuid),this.settings.position?(this.element.insertAdjacentElement(this.settings.position,this._wrapper),this.element!==this._wrapper.parentNode&&(this.element=this._wrapper.parentNode)):this.element.appendChild(this._wrapper),this._generateOptionIds(this.config.options,"option_"+this.settings.product.id+"_"),dr.productOptionsClear&&(this._optionValuesClear=this.getValues()),this._findProductForm()?(this._translate=new Do(this.config),this._translate.translate(),this._productForm.noValidate=!0,this._productForm.addEventListener("options:render",(e=>this.render())),this._watchFormSubmit(),this._watchVariantChanges(),this.config.preview&&this._initPreview(),o.hasQueryParam(window.location.href,"item")&&this._restoreCartItem()):a.warn("product-options no product form found for element: ",this.element,this.config)}_variantsInCurrency(e=this.config.options){let t=[],i={};ur.priceVariant&&t.push(this.shopifyStore.getProduct(ur.priceProductHandle||"product-options").then((e=>{ur.priceVariantValue=e.price/100})).catch((()=>!0)));const r=e=>{let r=e.priceVariant,o=r.handle;!o&&r.title&&(o=r.title.substring(0,r.title.indexOf("-")).trim().replaceAll(" ","-").toLowerCase()),o&&(i[o]=i[o]||this.shopifyStore.getProduct(o),t.push(i[o].then((t=>{if(t.variants)for(let i=0;i<t.variants.length;i++){const o=t.variants[i];if(o.id.toString()===r.id.toString()){e.price=o.price/100,dr.productLinkAvailable&&(e.priceVariant?.quantity>1&&(e.hasOwnProperty("_price")||(e._price=e.price),e.price=e._price*e.priceVariant.quantity),e.disabled=!o.available);break}}})).catch((t=>{a.warn("missing linked product for optionValue: ",e,t),dr.productLinkAvailable&&(e.disabled=!0)}))))},o=e=>{let t=e.values;if(e.list&&this.settings.lists&&this.settings.lists.hasOwnProperty(e.list)&&(t=this.settings.lists[e.list]),t)for(let e=0;e<t.length;e++){const i=t[e];i.priceVariant&&r(i)}};for(let t=0;t<e.length;t++){let i=e[t];if(o(i),i.options&&i.options.length)for(let e=0;e<i.options.length;e++){o(i.options[e])}}return Promise.all(t)}_validateOptions(e,t=!1){let i=!0;for(let r=0;r<e.length;r++){const n=e[r];if(n.visible)if(n.options&&n.options.length){this._validateOptions(n.options,t)||(i=!1)}else{let e=this.element;this._popup&&this._popup.isOn()&&this._popupEl&&(e=this._popupEl);let r=e.querySelector(`#${n.id}`);if(n._controller&&"function"==typeof n._controller.onValidate){n.errors=[],n._controller.onValidate(n)||(i=!1,null==r&&(r=e.querySelector(`[data-option="${n.name}"]`)))}else if(null==r&&(r=e.querySelector(`input[id^=${n.id}-]:not([disabled])`)),null!=r&&!r.checkValidity()){if(i=!1,n.errors=[],n.params.validationMsg){n.errors.push(n.params.validationMsg);continue}for(const e in r.validity)if(r.validity[e]){let t="";t="tooLong"===e?l.get(this.settings.errorPrefix+e,{max:r.maxLength}):"tooShort"===e?l.get(this.settings.errorPrefix+e,{min:r.minLength}):"rangeOverflow"===e?l.get(this.settings.errorPrefix+e,{max:r.max}):"rangeUnderflow"===e?l.get(this.settings.errorPrefix+e,{min:r.min}):"patternMismatch"===e?l.get(this.settings.errorPrefix+e,{pattern:r.pattern}):l.get(this.settings.errorPrefix+e),t&&(-1===t.indexOf(this.settings.errorPrefix)?n.errors.push(t):a.warn("missing translation for "+t))}}if(!i&&r&&!t&&r.scrollIntoView){let e=r.closest(".cl-po--panel");e&&!e.previousElementSibling.classList.contains("cl-po--open")&&e.previousElementSibling.classList.add("cl-po--open");let i=r.closest("[data-option]");o.isScrolledIntoView(i)||(i.style.scrollMargin=window.clOptionScrollOffset||"100px",i.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"}),i.style.scrollMargin="",t=!0)}}}return i}_findProductForm(){if(this._productForm=o.findParent(this.element,this.settings.selectorForm),!this._productForm){let e={srcEl:this.element};this._productForm=this.shopifyStore.findProductFormBestMatch(this.settings.product.id,e),e.parentEl&&(this._productFormParentEl=e.parentEl)}if(this._productFormParent=this._productForm.contains(this._wrapper),!this._productFormParent||this._productFormLinkForce){let e=this._productForm.getAttribute("id");e&&(this._productFormLink=e),this.shopifyStore.findExpressPaymentButtons().length&&(this._buyNowCapture=!0)}let e=document.querySelector("shopify-paypal-button");return e&&(e.style.display="none",a.warn("[live-options] hiding paypal buy now")),null!==this._productForm}_initVariantOptions(){let e=this.shopifyStore.findProductFormVariantId(this._productFormParentEl||this._productForm);if(this.settings.product&&this.settings.product.variants&&(e||(e=this.settings.product.variants[0].id.toString()),this.config.variantOption&&this.settings.product.variants.length>1&&(this._variantOptions=new $o(this.config,this._productFormParentEl||this._productForm,{product:this.settings.product,variant:this._getVariantById(e),editorMode:this.settings.editorMode}),dr.productVariantFilter&&this._variantOptions.filterVariantValues()),this.settings.editorMode))if(this._variantIdOption={name:"id",id:"option_"+this.settings.product.id+"_id",value:e,params:{name:"id",info:"<b>Only shown in the App to test conditional options based on the selected variant.</b>"},visible:!0},1===this.settings.product.variants.length||this.config.variantOption)this._variantIdOption.type="hidden";else{this._variantIdOption.label="Variant",this._variantIdOption.type="select",this._variantIdOption.values=[];for(let e=0;e<this.settings.product.variants.length;e++){const t=this.settings.product.variants[e];this._variantIdOption.values.push({text:t.title,value:t.id.toString()})}}return e}_watchVariantChanges(){let e=this._initVariantOptions();return this._onVariantChange(null,e),this._productForm.addEventListener("change",(e=>this._onVariantChange(e))),this._productFormParentEl&&this.shopifyStore.onVariantIdChange(this._productFormParentEl,((e,t)=>this._onVariantChange(e,t))),dr.productVariantHistory&&(dr.productVariantHistoryPush&&this._watchVariantHistory("pushState"),dr.productVariantHistoryReplace&&this._watchVariantHistory("replaceState")),null!==this._variantId}_watchVariantHistory(e){if("function"==typeof window.history[e]){const t=window.history[e],i=this._productForm;window.history[e]=function(e){return setTimeout((function(){i.dispatchEvent(new Event("change"))}),300),t.apply(window.history,arguments)}}}_onVariantChange(e,t){if(t||(t=this.shopifyStore.findProductFormVariantId(this._productFormParentEl||this._productForm)),t!==this._variantId){if(this._variantId=t,delete this.conditionsEngine.data.variant,this._variantId){let e=this._getVariantById(this._variantId);e&&(this.conditionsEngine.data.variant=e),this._clearVisibleEditor(),this._triggerEvent("option:variant_changed",{variantId:this._variantId})}this.render()}}_getVariantById(e){if(this.settings.product.variants&&this.settings.product.variants.length>0)for(let t=0;t<this.settings.product.variants.length;t++){const i=this.settings.product.variants[t];if(i.id.toString()===e.toString())return i}return null}_triggerEvent(e,t){const i=new CustomEvent(e,{detail:t,cancelable:!0,bubbles:!0});this.element.dispatchEvent(i),this._productFormParent||this._productForm.dispatchEvent(i)}_optionValueChanged(e){e._variantOption&&this._variantOptions&&this._variantOptionValueChanged(e),this._clearVisibleEditor(),e.errors&&e.errors.length&&(e._error?delete e._error:e.errors.length=0),this._triggerEvent("option:changed",e),this.render()}_variantOptionValueChanged(e){let t=this._variantOptions.findSelectedVariant();t||(this._variantOptions.resetVariant(e),this._variantOptions.syncAllVariantOptions()),dr.productVariantFilter&&this.config.variantOptions.length>1&&this._variantOptions.filterVariantValues(),this._variantOptions.syncVariantChanges(e),this._variantIdOption&&t&&(this._variantIdOption.value=t.id.toString(),this._onVariantChange(null,this._variantIdOption.value))}_clearVisibleEditor(){this.settings.editorMode&&(this.visibleEditor={})}_clearOptionError(e,t,i){const r=t.errors.indexOf(i);r>-1&&t.errors.splice(r,1),this.render()}_generateOptionIds(e,t,i=!0,r=0){for(let o=0;o<e.length;o++){const n=e[o];let a=String(r+o);if(n.id=t+a,n.list&&this.settings.lists&&this.settings.lists.hasOwnProperty(n.list)&&(n.values=JSON.parse(JSON.stringify(this.settings.lists[n.list]))),"personalize"===n.type&&i){let e=this._initPersonalize(n);return this._generateOptionIds(e,t,r)}n.options&&n.options.length&&this._generateOptionIds(n.options,n.id+"_")}}_evaluateOptionConditions(e){for(let t=0;t<e.length;t++){const i=e[t];let r=!0;i.conditions&&i.conditions.length&&(r=this.conditionsEngine.evaluateConditions(i.conditions,i.conditionMode||yo.MODE.AND,"option.name="+i.name)),this.settings.editorMode&&this.visibleEditor.hasOwnProperty(i.name)&&(r=this.visibleEditor[i.name]),this.visible[i.name]=r,i.visible=r,i.options&&i.options.length&&this._evaluateOptionConditions(i.options)}}_evaluateOptionPrice(e){this.price.options={},this.price.total=0,this.price.totalBase=0,this.price.variants=[],this.price.variantTotal=0,this.price.weight=0,this.price.final=0,this.price.sku=[],this._pr=this._pp({total:0,totalBase:0,variantTotal:0}),this._evaluateOptionPriceTotal(e),dr.productPriceDeductVP&&(this._pr=this._pp({...this._pr,total:this._dVP(this._pr.total,!1),totalBase:this._dVP(this._pr.totalBase)}),this.price.total=this._pr.total,this.price.totalBase=this._pr.totalBase),this._patchProductPriceTotal(),this._patchProductWeightTotal(),this._patchProductSku()}_patchProductPriceTotal(){let e=this._variantPrice;if(this._variantId){let t=this._getVariantById(this._variantId);t&&(e=t.price,this._variantPrice=e,this._variantCompareAtPrice=t.compare_at_price)}if(!isNaN(e)&&(this.price.final=this.price.total+e/100,0!==this.price.total||this._priceElList&&this._priceElList.length||dr.productPriceDeductVP)){if(this._priceElList&&this._priceElList.length)for(let e=0;e<this._priceElList.length;e++)if(!o.isInPage(this._priceElList[e])){delete this._priceElList;break}if((!this._priceElList||0===this._priceElList.length)&&(this._priceElList=document.querySelectorAll('[data-live-price="'+this.settings.product.id+'"]'),0===this._priceElList.length&&dr.productPrice&&!this.settings.editorMode)){let t=cr(e,this.shopifyStore.trimMoneyFormatAmount(ur.moneyFormat)),i=o.findElementContainsRegex("*",new RegExp(`^.{0,50}${t}.{0,50}$`,"s"));if(i.length>0&&(i=i.filter((e=>!o.isHidden(e)&&!this._wrapper.contains(e)))),0===i.length&&(a.debug("no productPrice elements found for price:",t),dr.amountNoDecimals&&(t=cr(e,"{{ amount_no_decimals }}"),a.debug("trying fallback {{ amount_no_decimals }} price: ",t),i=o.findElementContainsRegex("*",new RegExp(`^.{0,50}${t}.{0,50}$`,"s")),i.length>0&&(i=i.filter((e=>!o.isHidden(e)&&!this._wrapper.contains(e)))))),i.length)if(a.debug("found "+i.length+" productPrice elements",i),dr.productPriceAll)this._priceElList=i.filter((e=>{for(let t=0;t<i.length;t++){const r=i[t];if(r!==e&&e.contains(r))return!1}return!0}));else{let e=null,t=-1,r=this._wrapper.getBoundingClientRect();for(let o=0;o<i.length;o++){const n=i[o];let a=n.getBoundingClientRect(),s=Math.abs(r.top-a.top)+Math.abs(r.left-a.left);(!e||e.contains(n)||s<t)&&(e=n,t=s)}e&&(this._priceElList=[e])}}const t=()=>{let t=e+100*this.price.total,i=cr(t,ur.moneyFormat);if(this._priceElList&&this._priceElList.length)for(let e=0;e<this._priceElList.length;e++){const t=this._priceElList[e];t.innerHTML=i,dr.productPriceObserver&&(t.dataset.liveFormat=t.textContent)}this._triggerEvent("options:price",{price:t,priceFormat:i})};if(t(),dr.productPriceTimeout&&setTimeout((()=>t()),1e3),this._variantCompareAtPrice){let e=document.querySelectorAll('[data-live-price-compare="'+this.settings.product.id+'"]');if(e.length){let t=cr(this._variantCompareAtPrice+100*this.price.total,ur.moneyFormat);for(let i=0;i<e.length;i++){e[i].innerHTML=t}}}dr.productPriceObserver&&!this._priceElObserver&&"MutationObserver"in window&&(this._priceElObserver=new MutationObserver((e=>{if(this._priceElList&&this._priceElList.length){a.trace("observer priceEl for removed nodes",this._priceElList);let t=!1;for(let i=0;i<e.length;i++){const r=e[i];if(r.removedNodes.length>0){if(1===r.removedNodes.length&&1!==r.removedNodes[0].nodeType&&3!==r.removedNodes[0].nodeType)continue;const e=Array.from(r.removedNodes);for(let i=0;i<this._priceElList.length;i++){const o=this._priceElList[i];if(r.target===o&&o.dataset.liveFormat){let e=o.textContent;o.dataset.liveFormat!==e&&(a.debug("priceEl was modified (reset to liveFormat):",o),o.innerText=o.dataset.liveFormat)}else if(e.indexOf(o)>-1||e.some((e=>e.contains(o)))){a.debug("priceEl was removed:",o),t=!0;break}}}if(t)break}t&&(a.debug("-> triggering patchProductTotal"),this._patchProductPriceTotal())}})),this._priceElObserver.observe(document.body,{subtree:!0,childList:!0}))}}_patchProductWeightTotal(){if((0!==this.price.weight||this._weightElList&&this._weightElList.length)&&(this._weightElList&&0!==this._weightElList.length||(this._weightElList=document.querySelectorAll('[data-live-weight="'+this.settings.product.id+'"]')),this._weightElList&&this._weightElList.length))for(let e=0;e<this._weightElList.length;e++){const t=this._weightElList[e];let i=this.price.weight;if(this._variantId){let e=this._getVariantById(this._variantId);e&&e.weight&&(e.grams?i+=e.grams/1e3:i+=e.weight/1e3)}let r=i.toFixed(2)+"kg",o=t.dataset.liveWeightUnit||"kg";"g"===o?r=Math.round(1e3*i)+"g":"lb"===o?r=(2.205*i).toFixed(2)+"lb":"oz"===o&&(r=(35.274*i).toFixed(2)+"oz"),t.innerHTML=r}}_patchProductSku(){if(this.price.sku.length||this._skuElList&&this._skuElList.length){if(this._variantId){let e=this._getVariantById(this._variantId);e&&e.sku&&this.price.sku.unshift(e.sku)}if(this.sku=this.price.sku.join(this.settings.skuSep),this._skuElList&&0!==this._skuElList.length||(this._skuElList=document.querySelectorAll('[data-live-sku="'+this.settings.product.id+'"]')),this._skuElList&&this._skuElList.length)for(let e=0;e<this._skuElList.length;e++){this._skuElList[e].innerHTML=this.sku}}}_evaluateOptionValue(e){if(fr.FORMULA)for(let t=0;t<e.length;t++){const i=e[t];if("value-formula"===i.type&&i.params.valueFormula){if(!i.visible)continue;if(i._optionValue=i._optionValue||{value:"",priceFormula:i.params.valueFormula},i.value=this._priceValueFormula(i,i._optionValue,!1),i.params.valueCopy){let e=this._getOption(i.params.valueCopy);e&&(e.value=i.value)}}i.options&&i.options.length&&this._evaluateOptionValue(i.options)}}_evaluateOptionPriceTotal(e){for(let t=0;t<e.length;t++){const i=e[t];if(i.visible){if(i._priceText&&delete i._priceText,void 0!==i.value&&i.values)for(let e=0;e<i.values.length;e++){const t=i.values[e];let r;if(i._controller&&"function"==typeof i._controller.isSelected?r=i._controller.isSelected(i,t):(r=String(t.value).trim()===String(i.value).trim(),t.priceText&&(r=!!i.value)),t.priceType)if(t.hasOwnProperty("_price")||(t._price=t.price),t.priceType===gr.PERCENTAGE){let e=this._getVariantById(this._variantId);e&&e.price?t.price=e.price/100/100*t._price:t.price=0}else if(t.priceType===gr.LETTER){let e=i.value;if(i.params.priceTextClean){if(!i._priceTextClean)try{i._priceTextClean=new RegExp(i.params.priceTextClean,i.params.textCleanFlags||"ug")}catch(e){a.error("failed to compile priceTextClean pattern for option: ",i.params.priceTextClean,i,e)}i._priceTextClean&&i._priceTextClean.test(e)&&(e=e.replaceAll(i._priceTextClean,""))}let r=e.length;i.params.priceTextMin&&(r=Math.max(0,r-i.params.priceTextMin)),t.price=t._price*r}else t.priceType===gr.FORMULA&&fr.FORMULA&&(t.price=this._priceValueFormula(i,t));if(t.priceVariant&&(t.priceVariantCart&&!this.settings.editorMode&&0!==t.priceVariant.quantity&&this._lookupCartQuantity(t.priceVariant.id).then((e=>{e>0&&(t.priceVariant.quantity=0,t.price=0,this.render())})),t.quantityInput&&!isNaN(t.priceVariant.quantity)&&(t.hasOwnProperty("_price")||(!dr.productLinkAvailable&&t.priceVariant.quantity>1&&(t.price=parseFloat(t.priceVariant.price)),t._price=t.price),t.price=t._price*t.priceVariant.quantity)),r){this.settings.priceWeight&&t.weight&&(this.price.weight+=t.weight),this.settings.sku&&t.sku&&this.price.sku.push(t.sku);let e=!1;if(t.priceVariant&&(this.price.variants.push(t.priceVariant),t.priceVariantQuantity&&(t.priceVariant.quantity=-1),e=t.priceVariant.exclude||dr.productVariantExcludeTotal,t.price&&!e&&(this.price.variantTotal+=t.price,this._pr=this._pp({...this._pr,variantTotal:this._pr.variantTotal+t.price}))),t.price){let r,o,n=t.price;t.priceVariant||(o=n,this.price.totalBase+=o,this._pr=this._pp({...this._pr,totalBase:this._pr.totalBase+o}),ur.currencyConvert&&(n=hr(o))),this.price.options.hasOwnProperty(i.name)?(r=this.price.options[i.name],r.price+=n,r.priceBase&&(r.priceBase+=o)):r={option:i,price:n,priceBase:o},e||(this.price.total+=n,this._pr=this._pp({...this._pr,total:this._pr.total+n})),r.priceText=cr(100*r.price,ur.moneyFormat),i.label&&i.params.labelPriceText&&(i._priceText=r.priceText),t.priceVariant||(this.price.options[i.name]=r)}}}i.options&&i.options.length&&this._evaluateOptionPriceTotal(i.options)}}}_priceValueFormula(e,t,i=!0){let r=0,o=t.priceFormula;try{if(!t._priceFunction)try{-1===o.indexOf("return")&&(o="return ( "+o+" )"),t._priceFunction=Function('"use strict";return (function(option, value, price, options){ '+o+" })")()}catch(i){a.error("failed to parse optionValue.priceFormula: ",t,o,i),this.settings.editorMode&&(e.errors=e.errors||[],-1===e.errors.indexOf(i.message)&&e.errors.push(i.message))}t._priceFunction&&(this._priceFunctionUtil=this._priceFunctionUtil||{option:e=>this._getOption(e),value:e=>{const t=this._getOption(e);return t?t.value:""},price:e=>{if(this.price.options.hasOwnProperty(e)){let t=this.price.options[e];return t.priceBase||t.price}return 0},controller:e=>{const t=this._getOption(e);return t&&t._controller?t._controller:{}},variant:e=>this._getVariantById(e||this._variantId),weight:(e,t,i)=>{const r=this._getOption(e);if(r)for(let e=0;e<r.values.length;e++){const o=r.values[e];if(o.value==(i||r.value))return isNaN(t)||(o.weight=t),o.weight}return 0}},r=t._priceFunction(e,t.value,t._price,this._priceFunctionUtil),i&&(r?"number"!=typeof r&&(r=parseFloat(r),isNaN(r)&&(r=0)):r=0,r>0&&e.params.priceFormulaDeductVP&&(r=this._dVP(r))))}catch(t){a.error("failed to calculate price with priceFormula: ",o,t),this.settings.editorMode&&(e.errors=e.errors||[],-1===e.errors.indexOf(t.message)&&e.errors.push(t.message))}return r}_watchFormSubmit(){this._productFormSubmit=!1,this._handleCartAdd(),this.shopifyStore.onProductFormSubmit(this._productForm,this._productFormParentEl||this._productForm,(e=>this._handleFormSubmit(e)),dr.productFormCapture),(this._productFormParentEl||this._productForm).addEventListener("keypress",(e=>{if(e.target&&"INPUT"===e.target.tagName){13===(e.keyCode||e.which)&&(e.preventDefault(),e.target.blur())}}))}_handleFormSubmit(e){if(!this._productFormSubmit){if(this._productFormSubmit=!0,!this.validate())return this._productFormSubmit=!1,e.preventDefault(),void e.stopImmediatePropagation();dr.productOptionsEmptyExclude&&this._disableEmptyOptions();const t=this._pr;let i=this._hasExportPreviews(),r=0!==t.total||this.price.variants.length>0;this._buyNowCapture=!0;let o=i||r||this._itemKey||this._buyNowCapture&&this.shopifyStore.isExpressPaymentButton(e.target);o&&(e.preventDefault(),e.stopImmediatePropagation(),this._productFormEvent=e,this._triggerFormDisabled(!0),this._triggerEvent("options:submit_prevent"));let n=[];if(i){let e=Promise.resolve(),t=this._getPreviews();for(let i=0;i<t.length;i++){const r=t[i];if(this._isExportPreview(r)){let t=document.createElement("progress");t.max=100,t.value=0,t.className="cl-po--preview-progress";let i=this._wrapper;this._popupEl&&(i=this._popupEl.querySelector(".options-atc")),i.appendChild(t);let o=e=>new Promise((function(t,i){setTimeout(i.bind(null,e),1e3)})),n=!1;e=e.then((()=>{let e=Promise.reject();for(let i=0;i<3;i++)e=e.catch((e=>{e&&(n=!0,a.warn("[live-options] preview export error",e),i>1&&(e.try=i),dr.previewExportLog&&this._upload._fileMeta.exportFailed(e));try{return this._exportPreview(r,t)}catch(e){return e.sync=!0,Promise.reject(e)}})).catch(o);return e.finally((()=>{i.removeChild(t)})),e})).then((()=>{n&&this._upload._fileMeta.exportFailed({success:!0})})).catch((e=>{if(e&&(a.error("[live-options] preview final failed",e),e.failed=!0,dr.previewExportLog&&this._upload._fileMeta.exportFailed(e),e.upload&&(alert(e.error),dr.previewExportRequired=!0)),dr.previewExportRequired)return this._productFormSubmit=!1,Promise.reject()}))}}n.push(e)}if(r){const e=ko.generateId();let i=Promise.resolve();if(this.price.variants.length)for(let t=0;t<this.price.variants.length;t++){const r=this.price.variants[t];let o={};if(dr.productAddonBundle&&(o[pr.BUNDLE]=e,this._setFormProperty(pr.BUNDLE,e)),0===r.quantity)continue;if(-1===r.quantity){let e=(this._productFormParentEl||this._productForm).querySelector('[name="quantity"]');e&&e.value?r.quantity=e.value:r.quantity=1}let n=this.shopifyCart.toItem(r.id,r.quantity,o);i=i.then((()=>this.shopifyCart.addItem(n))).catch((e=>{let t="Live Product Options: "+(e.description||"")+"\n**please check the linked products on options**";this.shopifyStore.isThemeEditor()?alert(t):console.error(t)}))}const o=this._pp({t:t.total-t.variantTotal});if(o.t>0||o.t<0&&ur.checkout.negative){const i=this._pp({m:Math.round(100*o.t),b:Math.round(100*t.totalBase)});let r={};r[pr.ID]=e;let n=!(ur.checkout.update||!ur.checkout.variantId)&&{};for(const e in this.price.options)if(this.price.options.hasOwnProperty(e)){const t=this.price.options[e];let i=t.priceText.replace(/(<([^>]+)>)/gi,"");r[t.option.name]=i,t.priceBase&&(r["_"+t.option.name]=t.priceBase,n&&(n[t.option.name]=t.priceBase))}this._setFormProperty(pr.ID,e),this._setFormProperty(pr.PRICE,i.m),ur.currencyConvert&&(this._setFormProperty(pr.CURRENCY,ur.currency),this._setFormProperty(pr.PRICE_BASE,i.b)),ur.checkout.key&&this._setFormProperty(pr.PRICE_KEY,this._pk(ur.currencyConvert?i.b:i.m,ur.checkout.key)),ko.storeItem(e,{properties:r,currency:ur.currency}),n&&this._setFormProperty(pr.JSON_PRICE,JSON.stringify(n))}else r=!1;n.push(i)}r||(this._removeFormProperty(pr.ID),this._removeFormProperty(pr.PRICE),this._removeFormProperty(pr.PRICE_BASE),this._removeFormProperty(pr.PRICE_KEY),this._removeFormProperty(pr.CURRENCY),this._removeFormProperty(pr.JSON),this._removeFormProperty(pr.JSON_PRICE)),this.settings.priceWeight&&this.price.weight>0?this._setFormProperty(pr.WEIGHT,this.price.weight):this._removeFormProperty(pr.WEIGHT),this.settings.sku&&this.sku?this._setFormProperty(this.settings.skuProp,this.sku):this._removeFormProperty(this.settings.skuProp),o||"cloudlift.cart"!==e.type||(o=!0);let s=null;if(!ur.checkout.update&&(r||ur.checkout.image&&i)&&(s=()=>{let e=this.shopifyStore.getFormProperties(this._productForm),t=[pr.JSON,pr.JSON_PRICE,pr.PRICE_KEY];for(const i of t)delete e[i];this._setFormProperty(pr.JSON,JSON.stringify(e))}),o)return Promise.all(n).then((()=>{if(s&&s(),this._itemKey&&-1!==this._itemKey.indexOf(this._variantId)){const t=()=>this.shopifyCart.updateItemById({id:this._itemKey,quantity:this.shopifyStore.findProductFormQuantity(this._productFormParentEl||this._productForm),properties:this.shopifyStore.getFormProperties(this._productForm)}).then((()=>{"function"==typeof window.clOnCartUpdate?window.clOnCartUpdate():window.location.href=this.shopifyStore.settings.api+"/cart"}));if(dr.productItemModal){let i="product.options.item.modal.",r=document.createElement("dialog");return r.className="cl-po--dialog",r.innerHTML=`\n                                  <form method="dialog">\n                                    <h4>${l.get(i+"title")}</h4>\n                                    <div class="action">\n                                      <button class="cl-po--swatch cl-po--swatch-button cl-po--small" value="update">${l.get(i+"update")}</button>\n                                      <button class="cl-po--swatch cl-po--swatch-button cl-po--small" value="add">${l.get(i+"add")}</button>\n                                    </div>\n                                  </form>`,void 0!==window.dialogPolyfill&&(window.dialogPolyfill.registerDialog(r),r.style.height="auto"),this._wrapper.appendChild(r),r.showModal(),r.addEventListener("close",(()=>{"update"===r.returnValue?t():"cloudlift.cart"===e.type?(delete this._itemKey,delete this._productFormSubmit,this._handleFormSubmit(e)):this._triggerFormEvent()})),!0}if(dr.productItemUpdate)return t()}return dr.productBuyNow&&this.shopifyStore.isExpressPaymentButton(e.target)&&(e=new CustomEvent("cloudlift.cart",{detail:{onSuccess:()=>{window.location.href=this.shopifyStore.settings.api+"/checkout"}},cancelable:!0,bubbles:!1})),"cloudlift.cart"===e.type?this.shopifyCart.addItem({id:this._variantId,quantity:this.shopifyStore.findProductFormQuantity(this._productFormParentEl||this._productForm),properties:this.shopifyStore.getFormProperties(this._productForm)}).then((()=>(this._productFormSubmit=!1,e.detail&&"function"==typeof e.detail.onSuccess?e.detail.onSuccess():window.location.href=this.shopifyStore.settings.api+"/cart",!0))):(this._triggerFormEvent(),this._triggerEvent("options:submit"),!0)})).catch((e=>(a.error("[live-options] submit handler error",e),this._productFormSubmit=!1,this._triggerFormDisabled(!1),!1)));s&&s(),setTimeout((()=>{this._triggerEvent("options:submit"),this._productFormSubmit=!1,this._triggerFormDisabled(!1)}),300)}return Promise.resolve(!1)}_handleCartAdd(){let e=document.querySelectorAll("[data-live-cart-add]");if(e.length){a.debug("found manual cart add btn",e);for(let t=0;t<e.length;t++){const i=e[t];(this._productFormParentEl||this._productForm).contains(i)&&(dr.productFormCapture=!1),i.addEventListener("click",(e=>{i.dataset.liveCartAdd&&this.settings.product.id.toString()!==i.dataset.liveCartAdd||(e.preventDefault(),e.stopImmediatePropagation(),this._productFormSubmit=!1,this._handleFormSubmit(new CustomEvent("cloudlift.cart",{detail:{},cancelable:!0,bubbles:!1})))}),{capture:!0})}}}_setFormProperty(e,t){let i;this._formInputs?this._formInputs.hasOwnProperty(e)&&(i=this._formInputs[e]):this._formInputs={},i?i.value=t:(i=document.createElement("input"),i.type="hidden",i.name="properties["+e+"]",i.value=t,this._productForm.appendChild(i)),this._formInputs[e]=i}_removeFormProperty(e){if(this._formInputs&&this._formInputs.hasOwnProperty(e)){let t=this._formInputs[e];t.parentNode.removeChild(t),delete this._formInputs[e]}}_triggerFormEvent(){if(this._triggerFormDisabled(!1),this._productFormEvent){let e=this._productFormEvent;e.target||e.currentTarget?"click"===e.type?e.target&&e.target.click?e.target.click():e.currentTarget&&e.currentTarget.click?e.currentTarget.click():"BUTTON"===e.target.parentNode.tagName&&e.target.parentNode.click():"submit"===e.type&&e.target.submit():(a.error("missing event target - manual form submit"),this._productForm.submit()),this._productFormEvent=null,this._productFormSubmit=!1}this._optionValuesClear&&setTimeout((()=>{this.setValues(this._optionValuesClear),this.render(),this._renderPreview()}),1e3)}_triggerFormDisabled(e){if(dr.productFormDisabled)if(e){if(this._productFormEvent){let e=this._productFormEvent.target||this._productFormEvent.currentTarget;e&&("BUTTON"===e.tagName?this._btnDisabled=e:this._btnDisabled=e.closest("button"),this._btnDisabled&&this._btnDisabled.setAttribute("disabled","disabled"))}}else this._btnDisabled&&(this._btnDisabled.removeAttribute("disabled"),delete this._btnDisabled)}_getControllers(e={},t=this.config.options){for(let i=0;i<t.length;i++){const r=t[i];r.options&&r.options.length?this._getControllers(e,r.options):r._controller&&(e[r.name+"_"+r.type]=r._controller)}return e}_setControllers(e,t=this.config.options){for(let i=0;i<t.length;i++){const r=t[i];r.options&&r.options.length?this._setControllers(e,r.options):e.hasOwnProperty(r.name+"_"+r.type)&&(r._controller=e[r.name+"_"+r.type])}}_getOption(e,t=this.config.options){for(let i=0;i<t.length;i++){const r=t[i];if(r.name===e)return r;if(r.options&&r.options.length){let t=this._getOption(e,r.options);if(t)return t}}return null}_initPreview(){this.config.previewConfig.gallery?(this._gallery=new Fo(this.config,this._productForm,this.conditionsEngine,{api:this.settings.api,assets:this.settings.assets,selector:this.settings.selectorPreview,selectorThumbnail:this.settings.selectorThumbnail,position:this.settings.positionPreview,sticky:this.settings.stickyPreview,stickyMobile:this.settings.stickyPreviewMobile,stickyMobileSize:this.settings.stickyPreviewMobileSize,zoom:this.settings.previewZoom,maxHeight:this.settings.maxHeightPreview,product:this.settings.product,variantId:this._variantId,editorMode:this.settings.editorMode,galleryConfig:this.config.previewConfig.galleryConfig}),this._gallery.ready&&(this._gallery.ready.then((e=>{this._preview=this._gallery._preview})),this._gallery.element.addEventListener("preview:active",(()=>{this._preview=this._gallery._preview})))):this._preview=new Oo(this.config,this.config.previewConfig,this._productForm,this.conditionsEngine,{api:this.settings.api,assets:this.settings.assets,selector:this.settings.selectorPreview,selectorThumbnail:this.settings.selectorThumbnail,position:this.settings.positionPreview,sticky:this.settings.stickyPreview,stickyMobile:this.settings.stickyPreviewMobile,stickyMobileSize:this.settings.stickyPreviewMobileSize,zoom:this.settings.previewZoom,maxHeight:this.settings.maxHeightPreview,product:this.settings.product,variantId:this._variantId,editorMode:this.settings.editorMode})}_renderPreview(){this.config.preview&&(this._gallery&&this._gallery.ready?this._gallery.ready.then((()=>this._gallery._previews.forEach((e=>e.renderPreview())))):this._preview&&this._preview.ready&&this._preview.ready.then((()=>this._preview.renderPreview())))}_destroyPreview(){this._gallery?(this._gallery.destroy(),delete this._gallery):this._preview&&this._preview.destroy(),delete this._preview}_getPreviews(){return this._gallery?this._gallery._previews:this._preview?[this._preview]:[]}_isExportPreview(e){let t=e.previewConfig.export&&(e.previewConfig.exportConfig.thumbnail||e.previewConfig.exportConfig.original||fr.EXPORT&&e.previewConfig.exports&&e.previewConfig.exports.length);if(!t)for(let t=0;t<e.previewConfig.layers.length;t++){const i=e.previewConfig.layers[t];if(i.params.crop&&"upload"===i.type)return!0;if(i.params.exportCoords)return!0}return t}_hasExportPreviews(){let e=this._getPreviews();for(let t=0;t<e.length;t++)if(this._isExportPreview(e[t]))return!0;return!1}async _uploadPreview(e,t,i=100){return(await this._upload.upload([e],(e=>{if(t&&e.lengthComputable){let r=e.loaded/e.total*100;r=Math.min(r,i),r>t.value&&(t.value=r)}})))[0]}async _exportPreview(e,t){let i=e.previewConfig;if(i.export){if(t.value=15,fr.EXPORT&&i.exports&&i.exports.length){let r="svg",o="excludeOriginal",n=e.export({width:i.width,height:i.height},!1,!dr.previewBlobs,o,r);if(n){dr.previewBlobs&&(n=await this._exportBlobs(n));let e=this._upload._fileMeta.fromBlob(n,"preview_export."+r);e.meta.variant="export";let o=i.exportConfig.original?50:80,a=await this._uploadPreview(e,t,o);for(let e=0;e<i.exports.length;e++){const t=i.exports[e];this._setFormProperty(t.property,this._exportConfigUrl(t,a))}}else for(let e=0;e<i.exports.length;e++)this._removeFormProperty(i.exports[e].property)}if(i.exportConfig.thumbnail){let r=e.export({width:i.exportConfig.thumbnailWidth,height:i.exportConfig.thumbnailHeight},!1,!0,"excludeThumbnail","png",.8);if(r){let o=this._upload._fileMeta.fromBlob(r,"preview_thumbnail.png");o.meta.variant="thumbnail";let n=null;if(i.exportConfig.thumbnailActive||window.clExportPreviewActive?(o.meta.property=e.active?"_preview":i.exportConfig.thumbnailProperty,i.exportConfig.thumbnailActiveOnly=!0,i.exportConfig.thumbnailActiveOnly&&!e.active||(n=o)):(o.meta.property=i.exportConfig.thumbnailProperty,n=o),n){let e=i.exportConfig.original?50:80;if(!1){let i=(await this.shopifyCart.addItemFormData({id:this._variantId,properties:{upload:n._file}},(i=>{t.value=e}))).data;await this.shopifyCart.removeItemById(i.key),this._setFormProperty(o.meta.property,i.properties.upload)}else{let i=await this._uploadPreview(n,t,e);this._setFormProperty(i.meta.property,i.url)}}}else this._removeFormProperty(i.exportConfig.thumbnailProperty)}if(i.exportConfig.original){let r=!(!i.exportConfig.crop||!i.exportConfig.cropConfig.width)&&i.exportConfig.cropConfig,o=i.exportConfig.originalFormat||"png",n=e.export({width:i.width,height:i.height},r,!0,"excludeOriginal",o);if(n){let e=this._upload._fileMeta.fromBlob(n,"preview_original."+o);e.meta.variant="original",e.meta.property=i.exportConfig.originalProperty;let r=await this._uploadPreview(e,t);this._setFormProperty(r.meta.property,r.url)}else this._removeFormProperty(i.exportConfig.originalProperty)}}for(let i=0;i<e.previewConfig.layers.length;i++){const r=e.previewConfig.layers[i];if("upload"===r.type&&(r.params.crop||r._removeBg)){let i="jpeg";(r._url&&-1!==r._url.indexOf(".png")||r._removeBg)&&(i="png");let o=e.exportLayer(r.name,!0,i,.8),n=r.params.option||r.name;if(o){let e=this._upload._fileMeta.fromBlob(o,n+"_crop."+i);e.meta.variant="original",e.meta.property=n,r._removeBg&&(e.meta.property="_remove_bg_"+n);let a=await this._uploadPreview(e,t);this._setFormProperty(a.meta.property,a.url)}else this._removeFormProperty(n)}if(r.params.exportCoords){let t=e.exportLayerCoords(r.name);t?this._setFormProperty("_"+r.name,`x:${t.x},y:${t.y},w:${t.w},h:${t.h}`+(0!==t.r?`,r:${t.r}`:"")):this._removeFormProperty("_"+r.name)}}}async _exportBlobs(e){let t,i=/xlink:href="blob:([^"]+)"/g;for(;t=i.exec(e);){let i=`blob:${t[1]}`,r=await fetch(i),o=await r.blob(),n=this._upload._fileMeta.fromBlob(o,"blob."+o.type.replace("image/",""));n.meta.variant="blob";let a=await this._uploadPreview(n);e=e.replace(i,a.url)}return new Blob([e],{type:"image/svg+xml"})}_exportConfigUrl(e,t){let i=t.path.replace(".svg","."+e.format),r=this.settings.api.replace("api","convert").replace("local","dev")+"/export/"+i,o={w:e.width,h:e.height,u:e.unit,dpi:e.dpi};return e.crop&&e.cropConfig&&(o.cW=e.cropConfig.width,o.cH=e.cropConfig.height,o.cX=e.cropConfig.x,o.cY=e.cropConfig.y),r+"?c="+btoa(JSON.stringify(o))}_initTooltips(){if(this._tippyInstances&&fr.FORMULA)for(let e=0;e<this._tippyInstances.length;e++){const t=this._tippyInstances[e];let i=t.reference.getAttribute("data-tippy-content");t.props.content!==i&&t.setContent(i)}let e=this._wrapper.querySelectorAll('[data-tippy-content]:not(.init):not([data-tippy-content=""])');if(e.length>0){this._tippyInstances||(this._tippyInstances=[]);for(let t=0;t<e.length;t++){const i=e[t];let r=i.getAttribute("data-tippy-content"),o=-1!==r.indexOf("<")&&-1!==r.indexOf(">"),n="ontouchstart"in window;if(r=r.trim(),r){const e={allowHTML:!0,maxWidth:350,interactive:o,appendTo:dr.tooltipBody?document.body:"parent"};n&&(e.trigger="click",e.onShow=e=>{setTimeout((function(){e.hide()}),window.clTooltipDuration||3e3)}),this._tippyInstances.push(gi(i,e))}i.classList.add("init")}}}_initPersonalize(e){e._controller={onValidate:e=>!e.required||e.value===e.values[0].value||(e.value=e.values[0].value,this.render(),e.params.popup?this._onPersonalizeChanged(e):e.params.validationMsg&&e.errors.push(e.params.validationMsg),!1),onChange:(e,t)=>{this._optionValueChanged(t),this._onPersonalizeChanged(t)}};let t=[...this.config.options];t.splice(this.config.options.indexOf(e),1),t=t.filter((e=>"personalize"!==e.type));let i=[];if(e.params.pExclude){let r=e.params.pExclude.split(",");t=t.filter((e=>-1===r.indexOf(e.name)||(i.push(e),!1)))}let r=[];r.push(e),e.values&&0!==e.values.length||(e.values=[{value:""}]);let o={data:"options",field:e.name,operator:"equals",value:e.values[0].value};if(r.push({name:"group_personalize",type:"group",value:"",required:!1,conditions:[o],params:{collapseOpen:!1,collapseLabel:"",collapse:!1},options:t,id:"option_group_personalize",visible:!1}),this.settings.editorMode&&e.params.popup&&(e.params.popup=!1),e.params.popup&&(this._productFormLinkForce=!0),this.config.preview){e.params.popup&&(this.config.preview=!1);const t=(e,t)=>{for(let i=0;i<e.length;i++){const r=e[i];r.params.option&&r.conditions.unshift(t)}};if(t(this.config.previewConfig.layers,o),this.config.previewConfig.gallery)for(let e=0;e<this.config.previewConfig.views.length;e++){t(this.config.previewConfig.views[e].layers,o)}}return this.config.options.length=0,i.length&&this.config.options.push(...i),this.config.options.push(...r),this._personalizeOption=e,t}_onPersonalizeChanged(e){if(e.params.popup)if(e.value===e.values[0].value){this.config.preview=!0,this._personalizeGroupEl||(this._personalizeGroupEl=this._wrapper.querySelector('[data-option="group_personalize"]'),this._personalizeGroupEl.style.display="none");let t=Promise.resolve(!0);if(!$r.isDefined("popup")){let e=[this.settings.assets+"/static/lib/ldcover/ldcv.full.min.css",this.settings.assets+"/static/lib/ldcover/ldcv.min.js"];t=$r.loadOnce(e,"popup",{async:!1})}t.then((()=>{const t=()=>{let t={id:this.config.uuid,product:this.settings.product,className:"fade"+(e.params.popupFull?" full":""),option:e,visible:this.config.options[1].visible},i=this.settings.selectorPreview;if(!o.isElement(i)){if(i=document.createElement("img"),i.className="cl-po--gallery-img",this._variantId)for(let e=0;e<this.settings.product.variants.length;e++){const t=this.settings.product.variants[e];if(t.id.toString()===this._variantId.toString()){t.featured_image&&t.featured_image.src&&(i.src=t.featured_image.src);break}}i.src||(i.src=this.settings.product.featured_image)}ee(mo(i,this._personalizeGroupEl,this._popupPriceEl,t,(e=>{this._productFormSubmit=!1;let t=document.querySelector("[data-live-cart-add-popup]");if(t)window.addEventListener("options:submit",(e=>{this._popupClose=!0,this._popup.set("close",!0)}),{once:!0}),t.click();else{let e;"function"==typeof window.clOnCartUpdate&&(e=()=>{this._popup.set("close",!0),window.clOnCartUpdate()}),this._handleFormSubmit(new CustomEvent("cloudlift.cart",{detail:{onSuccess:e},cancelable:!0,bubbles:!1}))}}),(e=>{this._popup.set("close",!0)})),this._popupEl)};this._popupEl?t():(this._popupEl=document.createElement("div"),this._popupPriceEl=document.createElement("span"),this._priceElList?(o.isNodeList(this._priceElList)&&(this._priceElList=Array.prototype.slice.call(this._priceElList)),this._priceElList.push(this._popupPriceEl)):this._priceElList=[this._popupPriceEl],t(),this._personalizeGroupEl.style.display="",document.body.appendChild(this._popupEl),this._popup=new ldCover({root:this._popupEl.querySelector(".ldcv"),lock:!1}),this._popup.on("toggle.on",(()=>{if(this._preview)this._renderPreview();else{if(window.innerWidth<=768)this.settings.maxHeightPreview=Math.floor(window.innerHeight/4),25!==this.settings.stickyPreviewMobileSize&&(this.settings.maxHeightPreview=Math.floor(window.innerHeight*(this.settings.stickyPreviewMobileSize/100)));else{let e=this.config.previewConfig.gallery&&"bottom"===this.config.previewConfig.galleryConfig.layout;this.settings.maxHeightPreview=e?550:660}this._initPreview()}this.render()}))),this._popup.get().then((i=>{this._popupClose?delete this._popupClose:(e.value=e.values[1].value,this.render(),this._renderPreview(),t())})),this._popup.toggle()}))}else this._popup&&this._popup.set(!1,!0)}_destroyTooltips(){if(null!=this._tippyInstances)for(let e=0;e<this._tippyInstances.length;e++){const t=this._tippyInstances[e];t.reference.classList.remove("init"),t.destroy()}}_restoreCartItem(){let e=o.getQueryParam(window.location.href,"item");this.shopifyCart.getCart(!0).then((t=>{for(let i=0;i<t.items.length;i++){const r=t.items[i];if(r.key===e&&r.properties){if(a.debug("restoring cart item values: ",r.properties),this.setValues(r.properties),this.render(),this._renderPreview(),r.quantity>1){let e=this.shopifyStore.findProductFormQuantityEl(this._productFormParentEl||this._productForm);e&&(e.value=r.quantity)}dr.productItemModal&&"function"!=typeof HTMLDialogElement&&(this._dialogPolyfill=$r.loadOnce([this.settings.assets+"/static/lib/dialog/dialog-polyfill.min.js",this.settings.assets+"/static/lib/dialog/dialog-polyfill.min.css"],"dialog",{async:!1})),this._itemKey=e,this._personalizeOption&&this._onPersonalizeChanged(this._personalizeOption);break}}}))}_lookupCartQuantity(e){return new Promise(((t,i)=>{setTimeout((()=>{this.shopifyCart.getCart(!0).then((i=>{let r=0;for(let t=0;t<i.items.length;t++){const o=i.items[t];o.variant_id.toString()===e.toString()&&(r+=o.quantity)}return t(r)}))}),500)}))}_hasOptionsValues(){let e=this.getValues();for(const t in this.visible)this.visible[t]||delete e[t];return Object.values(e).some((e=>""!==e))}_disableEmptyOptions(){let e=this.getValues(),t=[];for(const i in e)if(!e[i]){let e=document.querySelectorAll(`[name="properties[${i}]"]`);if(e.length)for(let i=0;i<e.length;i++){const r=e[i];r.disabled||(r.disabled=!0,t.push(r))}}t.length&&this.element.addEventListener("options:submit",(e=>{t.forEach((e=>{e.disabled=!1}))}),{once:!0})}_dVP(e,t=!0){let i=this._getVariantById(this._variantId);if(i?.price){let r=i.price/100;t&&ur.currencyConvert&&1!==ur.currencyFactor&&(r*=1/ur.currencyFactor,r=Math.round(100*r)/100),e-=r,ur.checkout.negative||(e=Math.max(e,0))}return e}_pp(e){return new Proxy(e,{set:(e,t,i)=>!0})}_pk(e,t){const i=`${t}:${e}`;let r=0;for(let e=0,t=i.length;e<t;e++){r=(r<<5)-r+i.charCodeAt(e),r>>>=0}return r}constructor(e,t){let i={api:"https://api.cloudlift.app",assets:"https://assets.cloudlift.app",queryParams:{},selector:".cl-options",position:"",selectorPreview:".cl-preview",selectorThumbnail:"",positionPreview:"",stickyPreview:!1,stickyPreviewMobile:"overlay",stickyPreviewMobileSize:25,previewZoom:null,maxHeightPreview:0,selectorForm:'form[action*="/cart/add"]',classNamePrefix:"cl-po",product:{},priceDraft:!0,priceWeight:!1,sku:dr.productSKU,skuProp:window.clSKUProp||"SKU",skuSep:"string"==typeof window.clSKUSep?window.clSKUSep:"-",errorPrefix:"product.options.validity.",editorMode:!1,visible:{},visibleEditor:{},lists:null,idLink:!0};this.config=e,this.settings=o.extend(i,t||{}),this.settings.lists=t.lists,this.visible={},this.visibleEditor={},this.shopifyStore=h.getInstance(),this.shopifyCart=g.getInstance(),this.conditionsEngine=new yo({},{product:this.settings.product,options:this.config.options}),this._upload=Sr.getInstance({api:this.settings.api,queryParams:this.settings.queryParams}),Fr.settings.api=this.settings.api,Fr.settings.assets=this.settings.assets,Fr.settings.queryParams=this.settings.queryParams,this.price={options:{},total:0,totalBase:0,variants:[],variantTotal:0,weight:0,sku:[]},o.isElement(this.settings.selector)?this.element=this.settings.selector:this.element=document.querySelector(this.settings.selector),null!=this.element?(a.info("--\x3e new product-options: ",this.element),ur.currencyConvert&&1!==ur.currencyFactor||dr.productLinkAvailable&&!this.settings.editorMode?this._variantsInCurrency().then((()=>this._init())):this._init()):a.warn("no elements with selector found: ",this.settings.selector)}};var jo=class{setup(e=!1){e&&(h.products={}),this.destroy(),this.shopifyStore.parseProductJsonElements(),this.shopifyStore.tryGetProductMap().then((e=>{for(let t=0;t<this.config.configs.length;t++){const i=this.config.configs[t];if(a.debug("-> evaluating options-config:",i.uuid),0===i.targetMode){let t=[{data:"product",field:"product",products:[i.product]}];for(let r in e)if(e.hasOwnProperty(r)){let o=e[r];this._evaluateProductTargeting(i,o,t,1)}}else if(0===i.conditionMode){if(this.shopifyStore.isProduct()){let t=e[this.shopifyStore.getHandleFromUrl()+".js"];t&&this._evaluateProductTargeting(i,t,[],0)}}else if(i.conditions.length>0)for(let t in e)if(e.hasOwnProperty(t)){let r=e[t];this._evaluateProductTargeting(i,r,i.conditions,i.conditionMode)}}0===this.products.length?this.shopifyStore.isThemeEditor()&&!this.config.lazy&&this._evaluateThemeEditor(e):setTimeout((()=>{this._compatible()}),1e3)})),this.config.setup&&this.config.configs.length>0&&(this._watch||(this._watchCartItems(),dr.checkoutLog&&this._watchFormSubmit(),dr.productQuickView&&this._watchQuickView(),this._watch=!0))}destroy(){for(;this.products.length;){this.products.pop().destroy()}}async _evaluateProductTargeting(e,t,i,r){this.conditionsEngine.data.product=t;let o=this.conditionsEngine.evaluateConditions(i,r,"config.uuid="+e.uuid);if(o){this.config.lazy&&(this._lazyFetch&&await this._lazyFetch,this._lazyFetch=this._getConfigLazy(e),await this._lazyFetch);let i="#product_form_"+t.id;i+=', [data-product-form="'+t.id+'"]',o=this._createProductOptions(e,t,i),o||(o=this._createProductOptions(e,t)),o||a.error("no container found options-config:",e.uuid,t)}a.debug("--\x3e evaluated options-config:",e.uuid,t,o)}async _getConfigLazy(e){const t=-1===this.config.api.indexOf("local")?this.config.api.replace("api.","assets."):this.config.api,i=await new n(t+"/api/assets/options.json",{method:"GET",responseType:"json",queryParams:{shop:this.config.shop,config:e.uuid}});if(i.data?.configs){let t=i.data;for(let i=0;i<t.configs.length;i++){const r=t.configs[i];if(r.uuid===e.uuid)return Object.assign(e,r),a.debug("--\x3e lazy fetch options-config:",e.uuid,e),void(t.lists&&(this.config.lists=this.config.lists||{},Object.assign(this.config.lists,t.lists)))}}a.warn("[live-options] lazy config missing:",e.uuid)}_evaluateThemeEditor(e){const t="cl_live_theme";if("0"!==o.readCookie(t))for(let i in e)if(e.hasOwnProperty(i)){let r=e[i],n=this._findOrCreateContainer(null,r,'form[action*="/cart/add"]:not([id*=instal])');if(n){let e=0===this.config.configs.length,i=void 0!==n.dataset.liveOptions;n.classList.add("cl-block");let r=`<style>\n                            .cl-block { padding: 10px;border-radius: 3px;background-color: rgb(55, 167, 220, 1); border: 2px solid #000;margin-bottom: 10px;opacity: 0.75; position: relative; }\n                            .cl-block span { font-size:14px; display: block; margin-bottom:5px; }\n                            .cl-block a, .cl-block span { color:#fff; }\n                            .cl-block a.live { font-size:20px;font-weight:bold;line-height: 1;text-shadow: 1px 1px 1px black;text-decoration: none; }\n                            .cl-block a.link { font-weight:bold;text-shadow: 1px 1px 1px black; }\n                            .cl-block .live-close { position: absolute; right:7px; top:0px; font-size:20px; cursor:pointer; }\n                    </style>\n                    <span class="live-close">✅</span>\n                    <span><a class="live" href="/admin/apps/live-product-options">Live Product Options</a></span>\n                    <span>Custom product options will appear here. ${e?"":"<b>(only shown in editor)</b>"}</span>`;return e?r+="<span><b>NEXT:</b> save the theme & continue with the setup in the app.</span>":i||(r+='<span>To change the location visit: <a class="link" href="https://docs.cloudlift.app/article/126-product-options-block-in-theme-editor" target="_blank">Product Options App Block</a></span>'),n.innerHTML=r,void n.querySelector(".live-close").addEventListener("click",(e=>{n.parentElement.removeChild(n),o.writeCookie(t,"0",30,"/")}))}}}_createProductOptions(e,t,i){for(let i=0;i<this.products.length;i++){const r=this.products[i];if(r.settings.product.id===t.id)return a.debug("-> MERGE",e.uuid,"options with existing productOptions for product.id: ",t.id,e.options),r._generateOptionIds(e.options,"option_"+t.id+"_",!1,r.config.options.length),r._translate&&(r._translate.config=e,r._translate.translate()),r.config.options.push(...e.options),r._wrapper&&r.render(),dr.productLinkAvailable&&r._variantsInCurrency(e.options).then((()=>r._wrapper?r.render():null)),!0}i||(i='form[action*="/cart/add"]:not([id*=instal])');let r=1===this.config.locationMode?this.config.selector:"",n=1===this.config.locationMode?this.config.position:void 0,s=this._findOrCreateContainer(r,t,i);if(this._autoPosition&&(n=this._autoPosition,delete this._autoPosition),s){let i,r=JSON.parse(JSON.stringify(e)),a=1===this.config.previewLocationMode?this.config.previewSelector:"",l=1===this.config.previewLocationMode?this.config.previewPosition:void 0;i=o.isNodeList(s)?s:[s];for(let e=0;e<i.length;e++){const o=i[e],s=r.preview?this._findOrCreatePreviewContainer(a,t,r):void 0;this.products.push(new No(r,{api:this.config.api,assets:this.config.assets,queryParams:{shop:this.config.shop},selector:o,position:n,selectorPreview:s,positionPreview:l,selectorThumbnail:this.config.previewImgThumbnailSelector,stickyPreview:this.config.previewSticky,stickyPreviewMobile:this.config.previewStickyMobile,stickyPreviewMobileSize:this.config.previewStickyMobileSize,previewZoom:this.config.previewZoom,product:t,priceDraft:this.config.priceDraft,priceWeight:this.config.priceWeight,lists:this.config.lists}))}return!0}return!1}_findOrCreateContainer(e,t,i){let r,o;i&&(o=document.querySelector(i));const n=(e,t)=>t&&(r=t.querySelectorAll(e),r.length>0)?(a.debug("using container in form with provided selector:",i,e,r),!0):(r=document.querySelectorAll(e),r.length>0&&(a.debug("using container with provided selector:",e,r),!0));if(e)return n(e,o)?r:(a.debug("no container found with selector:",e),null);if(r=document.querySelector('[data-live-options="'+t.id+'"]'),null!=r)return a.debug("using default container with selector: [data-live-options]"),r;if(this.config.autoSelector&&n(this.config.autoSelector,o))return this.config.autoSelectorPosition&&(this._autoPosition=this.config.autoSelectorPosition),r;if(o){let e=o.querySelector("[type=submit],.add_to_cart,.btn.add-to-cart");return r=document.createElement("div"),r.className="inject",r.style.width="100%",e?e.parentNode.insertBefore(r,e):o.insertBefore(r,o.firstChild),a.debug("injected container into form:",o),r}return null}_findOrCreatePreviewContainer(e,t,i){let r;if(!e&&this.shopifyStore.isTheme("Dawn")&&(this.config.autoPreviewSelector||this.config.autoGallerySelector||(i.previewConfig.gallery?document.querySelector(".product media-gallery")?this.config.autoGallerySelector=".product media-gallery":this.config.autoGallerySelector=".product slider-component":this.config.autoPreviewSelector='.product slider-component:not([class*="thumb"]) ul li:first-child')),r=this._checkPersonalizeContainer(i),r)return r;const n=e=>{let i=document.querySelectorAll(e);if(i.length>0){if(i.length>1)for(let n=0;n<i.length;n++)if(r=i[n],dr.previewHiddenExclude&&o.isMinSize(r))a.warn("container preview found but hidden:",e,r);else{if(-1!==r.className.indexOf(t.id)||r.dataset.livePreview==t.id)break;if(t.media?.length&&-1!==r.innerHTML.indexOf(t.media[0].id))break}else r=i[0],dr.previewHiddenExclude&&o.isMinSize(r)&&(a.warn("container preview found but hidden:",e,r),r=null);a.debug("using container preview with provided selector:",e,r)}};let s=!0;if(e||(e='[data-live-preview="'+t.id+'"]',s=!1),n(e),s&&!r)return a.error("no container preview found with selector:",e),null;if(r||(i.previewConfig.gallery&&this.config.autoGallerySelector?n(this.config.autoGallerySelector):this.config.autoPreviewSelector&&(n(this.config.autoPreviewSelector),!r&&this.shopifyStore.isTheme("Dawn")&&n(".featured-product modal-opener"))),!r){let e;if(t.media&&t.media.length){let r=0;if(i.previewConfig&&i.previewConfig.layers.length)for(let e=0;e<i.previewConfig.layers.length;e++){const o=i.previewConfig.layers[e];if("product"===o.type){o.params.imgPos&&t.media.length>o.params.imgPos-1&&(r=o.params.imgPos-1);break}}e=t.media[r]}else t.featured_image&&(e={src:t.featured_image});if(e){let t=this.config.previewImgParent,i=this.config.previewImgParentSelector,n=o.pathBaseName(e.src,!1),s=[];if(this.config.previewImgMainSelector&&(s=document.querySelectorAll(this.config.previewImgMainSelector)),0===s.length&&(s=document.querySelectorAll('img[src*="'+n+'"], img[data-src*="'+n+'"], img[data-srcset*="'+n+'"]')),s.length&&dr.previewHiddenExclude&&(s=Array.prototype.filter.call(s,(function(e){return!o.isHidden(e)}))),s.length>0){if(a.debug("found main product images:",s),1===s.length)r=s[0];else{let e=Number.MAX_VALUE,t=-1;for(let i=0;i<s.length;i++){const a=s[i];let l=a.offsetWidth*a.offsetHeight;if(0===l&&a.src){let e=this.shopifyStore.parseImageDimension(a.src);l=e.x*e.y}let c=a.src&&0!==a.src.indexOf("data:")?a.src:null,p=o.pathBaseName(c||a.dataset.src||a.dataset.srcset||a.src,!1);p=this.shopifyStore.stripImageDimension(p);let d=p.replace(n,"").length;d<e?(e=d,t=l,r=a):d===e&&l>t&&(t=l,r=a)}}let e;if(a.debug("selected auto preview img:",r),i&&(e=o.findParent(r,i)),null!=e)r=e,a.debug("using auto preview container with parent selector:",i,r);else if(r){1===t&&(r.parentElement&&null!==r.parentElement.getAttribute("data-zoom")||-1!==r.parentElement.id.indexOf("Zoom")||-1!==r.parentElement.className.indexOf("modal"))&&(t=2);for(let e=0;e<t;e++)r=r.parentElement;a.debug("using auto preview container with parent:",t,r)}}else a.debug("failed to find main product image:",n)}}if(r){for(r.style.minHeight||(r.style.minHeight="1px");r.firstChild;)r.removeChild(r.lastChild);let e=document.querySelectorAll('[data-live-preview-hide="'+t.id+'"]');if(e.length)for(let t=0;t<e.length;t++){e[t].style.display="none"}}else a.warn("[live-options] no preview container found");return r}_checkPersonalizeContainer(e){for(let t=0;t<e.options.length;t++){const i=e.options[t];if("personalize"===i.type){if(i.params.popup){return document.createElement("div")}break}}return null}_getDiscount(){let e={type:mr.NONE};for(let t=0;t<this._cart.items.length;t++){const i=this._cart.items[t];i.discounts&&i.discounts.length&&(e.type=mr.AUTO,e.code=i.discounts[0].title)}if(0===e.type){let t=this.shopifyStore.getDiscountCode();t&&(e.type=mr.CODE,e.code=t)}return e}_watchFormSubmit(){this.shopifyStore.onCartFormSubmit((e=>{if(e.submitter&&e.submitter.name&&"update"===e.submitter.name)return;let t=JSON.stringify(this._cart),i=this.config.api+"/api/checkout/cart?shop="+this.config.shop;navigator.sendBeacon(i,t)}),dr.cartFormCapture)}_watchCartItems(){if(window.theme&&window.theme.Cart&&window.theme.Cart.prototype&&window.theme.Cart.prototype._setProductDetailsList){const e=window.theme.Cart.prototype._setProductDetailsList;window.theme.Cart.prototype._setProductDetailsList=function(t,i){e(t,i.filter((e=>e)))}}this._processCartItems();let e=o.debounced(1e3,(()=>this._processCartItems()));this._processPending=0;v.register((t=>{if(/.*cart.*/.test(t.url)){if((t.method&&"POST"===t.method.toString().toUpperCase()||-1!==t.url.indexOf("/cart/add")||-1!==t.url.indexOf("/cart/change"))&&delete this.shopifyCart.cache,this._processPending++,this._processPending>2)return this._processPending=0,void a.warn("[live-options] cart process skipped to avoid endless loop");e()}}));setTimeout((()=>e()),2e3)}_processCartItems(){return this.shopifyCart.getCart(!0).then((e=>{this._processPending=0,this._cart=e;for(let t=0;t<e.items.length;t++){let i=e.items[t];if(!this._processCartItem(e,i,t))return}this._checkDiscount(e),-1!==ur.moneyFormat.indexOf("class")&&window.dispatchEvent(new Event("resize"));let t=document.querySelectorAll("[data-live-enabled]");if(t.length)for(let e=0;e<t.length;e++){const i=t[e];!0===i.disabled&&(i.disabled=!1),"none"===i.style.display&&(i.style.display="block")}}))}_processCartItem(e,t,i){let r=t.quantity;if(t.properties){let i=!1;if((t.properties.hasOwnProperty(pr.OPTIONS)||t.properties.hasOwnProperty(pr.ID))&&(i=!0),i){if(ur.currencyConvert){let e=ko.getItem(t.properties[pr.ID]);e?.currency&&e.currency!==ur.currency&&(this._convertOptionsPriceProperties(e.properties),e.currency=ur.currency,ko.storeItem(t.properties[pr.ID],e))}let i=0;t.properties[pr.ID]&&t.properties.hasOwnProperty(pr.OPTIONS)&&t.properties[pr.PRICE]&&(i=parseInt(t.properties[pr.PRICE]));let n=this._resolveCartItemEl(e,t);0===n.length&&a.warn("[live-options] missing cart item element for: ",t);for(let e=0;e<n.length;e++){const i=n[e];if(t.properties.hasOwnProperty(pr.OPTIONS)||(r=0),i){let e="_preview",r=t.properties[e];if(!r&&dr.cartItemPreviewViews)for(const i in t.properties)if(t.properties.hasOwnProperty(i)&&i.startsWith(e)&&t.properties[i]){r=t.properties[i];break}if(r){let e=i.querySelector("[data-live-item-image]");if(!e&&dr.cartItemPreview){let r=o.pathBaseName(t.image,!1);e=i.querySelector('img[src*="'+r+'"], img[data-src*="'+r+'"], img[data-srcset*="'+r+'"]')}e&&(e.src=r,e.hasAttribute("srcset")&&e.removeAttribute("srcset"),e.hasAttribute("data-srcset")&&e.removeAttribute("data-srcset"),e.hasAttribute("data-src")&&e.removeAttribute("data-src"))}if(!window.Cloudlift.upload)for(const e in t.properties)if(t.properties.hasOwnProperty(e)){let r=t.properties[e];if("string"==typeof r&&-1!==r.indexOf("cloudlift.app")){let e=o.findElementContainsText("*",o.escapeRegex(r),i);if(e.length>0){let t=e[e.length-1],i=document.createElement("span");i.className="cl-prop",i.innerHTML=t.textContent.replace(r,'<a href="'+r+'" target="_blank" style="cursor:pointer;border:0;">'+l.get("product.options.file.link")+"</a>"),t.parentNode.replaceChild(i,t)}}}let n=i.querySelector("[data-live-item-edit]");if(!n&&dr.cartItemEdit){let e,r="afterend",s=[];for(let r in t.properties)if(t.properties.hasOwnProperty(r)){if("_"===r.charAt(0))continue;let n=o.findElementContainsRegex("*",new RegExp(`${o.escapeRegex(r)}.*${o.escapeRegex(t.properties[r])}`,"s"),i);if(n.length>0)if(s.length){for(let t=n.length-1;t>=0;t--){const i=n[t];if(-1!==s.indexOf(i)){e=i;break}}if(e)break}else s.push(...n)}if(!e&&s.length&&(e=s[s.length-1]),e||(e=i.querySelector('a[href*="/cart/change"]'),r="beforebegin"),null!=e){a.debug("---\x3e adding editBtn: "+r,e),n=document.createElement("a"),n.style.padding="5px 10px",n.style.border="1px solid #d1d5db",n.style.borderRadius="3px",n.innerText=l.get("product.options.item.edit"),n.dataset.liveItemEdit="1";let t=document.createElement("div");t.style.padding="10px 0",t.appendChild(n),e.insertAdjacentElement(r,t)}}if(n){a.debug("---\x3e using editBtn element",n);let e=t.url+"&item="+t.key;"A"===n.tagName?n.href=e:n.addEventListener("click",(()=>window.location.href=e))}if(dr.cartItemClOptions)for(let e in t.properties)if(t.properties.hasOwnProperty(e)&&e.startsWith(pr.OPTIONS)&&-1!==i.innerHTML.indexOf(e)){let r=o.findElementContainsRegex("*",new RegExp(`${e}.*${t.properties[e]}`,"s"),i);if(r.length>0){let i=r[r.length-1],o=!0;for(let e in t.properties)if(t.properties.hasOwnProperty(e)&&-1!==i.innerHTML.indexOf(e)){o=!1;break}if(o)i.parentNode.removeChild(i);else{let r=String(t.properties[e]),o=i.innerHTML.indexOf(e),n=i.innerHTML.indexOf(r)+r.length;i.innerHTML=i.innerHTML.replace(i.innerHTML.slice(o,n),"")}}}if(t.properties[pr.ID]&&t.properties.hasOwnProperty(pr.OPTIONS)&&dr.cartItemPriceOptions){let e=ko.getItem(t.properties[pr.ID]);if(e?.properties)for(let r in e.properties)if("_"!==r.charAt(0)&&e.properties.hasOwnProperty(r)&&t.properties.hasOwnProperty(r)){let n=o.findElementContainsRegex("*",new RegExp(`${o.escapeRegex(r)}.*${o.escapeRegex(t.properties[r])}`,"s"),i);if(n.length>0){let i=n[n.length-1],o=r.replace(/^[^a-zA-Z]+|[^\w]+/g,"");const s="p"+o.charAt(0).toUpperCase()+o.slice(1);if(!i.dataset[s]){a.debug("--\x3e found element to display options price for property: "+r,i);let o=t.properties[r];-1!==o.indexOf("&")&&-1!==i.innerHTML.indexOf("&amp;")&&(o=o.replace(/&/g,"&amp;")),i.innerHTML=i.innerHTML.replace(o,o+" | "+e.properties[r]),i.dataset[s]="1"}}}}}else t.properties.hasOwnProperty(pr.OPTIONS)&&a.debug("--\x3e no cart item node found for item: ",t)}}}return!0}_resolveCartItemEl(e,t){let i=[],r=['[data-live-item-key="'+t.key+'"]','[data-line-item-key="'+t.key+'"]','[data-cart-item-key="'+t.key+'"]',".cart_item_"+t.id];for(let e=0;e<r.length;e++){const t=r[e];if(i=document.querySelectorAll(t),i.length)return i}if(t.image&&dr.cartItem){let i;a.debug("--\x3e [cart-item] image fallback ",t);let r=o.pathBaseName(t.image,!1),n=['img[src*="'+r+'"]','img[data-src*="'+r+'"]','img[data-srcset*="'+r+'"]'];if(this.config.itemImgParentSelector){let e=this.config.itemImgParentSelector.split(","),t=[];for(let i=0;i<e.length;i++){const r=e[i];for(let e=0;e<n.length;e++){const i=n[e];t.push(r+" "+i)}}n=t}let s=document.querySelectorAll(n.join(","));if(s.length>0){for(let r=0;r<s.length;r++){const n=s[r];if(this.config.itemImgParentSelector){let e=o.findParent(n,this.config.itemImgParentSelector);if(e&&!e.dataset.liveItemKey)return e.dataset.liveItemKey=t.key,a.debug("resolved cart item node via parent selector ",this.config.itemImgParentSelector,e),[e]}let l=o.findParent(n,"form");if(!l){if(1===s.length)return i=s[0].parentNode,i.dataset.liveItemKey=t.key,[i];continue}let c=n;for(;c!==l;){if(-1!==c.innerHTML.indexOf(t.key)){let i=!0;if(e.items.length>1)for(let r=0;r<e.items.length;r++){const o=e.items[r];if(o!==t&&-1!==c.innerHTML.indexOf(o.key)){i=!1;break}}if(i)return c.dataset.liveItemKey=t.key,a.debug("auto resolved cart item node ",c),[c];break}c=c.parentElement}}let r=s[0];i=o.findParent(r,"tr")||o.findParent(r,"li")||o.findParent(r,"div")||r.parentNode,i.dataset.liveItemKey=t.key,a.debug("fallback cart item parent ",i)}return[i]}return i}_checkDiscount(){if(this._discountEl=document.querySelector("[data-live-discount]"),!this._discountEl&&dr.cartDiscount){if(this.shopifyStore.isTheme("Dawn")){let e=document.querySelector(".cart__blocks, .drawer__footer");e&&(this._discountEl=document.createElement("div"),this._discountEl.dataset.liveDiscount="",e.insertBefore(this._discountEl,e.firstChild))}if(!this._discountEl){let e=this.shopifyStore.trimMoneyFormatAmount(ur.moneyFormat),t=this._findPriceEl('form[action*="/cart"]:not(form[action*="/cart/add"]) *, form[action*="/checkout"] *',this._cart.total_price,e);if(t){let e=t.parentNode;for(;e;){if("P"!==e.tagName){let t=getComputedStyle(e).display;if("block"===t||"flex"===t){this._discountEl=document.createElement("div"),this._discountEl.dataset.liveDiscount="1",e.insertBefore(this._discountEl,e.firstChild);break}}e=e.parentNode}}}}if(null!=this._discountEl){let e=this._getDiscount();if(e.type===mr.AUTO&&(e.valid=!0,delete this._discount),!this._discount||this._discount.code!==e.code){if(this._discount=e,this._discountInput={code:"",loading:!1,button:l.get("product.options.discount.button"),placeholder:l.get("product.options.discount.placeholder")},this._discount.type!==mr.NONE){if(window.localStorage){let e=localStorage.getItem("cl_discount");if(e){let t=JSON.parse(e);t.code===this._discount.code&&(this._discount=t)}}this._discount.valid||(this._discountInput.code=this._discount.code,this._applyDiscount())}let t='form[action*="/cart"]:not(form[action*="/cart/add"]):not([id="cart-notification-form"]), form[action*="/checkout"]',i=o.findParent(this._discountEl,t);if(!i&&(i=document.querySelector(t),i)){let e=i.getAttribute("id");e&&(this._discountInput.cartFormLink=e)}}this._renderDiscount()}}_removeDiscount(e){e&&(e.preventDefault(),e.stopImmediatePropagation()),this._discount.type=mr.NONE,this._discount.code="",this._discount.valid=!1,this.shopifyStore.removeDiscountCode(),this._renderDiscount()}_applyDiscount(e){if(e&&(e.preventDefault(),e.stopImmediatePropagation()),!this._discountInput.code)return;this._discount.type=mr.CODE,this._discount.code=this._discountInput.code,this._discount.valid=!1,this._discountInput.loading=!0,this._discountInput.error="",this._discountInput.success="";let t=[];for(let e=0;e<this._cart.items.length;e++){const i=this._cart.items[e];let r=this.shopifyCart.toItem(i.id,i.quantity,i.properties);r.productId=i.product_id,t.push(r)}const i={items:t,discount:this._discount,currency:this._cart.currency,country:window.Shopify?window.Shopify.country:void 0};let r=new n(this.config.api+"/api/checkout/discount",{method:"POST",data:{checkout:i},responseType:"json",headers:{"Content-type":"application/json"},queryParams:{shop:this.config.shop}});return this._renderDiscount(),r.then((e=>{this._discountInput.loading=!1,e.data?(this._discount=e.data,this._discount.valid=!0,this._discountInput.code="",window.localStorage&&localStorage.setItem("cl_discount",JSON.stringify(this._discount)),this.shopifyStore.saveDiscountCode(this._discount.code),this._discountInput.success=l.get("product.options.discount.valid")):this._discountInput.error=l.get("product.options.discount.invalid"),this._renderDiscount(),a.debug("[live-options-api] checkout discount response",e.data)})).catch((e=>{this._discountInput.loading=!1,this._discountInput.error="Please try again",this._renderDiscount(),a.error("[live-options-api] checkout discount error",e)}))}_renderDiscount(){var e,t,i,r,o;ee((e=this._discount,t=this._discountInput,i=this._applyDiscount.bind(this),r=this._removeDiscount.bind(this),o=e=>{this._discountInput.code=e.target.value,this._discountInput.error&&(this._discountInput.error="",this._renderDiscount())},te`
    
    ${e.type!==mr.AUTO?te`
    <div class="cl-po--discount">
        <div class="cl-po--discount-input">
            <input type="text" placeholder=${t.placeholder} class="${Mi({"cl-po--invalid":t.error})}" .value=${Fi(t.code)} @input=${e=>o(e)} />
            <button @click=${e=>i(e)}>
                ${t.loading?te`<svg class="cl-po--icon loading" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M20 10c0 5.523-4.477 10-10 10S0 15.523 0 10 4.477 0 10 0v2c-4.418 0-8 3.582-8 8s3.582 8 8 8 8-3.582 8-8h2z"></path></svg>`:t.button}
            </button>
        </div>
        ${t.error?te` <p class="cl-po--discount-error">${t.error}</p>`:null}
       
        ${e.valid?te`
        <div class="cl-po--discount-wrap">
            <input type="hidden" name="discount" .value=${Fi(e.code)} form=${Ai(t.cartFormLink)} />
            
            <div class="cl-po--discount-tag">
                <svg class="cl-po--icon tag" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18"><path d="M17.78 3.09C17.45 2.443 16.778 2 16 2h-5.165c-.535 0-1.046.214-1.422.593l-6.82 6.89c0 .002 0 .003-.002.003-.245.253-.413.554-.5.874L.738 8.055c-.56-.953-.24-2.178.712-2.737L9.823.425C10.284.155 10.834.08 11.35.22l4.99 1.337c.755.203 1.293.814 1.44 1.533z" fill-opacity=".55"></path><path d="M10.835 2H16c1.105 0 2 .895 2 2v5.172c0 .53-.21 1.04-.586 1.414l-6.818 6.818c-.777.778-2.036.782-2.82.01l-5.166-5.1c-.786-.775-.794-2.04-.02-2.828.002 0 .003 0 .003-.002l6.82-6.89C9.79 2.214 10.3 2 10.835 2zM13.5 8c.828 0 1.5-.672 1.5-1.5S14.328 5 13.5 5 12 5.672 12 6.5 12.672 8 13.5 8z"></path></svg>
                <span>${e.code}</span>
                <button @click=${e=>r(e)}>
                    <svg class="cl-po--icon remove" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 13 13"><path d="M1.5 1.5l10.05 10.05M11.5 1.5L1.45 11.55" stroke-width="2" fill="none" fill-rule="evenodd" stroke-linecap="round"></path></svg>
                </button>
            </div>
    
            ${t.success?te` <p class="cl-po--discount-success">${t.success}</p>`:null}
        </div>
        `:null}
    </div>
    `:null}
`),this._discountEl)}_findPriceEl(e,t,i,r){let n,s=cr(t,i);return n=0===t||dr.cartPriceRegex?o.findElementContainsRegex(e,new RegExp(`[^0-9]${s}[^0-9]`,"s"),r):o.findElementContainsText(e,s,r),0===n.length&&(a.debug("no price elements found for price:",s,r),dr.amountNoDecimals&&(s=cr(t,"{{ amount_no_decimals }}"),a.debug("fallback {{ amount_no_decimals }} price: ",s,r),n=o.findElementContainsText("*",s,r))),n.length?n[n.length-1]:null}_convertOptionsPriceProperties(e){for(let t in e)if("_"!==t.charAt(0)&&e.hasOwnProperty(t)&&e.hasOwnProperty("_"+t)){let i=parseInt(e["_"+t]);i=hr(i),e[t]=cr(100*i,ur.moneyFormat).replace(/(<([^>]+)>)/gi,"")}}_watchQuickView(){let e=["[data-live-quick-view]",".quick-add__submit"].join(",");document.addEventListener("click",(t=>{t.target&&o.matchesIncludeParent(t.target,e)&&setTimeout((()=>{this.setup(!0)}),1e3)}),{capture:!0})}_compatible(){const e=e=>`[Live Product Options] found incompatible app: ${e} \n**Please reach out to our app support to check your theme**`,t=t=>this.shopifyStore.isThemeEditor()?alert(e(t)):console.error(e(t));"undefined"!=typeof cst_money_formate?t("Customify"):null!==document.querySelector('script[src*="options.ymq"]')?t("YMQ Product Options"):null!==document.querySelector('script[src*="customily"]')&&t("Customily")}constructor(e){this.config=e,this.products=[];let t={};if(l.locale&&String.prototype.startsWith&&window.location.pathname.toLowerCase().startsWith("/"+l.locale.toLowerCase())&&(t.api="/"+l.locale.toLowerCase()),window.Shopify&&window.Shopify.routes&&window.Shopify.routes.root&&"/"!==window.Shopify.routes.root){let e=window.Shopify.routes.root;t.api="/"===e[e.length-1]?e.substr(0,e.length-1):e}if(this.shopifyStore=h.getInstance({api:t.api}),this.shopifyCart=g.getInstance(t),this.conditionsEngine=new yo,this.currency=ur,this.config.theme)for(let e in this.config.theme)this.config.theme.hasOwnProperty(e)&&(dr[e]=this.config.theme[e]);this.config.themeId&&window.Shopify&&window.Shopify.theme&&window.Shopify.theme.id&&this.config.themeId!==window.Shopify.theme.id.toString()&&(a.debug("--\x3e theme.id config does not match - reseting custom selectors ",this.config.themeId,window.Shopify.theme.id.toString()),delete this.config.previewImgMainSelector,delete this.config.previewImgThumbnailSelector,delete this.config.itemImgParentSelector),this.shopifyStore.isTheme("Dawn")&&(dr.themeGallery=void 0===this.config.theme.themeGallery||this.config.theme.themeGallery,dr.productPriceObserver=!0,this.config.itemImgParentSelector=".cart-notification, .cart-item"),window.theme&&window.theme.settings&&window.theme.settings.superScriptPrice&&(dr.amountNoDecimals=!0);for(let e in this.config.currencyFormats)if(this.config.currencyFormats.hasOwnProperty(e)){let t=this.config.currencyFormats[e];-1!==t.indexOf("&")&&(t=o.decodeHtml(t)),"moneyWithCurrencyFormat"===e&&(e="moneyFormatWithCurrency"),ur[e]=t}if(ur.priceVariant=!this.config.priceDraft,ur.priceVariantId=this.config.priceVariantId,ur.priceVariantValue=this.config.priceVariantValue,ur.priceProductHandle=this.config.priceProductHandle,ur.currencyConvert=window.theme&&Array.isArray(window.theme.currencies)?window.theme.currencies.length>1:this.config.currencyConvert,window.Shopify&&window.Shopify.currency&&(ur.currency=window.Shopify.currency.active,ur.currencyConvert)){let e=parseFloat(window.Shopify.currency.rate);isNaN(e)||1===e||(ur.currencyFactor=e)}if(ur.currencyConvert||-1===ur.moneyFormat.indexOf("<")||-1===ur.moneyFormat.indexOf(">")||(dr.currencyFormat=!1),dr.currencyFormat&&window.theme&&window.theme.moneyFormat&&(ur.moneyFormat=window.theme.moneyFormat,ur.moneyFormatWithCurrency=window.theme.moneyFormatWithCurrency||window.theme.moneyFormat),dr.priceVisibleCustomer&&this.config.setup&&(dr.priceVisible=null!==this.shopifyStore.getCustomerId()),this.config.checkout&&this.config.checkoutConfig&&(ur.priceVariant=!1,ur.checkout=this.config.checkoutConfig),e.extensions){let t=e.extensions.split(",");for(let e=0;e<t.length;e++){const i=t[e];fr[i.toUpperCase()]=!0}}this.config.css&&o.addStyleElement(this.config.css),this.config.js&&o.addScriptElement(this.config.js),this.config.setup&&(/complete|interactive|loaded/.test(document.readyState)?this.setup():(a.debug("---\x3e document not ready ("+document.readyState+") => waiting for DOMContentLoaded"),document.addEventListener("DOMContentLoaded",(()=>this.setup()),!1)),this.shopifyStore.onThemeSectionEvent("load",(e=>{this.setup()})))}};
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const Ro=(e=!1)=>{if(!e&&"content"in document.createElement("template"))return;const t=document.implementation.createHTMLDocument("template"),i=t.body,r={enumerable:!0,configurable:!0},o=Document.prototype.createElement;Document.prototype.createElement=function(e,n){const a=o.call(this,e,n);return"TEMPLATE"===a.tagName&&(e=>{const o=t.createDocumentFragment();Object.defineProperties(e,{content:Object.assign(Object.assign({},r),{get:()=>o}),innerHTML:Object.assign(Object.assign({},r),{set:function(e){i.innerHTML=e,C(o,o.firstChild),x(o,i.firstChild)}})})})(a),a}};let Vo=()=>{Ro();const e=window.Cloudlift.options.config;a.setDefaultLevel(a.levels.ERROR);let t=a.getLevel();a.setLevel(void 0!==e.log?e.log:t),a.debug("got config",e),window.addEventListener("cloudlift.options.ready",(e=>{a.debug("resources loaded")}));const i=-1===e.api.indexOf("local")?e.api.replace("api.","assets."):e.api;d.fonts=e.fonts,d.api=i+"/api/font",d.apiParams.shop=e.shop,l.translations=e.i18n||{},e.setup?window.clTranslate?l.translations=o.extend(l.translations,window.clTranslate):(l.api=i+"/api/assets/"+e.app+"/translate/{locale}?shop="+e.shop,l.event+="."+e.app,l.locale&&e.locale&&l.locale!=e.locale&&l.fetch(l.locale)):(window.Translate=l,window.FontLoader=d),window.Cloudlift.options.lib={ProductOptions:No,ProductPreview:Oo},l.ready.then((()=>{window.Cloudlift.options.App=new jo(e)}))};"Promise"in window&&"assign"in Object&&String.prototype.startsWith&&Array.prototype.flat?Vo():e(Lr)(window.Cloudlift.options.config.assets+"/static/lib/core-js/core-js.min.js",Vo)}();